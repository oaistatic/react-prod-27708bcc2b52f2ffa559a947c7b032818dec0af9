var q=Object.freeze,K=Object.defineProperty;var A=(s,r)=>q(K(s,"raw",{value:q(r||s.slice())}));import{e as G,a as I,r as b,i as O,b as W,j as e,M as h,u as H,d as V}from"./fg33krlcm0qyi6yw.js";import{I as Z,b as J,P as w,C as X,a9 as Y,F as $,m as z,R as B,T as ee,g2 as j}from"./mtk1qztvnb31pw5r.js";import{d5 as se,d6 as te,d7 as Q,d8 as L,cV as ae,cL as re,d9 as ne,cw as oe,da as ie}from"./k65njl5wlgspihfr.js";import{T as M}from"./hcn3kohxpjzaoxwc.js";import{M as le,R as de,t as me}from"./exbyaee45o0onuld.js";import"./ifr23omr9d78ntp2.js";function ce({gizmo:s,memory:r}){var p;const i=G(),l=z(),d=I(),{mutate:t,isPending:m}=H({mutationFn:async u=>{const{success:v}=await B.safeDelete("/memories/{memory_id}",{parameters:{path:{memory_id:u}},requestBody:{gizmo_id:s==null?void 0:s.id}});if(!v)throw new Error("An error occurred while deleting the memory")},onSettled:()=>{d.invalidateQueries({queryKey:Q(s==null?void 0:s.id)}),d.invalidateQueries({queryKey:L()})},onError:()=>{l.danger(V({id:"MemoriesModal.deleteFailed",defaultMessage:"Failed to forget memory"}),{id:"memoryDeleteFailed",toastId:"memory_delete_failed"})}}),[n,c]=b.useState(!1),y=i.formatMessage({id:"N0czuB",defaultMessage:"Remove"});return e.jsxs(e.Fragment,{children:[e.jsxs(M.Row,{disabled:m,children:[e.jsx(M.Cell,{children:e.jsx("div",{className:"py-2 whitespace-pre-wrap",children:r.content})}),e.jsx(M.Cell,{textAlign:"right",children:e.jsx(M.Actions,{children:e.jsx("button",{onClick:()=>{w.logEvent("Memory Manage Modal Memory Delete Clicked"),c(!0)},"aria-label":y,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(ee,{className:"leading-none",label:y,side:"top",children:e.jsx(re,{className:"icon-sm"})})})})})]}),n&&e.jsx(ne,{isOpen:!0,primaryButtonColor:"danger",title:y,confirmText:i.formatMessage({id:"fCn0ar",defaultMessage:"Forget"}),onConfirm:()=>{w.logEvent("Memory Manage Modal Memory Delete Confirmed"),t(r.id),c(!1)},onClose:()=>{c(!1)},children:e.jsx(h,{id:"j2cZHW",defaultMessage:'Remove "{title}" from {name}’s saved memories. This can’t be undone. <link>Learn more</link>',values:{name:(p=s==null?void 0:s.name)!=null?p:"ChatGPT",title:e.jsx("strong",{children:me(r.content,{length:130,omission:"..."})}),link:u=>e.jsx("a",{href:"https://help.openai.com/en/articles/8590148-memory-faq",target:"_blank",className:"underline",rel:"noreferrer",children:u})}})})]})}function ue({selectedGizmoId:s,onSelect:r,items:i}){const l=i.find(t=>t.id===s);function d(t){var m;return e.jsx(ie,{isFirstParty:t.id===void 0,src:(m=t.iconUrl)!=null?m:null,className:"icon"})}return e.jsx("div",{className:"border-token-border-medium mb-2 inline-flex rounded-md border",children:e.jsxs(j.Root,{children:[e.jsx(j.Trigger,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[l?e.jsxs(e.Fragment,{children:[d(l),e.jsx("span",{className:"text-token-text-primary",children:l.name})]}):e.jsx(h,{id:"MemoriesModal.unknownGizmo",defaultMessage:"Unknown GPT"}),e.jsx(oe,{className:"icon-sm text-token-text-tertiary"})]})}),e.jsx(j.Portal,{children:e.jsx(j.Content,{children:i.map(t=>e.jsxs(j.Item,{className:"flex items-center gap-3",onClick:()=>{r(t.id)},children:[d(t),t.name]},t.id))})})]})})}var D;const T=$.div(D||(D=A(["flex h-full items-center justify-center pb-8 text-sm text-token-text-tertiary rounded-lg border border-token-border-default"])));function pe({onClose:s,initialGizmoId:r,contextScopes:i,requiredContextScopes:l}){var F,E,R;const d=G(),t=I(),m=se(),[n,c]=b.useState(r),y=J(),p=O(),u=Z(y),v=u==null?void 0:u.hasPlusFeatures();b.useEffect(()=>{w.logEvent("Memory Modal Shown")},[]);const{data:x,isLoading:C,isError:N,refetch:_}=te(n,!0,m,i,l),f=x==null?void 0:x.memories,{data:k,refetch:U}=W({queryKey:["memory_gizmos"],queryFn:()=>B.safeGet("/memories/gizmos"),refetchOnMount:"always"}),P=[{id:void 0,name:"ChatGPT",iconUrl:null},...(F=k==null?void 0:k.items.map(({gizmo:a})=>{var S;return{id:a.id,name:a.display.name,iconUrl:(S=a.display.profile_picture_url)!=null?S:null}}))!=null?F:[]],o=P.find(a=>a.id===n);b.useEffect(()=>{!C&&!N&&n!==void 0&&(!f||f.length===0)&&c(void 0)},[C,N,f,n]);let g;return C?g=e.jsx(T,{children:e.jsx(h,{id:"MemoriesModal.loading",defaultMessage:"Loading..."})}):N?g=e.jsx(T,{children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(h,{id:"MemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."})}),e.jsx("div",{children:e.jsx(Y,{color:"secondary",onClick:()=>{_()},children:e.jsx(h,{id:"MemoriesModal.retry",defaultMessage:"Retry"})})})]})}):!f||f.length===0?g=e.jsx(T,{children:e.jsx("div",{className:"max-w-sm text-center",children:m?e.jsx(h,{id:"MemoriesModal.noMemories.1",defaultMessage:"As you chat with {name}, the details and preferences it saves will be shown here.",values:{name:(E=o==null?void 0:o.name)!=null?E:"ChatGPT"}}):e.jsx(h,{id:"MemoriesModal.noMemoriesAndDisabled",defaultMessage:"Memory is disabled. ChatGPT won't use or save memories."})})}):g=e.jsx(M.Root,{className:"border-token-border-default h-full",size:"compact",bordered:!0,children:e.jsx(M.Body,{children:f.map(a=>e.jsx(ce,{gizmo:o?{id:o.id,name:o.name}:void 0,memory:a},a.id))})}),e.jsxs(X,{testId:"modal-memories",isOpen:!0,onClose:s,size:"custom",className:"max-w-5xl",type:"success",title:d.formatMessage({id:"MemoriesModal.title",defaultMessage:"Saved memories"}),showCloseButton:!0,children:[v&&P.length>1&&e.jsx("div",{className:"mb-4",children:e.jsx(ue,{selectedGizmoId:n,items:P,onSelect:a=>{t.invalidateQueries({queryKey:Q(a)}),t.invalidateQueries({queryKey:L()}),c(a)}})}),e.jsx(le,{memoryFullPct:x==null?void 0:x.memoryFullPct,isPaid:v,showUpgradeCTA:!1,onUpgrade:()=>{w.logEventWithStatsig("Memories Upgrade Button Clicked","chatgpt_memories_upgrade_button_clicked_settings"),ae(p,"chatgpt_memories_upgrade_button")},className:"mb-5"}),e.jsx("div",{className:"h-[24rem]",children:g}),e.jsx("div",{className:"mt-5 flex justify-end",children:e.jsx(de,{onReset:()=>{_(),U(),n&&c(void 0)},gizmoId:n,memoryName:(R=o==null?void 0:o.name)!=null?R:"ChatGPT",contextScopes:i,requiredContextScopes:l})})]})}export{pe as default};
//# sourceMappingURL=iwjq7ihlx67l3ajk.js.map
