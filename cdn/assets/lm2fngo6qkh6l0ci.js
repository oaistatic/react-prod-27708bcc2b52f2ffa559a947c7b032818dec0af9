var J=Object.defineProperty,ee=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var V=(a,t,s)=>t in a?J(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s,C=(a,t)=>{for(var s in t||(t={}))se.call(t,s)&&V(a,s,t[s]);if(W)for(var s of W(t))oe.call(t,s)&&V(a,s,t[s]);return a},b=(a,t)=>ee(a,ne(t));import{e as te,r as g,j as e,M as h}from"./fg33krlcm0qyi6yw.js";import{bb as ce,mN as ae,d as f,gY as ie,b as le,gZ as re,bR as de,gW as ue,bo as pe,bB as xe,si as ge,c0 as X,o_ as k,bq as Y,bt as I,sj as fe,bZ as Z,bU as q,b3 as _e,Z as me,C as ye,aY as Ce,l as Q,a9 as H}from"./mtk1qztvnb31pw5r.js";import{dG as be,fn as he,cX as ke,ca as Ne,ao as ve}from"./k65njl5wlgspihfr.js";function Me({onClose:a,onContinue:t}){const s=le(),w=ce(),N=te(),{openSettings:A}=be(),_=ae(),[v,K]=g.useState(!1),r=f(()=>ie(s)),E=!r,d=f(()=>re(s)),R=d===void 0,{mutateAsync:L,isPending:P,isSuccess:j}=de(),u=f(()=>ue(s)),p=f(()=>{var n;return(n=pe(s,{}).data)==null?void 0:n.connectors}),D=p===void 0,x=f(()=>xe(s,{fetchValidLinksOnly:!0}).data),G=x===void 0,U=g.useMemo(()=>{const n=new Set(r==null?void 0:r.map(c=>c.type)),m=new Set(d==null?void 0:d.map(c=>"".concat(c.user_connection_details.connection_type))),i=new Set(ge().filter(c=>n.has(c)||m.has(c)));return Array.from(i).slice(0,5)},[r,d]),S=g.useMemo(()=>{var m;const n=[];if(E||D||G||R)return Array.from({length:5},(i,c)=>({icon:e.jsx(X,{}),label:"",key:"loading-"+c,connected:!1,onClick:void 0,loading:void 0}));for(const i of U){const c=r.find(o=>o.type===i);if(c){const o=u!=null&&u.has(c.type);n.push({icon:e.jsx(he,{connector:c,size:"small"}),label:c.name,key:c.type,connected:o,onClick:o?void 0:()=>{_({connectorId:c.id,noRedirect:!0})},loading:void 0})}const l=[...d].find(o=>i===k.notion_sync_connector?o.user_connection_details.connection_instance_id.startsWith("ks--merge")&&o.user_connection_details.connection_type===i:o.user_connection_details.connection_type===i);if(l){const o=["partially_activated","activated","activating"].includes(l.user_connection_details.activation_status),y={icon:e.jsx("img",{src:w&&l.connection_display_info.icon_dark_url?l.connection_display_info.icon_dark_url:(m=l.connection_display_info.icon_url)!=null?m:"",alt:l.connection_display_info.display_name,className:"icon-lg"}),label:l.connection_display_info.display_name,key:l.user_connection_details.connection_type,connected:o,loading:void 0};i===k.notion_sync_connector?n.push(b(C({},y),{connected:o||!!(u!=null&&u.has(I.NOTION_CONNECTOR)),onClick:o?void 0:()=>{_({connectorId:Y[I.NOTION_CONNECTOR],noRedirect:!0,syncOnly:!0})}})):i===k.slack_sync_connector?n.push(b(C({},y),{connected:o||v,label:"Slack",onClick:o||v?void 0:async()=>{const{success:T}=await fe({connectorType:"slack",connectionId:l.user_connection_details.connection_instance_id,location:"user_nux_modal",intl:N});T&&(K(!0),setTimeout(()=>{Z(s)},1e3))}})):i===k.gdrive_sync_connector?n.push(b(C({},y),{connected:o||j,loading:P,label:"Google Drive",onClick:o||j?void 0:async()=>{var B,F;const T=(B=p==null?void 0:p.find(M=>M.id===q))==null?void 0:B.id,z=(F=x==null?void 0:x.get(q))==null?void 0:F.find(M=>M.connector_id===T);z?(await L({link:z,referrer:"glaux_nux_modal"}),setTimeout(()=>{Z(s)},1e3)):_({connectorId:Y[I.GDRIVE_ACTION_CONNECTOR],noRedirect:!0})}})):n.push(y)}}return n.push({icon:e.jsx(ke,{className:"icon-lg"}),label:N.formatMessage({id:"+rj0FA",defaultMessage:"More apps"}),key:"more-apps",onClick:()=>{A(_e.Connectors)}}),n},[s,E,D,G,R,N,U,r,d,u,_,w,v,j,P,p,x,L,A]),O=g.useMemo(()=>S.filter(n=>n.connected),[S]),$=g.useCallback(()=>{me.setItem("oai/apps/connectors/glauxOnboarding",new Date().getTime()),a(!1),t()},[t,a]);return e.jsxs(ye,{className:"max-w-[480px] pb-8",hideSeparator:!0,isOpen:!0,onClose:()=>a(!1),showCloseButton:!1,testId:"modal-glaux-nux",type:"success",children:[e.jsx("div",{className:"flex justify-end pb-6",children:e.jsx(Ce,{onClick:()=>a(!1)})}),e.jsxs("div",{className:"flex flex-col px-8",children:[e.jsx("div",{className:"text-center text-2xl font-semibold",children:e.jsx(h,{id:"uXSq7y",defaultMessage:"Enable internal knowledge"})}),e.jsx("div",{className:"text-token-text-secondary mt-2 text-center",children:e.jsx(h,{id:"KyWNjA",defaultMessage:"Connect these apps for the best experience"})}),e.jsx("div",{className:"grid grid-cols-3 gap-2 py-10",children:S.map(n=>e.jsxs("div",{className:Q("border-token-border-secondary flex grow flex-col gap-2 rounded-xl border p-3",n.onClick?"hover:bg-token-bg-tertiary cursor-pointer":""),onClick:n.onClick,children:[e.jsxs("div",{className:"flex w-full items-center justify-between gap-2",children:[e.jsx("div",{className:"h-6 w-6",children:n.icon}),typeof n.connected=="boolean"?e.jsx("div",{className:"bg-token-bg-tertiary h-5 w-5 rounded-full",children:e.jsx("div",{className:Q("flex h-full w-full items-center justify-center rounded-full",n.connected?"bg-blue-400":"bg-token-bg-tertiary"),children:n.loading?e.jsx(X,{}):n.connected?e.jsx(Ne,{className:"icon-xs fill-white"}):e.jsx(ve,{className:"icon-xs"})})}):null]}),e.jsx("div",{className:"text-token-text-secondary mt-3 line-clamp-1 text-sm",children:n.label})]},n.key))}),e.jsx("div",{className:"flex flex-col gap-3",children:O.length<5&&O.length>0?e.jsx(H,{onClick:$,size:"large",children:e.jsx(h,{id:"vec4yt",defaultMessage:"Continue with limited apps"})}):e.jsx(H,{disabled:O.length<5,onClick:$,size:"large",children:e.jsx(h,{id:"MCrtpI",defaultMessage:"Continue"})})})]})]})}export{Me as GlauxNuxModal};
//# sourceMappingURL=lm2fngo6qkh6l0ci.js.map
