var Me=Object.defineProperty,je=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var ce=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var ue=(a,t,l)=>t in a?Me(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,r=(a,t)=>{for(var l in t||(t={}))Ie.call(t,l)&&ue(a,l,t[l]);if(ce)for(var l of ce(t))we.call(t,l)&&ue(a,l,t[l]);return a},J=(a,t)=>je(a,Ce(t));import{e as se,r as d,j as e,M as E,f as Se,a as ye,u as ke}from"./fg33krlcm0qyi6yw.js";import{T as Re,a9 as q,nW as Ne,l as z,ck as ve,b as xe,H as he,P as $,t as de,jW as Te,es as pe,e as Ae,R as _e}from"./mtk1qztvnb31pw5r.js";import{cJ as De,cK as Ve,z as Fe,an as F,cL as Le,y as Be,ao as We,cM as Pe,cN as Oe,cO as ze,V as ne}from"./k65njl5wlgspihfr.js";import{T as _}from"./hcn3kohxpjzaoxwc.js";import{E as He}from"./l7qr5j8e9lh3l959.js";import{I as Ue}from"./dtmrhhn0qnqwrc6e.js";import{c as Ke,d as qe}from"./efooahjtdr85x1lo.js";const be=25,me=[],ge=a=>{const t=a.trim();if(!ne.test(t))return null;const[,l=""]=t.split("@");return l.toLowerCase()||null},$e=({workspace:a,onSuccess:t,seatCount:l,k12InviteDomain:M})=>{"use no forget";var ie;const f=se(),o=xe(),m=ve(o),g=he(),C=a.isOwnerOfAccount(),[y,I]=d.useState(!1),x=d.useRef(null),[N,b]=d.useState(!1),[h,T]=d.useState(!0),[j,w]=d.useState(!1),[u,S]=d.useState([]),[R,A]=d.useState([]),[D,L]=d.useState(l?Array(l).fill(""):[]),{mutateAsync:Z}=Je(a.id,t),W=Oe(),G=(ie=ze())!=null?ie:!0,[le,ee]=d.useState(me),k=d.useMemo(()=>g==null?void 0:g.subscriptionAnalyticsParams,[g]);d.useEffect(()=>{if(!(u!=null&&u.length)){ee(me);return}const c=new Set;if(a.isK12()&&M){const s=M.toLowerCase();u.forEach(({email:i})=>{const p=i.toLowerCase();!p.endsWith("@".concat(s))&&p.includes("@")&&c.add(i)})}if(!G&&(W!=null&&W.length)){const s=W.map(i=>"@"+i.hostname.toLowerCase());u.map(({email:i})=>i.toLowerCase()).filter(i=>!s.some(p=>i.endsWith(p))).forEach(i=>c.add(i))}const v=Array.from(c);ee(v.length?v:me)},[W,G,u,M,a]);const B=ea(C),H=d.useMemo(()=>{var v;const c=a.isFreeWorkspace()?"owner":"member";return(v=B[c])!=null?v:B.member},[B,a]),P=d.useCallback(c=>{const v={numEmailsAdded:c,uploadType:"Bulk"};$.logEvent("Account Pay: Collaborator Emails Added",r(r({},k),v))},[k]),oe=d.useCallback(async c=>{var s;b(!0);const v=(s=c.target.files)==null?void 0:s[0];if(v){const i=await Ze(v,B,H,y,a.isFreeWorkspace());i.status==="success"?(S(i.newRows),A(i.newRows.map(p=>({label:p.email,value:p.email,isValid:ne.test(p.email)}))),I(i.hasWarning),P(i.newRows.length),c.target.files=null):i.reason==="file_too_large"?m.danger(f.formatMessage(n.fileTooLargeWarning,{maxSize:"".concat(be,"MB")}),{duration:5,loggingTitle:"CSV Upload: File too large"}):i.reason==="invalid_file_type"&&m.danger(f.formatMessage(n.fileIncorrectTypeWarning),{duration:5,loggingTitle:"CSV Upload: File incorrect type",toastId:"csv_upload",loggingDescription:n.fileIncorrectTypeWarning.defaultMessage})}},[B,H,f,y,m,P,a]),ae=(c,v,s)=>{const i=[...u];i[c]=J(r({},i[c]),{[v]:s}),S(i)},Y=d.useCallback(c=>{$.logEvent("Account Pay: Add Collaborators Modal Clicked",r(r({},k),c))},[k]),Q=d.useCallback(()=>{$.logEvent("Account Pay: Add Collaborators Upload Clicked",k)},[k]),te=d.useCallback(()=>{$.logEvent("Account Pay: Collaborator Email Removed",k)},[k]),re=c=>{const v=[...u.slice(0,c),...u.slice(c+1)];S(v),te()},V=d.useCallback(()=>{S([]),w(!1),A([])},[]),U=d.useCallback(async()=>{w(!0);try{u.length>5&&m.info(f.formatMessage(n.inviteMessageLoading,{numRows:u.length}),{hasCloseButton:!0});const c=[["admin",de.ADMIN],["owner",de.OWNER],["member",de.STANDARD]],s=(await Promise.all(Te(c.map(([i,p])=>{const K=u.filter(O=>O.role===i).map(O=>O.email);return K.length>0&&Z({emails:K,role:p,resendEmails:h})})))).flat().length;s>0&&m.success(f.formatMessage(n.inviteSuccessToast,{numRows:s,userStr:s===1?"user":"users",workspaceName:Ke(f,a)})),pe(o,"chatgpt_invite_users_to_workspace",u.length,{action:"SubmitEmails",location:"modal-submit-button",text:"Submit",step:"AdminModal-CollectEmails-Submit"}),t==null||t(),V()}finally{w(!1)}},[u,o,t,V,m,f,Z,h,a]),X=d.useCallback(()=>{var c,v;(c=x.current)!=null&&c.value&&(x.current.value=""),(v=x.current)==null||v.click(),typeof document<"u"&&document.activeElement&&setTimeout(()=>{var i;const s=document.activeElement;(i=s==null?void 0:s.blur)==null||i.call(s)},0),Q()},[x,Q]);return{INVITE_ROLES:B,defaultInviteRole:H,clearState:V,emailInputList:D,emailTableRows:u,emailTextAreaValue:R,emailsOutsideOfDomain:le,fileInputRef:x,handleClickImportCSV:X,handleDeleteRow:re,handleInputChange:ae,handleSubmit:U,handleUploadCSV:oe,hasUploadedCsv:N,isInviting:j,resendEmails:h,setEmailInputList:L,setEmailTableRows:S,setEmailTextAreaValue:A,setResendEmails:T,shouldShowWarning:y,trackNavigationClick:Y,trackUploadClick:Q}},Ge=({email:a,index:t,emailInputList:l,setEmailInputList:M,setEmailTableRows:f,defaultInviteRole:o,shouldCheckDomainMismatch:m,allowedDomain:g})=>{const C=Ae(),y=se(),[I,x]=d.useState(!1),[N,b]=d.useState(!1),h=qe(),T=d.useMemo(()=>h?ge(h):null,[h]),j=g!=null?g:T,w=!!a&&!I&&!N&&t>0&&l.indexOf(a)<t;return e.jsxs("div",{className:"flex w-full flex-col gap-1",children:[e.jsx(Ue,{className:z((I||N||w)&&"border-token-text-error"),type:"email",value:a,onBlur:()=>{const u=!!a&&!ne.test(a);if(x(u),!a||u||!j||!m){b(!1);return}const S=ge(a),R=S!==null&&S!==j;b(R),R&&pe(C,"chatgpt_business_workspace_invite_domain_mismatch")},placeholder:y.formatMessage(n.emailInputPlaceholder),onChange:u=>{b(!1),M(S=>{const R=[...S];return R[t]=u.target.value,f(R.filter(Boolean).map(A=>({email:A,role:o}))),R})}},t),I&&e.jsx("div",{className:"text-token-text-error ms-1 flex text-xs",children:e.jsx(E,r({},n.invalidEmailWarning))}),N&&e.jsx("div",{className:"text-token-text-error ms-1 flex text-xs",children:e.jsx(E,J(r({},n.mismatchedDomainWarning),{values:{domain:j!=null?j:""}}))}),w&&e.jsx("div",{className:"text-token-text-error ms-1 flex text-xs",children:e.jsx(E,r({},n.duplicateEmailWarning))})]})},fe=25,Ye=10;function Qe(a,t,l,M){const f=Math.max(0,M),o=Math.min(Math.max(0,l),t),m=Math.max(t-o,0),g=Math.min(f,m),C=Math.max(f-g,0);if(a<o)return"bg-black/30 dark:bg-white/30";if(a<o+g)return"bg-black dark:bg-white";if(a<o+g+C)return"bg-blue-200 dark:bg-blue-500 border border-blue-600 dark:border-blue-300"}function da({workspace:a,canResendInviteEmails:t,onCancel:l,cancelButtonText:M,onSuccess:f,fullWidthButtons:o=!1,seatCount:m,seatsUsedBaseline:g=0,enableRoleSelectionStep:C=!1,showCancelButton:y=!0,csvButtonAlignedWithPrimary:I=!1}){"use no forget";const x=se(),[N,b]=d.useState(m>Ye),[h,T]=d.useState(!1),j=a.isK12(),w=De(a.id,j),u=a.isFreeWorkspace()||j&&!!w,{clearState:S,emailInputList:R,emailTableRows:A,emailTextAreaValue:D,emailsOutsideOfDomain:L,fileInputRef:Z,handleClickImportCSV:W,handleSubmit:G,handleUploadCSV:le,hasUploadedCsv:ee,isInviting:k,resendEmails:B,setEmailInputList:H,setEmailTableRows:P,setEmailTextAreaValue:oe,setResendEmails:ae,trackNavigationClick:Y,shouldShowWarning:Q,handleInputChange:te,handleDeleteRow:re,INVITE_ROLES:V,defaultInviteRole:U}=$e({workspace:a,onSuccess:f,seatCount:m,k12InviteDomain:w}),X=e.jsx(Re,{label:x.formatMessage(n.importCSVTooltip),contentClassName:"w-[280px]",side:"top",delayDuration:200,children:e.jsx(q,{color:I?"ghost":"secondary",icon:Ve,onClick:W,children:e.jsx(E,r({},ee?n.reimportCSVButton:n.importCSVButton))})}),ie=s=>{const i=s.filter((p,K,O)=>O.findIndex(Ee=>Ee.value===p.value)===K);oe(i),P(i.map(p=>({email:p.value,role:U})))};d.useEffect(()=>{const s=D.filter((i,p,K)=>K.findIndex(O=>O.value===i.value)===p);P(s.map(i=>({email:i.value,role:U})))},[U,D,P]);const c=s=>e.jsx(q,{className:z(s,o&&"w-full"),color:"primary",size:o?"large":"medium",loading:C?!1:k,disabled:(C?!1:k)||A.length===0||L.length>0,onClick:()=>{C?T(!0):(G(),Y({buttonType:"Send"}))},children:C?x.formatMessage(n.inviteMemberInviteNextButton):x.formatMessage(k?n.inviteMemberInviteSubmitButtonLoading:n.inviteMemberInviteSubmitButton)}),v=()=>y?e.jsx(q,{color:"ghost",size:o?"large":"medium",onClick:()=>{S(),l(),Y({buttonType:"Skip"})},children:M}):null;return C&&h?e.jsxs("div",{className:"flex flex-col gap-2",children:[!a.isFreeWorkspace()&&Q&&e.jsxs("div",{className:"flex w-full items-center rounded-xl bg-yellow-100 p-4",children:[e.jsx(Ne,{className:"icon-sm me-2 text-yellow-700"}),e.jsx("div",{className:"grow text-yellow-700",children:e.jsx(E,r({},n.unspecifiedRoleDescription))})]}),L.length>0&&e.jsx("div",{className:"flex w-full items-center bg-red-100 p-4",children:e.jsxs("div",{className:"grow text-red-700",children:[e.jsx(E,r({},n.prohibitedExternalEmailDescription)),e.jsx("pre",{className:"my-1",children:L.join(", ")}),e.jsx(E,r({},n.prohibitedExternalEmailResolution))]})}),e.jsxs(_.Root,{size:"normal",children:[e.jsxs(_.Header,{children:[e.jsx(_.HeaderCell,{children:e.jsx(E,r({},n.inviteTableHeaderEmail))}),e.jsx(_.HeaderCell,{className:"w-32 ps-3",children:e.jsx(E,r({},n.inviteTableHeaderRole))}),e.jsx(_.HeaderCell,{})]}),e.jsx(_.Body,{children:A.map((s,i)=>e.jsxs(_.Row,{children:[e.jsx(_.Cell,{children:e.jsx(Fe,{ariaLabel:x.formatMessage(n.inviteTableHeaderEmail),name:"email",type:"email",value:s.email,onChange:p=>te(i,"email",p.target.value),color:"neutral"})}),e.jsx(_.Cell,{children:e.jsxs(F.Root,{value:s.role,onValueChange:p=>te(i,"role",p),disabled:a.isFreeWorkspace(),children:[e.jsxs(F.Trigger,{className:"w-32 justify-between",children:[e.jsx(F.Value,{}),e.jsx(F.Icon,{})]}),e.jsx(F.Portal,{children:e.jsxs(F.Content,{className:"border-token-main-surface-secondary border",children:[e.jsx(F.Item,{value:V.member,children:e.jsx(E,r({},n.inviteRoleMember))}),V.admin&&e.jsx(F.Item,{value:V.admin,children:e.jsx(E,r({},n.inviteRoleAdmin))}),V.owner&&e.jsx(F.Item,{value:V.owner,children:e.jsx(E,r({},n.inviteRoleOwner))})]})})]})}),e.jsx(_.Cell,{textAlign:"right",children:e.jsx(Le,{onClick:()=>re(i),className:"icon-sm text-token-text-secondary me-2 cursor-pointer"})})]},i))})]}),t&&ae&&e.jsx("div",{className:"text-token-text-secondary mt-2 flex items-center text-start",children:e.jsx(Be,{id:"resend-emails",checked:B,onChange:s=>ae(s.currentTarget.checked),label:x.formatMessage(n.resendEmailsFieldName)})}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx(q,{color:"secondary",size:o?"large":"medium",onClick:()=>T(!1),children:x.formatMessage(n.inviteMemberInviteBackButton)}),e.jsx(q,{color:"primary",size:o?"large":"medium",disabled:k||A.length===0||L.length>0,onClick:()=>{G(),Y({buttonType:"Send"})},children:k?x.formatMessage(n.inviteMemberInviteSubmitButtonLoading):x.formatMessage(n.inviteMemberInviteSubmitButton)})]})]}):e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("input",{ref:Z,type:"file",accept:".csv,text/csv",id:"upload-csv",className:"hidden",onChange:s=>{le(s),b(!0)}}),L.length>0&&e.jsx("div",{className:"flex w-full items-center bg-red-100 p-4",children:e.jsxs("div",{className:"grow text-red-700",children:[e.jsx(E,r({},n.prohibitedExternalEmailDescription)),e.jsx("pre",{className:"my-1",children:L.join(", ")}),e.jsx(E,r({},n.prohibitedExternalEmailResolution))]})}),N?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8 flex w-full items-center gap-3",children:[Math.max(m,Math.min(g,m)+D.length)<=fe&&e.jsx("div",{className:"bg-token-main-surface-secondary flex h-2 grow overflow-hidden rounded-3xl",children:Array(Pe(Math.max(m,Math.min(g,m)+D.length),0,fe)).fill(0).map((s,i)=>e.jsx("div",{className:z("border-token-bg-primary h-full grow border-e-2 last-of-type:border-0",Qe(i,m,g,D.length))},i))}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(E,J(r({},n.seatsInvited),{values:{seatCount:m,enteredCount:Math.max(0,g)+D.length}}))})]}),e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("label",{htmlFor:"add-member-emails",id:"add-emails-label",className:"sr-only",children:e.jsx(E,r({},n.addEmailsFieldName))}),!I&&X]}),e.jsx(Xe,{value:D,onChange:ie})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-4",children:R.map((s,i)=>e.jsx(Ge,{email:s,index:i,emailInputList:R,setEmailInputList:H,setEmailTableRows:P,defaultInviteRole:U,shouldCheckDomainMismatch:u,allowedDomain:j?w:void 0},i))}),e.jsxs("div",{className:"align-center mb-4 flex justify-between",children:[e.jsx(q,{color:"secondary",onClick:()=>{H(s=>[...s,""])},icon:We,children:e.jsx(E,r({},n.addEmailButton))}),!I&&X]})]}),Math.max(0,g)+A.length-m>0&&!j&&!a.isFreeWorkspace()&&e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(E,J(r({},n.seatsExceeded),{values:{exceeded:Math.max(0,g)+A.length-m}}))})]}),e.jsx("div",{className:z("flex w-full flex-shrink-0 flex-col gap-2",I?"mt-0":"mt-8"),children:I?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:z("flex w-full gap-2",o?"flex-col":"items-center justify-between"),children:[e.jsx("div",{className:z(o?"w-full":"flex-shrink-0"),children:X}),e.jsx("div",{className:z(o?"w-full":"flex-shrink-0"),children:c()})]}),v()]}):e.jsxs(e.Fragment,{children:[c(),v()]})})]})}function Xe(a){const t=he(),l=d.useMemo(()=>t==null?void 0:t.subscriptionAnalyticsParams,[t]),M=d.useCallback(o=>{$.logEvent("Account Pay: Collaborator Emails Added",r(r({},l),o))},[l]),f=d.useCallback(o=>{$.logEvent("Account Pay: Collaborator Email Removed",r(r({},l),o))},[l]);return e.jsx(He,r({trackEmailsAdded:M,trackEmailRemoved:f},a))}function Je(a,t){"use no forget";const l=se(),M=xe(),f=ve(M),o=ye();return ke({mutationFn:async({emails:m,role:g,resendEmails:C})=>{const y=[],I=Math.max(5,Math.round(m.length/10));for(let b=0;b<m.length;b+=I)y.push(m.slice(b,b+I));const x=async b=>_e.safePost("/accounts/{account_id}/invites",{parameters:{path:{account_id:a}},requestBody:{email_addresses:b,role:g,resend_emails:C}}).then(h=>(h.errored_emails.length>0&&f.danger(l.formatMessage(n.inviteMessageFailure,{emailsStr:h.errored_emails.map(({email_address:T,error:j})=>"".concat(T,": ").concat(j)).join(", ")}),{loggingTitle:"Failed to invite members",toastId:"admin_invite",loggingDescription:n.inviteMessageFailure.defaultMessage}),h.account_invites)).catch(h=>{throw f.danger(h.message,{toastId:"admin_invite",loggingTitle:"Failed to invite members",loggingDescription:h.message}),h});return(await Promise.all(y.map(b=>x(b)))).flat()},onSuccess:()=>{o.invalidateQueries({queryKey:["workspace","invites",a]}),t==null||t()}})}function Ze(a,t,l,M,f){return new Promise(o=>{if(a.size/1048576>be)o({status:"error",reason:"file_too_large"});else if(a.type!=="text/csv")o({status:"error",reason:"invalid_file_type"});else{const g=new FileReader;g.readAsText(a),g.onload=function(C){var h;let y=M;const x=((h=C.target)==null?void 0:h.result).split("\n"),N=new Set,b=x.reduce((T,j)=>{var S;const[w,u]=j.split(",").map(R=>R.trim());return ne.test(w)&&!N.has(w)&&(t[u]===void 0&&!y&&(y=!0),T.push({email:w,role:f?l:(S=t[u])!=null?S:l})),N.add(w),T},[]);o({status:"success",newRows:b,hasWarning:y})}}})}const ea=a=>{const t={member:"member"};return a&&(t.admin="admin",t.owner="owner"),t},n=Se({addEmailsFieldName:{id:"admin-invite.addEmailsFieldName.0",defaultMessage:"Emails"},unspecifiedRoleDescription:{id:"admin-invite.unspecifiedRoleDescription",defaultMessage:"Roles that were unspecified have been changed to Member."},prohibitedExternalEmailDescription:{id:"admin-invite.prohibitedExternalEmailDescription",defaultMessage:"The following emails are not a part of your organization's verified domains:"},prohibitedExternalEmailResolution:{id:"admin-invite.prohibitedExternalEmailResolution",defaultMessage:'Either remove these emails, enable "Allow External Domain Invites" from your workspace settings, or verify these email domains.'},inviteTableHeaderEmail:{id:"admin-invite.inviteTableHeaderEmail",defaultMessage:"Email"},inviteTableHeaderRole:{id:"admin-invite.inviteTableHeaderRole",defaultMessage:"Role"},inviteRoleMember:{id:"admin-invite.inviteRoleMember",defaultMessage:"Member"},inviteRoleAdmin:{id:"admin-invite.inviteRoleAdmin",defaultMessage:"Admin"},inviteRoleOwner:{id:"admin-invite.inviteRoleOwner",defaultMessage:"Owner"},fileTooLargeWarning:{id:"admin-invite.fileTooLargeWarning",defaultMessage:"File is too large. Please upload a CSV file smaller than {maxSize}."},fileIncorrectTypeWarning:{id:"admin-invite.fileIncorrectTypeWarning",defaultMessage:"Please upload a CSV file."},resendEmailsFieldName:{id:"admin-invite.resendEmailsFieldName",defaultMessage:"Resend emails for existing invites"},inviteMessageLoading:{id:"admin-invite.inviteMessageLoading",defaultMessage:"Sending out {numRows} invites, this may take a minute..."},inviteSuccessToast:{id:"admin-invite.inviteSuccessToast",defaultMessage:"Invited {numRows} {userStr} to {workspaceName}"},inviteMemberInviteNextButton:{id:"admin-invite.inviteMemberInviteNextButton",defaultMessage:"Next"},inviteMemberInviteSubmitButton:{id:"admin-invite.inviteMemberInviteSubmitButton",defaultMessage:"Send invites"},inviteMemberInviteSubmitButtonLoading:{id:"admin-invite.inviteMemberInviteSubmitButtonLoading",defaultMessage:"Sending invites..."},inviteMemberInviteBackButton:{id:"admin-invite.inviteMemberInviteBackButton",defaultMessage:"Back"},inviteMessageFailure:{id:"admin-invite.inviteMessageFailure",defaultMessage:"Unable to invite {emailsStr}"},importCSVButton:{id:"admin-invite.importCSVButton",defaultMessage:"Upload CSV"},reimportCSVButton:{id:"admin-invite.reimportCSVButton",defaultMessage:"Re-upload CSV"},importCSVTooltip:{id:"admin-invite.importCSVTooltip",defaultMessage:"Upload a CSV file. Your file must include an email on each line."},seatsInvited:{id:"admin-invite.seatsInvited",defaultMessage:"{enteredCount} of {seatCount} users"},seatsExceeded:{id:"admin-invite.seatsExceeded",defaultMessage:"Inviting these users will bill {exceeded} additional {exceeded, plural, one {user} other {users}} on your workspace."},emailInputPlaceholder:{id:"admin-invite.emailInputPlaceholder",defaultMessage:"Email"},addEmailButton:{id:"admin-invite.addEmailButton",defaultMessage:"Add more"},duplicateEmailWarning:{id:"admin-invite.duplicateEmailWarning",defaultMessage:"This email is a duplicate."},invalidEmailWarning:{id:"admin-invite.invalidEmailWarning",defaultMessage:"Please enter a valid email address."},mismatchedDomainWarning:{id:"admin-invite.mismatchedDomainWarning",defaultMessage:"Enter an email address with the {domain} domain."}});export{da as A};
//# sourceMappingURL=osmdmxcl4s1h4x86.js.map
