var ue=Object.defineProperty,de=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var D=(e,t,n)=>t in e?ue(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,U=(e,t)=>{for(var n in t||(t={}))_e.call(t,n)&&D(e,n,t[n]);if(K)for(var n of K(t))fe.call(t,n)&&D(e,n,t[n]);return e},C=(e,t)=>de(e,pe(t));import{r as T,j as o,M as G}from"./fg33krlcm0qyi6yw.js";import{b as H,fN as me,d as ee,eW as xe,dB as he,bL as ge,o as ye,e2 as Q,e4 as X,bv as be,l as P,i as ve,id as je,P as te,dF as oe}from"./mtk1qztvnb31pw5r.js";import{e$ as Se,f0 as ae,f1 as Fe,f2 as Ie,f3 as Ee,f4 as se,f5 as Y,ee as W,f6 as we,f7 as ke,f8 as Me,eb as ne,f9 as Te,cX as z,ef as Ne,eY as Ae,ej as Oe}from"./k65njl5wlgspihfr.js";import{F as Re}from"./cu0ig3jox4ha1bc5.js";import{GlauxSearchQueryWithIcon as re,GlauxSearchQueryOverflow as qe}from"./ctgqahsfx1txd4g6.js";import{A as le}from"./evgr6wx9jd99ot87.js";import"./du98r2zhw5p0hoto.js";import"./e5ksk0bbujs0ac88.js";function V(e,t){const n=new RegExp("<\\s*".concat(t,"\\s*>([\\s\\S]*?)<\\s*/\\s*").concat(t,"\\s*>"),"i"),d=e.match(n);return d&&d[1]?d[1].trim():e}function Ue(e){if(e===void 0)return;const t="Content Snippet:",n=e.indexOf(t);return n===-1?e:e.substring(n+t.length).trim()}function Ce(e,t){var n,d,N,F,h;t.text=Ue(e.contents),(n=e.documentId)!=null&&n.includes("ks--slack")||(d=t.cloud_doc_url)!=null&&d.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/(issues|pull)\/\d+/)?(t.text=void 0,t.name="#".concat(t.name)):(N=t.cloud_doc_url)!=null&&N.startsWith("https://docs.google.com/spreadsheets/")&&t.text!==void 0?t.text=V(t.text,"sheet_summary"):(F=t.cloud_doc_url)!=null&&F.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/commit\//)&&t.text!==void 0?t.text=V(t.text,"git_summary"):(h=t.cloud_doc_url)!=null&&h.match(/^https:\/\/github\.com\/[^/]+\/[^/]+\/blob\//)&&t.text!==void 0&&(t.text=V(t.text,"code_summary")),t.text&&(t.text=t.text.slice(0,250))}function ze({turnIndex:e,clientThreadId:t,variant:n="sidebar"}){const d=H(),N=Se(),F=ae(d)||N,h=Fe(d),A=Ie(d),[R,i]=me(t,u=>[oe.getTurnContentReferences(u,e),oe.getConversationTurnAtIndex(u,e).messages]),O=ee(()=>xe(he(d,t))),I=Ee(O),E=ee(()=>{if(I)return ge(d,{skipLogos:!1})}),w=i.some(u=>{var p;return((p=u==null?void 0:u.metadata)==null?void 0:p.api_tool_type)==="glaux"}),q=w||ye(d,"2137702454"),L=T.useMemo(()=>({turnIndex:e,clientThreadId:t}),[t,e]),B=T.useMemo(()=>{const u=[],p=new Set,_=new Map;if(A.forEach(s=>{_.set(s,[])}),R.forEach(s=>{var a,l,f,c,y,m,k,x,g;if(s.type==="file"&&!p.has(s.id)){const{Icon:r,appName:b}=se({connectorId:(a=s.connector_id)!=null?a:void 0,cloud_doc_url:s.cloud_doc_url,availableConnectors:E}),v={id:s.id,name:b||s.name,subtitle:b?s.name:void 0,cloud_doc_url:(f=s.cloud_doc_url)!=null?f:(l=s.extra)==null?void 0:l.cloud_doc_url,text:q?s.snippet:void 0,authors:(c=s.medical_file_reference)==null?void 0:c.authors_display,publication_year:(y=s.medical_file_reference)==null?void 0:y.publication_year,journal_name:(m=s.medical_file_reference)==null?void 0:m.journal_name,doi:(k=s.medical_file_reference)==null?void 0:k.doi,journal_homepage_url:(x=s.medical_file_reference)==null?void 0:x.journal_homepage_url,Icon:r};if(!!!v.cloud_doc_url&&!Y(v.id))return;u.push(v),_.has(s.type)&&((g=_.get(s.type))==null||g.push(v)),p.add(s.id)}else s.type==="file_navlist"?s.items.forEach(r=>{var b,v,M;if(!p.has(r.id)){const j=W((b=r.cloud_doc_url)!=null?b:""),S={name:(v=j==null?void 0:j.type)!=null?v:r.name,subtitle:j!=null&&j.type?r.name:void 0,cloud_doc_url:r.cloud_doc_url,text:q?r.description:void 0,id:r.id,lastModifiedTime:r.last_modified_time};if(!!!S.cloud_doc_url&&!Y(S.id))return;u.push(S),_.has(s.type)&&((M=_.get(s.type))==null||M.push(S)),p.add(r.id)}}):s.type==="grouped_webpages"&&h&&s.items.forEach(r=>{var b,v,M,j;if(!p.has(r.url)){const S=W((b=r.url)!=null?b:""),J={name:(v=S==null?void 0:S.type)!=null?v:r.title,subtitle:S!=null&&S.type?r.title:void 0,cloud_doc_url:r.url,text:q&&(M=r.snippet)!=null?M:void 0,journal_name:r.attribution,id:r.url};u.push(J),_.has(s.type)&&((j=_.get(s.type))==null||j.push(J)),p.add(r.url)}})}),A.length>0){const s=[];return A.forEach(a=>{var l;_.has(a)&&s.push(...(l=_.get(a))!=null?l:[])}),s}return u},[A,R,q,h,E]),Z=T.useMemo(()=>{var _,s;if(!I||n==="bottom")return[];const u=[],p=new Set;for(const a of i)if(a.author.role===Q.Tool&&a.author.name==="file_search"&&a.content.content_type===X.TetherBrowsingDisplay){const l=we(a.content.result),f=(s=(_=a.metadata)==null?void 0:_.cloud_doc_urls)!=null?s:[];l.chunks.forEach((c,y)=>{var r,b;if(!c.documentId||p.has(c.documentId))return;let m;if(c.metadata.cloud_doc_url)m=c.metadata.cloud_doc_url.toString();else if(y<f.length)m=f[y];else if(c.documentId.endsWith("--google")){const v=c.documentId.split("--")[1];m="https://drive.google.com/file/d/".concat(v)}if(!m)return;p.add(c.documentId);const k=(r=c.metadata["File last modified at"])!=null?r:c.metadata["File created at"],x=W(m!=null?m:""),g={id:c.documentId,name:(b=x==null?void 0:x.type)!=null?b:c.title,subtitle:x!=null&&x.type?c.title:void 0,cloud_doc_url:m,text:c.contents,lastModifiedTime:k?k.toString():void 0};Ce(c,g),u.push(g)})}return u},[I,i,n]),$=T.useMemo(()=>{var p,_,s;if(n==="bottom"||!w)return[];const u=[];for(const a of i)if(a.author.role===Q.Tool&&a.author.name==="api_tool.call_tool"&&a.content.content_type===X.MultimodalText){const l=(p=a.metadata)==null?void 0:p.citation_metadata,f=l==null?void 0:l.id;if(!l||!f||!l.url)continue;const m=a.content.parts[1].toString().split("\n").flatMap(g=>{const r=ke.exec(g);return r?[r[1]]:[]}).flatMap(g=>{const r=Me.exec(g);return r?/^\s*[^()]+?\s*\(\s*display_name:\s*([^;]+);\s*real_name:\s*([^;]+);\s*username:\s*[^)]+\)\s*:/i.exec(r[2])?[r[2].trim().replace(/^\s*[^()]+?\s*\(\s*display_name:\s*([^;]+);\s*real_name:\s*([^;]+);\s*username:\s*[^)]+\)\s*:/i,(v,M,j)=>"".concat((j==null?void 0:j.trim())||(M==null?void 0:M.trim()),":")).replace(/\r/g,"")]:[r[2].trim()]:[]}),{Icon:k,appName:x}=se({connectorId:l.__connector_id,cloud_doc_url:l.url,availableConnectors:E});u.push(o.jsx(ie,{clientThreadId:t,item:{id:f,name:x||l.title,subtitle:x?l.title:void 0,cloud_doc_url:l.url,text:m.slice(0,3).join("\n"),lastModifiedTime:l.last_modified_at,Icon:k}},"".concat(a.id,"-").concat(f)))}else if(a.author.role===Q.Assistant&&a.recipient==="api_tool.call_tool"&&a.content.content_type===X.Code&&a.content.language==="json"){let l={};try{if(l=JSON.parse(a.content.text),typeof l.args=="string")try{l.args=JSON.parse(l.args)}catch(c){continue}}catch(c){continue}if(!l.path)continue;const f=[];if(l.path==="mixer://search"&&typeof((_=l.args)==null?void 0:_.sources)=="object"){const c=l.args.sources;for(const y in c){const m=c[y],k=ne(y);if(k){const x=new Set;m.forEach(g=>{g.query&&!x.has(g.query)&&(f.push(C(U({},k),{query:g.query})),x.add(g.query))})}}}else if((s=l.args)!=null&&s.query){const c=ne(l.path);c&&f.push(C(U({},c),{query:l.args.query}))}if(!f.length)continue;u.push(o.jsx("div",{className:"flex flex-row flex-wrap items-center gap-2 px-3 py-2.5",children:f.length<=3?f.map((c,y)=>o.jsx(re,{query:c.query},a.id+y)):o.jsxs(o.Fragment,{children:[f.slice(0,3).map((c,y)=>o.jsx(re,{query:c.query},a.id+y)),o.jsx(qe,{maxResults:3,queries:f},a.id+"query-overflow")]})},a.id))}return u},[t,i,n,w,E]);return o.jsx(be,{children:o.jsxs("div",{className:P("bg-token-main-surface-primary flex w-full flex-col",n==="sidebar"&&"mt-[calc(var(--threadFlyOut-leading-height,57px)*-1)]"),children:[o.jsx(ce,{title:o.jsx(G,{id:"dlVlo6",defaultMessage:"Citations"}),items:B,clientThreadId:t,sectionId:"citations",analyticsMetadata:L}),!F&&o.jsx(ce,{title:o.jsx(G,{id:"njZblE",defaultMessage:"Search Results"}),items:Z,clientThreadId:t,sectionId:"search-results",analyticsMetadata:L,unstructuredResults:$})]})})}function ce({title:e,items:t,scrollToHeader:n,shouldAnimateScroll:d,clientThreadId:N,analyticsMetadata:F,sectionId:h,unstructuredResults:A=[]}){const R=H(),i=ve(R),O=T.useRef(null),I=T.useMemo(()=>F?C(U({},F),{sectionId:h,numResultsInSection:t.length}):void 0,[F,t.length,h]);return T.useEffect(()=>{O.current&&n&&setTimeout(()=>{O.current&&O.current.scrollIntoView({behavior:d?"smooth":"instant"})},300)},[n,d]),A.length===0&&(!t||t.length===0)?null:o.jsxs("div",{ref:O,children:[o.jsx(le,{className:P("bg-token-main-surface-primary text-token-text-primary sticky top-0 z-1 flex items-center px-6 pt-4 pb-4 text-sm font-medium",i?"border-b-thin h-[var(--header-height,3.5rem)] border-(--bento-border-color)":"border-token-border-sharp h-[calc(var(--header-height,3.5rem)+1px)] border-b"),children:e}),o.jsxs("div",{className:"flex list-none flex-col px-3 py-2",children:[t.map((E,w)=>o.jsx(le,{index:w,children:o.jsx(ie,{positionInSection:w,item:E,analyticsMetadata:I,clientThreadId:N},w)},"".concat(e,"-").concat(w))),A]})]})}function ie({item:e,analyticsMetadata:t,positionInSection:n,clientThreadId:d}){var $,u,p;const N=H(),F=je(),h=ae(N),A=Te(N),R=h&&e.journal_name!=null?e.journal_name:e.name,i=W(($=e.cloud_doc_url)!=null?$:"");let O=R!=null?R:o.jsx(G,{id:"bqY3sN",defaultMessage:"File"}),I=e.Icon?()=>e.Icon:(u=i==null?void 0:i.Icon)!=null?u:e.cloud_doc_url?z:Ne;!e.cloud_doc_url&&!Y(e.id)&&(O=o.jsx(G,{id:"hGgoxF",defaultMessage:"Source"}),I=z);const[E,w]=T.useState(!1);let q=e.cloud_doc_url?e.cloud_doc_url:"";A&&e.journal_homepage_url&&(q=e.journal_homepage_url),h&&q.length>0&&(I=({className:_})=>o.jsx(Oe,{url:q,className:P(_,"object-cover"),size:32,fallback:o.jsx(z,{className:_})}));const L=T.useCallback(()=>{t&&te.logEventWithStatsig("File Sources Sidebar Item Clicked","file_sources_sidebar_link_clicked",C(U({},t),{positionInSection:n,sourceType:i==null?void 0:i.type,hasUrl:!!e.cloud_doc_url}))},[t,e.cloud_doc_url,i==null?void 0:i.type,n]),B=T.useCallback(()=>{t&&te.logEventWithStatsig("File Source Sidebar Item Followup Clicked","file_sources_sidebar_item_followup_clicked",C(U({},t),{positionInSection:n,sourceType:i==null?void 0:i.type,hasUrl:!!e.cloud_doc_url}))},[t,e.cloud_doc_url,i==null?void 0:i.type,n]);return o.jsx(o.Fragment,{children:o.jsxs("a",{href:e.cloud_doc_url,target:"_blank",rel:"noreferrer",onClick:L,className:P("group relative flex flex-col gap-0.5 rounded-xl px-3 py-2.5","hover:bg-token-main-surface-secondary",E&&"bg-token-main-surface-secondary"),children:[o.jsxs("div",{className:"ellipses flex h-6 items-center gap-2 text-xs",children:[I&&o.jsx(I,{className:"icon-sm bg-primary flex-none rounded-full object-cover"}),o.jsx("p",{className:"text-token-text-secondary flex-auto truncate overflow-ellipsis",children:O})]}),h&&e.name!=null&&o.jsx("div",{className:"line-clamp-2 text-sm font-bold break-words",children:e.name}),h&&e.authors!=null&&e.publication_year!=null&&o.jsxs("div",{className:"line-clamp-2 text-sm break-words",children:[o.jsx("span",{className:"italic",children:e.authors}),o.jsx("span",{className:"ms-1 not-italic",children:e.publication_year})]}),h&&e.doi!=null&&o.jsx("div",{className:"line-clamp-2 text-sm break-words",children:e.doi}),e.subtitle&&o.jsx("div",{className:"text-token-text-primary line-clamp-1 text-sm font-semibold",children:e.subtitle}),((p=e.text)!=null?p:e.lastModifiedTime)&&o.jsxs("div",{className:"text-token-text-secondary line-clamp-2 text-sm leading-snug font-normal",children:[e.lastModifiedTime&&o.jsxs("span",{children:[o.jsx(Ae,{date:new Date(e.lastModifiedTime.trim())}),e.text&&" â€” "]}),e.text]}),F?null:o.jsx(Re,{className:P("absolute end-2 top-2 flex h-7 w-7 items-center justify-center rounded-sm p-1 transition","text-token-text-secondary group-hover:text-token-text-primary","invisible group-hover:visible","bg-token-main-surface-secondary hover:bg-token-main-surface-tertiary",E&&"bg-token-main-surface-tertiary text-token-text-primary visible"),clientThreadId:d,fileId:e.id,fileName:e.name,fileCloudDocUrl:e.cloud_doc_url,isFollowupMenuOpen:E,setIsFollowupMenuOpen:w,trackFileSourceFollowup:B})]})})}export{ze as ChatScreenRetrievalResultsFlyoutContent,ce as SourcesListGroup,Ce as __hacky_maybe_enhance_ref};
//# sourceMappingURL=cwhbtosecjtdlg02.js.map
