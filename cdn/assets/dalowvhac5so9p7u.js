const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/dabcfwyv1j7qyi38.js","assets/fg33krlcm0qyi6yw.js","assets/d0444mle8cdypjta.js","assets/mtk1qztvnb31pw5r.js","assets/root-mcq3deyb.css","assets/klzrztgvm2c9gs50.js","assets/k65njl5wlgspihfr.js","assets/conversation-small-332fs9rk.css","assets/zqbip2ya77i1mx4s.js","assets/kg0cp341m64rddpv.js","assets/ansi-1f6vhsjh.css","assets/lbbnz7rb7sd2lk50.js","assets/ck1u9icgxosmytry.js","assets/dq5a57hcb44a83mi.js","assets/cmaobpdpreyiep8p.js","assets/sy1xvqwioh9ks4z8.js","assets/kzbknm4lxuyoq9wi.js","assets/jed1ux7qibe55pmj.js","assets/h1em0bjkpkjv8ykw.js","assets/f5ep9o7usovyn4vf.js","assets/ly75bs3d14n5v622.js","assets/hu1bt0oauegdhua6.js","assets/bes67zhi4fr5gq8i.js","assets/n0ab5m1z76n8mazm.js","assets/lptwpbjabrvjmhsj.js","assets/ose6175gtasqnfv0.js","assets/o51gjyxad96i2yey.js","assets/cv3wsu6uenrjij6h.js","assets/lbq5605sor1ah5hb.js","assets/n0qmvbt3dffalvvl.js","assets/jcfo2542d2wvunuv.js","assets/j37p94g6trtb4j3z.js","assets/lad8yx56mqsdspc9.js","assets/fznnr8l9owxbou6l.js","assets/haneze5lyzwaewf8.js","assets/j4u691tk1tplayl2.js","assets/j0vhwkpwiqu2ejer.js","assets/wham-task-push-diff-dropdown-deq1eh5n.css","assets/l09h2qppleubii6l.js","assets/bbzlu7xqes2h12wz.js","assets/eqi3xjytwhmszqqa.js","assets/bm9dehzwm3r2l9jr.js","assets/dm7q440f2oraxz29.js","assets/j3x02iqqi345yx57.js","assets/mmn9462oogkapcg8.js","assets/blmsijdyv0yxybpw.js","assets/npp0xpas090zc0qr.js","assets/0hruh9i7xt25bbur.js","assets/bgx9m29b5moow7ak.js","assets/kpobiwwkg2o2u14w.js","assets/ir7nzwbolrsm3ds2.js","assets/btdpwmi6j9nv6qc2.js","assets/mg1nwivo9tzc7m2p.js","assets/cnrdqaihcmlb57i1.js","assets/j7vr3wxxnh5g6uxz.js"])))=>i.map(i=>d[i]);
var Rt=Object.defineProperty,Dt=Object.defineProperties;var Et=Object.getOwnPropertyDescriptors;var at=Object.getOwnPropertySymbols;var Ot=Object.prototype.hasOwnProperty,Wt=Object.prototype.propertyIsEnumerable;var st=(t,e,o)=>e in t?Rt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,Pe=(t,e)=>{for(var o in e||(e={}))Ot.call(e,o)&&st(t,o,e[o]);if(at)for(var o of at(e))Wt.call(e,o)&&st(t,o,e[o]);return t},Se=(t,e)=>Dt(t,Et(e));import{r as p,j as s,c as qe,e as ge,M as me,_ as ht,i as Ae,d as gt,u as Me,b as Bt,a as He}from"./fg33krlcm0qyi6yw.js";import{gd as pt,l as xe,c0 as qt,da as Ht,a9 as _e,fh as Ut,bh as wt,kq as Tt,Z as ot,bg as ke,bv as xt,C as Qt,m as je,f$ as $t,mI as Kt,b as _t,o as Ee,yK as Vt,fX as Gt,R as et,aW as Ue,H as vt,Ab as zt,b9 as Yt,T as bt,hv as Xt,Q as Jt,S as Zt,qY as At,i9 as ea}from"./mtk1qztvnb31pw5r.js";import{cG as ta,iX as aa,cD as Oe,cE as ze,cM as sa,cH as oa,e4 as ia,Z as Ye,aw as ra,ib as na,kS as la,Y as it,ab as ca,ac as da,ax as Qe,os as ua,dt as rt,v3 as nt,Bj as ma,Bk as fa,hD as ha,gd as ga}from"./k65njl5wlgspihfr.js";import{M as $e,a as Xe,W as pa,D as wa,f as xa,P as _a,b as va,c as lt,d as ba}from"./d0444mle8cdypjta.js";import{n as ya,h as We,j as ka,v as Ma,b as Ca}from"./n0ab5m1z76n8mazm.js";import{h as Le,i as yt,j as Ce,k as ja,c as Pa,W as he,a as Je,w as Ze,g as we}from"./sy1xvqwioh9ks4z8.js";import{u as Sa}from"./l09h2qppleubii6l.js";import{T as kt,a as Mt,b as Ct}from"./fznnr8l9owxbou6l.js";import{u as jt}from"./bbzlu7xqes2h12wz.js";import{W as Be}from"./eqi3xjytwhmszqqa.js";import{E as Na}from"./bm9dehzwm3r2l9jr.js";import{JsonViewer as La}from"./ose6175gtasqnfv0.js";import{i as Ia,W as Fa}from"./dm7q440f2oraxz29.js";import{u as Ra,g as Da,N as Ea}from"./kpobiwwkg2o2u14w.js";import{W as ct,O as Oa}from"./mg1nwivo9tzc7m2p.js";import{s as Ke}from"./j4u691tk1tplayl2.js";import{A as Wa}from"./cnrdqaihcmlb57i1.js";import{s as Re,B as Ba}from"./j7vr3wxxnh5g6uxz.js";import{W as qa}from"./bes67zhi4fr5gq8i.js";import{p as De}from"./jcfo2542d2wvunuv.js";const Pt=p.createContext(null);function $s({value:t,children:e}){return s.jsx(Pt.Provider,{value:t,children:e})}function Ie(){const t=p.useContext(Pt);if(!t)throw new Error("useWhamTaskPageContext must be used within its provider");return t}function Ha(t){var c,u;const e={},o={};let a;for(const i of t)Le(i)?i.previous_turn_id?o[i.previous_turn_id]=i:a=i:i.previous_turn_id&&((u=e[c=i.previous_turn_id])!=null?u:e[c]=[]).push(i);if(!a)return null;const r=i=>{var l;const d=(l=e[i.id])!=null?l:[],n={};for(const w of d){const b=o[w.id];b&&(n[w.id]=r(b))}return{userTurn:i,assistantTurns:d,children:n}};return r(a)}function Ua(t){for(let e=t.length-1;e>=0;e--){const o=t[e];if(Le(o)&&o.previous_turn_id)return o.previous_turn_id}return null}function Ta(t,e){var r,c,u,i;if(!t)return[];const o=[];if(e){const d=l=>{for(const w of l.assistantTurns){if(w.id===e)return[{node:l,activeId:w.id}];const b=l.children[w.id],_=b&&d(b);if(_)return[{node:l,activeId:w.id},..._]}return null},n=d(t);n&&o.push(...n)}o.length===0&&o.push({node:t,activeId:(c=(r=t.assistantTurns[0])==null?void 0:r.id)!=null?c:null});let a=o[o.length-1];for(;a!=null&&a.activeId;){const d=a.node.children[a.activeId];if(!d)break;o.push({node:d,activeId:(i=(u=d.assistantTurns[0])==null?void 0:u.id)!=null?i:null}),a=o[o.length-1]}return o}function Qa(t){return t==null?void 0:t.assistantTurns.some(e=>yt(e.turn_status))}function $a(t){"use forget";var re,te,$,ae,ie,K;const e=qe.c(31),{className:o,focusedAssistantTurn:a,currentTab:r,permissions:c,task:u,turns:i,containerHeight:d,onClickFile:n,setFocusedAssistantTurnId:l,onTabChange:w,latestTurnRef:b,latestUserMessageRef:_,hasComments:x,clearComments:f,showFullDiff:E,loadingTurnMapping:m,reserveComposerSpace:g}=t,P=g===void 0?!0:g;let N,O;e[0]!==a||e[1]!==l||e[2]!==i?(N=()=>{if(!a){const k=Ua(i);k&&l(k)}},O=[a,i,l],e[0]=a,e[1]=l,e[2]=i,e[3]=N,e[4]=O):(N=e[3],O=e[4]),p.useEffect(N,O);let q;e[5]!==i?(q=Ha(i),e[5]=i,e[6]=q):q=e[6];const v=q;let H;e[7]!==(a==null?void 0:a.id)||e[8]!==v?(H=()=>{var k;return Ta(v,(k=a==null?void 0:a.id)!=null?k:null)},e[7]=a==null?void 0:a.id,e[8]=v,e[9]=H):H=e[9],a==null||a.id;let Y;e[10]!==H?(Y=H(),e[10]=H,e[11]=Y):Y=e[11];const A=Y,S=A.length-1,ee=A.slice(0,S);let X,T;e[12]!==A||e[13]!==P?(X=pt(A),T=P&&Qa(X==null?void 0:X.node),e[12]=A,e[13]=P,e[14]=X,e[15]=T):(X=e[14],T=e[15]);const de=T,{data:C}=ya(u==null?void 0:u.id);C==null||C.current_assistant_turn;let U;e:{if(!m||!(C!=null&&C.current_assistant_turn)){U=null;break e}const k=C.current_assistant_turn,V=((te=(re=k.sibling_turn_ids)==null?void 0:re.length)!=null?te:0)+1,F=($=k.attempt_placement)!=null?$:0;let G;if(e[16]!==V||e[17]!==((ae=k.debug_metadata)==null?void 0:ae.shadow_turn_control_for)||e[18]!==k.id||e[19]!==F){let B;e[21]!==k.id||e[22]!==F?(B=(D,Z)=>Z===F?k.id:"placeholder-".concat(Z),e[21]=k.id,e[22]=F,e[23]=B):B=e[23];const M=Array.from({length:V},B),L={};M.forEach((D,Z)=>L[D]=Z),G={attemptIds:M,idToIdxMap:L},e[16]=V,e[17]=(ie=k.debug_metadata)==null?void 0:ie.shadow_turn_control_for,e[18]=k.id,e[19]=F,e[20]=G}else G=e[20];U=G}const R=U;let J;e[24]!==o?(J=xe("relative flex h-full w-full flex-col",o),e[24]=o,e[25]=J):J=e[25];const ne="flex h-fit min-h-full shrink-0 flex-col gap-6 pt-6 text-sm",Q=m&&u&&(C!=null&&C.current_user_turn)&&(C!=null&&C.current_assistant_turn)?s.jsxs("div",{ref:b,className:xe("flex min-h-full shrink-0 flex-col gap-6",de&&"pb-36"),style:{minHeight:d-24},children:[s.jsx("div",{className:"text-token-text-secondary flex w-full items-center justify-center gap-2",children:s.jsx(qt,{className:"text-xl"})}),s.jsx($e,{isLatest:!0,task:u,userTurn:C.current_user_turn,assistantTurns:[C.current_assistant_turn],selectedAssistantId:C.current_assistant_turn.id,focusedAssistantTurn:C.current_assistant_turn,setFocusedAssistantTurnId:l,onClickFile:n,currentTab:r,onTabChange:w,permissions:c,startOpen:!0,hasComments:x,clearComments:f,showFullDiff:E,attemptIdsOverride:R==null?void 0:R.attemptIds,idToIndexMapOverride:R==null?void 0:R.idToIdxMap,latestUserMessageRef:_})]}):s.jsxs(s.Fragment,{children:[ee.length>0&&s.jsx("div",{className:"flex flex-col gap-6",children:ee.map((k,V)=>{const{node:F,activeId:G}=k;return s.jsx($e,{isLatest:V===S,task:u,userTurn:F.userTurn,assistantTurns:F.assistantTurns,selectedAssistantId:G,focusedAssistantTurn:a,setFocusedAssistantTurnId:l,onClickFile:n,startOpen:V===S,currentTab:r,onTabChange:w,permissions:c,hasComments:x,clearComments:f,showFullDiff:E},F.userTurn.id)})}),X&&s.jsx("div",{ref:b,className:xe("flex min-h-full shrink-0 flex-col gap-6",de&&"pb-36"),style:{minHeight:d-24},children:s.jsx($e,{isLatest:!0,task:u,userTurn:X.node.userTurn,assistantTurns:X.node.assistantTurns,selectedAssistantId:(K=a==null?void 0:a.id)!=null?K:null,focusedAssistantTurn:a,setFocusedAssistantTurnId:l,onClickFile:n,currentTab:r,onTabChange:w,permissions:c,startOpen:!0,hasComments:x,clearComments:f,showFullDiff:E,latestUserMessageRef:_})})]});let W;e[26]!==Q?(W=s.jsx("div",{className:ne,children:Q}),e[26]=Q,e[27]=W):W=e[27];let oe;return e[28]!==W||e[29]!==J?(oe=s.jsx("div",{className:J,children:W}),e[28]=W,e[29]=J,e[30]=oe):oe=e[30],oe}const St=p.createContext(null);function Ks({value:t,children:e}){return s.jsx(St.Provider,{value:t,children:e})}function tt(){const t=p.useContext(St);if(!t)throw new Error("useTaskComments must be used within a TaskCommentsProvider");return t}function Ka({currentTab:t,permissions:e,onClickFile:o,onTabChange:a,showFullDiff:r,loadingTurnMapping:c,footer:u}){const{task:i,focusedAssistantTurn:d,pastTurns:n,setFocusedAssistantTurnId:l}=Ie(),{comments:w,clearComments:b}=tt(),[{height:_},x]=Sa(),f=p.useRef(null),E=p.useRef(null),m=p.useRef(null);return Ht(()=>{const g=f.current,P=m.current;!g||!P||!g.contains(P)||P.scrollIntoView({block:"start",behavior:"auto"})},[n.length,c]),s.jsx("div",{ref:ta(x,f),className:"flex h-full w-full scroll-pt-3 flex-col items-center overflow-y-auto px-6",children:s.jsxs("div",{className:xe("@container w-full",Xe),children:[s.jsx($a,{focusedAssistantTurn:d,currentTab:t,permissions:e,task:i,turns:n,containerHeight:_,onClickFile:o,setFocusedAssistantTurnId:l,onTabChange:a,latestTurnRef:E,latestUserMessageRef:m,hasComments:w.length>0,clearComments:b,showFullDiff:r,loadingTurnMapping:c,reserveComposerSpace:u!=null}),u&&s.jsx("div",{className:"keyboard-open:fixed absolute start-0 end-0 bottom-0",children:u})]})})}function Va(t){"use forget";const e=qe.c(10),{onRetry:o,isRetrying:a}=t,r=ge();let c;e[0]!==r?(c=r.formatMessage({id:"wham.whamPreviewImageCarousel.retryAriaLabel",defaultMessage:"Retry loading preview images"}),e[0]=r,e[1]=c):c=e[1];const u=c;let i;e[2]===Symbol.for("react.memo_cache_sentinel")?(i=s.jsx("div",{className:"bg-token-bg-tertiary text-token-text-tertiary rounded-full p-3",children:s.jsx(Na,{className:"icon-lg"})}),e[2]=i):i=e[2];let d;e[3]===Symbol.for("react.memo_cache_sentinel")?(d=s.jsx("p",{className:"text-token-text-primary text-base font-medium",children:s.jsx(me,{id:"wham.whamPreviewImageCarousel.errorTitle",defaultMessage:"Preview unavailable"})}),e[3]=d):d=e[3];let n;e[4]===Symbol.for("react.memo_cache_sentinel")?(n=s.jsxs("div",{className:"flex flex-col gap-2",children:[d,s.jsx("p",{className:"text-token-text-secondary text-sm",children:s.jsx(me,{id:"wham.whamPreviewImageCarousel.errorSubtitle",defaultMessage:"We couldn't load the preview images. Please try again."})})]}),e[4]=n):n=e[4];let l;e[5]===Symbol.for("react.memo_cache_sentinel")?(l=s.jsx(me,{id:"wham.whamPreviewImageCarousel.retry",defaultMessage:"Retry"}),e[5]=l):l=e[5];let w;return e[6]!==a||e[7]!==o||e[8]!==u?(w=s.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-4 px-6 text-center",children:[i,n,s.jsx(_e,{color:"secondary",onClick:o,loading:a,label:u,className:"mt-1",children:l})]}),e[6]=a,e[7]=o,e[8]=u,e[9]=w):w=e[9],w}function Ga({previewImages:t}){"use no forget";var m;const e=ge(),o=aa(t.map(g=>{var P,N,O,q;return{content_type:Ut.ImageAssetPointer,asset_pointer:(P=g.asset_pointer)!=null?P:"",size_bytes:(N=g.size_bytes)!=null?N:0,width:(O=g.width)!=null?O:0,height:(q=g.height)!=null?q:0}})),a=p.useMemo(()=>o.filter(g=>g.data),[o]),r=a.length>0,c=p.useMemo(()=>o.some(g=>g.isError),[o]),u=p.useMemo(()=>o.some(g=>g.isFetching),[o]),[i,d]=p.useState(0),[n,l]=p.useState(!1),w=Math.min(Math.max(i,0),Math.max(a.length-1,0)),b=p.useCallback(()=>{a.length<=1||(d(g=>(g-1+a.length)%a.length),Be.recordPreviewImagesCarouselPrev())},[a.length]),_=p.useCallback(()=>{a.length<=1||(d(g=>(g+1)%a.length),Be.recordPreviewImagesCarouselNext())},[a.length]),x=p.useCallback(async()=>{l(!0);try{await Promise.all(o.map(g=>g.refetch({throwOnError:!1})))}finally{l(!1)}},[o]);jt([{key:"previewCarouselPrev",action:b,actionMessageDescriptor:e.formatMessage({id:"wham.keyboardActions.previousPreviewImage",defaultMessage:"Select previous image"}),group:ze.Chat,keyboardBinding:[Oe.ArrowLeft],enabled:a.length>1},{key:"previewCarouselNext",action:_,actionMessageDescriptor:e.formatMessage({id:"wham.keyboardActions.nextPreviewImage",defaultMessage:"Select next image"}),group:ze.Chat,keyboardBinding:[Oe.ArrowRight],enabled:a.length>1}]);const f=(m=a[w])==null?void 0:m.data,E=!r&&c&&!u;return s.jsxs("div",{className:"relative flex h-full w-full items-center justify-center overflow-hidden p-4",children:[E?s.jsx(Va,{isRetrying:n,onRetry:()=>{x()}}):f?s.jsx("div",{className:"flex h-full w-full items-start justify-center overflow-auto",children:s.jsx("img",{src:f.url,width:f.width,height:f.height,alt:e.formatMessage({id:"wham.whamTaskPageContentLoaded.previewImageAlt",defaultMessage:"Generated image"}),className:"h-auto max-w-full"},w)}):s.jsx("div",{className:"text-secondary flex h-full w-full items-center justify-center text-sm",children:s.jsx(me,{id:"wham.whamPreviewImageCarousel.loading",defaultMessage:"Loading preview…"})}),a.length>1&&s.jsxs(s.Fragment,{children:[s.jsx("button",{type:"button","aria-label":e.formatMessage({id:"wham.whamPreviewImageCarousel.prev",defaultMessage:"Previous image"}),onClick:b,className:"absolute start-2 top-1/2 -translate-y-1/2 rounded-md bg-black/40 px-2 py-1 text-white hover:bg-black/60 focus:ring-2 focus:ring-white/70 focus:outline-none",children:"‹"}),s.jsx("button",{type:"button","aria-label":e.formatMessage({id:"wham.whamPreviewImageCarousel.next",defaultMessage:"Next image"}),onClick:_,className:"absolute end-2 top-1/2 -translate-y-1/2 rounded-md bg-black/40 px-2 py-1 text-white hover:bg-black/60 focus:ring-2 focus:ring-white/70 focus:outline-none",children:"›"}),s.jsxs("div",{className:"pointer-events-none absolute start-1/2 bottom-2 -translate-x-1/2 rounded-md bg-black/40 px-2 py-0.5 text-xs text-white",children:[w+1," / ",a.length]})]})]})}const za=["task","user_turn","assistant_turn","rollout","app_server_events"];function Ya(t){"use forget";const e=qe.c(93),{task:o,userTurn:a,assistantTurn:r,assistantTurns:c,rollout:u}=t,i=ge();let d;e[0]!==r||e[1]!==c.length||e[2]!==u||e[3]!==o||e[4]!==a?(d=()=>o?"task":a?"user_turn":r?"assistant_turn":u?"rollout":c.length>0?"app_server_events":"task",e[0]=r,e[1]=c.length,e[2]=u,e[3]=o,e[4]=a,e[5]=d):d=e[5];const n=d,[l,w]=p.useState(n);let b;e[6]!==i?(b=i.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.noData",defaultMessage:"No data available for this view."}),e[6]=i,e[7]=b):b=e[7];const _=b;let x;e[8]!==i?(x=i.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.noDataTooltip",defaultMessage:"No data available for this tab"}),e[8]=i,e[9]=x):x=e[9];const f=x;let E;e[10]!==_?(E=(se,fe)=>se?s.jsx("div",{className:"flex h-full w-full overflow-auto p-4",children:s.jsx(La,{json:se,jsonFiltersKey:fe,jsonViewProps:{collapsed:5}})}):s.jsx("div",{className:"text-token-text-tertiary flex h-full w-full items-center justify-center p-4 text-sm",children:_}),e[10]=_,e[11]=E):E=e[11];const m=E,g=!!o,P=!!a,N=!!r,O=!!u,q=c.length>0;let v;e[12]!==g||e[13]!==P||e[14]!==N||e[15]!==O||e[16]!==q?(v={task:g,user_turn:P,assistant_turn:N,rollout:O,app_server_events:q},e[12]=g,e[13]=P,e[14]=N,e[15]=O,e[16]=q,e[17]=v):v=e[17];const H=v;let Y;e:{if(c.length===0){Y=null;break e}let se;e[18]!==c?(se=c.flatMap(Ja),e[18]=c,e[19]=se):se=e[19],Y=se}const A=Y;let S;e[20]!==i?(S=i.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.task",defaultMessage:"Task"}),e[20]=i,e[21]=S):S=e[21];let ee;e[22]!==i?(ee=i.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.taskAriaLabel",defaultMessage:"Tab to view the task object"}),e[22]=i,e[23]=ee):ee=e[23];const X=o?void 0:f;let T;e[24]!==m||e[25]!==o?(T=m(o,"internal-data-task"),e[24]=m,e[25]=o,e[26]=T):T=e[26];let de;e[27]!==S||e[28]!==ee||e[29]!==X||e[30]!==T?(de={key:"task",label:S,ariaLabel:ee,tooltip:X,children:T},e[27]=S,e[28]=ee,e[29]=X,e[30]=T,e[31]=de):de=e[31];let C;e[32]!==i?(C=i.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.userTurn",defaultMessage:"User Turn"}),e[32]=i,e[33]=C):C=e[33];let U;e[34]!==i?(U=i.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.userTurnAriaLabel",defaultMessage:"Tab to view the user turn object"}),e[34]=i,e[35]=U):U=e[35];const R=a?void 0:f;let J;e[36]!==m||e[37]!==a?(J=m(a,"internal-data-user-turn"),e[36]=m,e[37]=a,e[38]=J):J=e[38];let ne;e[39]!==C||e[40]!==U||e[41]!==R||e[42]!==J?(ne={key:"user_turn",label:C,ariaLabel:U,tooltip:R,children:J},e[39]=C,e[40]=U,e[41]=R,e[42]=J,e[43]=ne):ne=e[43];let Q;e[44]!==i?(Q=i.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.assistantTurn",defaultMessage:"Assistant Turn"}),e[44]=i,e[45]=Q):Q=e[45];let W;e[46]!==i?(W=i.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.assistantTurnAriaLabel",defaultMessage:"Tab to view the assistant turn object"}),e[46]=i,e[47]=W):W=e[47];const oe=r?void 0:f;let re;e[48]!==r||e[49]!==m?(re=m(r,"internal-data-assistant-turn"),e[48]=r,e[49]=m,e[50]=re):re=e[50];let te;e[51]!==Q||e[52]!==W||e[53]!==oe||e[54]!==re?(te={key:"assistant_turn",label:Q,ariaLabel:W,tooltip:oe,children:re},e[51]=Q,e[52]=W,e[53]=oe,e[54]=re,e[55]=te):te=e[55];let $;e[56]!==i?($=i.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.rollout",defaultMessage:"Rollout"}),e[56]=i,e[57]=$):$=e[57];let ae;e[58]!==i?(ae=i.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.rolloutAriaLabel",defaultMessage:"Tab to view the rollout data"}),e[58]=i,e[59]=ae):ae=e[59];const ie=u?void 0:f;let K;e[60]!==m||e[61]!==u?(K=m(u,"internal-data-rollout"),e[60]=m,e[61]=u,e[62]=K):K=e[62];let k;e[63]!==$||e[64]!==ae||e[65]!==ie||e[66]!==K?(k={key:"rollout",label:$,ariaLabel:ae,tooltip:ie,children:K},e[63]=$,e[64]=ae,e[65]=ie,e[66]=K,e[67]=k):k=e[67];let V;e[68]!==i?(V=i.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.appServerEvents",defaultMessage:"App Server Events"}),e[68]=i,e[69]=V):V=e[69];let F;e[70]!==i?(F=i.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels.appServerEventsAriaLabel",defaultMessage:"Tab to view app server events for assistant turns"}),e[70]=i,e[71]=F):F=e[71];const G=c.length>0?void 0:f;let B;e[72]!==A||e[73]!==m?(B=m(A,"internal-data-app-server-events"),e[72]=A,e[73]=m,e[74]=B):B=e[74];let M;e[75]!==V||e[76]!==F||e[77]!==G||e[78]!==B?(M={key:"app_server_events",label:V,ariaLabel:F,tooltip:G,children:B},e[75]=V,e[76]=F,e[77]=G,e[78]=B,e[79]=M):M=e[79];let L;e[80]!==de||e[81]!==ne||e[82]!==te||e[83]!==k||e[84]!==M?(L=[de,ne,te,k,M],e[80]=de,e[81]=ne,e[82]=te,e[83]=k,e[84]=M,e[85]=L):L=e[85];const Z=L;let le;e[86]!==H?(le=za.find(se=>H[se]),e[86]=H,e[87]=le):le=e[87];const y=le,I=H[l]||!y?l:y;let z,h;e[88]===Symbol.for("react.memo_cache_sentinel")?(z=s.jsx(kt,{className:"border-token-border-heavy border-b px-3",buttonClassName:"pb-2 pt-2"}),h=s.jsx(Mt,{children:Xa}),e[88]=z,e[89]=h):(z=e[88],h=e[89]);let j;return e[90]!==I||e[91]!==Z?(j=s.jsx("div",{className:"flex h-full w-full flex-col",children:s.jsxs(Ct,{tabs:Z,currentTab:I,onChange:w,withUnderline:!0,children:[z,h]})}),e[90]=I,e[91]=Z,e[92]=j):j=e[92],j}function Xa(t){const{content:e}=t;return s.jsx("div",{className:"flex h-full w-full",children:e})}function Ja(t){var e,o;return(o=(e=t.app_server_events)==null?void 0:e.events)!=null?o:[]}const Nt=wt(()=>ht(()=>import("./dabcfwyv1j7qyi38.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54])).then(t=>t.WhamTaskPageCodeDiffContent),{loading:()=>s.jsx("div",{className:"flex-1"})});function Za(t){"use forget";var j,se;const e=qe.c(100),{currentTab:o,setCurrentTab:a,defaultTab:r,isMobile:c,hasDiff:u,previewImages:i,diffFiles:d,unifiedDiff:n,handleDiffModeChange:l,showFullDiff:w,setShowFullDiff:b,isPreferencesLoading:_,isSharedExampleTask:x,focusedAssistantTurn:f,leftContent:E}=t,{taskId:m,task:g,canFollowUp:P,pastTurns:N}=Ie(),{comments:O,setComments:q}=tt(),v=ge();let H;e[0]!==_?(H=[_],e[0]=_,e[1]=H):H=e[1],p.useEffect(ts,H);let Y;if(e[2]!==f||e[3]!==N){e:{if(!f){Y=null;break e}const fe=N!=null?N:[];let ce;e[5]!==f?(ce=ue=>ue.id===f.id,e[5]=f,e[6]=ce):ce=e[6];const pe=fe.findIndex(ce);if(pe>0)for(let ue=pe-1;ue>=0;ue=ue-1,ue){const be=fe[ue];if(Le(be)){Y=be;break e}}if(f.previous_turn_id){let ue;e[7]!==f.previous_turn_id?(ue=Fe=>Le(Fe)&&Fe.id===f.previous_turn_id,e[7]=f.previous_turn_id,e[8]=ue):ue=e[8];const be=fe.find(ue);if(be){Y=be;break e}}const ve=[...fe].reverse().find(es);Y=ve!=null?ve:null}e[2]=f,e[3]=N,e[4]=Y}else Y=e[4];const A=Y;let S;e[9]!==N?(S=N!=null?N:[],e[9]=N,e[10]=S):S=e[10];let ee;e[11]!==S?(ee=S.filter(Ce),e[11]=S,e[12]=ee):ee=e[12];const X=ee,T=(j=f==null?void 0:f.id)!=null?j:m,de=!c;let C;e[13]!==v?(C=v.formatMessage({id:"wham.whamTaskPageContentLoaded.conversation",defaultMessage:"Conversation"}),e[13]=v,e[14]=C):C=e[14];let U;e[15]!==v?(U=v.formatMessage({id:"wham.whamTaskPageContentLoaded.conversationAriaLabel",defaultMessage:"Tab to view the conversation with the assistant"}),e[15]=v,e[16]=U):U=e[16];let R;e[17]!==E||e[18]!==de||e[19]!==C||e[20]!==U?(R={key:"chat",isHidden:de,label:C,ariaLabel:U,children:E},e[17]=E,e[18]=de,e[19]=C,e[20]=U,e[21]=R):R=e[21];const J=i.length===0;let ne;e[22]!==v?(ne=v.formatMessage({id:"wham.whamTaskPageContentLoaded.preview",defaultMessage:"Preview"}),e[22]=v,e[23]=ne):ne=e[23];let Q;e[24]!==v?(Q=v.formatMessage({id:"wham.whamTaskPageContentLoaded.previewAriaLabel",defaultMessage:"Tab to view preview images"}),e[24]=v,e[25]=Q):Q=e[25];let W;e[26]!==i?(W=s.jsx(Ga,{previewImages:i}),e[26]=i,e[27]=W):W=e[27];let oe;e[28]!==J||e[29]!==ne||e[30]!==Q||e[31]!==W?(oe={key:"preview",isHidden:J,label:ne,ariaLabel:Q,children:W},e[28]=J,e[29]=ne,e[30]=Q,e[31]=W,e[32]=oe):oe=e[32];const re=!u;let te;e[33]!==v?(te=v.formatMessage({id:"wham.whamTaskPageContentLoaded.diff",defaultMessage:"Diff"}),e[33]=v,e[34]=te):te=e[34];let $;e[35]!==v?($=v.formatMessage({id:"wham.whamTaskPageContentLoaded.diffAriaLabel",defaultMessage:"Tab to view the code diff"}),e[35]=v,e[36]=$):$=e[36];let ae;e[37]!==P||e[38]!==O||e[39]!==d||e[40]!==u||e[41]!==_||e[42]!==q||e[43]!==n?(ae=!_&&u&&s.jsx(Nt,{diffFiles:d,unifiedDiff:n,enableComments:P,comments:O,setComments:q}),e[37]=P,e[38]=O,e[39]=d,e[40]=u,e[41]=_,e[42]=q,e[43]=n,e[44]=ae):ae=e[44];let ie;e[45]!==re||e[46]!==te||e[47]!==$||e[48]!==ae?(ie={key:"diff",isHidden:re,label:te,ariaLabel:$,children:ae},e[45]=re,e[46]=te,e[47]=$,e[48]=ae,e[49]=ie):ie=e[49];let K;e[50]!==v?(K=v.formatMessage({id:"wham.whamTaskPageContentLoaded.logs",defaultMessage:"Logs"}),e[50]=v,e[51]=K):K=e[51];let k;e[52]!==v?(k=v.formatMessage({id:"wham.whamTaskPageContentLoaded.logsAriaLabel",defaultMessage:"Tab to view the work logs"}),e[52]=v,e[53]=k):k=e[53];const V=(se=f==null?void 0:f.environment)==null?void 0:se.agent_network_access;let F;e[54]!==f||e[55]!==V||e[56]!==m?(F=s.jsx(pa,{taskId:m,focusedAssistantTurn:f,agentNetworkAccess:V}),e[54]=f,e[55]=V,e[56]=m,e[57]=F):F=e[57];let G;e[58]!==x||e[59]!==K||e[60]!==k||e[61]!==F?(G={key:"logs",isHidden:x,label:K,ariaLabel:k,children:F},e[58]=x,e[59]=K,e[60]=k,e[61]=F,e[62]=G):G=e[62];let B;e[63]!==v?(B=v.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModels",defaultMessage:"Internal Data Models"}),e[63]=v,e[64]=B):B=e[64];let M;e[65]!==v?(M=v.formatMessage({id:"wham.whamTaskPageContentLoaded.internalDataModelsAriaLabel",defaultMessage:"Tab to view internal data models"}),e[65]=v,e[66]=M):M=e[66];const L=f==null?void 0:f.internal_only_rollouts;let D;e[67]!==X||e[68]!==f||e[69]!==L||e[70]!==g||e[71]!==A?(D=s.jsx(Ya,{task:g,userTurn:A,assistantTurn:f,assistantTurns:X,rollout:L}),e[67]=X,e[68]=f,e[69]=L,e[70]=g,e[71]=A,e[72]=D):D=e[72];let Z;e[73]!==B||e[74]!==M||e[75]!==D?(Z={key:"internal_data_models",isHidden:!0,label:B,ariaLabel:M,children:D},e[73]=B,e[74]=M,e[75]=D,e[76]=Z):Z=e[76];let le;e[77]!==oe||e[78]!==ie||e[79]!==G||e[80]!==Z||e[81]!==R?(le=[R,oe,ie,G,Z],e[77]=oe,e[78]=ie,e[79]=G,e[80]=Z,e[81]=R,e[82]=le):le=e[82];let y;e[83]!==l||e[84]!==u||e[85]!==b||e[86]!==w||e[87]!==n?(y=u&&s.jsx(wa,{unifiedDiff:n,setUnifiedDiff:l,showFullDiff:w,setShowFullDiff:b}),e[83]=l,e[84]=u,e[85]=b,e[86]=w,e[87]=n,e[88]=y):y=e[88];let I;e[89]!==c||e[90]!==y?(I=s.jsx(kt,{withUnderline:c,className:"items-center border-b p-3 pe-16 max-md:py-0",children:y}),e[89]=c,e[90]=y,e[91]=I):I=e[91];let z;e[92]===Symbol.for("react.memo_cache_sentinel")?(z=s.jsx(Mt,{children:Aa}),e[92]=z):z=e[92];let h;return e[93]!==o||e[94]!==r||e[95]!==a||e[96]!==le||e[97]!==I||e[98]!==T?(h=s.jsx("div",{className:"relative flex h-full w-full flex-col",children:s.jsxs(Ct,{onChange:a,currentTab:o,defaultTab:r,tabs:le,children:[I,z]},T)}),e[93]=o,e[94]=r,e[95]=a,e[96]=le,e[97]=I,e[98]=T,e[99]=h):h=e[99],h}function Aa(t){const{content:e}=t;return s.jsx("div",{className:"flex h-full w-full",children:e})}function es(t){return Le(t)}function ts(){Nt.prefetch()}const dt="oai/apps/wham-task-page-content-left-width",ut=672,Ve=400,as=({leftContent:t,rightContent:e=null})=>{const[o,a]=p.useState(()=>Tt(ot.DANGER_SECRET_FOLDERS_ONLY_getItem(dt),400)),r=sa(o,Ve,ut);p.useEffect(()=>{const n=setTimeout(()=>{ot.DANGER_SECRET_FOLDERS_ONLY_setItem(dt,r)},500);return()=>clearTimeout(n)},[r]);const c=p.useRef(null);c.current=()=>{e&&a(r)};const u=p.useCallback(()=>{var n;return(n=c.current)==null?void 0:n.call(c)},[]),[i,d]=p.useState(!1);return s.jsxs("div",{className:"flex h-full min-h-0 w-full",children:[s.jsxs(ke.div,{className:"relative h-full shrink-0",animate:{width:e?r:"100%"},initial:!1,transition:{type:"tween",duration:i?0:.14,ease:"easeOut"},children:[s.jsx(ke.div,{className:"flex h-full w-full flex-col items-center",transition:{type:"tween",duration:i?0:.14,ease:"easeOut"},animate:{width:e?r:"100%"},children:s.jsx("div",{className:"flex h-full flex-col",style:{width:e?r:"100%"},children:t})}),e&&s.jsx(ke.div,{drag:"x",className:xe("absolute end-[-1px] top-0 bottom-0 z-10 w-[1px] cursor-ew-resize after:absolute after:inset-0 after:-inset-x-2 after:content-['']",i?"bg-token-text-primary":"bg-token-border-light hover:bg-token-text-primary dark:bg-token-border-heavy transition-colors delay-0 hover:delay-300"),whileDrag:{width:"2px",end:"-1px"},transition:{type:"tween",duration:0},initial:!1,style:{x:0,y:0},dragMomentum:!1,dragElastic:!1,dragConstraints:{left:0,right:0,top:0,bottom:0},onDragStart:()=>d(!0),onDrag:(n,{delta:{x:l}})=>a(w=>w+l),onDragEnd:()=>{d(!1),u()},onDoubleClick:()=>a(r===Ve?ut:Ve)})]}),s.jsx(xt,{children:e&&s.jsx(ke.div,{className:"flex h-full min-w-0 flex-1",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:i?0:.04,ease:"easeOut",delay:.1},children:e})})]})};function Lt(t){const{outputDiffs:e}=Te(t==null?void 0:t.output_items);return{filesModified:Ke(e,o=>{var a;return(a=o.files_modified)!=null?a:0}),linesAdded:Ke(e,o=>{var a;return(a=o.lines_added)!=null?a:0}),linesRemoved:Ke(e,o=>{var a;return(a=o.lines_removed)!=null?a:0})}}function Te(t){let e=!1;return t?{outputDiffs:t.map(a=>{switch(a.type){case"output_diff":return a;case"pr":return e=!!a.pre_apply_patch,a.output_diff;case"cr":return a.reviewed_diff;default:return null}}).filter(a=>a!=null),hasPreApplyPatch:e}:{outputDiffs:[],hasPreApplyPatch:e}}function ss({isOpen:t,onConfirm:e,onClose:o,loading:a}){return s.jsx(Qt,{isOpen:t,onClose:o,testId:"modal-wham-retry-all-turns",type:"warning",title:s.jsx("p",{className:"text-token-text-primary font-semibold",children:s.jsx(me,{id:"wham.retryAllTurnsModal.title",defaultMessage:"Retry all turns"})}),primaryButton:s.jsx(_e,{color:"primary",loading:a,onClick:e,children:s.jsx(me,{id:"wham.retryAllTurnsModal.confirm",defaultMessage:"Retry all turns"})}),secondaryButton:s.jsx(_e,{color:"secondary",onClick:o,children:s.jsx(me,{id:"wham.retryAllTurnsModal.cancel",defaultMessage:"Cancel"})}),children:s.jsx("div",{className:"text-sm",children:s.jsx(me,{id:"wham.retryAllTurnsModal.message",defaultMessage:"All latest turns will restart, including any siblings turns that are in progress or completed."})})})}function os({focusedAssistantTurn:t,lastTurn:e,siblings:o}){const a=(e==null?void 0:e.type)==="assistant"?e.turn_status:"completed";return t&&((e==null?void 0:e.id)===t.id||o.some(c=>c.id===(e==null?void 0:e.id)))?t.turn_status:a}function is({turnId:t,comments:e,clearComments:o,lastTurn:a,focusedAssistantTurn:r,retry:c,attemptIndex:u,siblings:i}){var ie,K,k,V,F,G,B;const d=_t(),{taskId:n,task:l,setFocusedAssistantTurnId:w}=Ie(),b=Ae(),_=ge(),x=je(),f=$t(),E=Kt(),m=Ia(d),g=M=>{Vt(Gt(E)),o(),w(M.turn.id)},P=async()=>{var M,L;if(c){Y(!0);try{if(c.previousTurnId){const D=await he.createFollowUpTask(n,c.previousTurnId,c.prompt,(M=c.comments)!=null?M:[],!1,T?(L=c.bestOfN)!=null?L:1:void 0,m?c.attachments:[]);g(D)}else{const D=await he.createNewTask(c.environmentId,c.branch,c.prompt,!1,T?c.bestOfN:void 0,m?c.attachments:[]);b("/codex/tasks/".concat(D.task.id))}S(!1)}catch(D){D instanceof Je?Ze(D,t,_,x):x.danger(gt({id:"wham.whamTaskPageFooter.errorRetryingTask",defaultMessage:"Error retrying task"}),{toastId:"wham_task_page_footer_error_retrying_task"})}finally{Y(!1)}}},N=!!r&&Te(r.output_items).outputDiffs.length>0,O=!a||!r||a.id===(r==null?void 0:r.id)||!N,q=c&&O&&(r==null?void 0:r.turn_status)==="failed",v=(r==null?void 0:r.previous_turn_id)&&(a==null?void 0:a.type)==="assistant"&&r.previous_turn_id===a.previous_turn_id,[H,Y]=p.useState(!1),[A,S]=p.useState(!1),ee=Ee(d,"1406552515"),X=Ee(d,"879591222")||void 0,T=Ee(d,"3492040717"),de=p.useMemo(()=>{var D,Z,le,y,I,z,h;const M=[...(le=(Z=(D=r==null?void 0:r.output_items)==null?void 0:D.find(j=>j.type==="review"))==null?void 0:Z.suggested_followup_tasks)!=null?le:[],...(I=(y=r==null?void 0:r.output_items)==null?void 0:y.filter(j=>j.type==="suggested_task"))!=null?I:[]],L=xa((h=(z=r==null?void 0:r.child_turns)==null?void 0:z.filter(j=>j.source.type==="suggested_task"))==null?void 0:h.map(j=>[j.source.suggested_task_id,j]));return M.map(j=>{var se,fe,ce,pe;return{suggestion:j,userTurnId:j.id&&(fe=(se=L[j.id])==null?void 0:se.assistant_turn_id)!=null?fe:null,assistantTurnId:j.id&&(pe=(ce=L[j.id])==null?void 0:ce.user_turn_id)!=null?pe:null}})},[r]),C=(ie=r==null?void 0:r.id)!=null?ie:t,U=p.useMemo(()=>{var M,L;return(L=(M=r==null?void 0:r.output_items)==null?void 0:M.filter(ja))!=null?L:[]},[r]),R=p.useMemo(()=>U.reduce((M,L)=>M+L.comments.filter(D=>D.priority===0||D.priority===1).length,0),[U]),J=((k=(K=l==null?void 0:l.task_status_display)==null?void 0:K.latest_turn_status_display)==null?void 0:k.intent)==="cr",ne=(O||v)&&U.length>0,Q=Ra({taskId:n,latestTurnId:C}),W=Q.isPending||!C||R===0||ee,oe=os({focusedAssistantTurn:r,lastTurn:a,siblings:i}),re=(V=i==null?void 0:i.map(M=>M.turn_status))!=null?V:[],te=(F=i==null?void 0:i.map(M=>{var L;return(L=M.cancellation_requested_at)!=null?L:null}))!=null?F:[],$=(a==null?void 0:a.type)==="assistant"?a:null;return $&&["pending","in_progress"].includes($.turn_status)&&!Pa($)&&!X?null:s.jsxs(s.Fragment,{children:[s.jsxs("div",{id:"wham-message-modal-footer",className:"z-50 flex w-full justify-center",children:[(O||v)&&s.jsx("div",{className:"flex w-full justify-center px-4",children:s.jsx("div",{className:xe("relative z-1 flex w-full flex-col pt-2 pb-4",Xe),children:q?s.jsx(_e,{className:"w-full",color:"primary",size:"large",loading:H&&!A,onClick:()=>{var M;((M=c==null?void 0:c.bestOfN)!=null?M:1)>1?S(!0):P()},children:((G=c.bestOfN)!=null?G:1)>1?_.formatMessage({id:"wham.whamTaskPageFooter.retryAllTurns",defaultMessage:"Retry all turns"}):_.formatMessage({id:"wham.whamTaskPageFooter.retry",defaultMessage:"Retry"})}):ne?s.jsxs("div",{className:"flex w-full flex-col gap-3",children:[s.jsx(ct,{}),s.jsx(_e,{className:"w-full",color:"primary",size:"large",disabled:W,loading:Q.isPending,onClick:()=>{W||Q.mutateAsync(void 0)},children:s.jsx(me,{id:"wham.whamTaskPageFooter.fixIssues",defaultMessage:"{count, plural, one {Fix issue} other {Fix issues}}",values:{count:R}})})]}):o&&!J&&s.jsxs("div",{className:"flex w-full flex-col gap-3",children:[s.jsx(ct,{}),!ee&&s.jsx(Fa,{disableAutoFocus:!0,disableDuringSubmit:!0,onSuccess:g,onClearComments:o,followUp:{taskId:n,turnId:t,comments:e,turnStatus:oe,siblingTurnStatuses:re,cancellationRequestedAt:(B=r==null?void 0:r.cancellation_requested_at)!=null?B:null,siblingCancellationRequestedAts:te,followUpSuggestions:de},attemptIndex:u,ariaLabel:_.formatMessage({id:"wham.whamTaskPageFooter.composerAriaLabel",defaultMessage:"Composer to enter a follow up prompt to the task"})})]})})}),!O&&!v&&s.jsx(ke.div,{layout:!0,className:xe("dark mx-6 mb-6 w-full",Xe),initial:{opacity:0,translateY:10},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:10},transition:{duration:f?0:.25},children:s.jsx(oa,{title:s.jsx(me,{id:"wham.whamTaskPageFooter.previousTurn",defaultMessage:"You are viewing a previous turn"}),primaryCtaText:s.jsx(me,{id:"wham.whamTaskPageFooter.viewLatestTurn",defaultMessage:"View latest"}),content:s.jsx(me,{id:"wham.whamTaskPageFooter.followUpsLatestTurn",defaultMessage:"Follow-ups are only available for the latest turn"}),icon:s.jsx(ia,{className:"icon"}),onPrimaryCtaClick:()=>w(a.id)})})]}),s.jsx(ss,{isOpen:A,onClose:()=>S(!1),onConfirm:P,loading:H})]})}const It=window.location.origin+"/s/";function rs(t){return"".concat(It).concat(t)}function Ft(t){var e,o;return!t||!t.attachments||t.attachments.length===0||t.attachments[0].kind!=="codex"?null:{postId:t.id,permalink:(e=t.permalink)!=null?e:rs(t.id),permissions:(o=t.permissions.share_setting)!=null?o:"public",codexTask:t.attachments[0].task,codexTurn:t.attachments[0].turns}}function Ne(t){return["codex_tasks","result","share",t]}function ns({taskId:t,enabled:e}){return Bt({enabled:!!t&&e,queryKey:Ne(t),queryFn:async()=>{const o=await et.safeGet("/share/post/by_codex_task/{codex_task_id}",{parameters:{path:{codex_task_id:t}}});return o.post?Ft(o.post):null}})}function ls({taskId:t,onSuccess:e,onError:o}){return Me({scope:{id:t},mutationFn:()=>he.forkSharedTask(t),onSuccess:e,onError:o})}function cs({taskId:t,turnId:e,onSuccess:o,onError:a}){return Me({scope:{id:t},mutationFn:async()=>{const r=await et.safePost("/share/post",{requestBody:{attachments_to_create:[{kind:"codex",codex_task_id:t,current_codex_turn_id:e}]}});return Ft(r.post)},onSuccess:o,onError:a})}function ds({taskId:t,sharedResult:e}){var a;const o=He();return Me({scope:{id:(a=e==null?void 0:e.postId)!=null?a:""},mutationFn:async({sharedResultId:r,access:c})=>(await et.safePost("/share/post/update_access",{requestBody:{post_id:r,share_settings:c}})).share_setting,onMutate:({access:r})=>{const c=Ne(t),u=o.getQueryData(c);return o.setQueryData(c,u&&Se(Pe({},u),{permissions:r})),{previousAccess:u==null?void 0:u.permissions}},onSuccess:r=>{const c=Ne(t),u=o.getQueryData(c);u&&o.setQueryData(c,Se(Pe({},u),{permissions:r}))},onError:(r,c,u)=>{var n;const i=Ne(t),d=o.getQueryData(i);o.setQueryData(i,d&&Se(Pe({},d),{permissions:(n=u==null?void 0:u.previousAccess)!=null?n:"public"}))}})}function us({taskId:t}){const e=ge(),o=je(),a=Ae(),{mutate:r}=ls({taskId:t,onSuccess:c=>{var u,i;(u=c==null?void 0:c.task)!=null&&u.id&&a("/codex/tasks/".concat((i=c==null?void 0:c.task)==null?void 0:i.id))},onError:()=>{o.danger(e.formatMessage({id:"wham.codexForkButton.failedToFork",defaultMessage:"Failed to fork task"}))}});return s.jsx(_e,{size:"small",color:"secondary",type:"button",className:"px-3 py-2",onClick:()=>r(),children:s.jsx(me,{id:"wham.share.taskForkButton",defaultMessage:"Fork"})})}const ms="".concat(It,"...");function fs({taskId:t,turnId:e,isLoading:o,sharedResult:a,title:r}){const[c,u]=p.useState(!1),i=(m,g)=>{m&&Xt(m,void 0,g).then(()=>{u(!0),setTimeout(()=>u(!1),1500)}).catch(()=>{})},d=He(),n=je(),{mutate:l,isPending:w}=cs({taskId:t,turnId:e,onSuccess:m=>{if(!m){n.danger("Failed to create share link");return}d.setQueryData(Ne(t),m),i(m.permalink)}}),{mutate:b}=ds({taskId:t,sharedResult:a}),_=p.useRef(null),x=m=>{var g;(g=_.current)==null||g.focus(),a?i(a.permalink,m):l()},f=m=>{a&&b({sharedResultId:a.postId,access:m})},E=m=>{switch(m){case"public":return Qe.PUBLIC;case"private":return Qe.PRIVATE;case"workspace":return Qe.WORKSPACE}};return s.jsx(Ba,{inputRef:_,isLoading:o,isPublishedVersionLatest:!0,sharedObject:a&&{id:a.postId,title:r,access:E(a.permissions)},title:r,shareTextPlaceholder:ms,shareUrl:a==null?void 0:a.permalink,isCopySuccessful:c,isCreateLinkRequestInProgress:w,handlePrivacyChange:f,handlePrimaryButtonClick:x})}function hs({taskId:t,turnId:e,isDisabled:o,title:a}){const r=Ue(),c=vt(),u=ge(),[i,d]=p.useState(!1),{data:n,isLoading:l}=ns({taskId:t,enabled:i&&!o}),{triggerRef:w,container:b}=zt({isOpen:i,onClose:()=>d(!1)}),_=(c==null?void 0:c.isWorkspaceAccount())&&!(c!=null&&c.features.includes(Yt.WorkspaceShareLinks));return o||_?s.jsx(bt,{label:_?u.formatMessage(Re.workspaceSharingDisabled):u.formatMessage(Re.share),children:s.jsx(Ye,{disabled:!0,icon:ra,"aria-label":u.formatMessage(_?Re.workspaceSharingDisabled:Re.share)})}):s.jsxs(na,{open:i,onOpenChange:d,children:[s.jsx(la,{ref:w,asChild:!0,children:r?s.jsx(Ye,{icon:it,"aria-label":u.formatMessage({id:"wham.whamTaskPageHeader.shareAriaLabel",defaultMessage:"Share task"})}):s.jsx(_e,{icon:it,color:"ghost","aria-label":u.formatMessage({id:"wham.whamTaskPageHeader.shareAriaLabel",defaultMessage:"Share task"}),children:s.jsx(me,{id:"wham.whamTaskPageHeader.share",defaultMessage:"Share"})})}),s.jsx(xt,{children:i&&s.jsx(ca,{forceMount:!0,container:b,children:s.jsx(da,{align:"end",className:"z-50",sideOffset:8,collisionPadding:8,children:s.jsx(fs,{title:a,taskId:t,turnId:e,sharedResult:n,isLoading:l})})})})]})}function gs({assistantTurn:t}){var _,x,f,E,m,g;const e=ge(),o=je(),a=Ue(),r=(f=(x=(_=t==null?void 0:t.pull_request_data)==null?void 0:_.head)!=null?x:t==null?void 0:t.branch)!=null?f:"",c=Da(r),u=r&&r!==c,{outputDiffs:i}=Te(t==null?void 0:t.output_items),d=i[0],n=(g=(m=t==null?void 0:t.base_commit_sha)!=null?m:(E=t==null?void 0:t.pull_request_data)==null?void 0:E.base_sha)!=null?g:d==null?void 0:d.base_commit_sha;if(a||!r)return null;const l=n!=null&&r!==n,b=l?s.jsx("span",{className:"text-token-text-secondary hover:text-token-text-primary cursor-pointer",onClick:()=>{navigator.clipboard.writeText(n!=null?n:""),o.success(e.formatMessage({id:"wham.baseSha.copied",defaultMessage:"Copied branch commit SHA to clipboard"}))},children:n}):u?r:void 0;return s.jsx(bt,{label:b,side:"bottom",disabled:!b,interactive:l,children:s.jsx("span",{className:"text-token-text-secondary hover:text-token-text-primary cursor-pointer truncate",onClick:()=>{navigator.clipboard.writeText(r),o.success(e.formatMessage({id:"wham.branchName.copied",defaultMessage:"Copied branch name to clipboard"}))},children:c})})}const ps=({assistantTurn:t})=>{const e=ge(),o=p.useMemo(()=>t!=null&&t.created_at?new Date(t.created_at*1e3):null,[t==null?void 0:t.created_at]),a=p.useMemo(()=>(o==null?void 0:o.getFullYear())===new Date().getFullYear(),[o]);return o?o.toLocaleDateString(e.locale,{month:"short",day:"numeric",year:a?void 0:"numeric"}):null},ws=" · ";function xs({title:t,assistantTurn:e}){var d,n,l,w;const{linesAdded:o,linesRemoved:a}=Lt(e),r=(d=e==null?void 0:e.environment)==null?void 0:d.label,c=(w=(l=(n=e==null?void 0:e.pull_request_data)==null?void 0:n.head)!=null?l:e==null?void 0:e.branch)!=null?w:"",i=[{key:"created-at",element:s.jsx("span",{className:"text-token-text-secondary truncate empty:hidden max-md:hidden",children:s.jsx(ps,{assistantTurn:e})}),hideOnMobile:!0,shouldShow:!!(e!=null&&e.created_at)},{key:"environment",element:s.jsx("span",{className:"text-token-text-secondary truncate",children:r}),hideOnMobile:!1,shouldShow:!!r},{key:"branch",element:s.jsx(gs,{assistantTurn:e}),hideOnMobile:!0,shouldShow:!!c,noSeparator:!0},{key:"stats",element:s.jsx("span",{className:"max-md:hidden",children:s.jsx(qa,{linesAdded:o,linesRemoved:a})}),hideOnMobile:!0,shouldShow:!!(o||a)}].filter(b=>b.shouldShow);return s.jsxs("div",{className:"flex min-w-0 flex-col text-sm",children:[s.jsx("div",{className:"flex items-center gap-1",children:s.jsx("span",{className:"truncate font-medium",children:t})}),s.jsx("div",{className:"flex gap-2 max-md:flex-wrap max-md:gap-1",children:i.map((b,_)=>{const x=i[_-1],f=(x==null?void 0:x.hideOnMobile)||b.hideOnMobile||b.noSeparator;return s.jsxs(p.Fragment,{children:[_>0&&s.jsx("span",{"aria-hidden":"true",className:xe("text-token-text-secondary",f?"max-md:hidden":""),children:ws}),b.element]},b.key)})})]})}function _s({focusedAssistantTurn:t,onClose:e,shouldShowShare:o,shouldShowFork:a,permissions:r,title:c,isSharedExampleTask:u=!1}){"use no forget";var L,D,Z,le;const{taskId:i,task:d,currentDiffTaskTurn:n}=Ie(),l=vt(),w=(L=l==null?void 0:l.id)!=null?L:null,b=(D=d==null?void 0:d.creator_workspace)!=null?D:null,[_,x]=p.useState((n==null?void 0:n.pull_request_status)==="creating"),[f,E]=p.useState(void 0),m=je(),g=He(),P=ge(),N=ua(we(n)),O=r==="write",q=We(y=>y.getTurnsForTask(i).filter(Ce)),v=We(y=>y.getTurnsForTask(i)),H=new Map(v.map(y=>[y.id,y])),Y=y=>{if(Ce(y)){const z=d==null?void 0:d.external_pull_requests;if(z&&z.length)for(let h=z.length-1;h>=0;h--){const j=z[h];if(j.assistant_turn_id===y.id)return j}}const I=y.previous_turn_id?H.get(y.previous_turn_id):void 0;return I?Y(I):void 0},A=n!=null?n:t,S=A?Y(A):void 0,{linesAdded:ee,linesRemoved:X}=Lt(n),{outputDiffs:T,hasPreApplyPatch:de}=Te(n==null?void 0:n.output_items),C=O&&!de,U=((le=(Z=d==null?void 0:d.task_status_display)==null?void 0:Z.latest_turn_status_display)==null?void 0:le.intent)==="cr",R=Ae(),J=!!(t!=null&&t.id)&&O&&!U,Q=q.filter(y=>{var I;return(I=n==null?void 0:n.sibling_turn_ids)==null?void 0:I.includes(y.id)}).some(y=>{var I;return(I=y.pull_request_data)==null?void 0:I.url}),W=r==="write"&&S&&!S.pull_request.merged&&S.pull_request.state!=="closed"&&S.codex_updated_sha!==""&&((n==null?void 0:n.id)!==S.assistant_turn_id||(n==null?void 0:n.pull_request_status)==="externally_created")&&!Q,oe=p.useRef(null),{mutate:re,isPending:te}=Me({mutationFn:async()=>{i&&await he.archiveTask(i)},onSuccess:async()=>{await g.invalidateQueries({queryKey:["wham","tasks"]}),await g.invalidateQueries({queryKey:["wham","task",i]}),R("/codex")},onError:()=>{m.danger({id:"wham.whamTaskPageHeader.failedToArchiveTask",defaultMessage:"Failed to archive task",description:"Toast when archive request fails"},{toastId:"wham_task_page_header_failed_to_archive_task"})}}),{mutate:$,isPending:ae}=Me({mutationFn:async()=>{i&&await he.recoverTask(i)},onSuccess:async()=>{await g.invalidateQueries({queryKey:["wham","tasks"]}),await g.invalidateQueries({queryKey:["wham","task",i]})},onError:()=>{m.danger({id:"wham.whamTaskPageHeader.failedToArchiveTask",defaultMessage:"Failed to archive task",description:"Toast when archive request fails"},{toastId:"wham_task_page_header_failed_to_archive_task"})}}),ie=te||ae;p.useEffect(()=>{(n==null?void 0:n.pull_request_status)==="creating"?(x(!0),g.invalidateQueries({queryKey:["wham","task",i,"turns"]})):x(!1)},[i,n==null?void 0:n.pull_request_status,g]),jt([{key:"copyApplyToClipboard",action:()=>{K()},actionMessageDescriptor:P.formatMessage({id:"wham.keyboardActions.copyApplyToClipboard",defaultMessage:"Copy git apply"}),group:ze.Chat,keyboardBinding:[Oe.Mod,Oe.Shift,";"],enabled:!!N}]);const K=async()=>{N&&(await navigator.clipboard.writeText(" (cd \"$(git rev-parse --show-toplevel)\" && git apply --3way <<'EOF' \n".concat(N," \nEOF\n)")),m.success(P.formatMessage({id:"wham.message.modal.footer.copiedToClipboard",defaultMessage:"Copied git apply command to clipboard"}),{duration:3,hasCloseButton:!0}),n!=null&&n.id&&(Be.recordGitAction("diff-copied",ee,X,i,n.id,"regular"),he.copyGitApply(i,n.id,!0)))},k=async()=>{N&&(await navigator.clipboard.writeText(N),m.success(P.formatMessage({id:"wham.whamTaskPageHeader.copiedPatchToClipboard",defaultMessage:"Copied patch to clipboard"}),{duration:3,hasCloseButton:!0}),n!=null&&n.id&&await he.copyGitApply(i,n.id,!1))},V=async()=>{if(!S||!(n!=null&&n.id)){m.danger({id:"wham.whamTaskPageHeader.noPrToUpdate",defaultMessage:"No PR to update",description:"Toast when no PR is found to update"},{duration:3,hasCloseButton:!0,toastId:"wham_task_page_header_no_pr_to_update"});return}x(!0);try{await he.updatePr(i,n.id,S.id)}catch(y){x(!1),await he.getTaskTurnPR(i,S.assistant_turn_id),y instanceof Je?Ze(y,n.id,P,m):m.danger({id:"wham.whamTaskPageHeader.failedToUpdatePr",defaultMessage:"Failed to update PR",description:"Toast when failed to update PR"},{duration:3,hasCloseButton:!0,toastId:"wham_task_page_header_failed_to_update_pr"})}finally{await g.refetchQueries({queryKey:["wham","tasks"]}),await g.refetchQueries({queryKey:["wham","task",i]}),x(!1)}},F=async y=>{if(!(n!=null&&n.id))return;E(y);const I=oe.current;try{x(!0),await he.createPr(i,n.id,y),await g.refetchQueries({queryKey:["wham","task"]}),await g.fetchQuery(ka(i,n.id)).then(z=>{const h=z;h.turn.pull_request_data!=null&&(I&&!I.closed&&h.turn.pull_request_data.url&&I.location.assign(h.turn.pull_request_data.url),ma({title:h.task.title,clientThreadId:h.turn.conversation_id,subtitle:P.formatMessage({id:"wham.message.modal.footer.prCreatedSuccess",defaultMessage:"Click to view your pull request."}),onClick:()=>{var j;window.open((j=h.turn.pull_request_data)==null?void 0:j.url,"_blank")}}))}),Be.recordGitAction("pr-created",ee,X,i,n.id,y!=null?y:"regular")}catch(z){x(!1),I==null||I.close(),z instanceof Je?Ze(z,n.id,P,m):m.danger({id:"wham.message.modal.footer.createPrError",defaultMessage:"Failed to create PR",description:"Error message for failed to create PR"},{duration:3,hasCloseButton:!0,toastId:"wham_task_page_header_failed_to_create_pr"})}},G=()=>{if(!(n!=null&&n.id))return;const y=f?"?mode=".concat(f):"";oe.current=window.open("/codex/tasks/".concat(i,"/turns/").concat(n.id,"/pr").concat(y),"_blank")},B=!!Ue(),M=!!w&&!!b&&w===b;return s.jsxs("div",{className:"border-b-token-border-default flex w-full justify-between gap-2 border-b p-3 transition-colors duration-50",children:[s.jsxs("div",{className:"flex min-w-0 flex-shrink max-md:gap-2",children:[e?s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"hover:bg-token-bg-tertiary group-radix-state-open:bg-token-bg-tertiary rounded-sm p-2 font-semibold",onClick:e,"aria-label":P.formatMessage({id:"wham.taskPageHeader.goBack",defaultMessage:"Go back to tasks"}),children:s.jsx(Wa,{className:"icon-lg text-token-text-secondary"})}),s.jsx("div",{className:"bg-token-border-default my-auto ms-[11px] me-4 h-4 w-[1px] max-md:hidden"})]}):s.jsx("div",{className:"ms-3"}),s.jsx(xs,{title:c,assistantTurn:t})]}),s.jsxs("div",{className:"relative flex h-10 items-center gap-1.5",children:[!1,a&&(t==null?void 0:t.id)&&M&&s.jsx(us,{taskId:i}),J&&(B?s.jsx(Ye,{icon:d!=null&&d.archived?rt:nt,onClick:()=>d!=null&&d.archived?$():re(),disabled:ie,"aria-label":d!=null&&d.archived?P.formatMessage({id:"wham.whamTaskPageHeader.ariaLabelUnarchive",defaultMessage:"Unarchive Task"}):P.formatMessage({id:"wham.whamTaskPageHeader.ariaLabelArchive",defaultMessage:"Archive Task"})}):s.jsx(_e,{color:"ghost",icon:d!=null&&d.archived?rt:nt,loading:ie,onClick:()=>d!=null&&d.archived?$():re(),"aria-label":d!=null&&d.archived?P.formatMessage({id:"wham.whamTaskPageHeader.ariaLabelUnarchive",defaultMessage:"Unarchive Task"}):P.formatMessage({id:"wham.whamTaskPageHeader.ariaLabelArchive",defaultMessage:"Archive Task"}),children:d!=null&&d.archived?s.jsx(me,{id:"wham.whamTaskPageHeader.unarchive",defaultMessage:"Unarchive"}):s.jsx(me,{id:"wham.whamTaskPageHeader.archive",defaultMessage:"Archive"})})),o&&(t==null?void 0:t.id)&&s.jsx(hs,{taskId:i,turnId:t==null?void 0:t.id,isDisabled:!1,title:c!=null?c:""}),r==="write"&&!B&&s.jsx(Oa,{taskId:i}),T.length>0&&!U&&s.jsx(_a,{isCreatingPr:_,assistantTurn:n,copyApplyToClipboard:K,copyPatchToClipboard:k,createPr:F,navigateToCreatingPrPage:G,canCreatePr:C,updateBranch:W?V:void 0,permissions:r,showOnlyViewPr:u}),!B&&!u&&s.jsx(Ea,{})]})]})}function vs({focusedAssistantTurn:t,showFullDiff:e,currentDiffTaskTurn:o}){if(!t)return[];const a=!e;if(we(t,a).length>0)return De({assistantTurn:t,followUp:a});if(we(t,!1).length>0)return De({assistantTurn:t,followUp:!1});if(we(t,!0).length>0)return De({assistantTurn:t,followUp:!0});if(!o||o.id===t.id)return[];const i=we(o,!1),d=we(o,!0);if(i.length===0&&d.length===0)return[];const n=i.length===0&&d.length>0;return De({assistantTurn:o,followUp:n})}const mt=new Set,bs=wt(()=>ht(()=>import("./dabcfwyv1j7qyi38.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54])).then(t=>t.WhamTaskPageCodeDiffContent),{loading:()=>s.jsx("div",{className:"flex-1"})});function Vs({turnId:t,permissions:e,confirmClose:o,setConfirmClose:a,handleClose:r,showForkButton:c,loadingTurnMapping:u,isSharedExampleTask:i=!1}){"use no forget";var y,I,z;const{taskId:d,task:n,focusedAssistantTurn:l,pastTurns:w,canFollowUp:b,currentDiffTaskTurn:_}=Ie(),{comments:x,clearComments:f,setComments:E}=tt(),m=ge(),{data:g,isLoading:P}=Ma(),N=He(),[O,q]=p.useState(void 0),v=p.useMemo(()=>we(l,!0).length>0,[l]),[H,Y]=Jt(Zt.WhamShowFullDiff,!v,fa),A=p.useMemo(()=>vs({focusedAssistantTurn:l,showFullDiff:H,currentDiffTaskTurn:_}),[l,H,_]),S=p.useMemo(()=>l?l.output_items.filter(h=>h.type==="message").flatMap(h=>h.content).filter(h=>h.content_type==="image_asset_pointer_citation").map(h=>({content_type:"image_asset_pointer_citation",asset_pointer:h.asset_pointer,width:h.width,height:h.height,size_bytes:h.size_bytes})):[],[l]),ee=(l==null?void 0:l.turn_status)==="failed",X=S.length>0,T=A.length>0,de=pt(w),C=n?(y=n.title)!=null?y:m.formatMessage({id:"wham.whamTaskPageContentLoaded.newTask",defaultMessage:"New Task"}):null,U=je(),R=!!Ue(),J=R||(g==null?void 0:g.git_diff_mode)==="unified",ne=_t(),Q=Ee(ne,"3673716873");p.useEffect(()=>{const h=l==null?void 0:l.id;h&&!mt.has(h)&&(l==null?void 0:l.turn_status)==="completed"&&(mt.add(h),he.markTurnViewed(d,h))},[l==null?void 0:l.id,d,l==null?void 0:l.turn_status]);const{mutate:W}=Me({mutationFn:h=>he.updateUserPreferences(h),onSuccess:async()=>{await Ca(N)},onError:()=>{U.danger(gt({id:"wham.whamTaskPageContentLoaded.failedToUpdatePreferences",defaultMessage:"Failed to update preferences"}),{toastId:"wham_task_page_content_loaded_failed_to_update_preferences"})}}),oe=h=>{W({diffView:h?"unified":"split"})},re=X?"preview":R?"chat":T?"diff":void 0,[te,$]=p.useState(!1);!te&&n&&($(!0),q(re));const ae=l!=null&&l.turn_status?yt(l==null?void 0:l.turn_status):null,ie=p.useRef(!1),K=p.useRef({}),k=(I=l==null?void 0:l.id)!=null?I:t,V=p.useCallback(h=>K.current[h],[]),F=p.useCallback((h,j)=>{K.current[h]=j},[]),G=p.useMemo(()=>({versionKey:k,getOpenState:V,setOpenState:F}),[k,V,F]);p.useEffect(()=>{ae===!1?ie.current=!0:ae===!0&&ie.current&&T&&q("diff")},[ae]);const B=p.useMemo(()=>{var h,j,se,fe;if(ee&&(l!=null&&l.environment_id)&&(l!=null&&l.branch)){const ce=[...w].reverse().find(ye=>ye.type==="user"),pe=(h=ce==null?void 0:ce.input_items.find(ye=>ye.type==="message"))==null?void 0:h.content.find(ye=>ye.content_type==="text"),ve=pe==null?void 0:pe.text,ue=ce==null?void 0:ce.input_items.filter(ye=>ye.type==="comment"),be=((se=(j=l==null?void 0:l.sibling_turn_ids)==null?void 0:j.length)!=null?se:0)+1,Fe=va((fe=ce==null?void 0:ce.input_items)!=null?fe:[]);return{environmentId:l==null?void 0:l.environment_id,branch:l==null?void 0:l.branch,previousTurnId:ce==null?void 0:ce.previous_turn_id,prompt:ve!=null?ve:"",comments:ue!=null?ue:[],bestOfN:be,attachments:Fe}}},[ee,l,w]),{attemptIndex:M,siblings:L}=p.useMemo(()=>{if(!l)return{attemptIndex:null,hasSiblingTurns:!1};const h=w.filter(se=>{var fe;return Ce(se)&&!!((fe=se.sibling_turn_ids)!=null&&fe.includes(l.id))}),j=h.findIndex(se=>se.id===l.id);return{attemptIndex:j===-1?null:j+1,siblings:h}},[l,w]),D=e==="write"?s.jsx(is,{turnId:(z=l==null?void 0:l.id)!=null?z:t,comments:x,clearComments:f,focusedAssistantTurn:l,lastTurn:de,retry:B,attemptIndex:M,siblings:L!=null?L:[]}):null,Z=s.jsx(Ka,{currentTab:O,permissions:e,onClickFile:()=>q("diff"),onTabChange:h=>q(h),showFullDiff:H,loadingTurnMapping:u,footer:D}),le=s.jsx(lt.Provider,{value:G,children:s.jsx(Za,{currentTab:O,setCurrentTab:h=>q(h),defaultTab:re,isMobile:R,hasDiff:T,previewImages:S,diffFiles:A,unifiedDiff:J,handleDiffModeChange:oe,showFullDiff:H,setShowFullDiff:Y,isPreferencesLoading:P,isSharedExampleTask:i,focusedAssistantTurn:l,leftContent:Z})});return s.jsxs(s.Fragment,{children:[s.jsxs(ke.div,Se(Pe({className:xe("relative flex size-full flex-1 flex-col items-center",R?"[--right-bg:var(--bg-primary)]":"[--right-bg:var(--bg-tertiary)] dark:[--right-bg:black]")},ha),{children:[s.jsx(_s,{title:C,focusedAssistantTurn:l,onClose:r?()=>r==null?void 0:r({force:!0}):void 0,permissions:e,shouldShowShare:Q&&e==="write",shouldShowFork:!!c,isSharedExampleTask:i}),s.jsx("div",{className:"bg-token-bg-primary flex min-h-0 w-full flex-1",children:!n||!te?s.jsx(At,{}):R?le:s.jsx(as,{leftContent:Z,rightContent:i&&T?s.jsx("div",{className:"relative h-full w-full bg-[var(--right-bg)]",children:s.jsx(lt.Provider,{value:G,children:s.jsx(bs,{diffFiles:A,unifiedDiff:J,enableComments:b,comments:x,setComments:E})})}):O?s.jsxs("div",{className:"relative h-full w-full bg-[var(--right-bg)]",children:[le,s.jsx(ga,{className:"absolute end-3 top-2.5",icon:s.jsx(ea,{}),label:m.formatMessage({id:"wham.whamTaskPageContentLoaded.close",defaultMessage:"Close"}),onClick:()=>q(void 0)})]}):void 0})})]})),o&&a&&r&&s.jsx(ba,{setConfirmClose:a,handleClose:r})]})}function Gs({taskId:t,task:e,currentUserTurn:o,currentAssistantTurn:a}){var l,w,b,_;const r=We(x=>x.addTurnToTaskMap),c=We(x=>x.getTurnsForTask),[u,i]=p.useState((w=(l=a==null?void 0:a.id)!=null?l:e==null?void 0:e.current_turn_id)!=null?w:null);p.useEffect(()=>{var x;t&&(a&&["pending","in_progress","failed"].includes(a.turn_status)?i(a.id):i((x=a==null?void 0:a.id)!=null?x:null),o&&r(t,o),a&&r(t,a))},[a,o,t,r]);const d=c(t!=null?t:"");let n=(_=(b=d==null?void 0:d.filter(x=>x.type==="assistant"))==null?void 0:b.find(x=>x.id===u))!=null?_:null;return n||(n=a),{focusedAssistantTurn:n,setFocusedAssistantTurnId:i}}function zs({focusedAssistantTurn:t,pastTurns:e,currentDiffTaskTurnId:o}){if(!t)return null;if(Ge(t))return t;const a=ys(e);if(o){const c=a.get(o);if(c&&Ce(c)&&Ge(c))return c}let r=ft(t,a);for(;r;){const c=a.get(r);if(!c||!Ce(c))return null;if(Ge(c))return c;r=ft(c,a)}return null}function Ge(t){return we(t,!1).length>0||we(t,!0).length>0}function ys(t){const e=new Map;for(const o of t)e.set(o.id,o);return e}function ft(t,e){var a,r;const o=e.get((a=t.previous_turn_id)!=null?a:"");return o&&(r=o.previous_turn_id)!=null?r:null}export{Ks as T,$s as W,Ie as a,Gs as b,Vs as c,zs as g,tt as u};
//# sourceMappingURL=dalowvhac5so9p7u.js.map
