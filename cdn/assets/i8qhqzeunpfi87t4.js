const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/dr6nlrruhbxt9iko.js","assets/fg33krlcm0qyi6yw.js","assets/mtk1qztvnb31pw5r.js","assets/root-mcq3deyb.css","assets/9scxvhhxenoark9a.js","assets/joa8jajuiu4xqpzn.js"])))=>i.map(i=>d[i]);
var S=Object.defineProperty,L=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var I=(e,t,s)=>t in e?S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,N=(e,t)=>{for(var s in t||(t={}))W.call(t,s)&&I(e,s,t[s]);if(A)for(var s of A(t))H.call(t,s)&&I(e,s,t[s]);return e},T=(e,t)=>L(e,O(t));import{r as c,j as n,M as k,a as V,e as G,d as U,_ as z}from"./fg33krlcm0qyi6yw.js";import{bX as q,py as Q,bg as X,l as Z,fN as B,kx as y,kw as D,e4 as J,gr as K,_ as Y,m as $,bh as ee,dF as te}from"./mtk1qztvnb31pw5r.js";import{F as se}from"./jsvb554xldjovidb.js";import{fx as ne,hD as ie,eg as oe,l4 as ae,bo as b,eF as _,l5 as re,l6 as ce,l7 as le,l8 as de,iN as ue,l0 as me}from"./k65njl5wlgspihfr.js";import{u as fe}from"./d6c194b8r37zigga.js";import"./eb2ntjcgqhqizd13.js";import"./hots192vdjsjmkwr.js";import"./efooahjtdr85x1lo.js";import"./km71i01x6ma5r62b.js";import"./f9jzes5xr4mq3zrh.js";import"./j6htuwwuulo7h0p6.js";import"./czn39vd97sciq42g.js";import"./ifrwee0bgh9e2but.js";import"./gqx9i5tb3deqoo5z.js";import"./dg5jraediw4l39ow.js";import"./hb1mva1gmw4bcs8w.js";import"./mbql81gwv5du9dtu.js";import"./k43gn7pl526u53kc.js";import"./tkv1g3prhmmeuid6.js";import"./mivow98b53y1taf8.js";import"./krwszi9u3lj63i9v.js";import"./i5jw6wfkpao2rx5t.js";import"./mce0eiesimdmeqmr.js";import"./kgrrqncjl71482vi.js";import"./ohquqctluwabmb5i.js";import"./c2cj1dlcffke3f7m.js";function ge({mode:e,imageIndex:t,allImages:s,onSwitchImage:u,isLoadingNewImage:i}){const o=t>0,a=c.useCallback(()=>{o&&u(s[t-1])},[o,s,t,u]),m=t<s.length-1,l=c.useCallback(()=>{m&&u(s[t+1])},[m,s,t,u]);return c.useEffect(()=>{function f(r){r.target instanceof HTMLTextAreaElement||e==="default"&&(r.key==="ArrowLeft"?a():r.key==="ArrowRight"&&l())}return document.addEventListener("keydown",f),()=>{document.removeEventListener("keydown",f)}},[e,a,l]),n.jsx("div",{className:"text-token-text-secondary flex h-16 w-full items-center justify-center gap-3 font-semibold",children:e==="inpaint"?!i&&n.jsxs("div",{className:"flex items-center gap-1.5",children:[n.jsx(k,{id:"imageEditor.selectArea",defaultMessage:"Select an area to edit"}),n.jsx("a",{href:"https://help.openai.com/en/articles/9055440",target:"_blank",rel:"noreferrer",children:n.jsx(q,{className:"icon"})})]}):s.length>1?n.jsxs(n.Fragment,{children:[n.jsx("button",{disabled:!o,className:"disabled:text-token-text-tertiary",onClick:a,children:n.jsx(Q,{className:"icon"})}),n.jsx("div",{children:n.jsx(k,{id:"imageEditor.imageNumber",defaultMessage:"Image {num} of {numImages}",values:{num:t+1,numImages:s.length}})}),n.jsx("button",{disabled:!m,className:"disabled:text-token-text-tertiary",onClick:l,children:n.jsx(ne,{className:"icon"})})]}):null})}const he=0,pe=64;function we({imageAsset:e,children:t,containerDimensions:s,isLoadingNewImage:u}){return n.jsxs(X.div,T(N({className:"absolute",style:xe(e,s)},ie),{children:[t,n.jsx("div",{className:Z("bg-token-main-surface-primary absolute inset-0 flex items-center justify-center transition-opacity duration-1000",u?"pointer-events-auto opacity-60":"pointer-events-none opacity-0")})]}))}function xe(e,t){const{width:s,height:u}=e,{width:i,height:o}=t,a=i-2*he,m=o-2*pe,l=s/u,f=a/m,r=l>f,w=r?a:m*l,h=r?a/l:m,p=(o-h)/2,E=(i-w)/2;return{top:p,left:E,width:w,height:h}}const ye=ee(()=>z(()=>import("./dr6nlrruhbxt9iko.js"),__vite__mapDeps([0,1,2,3,4,5])).then(e=>e.DynamicDrawingCanvas));function Ze({clientThreadId:e,messageId:t,image:s,allImages:u}){const i=B(e,te.getCurrentNode),o=[y.Dalle,y.t2uay3k].includes(D(i.message))&&!oe(i.message),a=V();return c.useEffect(()=>{async function m(l,f){try{const r=await ae(a,l);b.setFocusedObject({type:_.Image,image:r[0],allImages:r,messageId:f})}catch(r){Y.addError(new Error("Failed to load newly created images:",{cause:r}))}}if(i!=null&&[y.Dalle,y.t2uay3k].includes(D(i.message))&&i.message.content.content_type===J.MultimodalText){const l=K.getImageAssetPointers(i.message);m(l,i.id)}},[a,i]),n.jsx(Ee,{image:s,allImages:u,isLoadingNewImage:o,clientThreadId:e,messageId:t})}function Ee({image:e,allImages:t,isLoadingNewImage:s,clientThreadId:u,messageId:i}){const[o,a]=c.useState("default"),[m,l]=c.useState({width:window.innerWidth-se,height:window.innerHeight}),f=c.useRef(null),[r,w]=c.useState(136),h=fe(),{currentDrawnShape:p,onNewDrawnShape:E,clearAllDrawings:M}=h,j=c.useRef(null),C=G(),v=$(),{setTargetedContent:x}=re();c.useEffect(()=>{const d=new ResizeObserver(g=>{const{width:P,height:R}=g[0].contentRect;l({width:P,height:R})});return f.current&&d.observe(f.current),()=>{d.disconnect()}},[]),c.useEffect(()=>{function d(g){g.key==="Escape"&&(o==="inpaint"?a("default"):b.close())}return document.addEventListener("keydown",d),()=>{document.removeEventListener("keydown",d)}},[o]),c.useEffect(()=>(p==null?x({type:"object",placeholderTextOverride:U({id:"imageEditor.transformationTextareaPlaceholder",defaultMessage:"Edit imageâ€¦"}),shouldPersistAcrossMessages:!0,isFocusedViewContent:!0,createNewCompletionParams:d=>ce(d,e)}):x({type:"object",label:C.formatMessage({id:"imageEditor.inpaintingTargetedContentLabel",defaultMessage:"Edit selection"}),isFocusedViewContent:!0,createNewCompletionParams:async d=>{var g;return await le(d,e,(g=j.current)==null?void 0:g.getImageData(),C,v)},onCleared:()=>a("default")}),()=>{x(void 0)}),[e,C,x,p,v]),c.useEffect(()=>{o!=="inpaint"&&M()},[o]),c.useEffect(()=>{a("default")},[e]);const F=t.findIndex(d=>d.asset_pointer===e.asset_pointer);return n.jsxs("div",{ref:f,className:"flex h-full w-full flex-col justify-between",children:[n.jsx(de,{imageAsset:e,mode:o,setMode:a,clientThreadId:u,messageId:i,cursorWidth:r,setCursorWidth:w,inpaintingDrawingState:h,isLoadingNewImage:s}),n.jsx(ge,{mode:o,imageIndex:F,allImages:t,onSwitchImage:d=>{b.setFocusedObject({type:_.Image,image:d,allImages:t,messageId:i})},isLoadingNewImage:s}),n.jsxs(we,{imageAsset:e,containerDimensions:m,isLoadingNewImage:s,children:[n.jsx(ue,{className:"h-full w-full",alt:me(e),src:e.url,width:e.width,height:e.height,fadeIn:!1}),o==="inpaint"&&n.jsx("div",{className:"absolute inset-0",children:n.jsx(ye,{drawingCanvasRef:j,color:"rgba(0, 122, 255, 0.5)",dashedOutlineColor:"rgba(255, 255, 255, 0.65)",cursorWidth:r,canvasWidth:e.width,canvasHeight:e.height,currentDrawnShape:p,onNewDrawnShape:E})})]})]})}export{Ze as ImageEditor};
//# sourceMappingURL=i8qhqzeunpfi87t4.js.map
