import{r as f,j as l,e as M}from"./fg33krlcm0qyi6yw.js";import{gd as x,bc as d,bd as T,o as C,b as _,dQ as E}from"./mtk1qztvnb31pw5r.js";import{CoTChunks as k}from"./bj1xayv0ee02amky.js";import{er as h}from"./k65njl5wlgspihfr.js";import"./jskmg2zu1nebndza.js";import"./d30pfo25z1qctykl.js";import"./l9v3ntkj34comb67.js";import"./h0pbwkfesoibvhzi.js";import"./ikh0apjsuisoywnq.js";import"./ctgqahsfx1txd4g6.js";import"./hy5xt98rivxg8tb4.js";import"./i1g2kxfbotvbgq93.js";import"./krwszi9u3lj63i9v.js";import"./qcr0k45a8ay8c0b9.js";import"./eu6wvuly09f1n3pt.js";import"./ju642fjyg5h2qo49.js";import"./fjbpw3a0vshjd395.js";import"./pbl95wx6493wq92j.js";import"./ir7nzwbolrsm3ds2.js";import"./je866d95n4n31rpb.js";import"./li70yj6yb4gouarj.js";import"./dcp7peq4y6a4kabz.js";const y=(o,t)=>{if(t<=1)return o.formatMessage({id:"ZxhUq1",defaultMessage:"a second"});if(t<3)return o.formatMessage({id:"4GD7tD",defaultMessage:"a couple of seconds"});if(t<4)return o.formatMessage({id:"jx5V1u",defaultMessage:"a few seconds"});if(t>=60){const n=Math.floor(t/60),s=t%60;return"".concat(n,"m ").concat(s,"s")}return o.formatMessage({id:"p4/pTg",defaultMessage:"{seconds} seconds"},{seconds:t})},R=o=>{var n,s;let t=0;for(const e of o)t+=(s=(n=e.metadata)==null?void 0:n.finished_duration_sec)!=null?s:0;return t},I=(o,t,n)=>{var s,e,i;return t.length>1?o.formatMessage({id:"sdDgmZ",defaultMessage:"Thought for {timing}"},{timing:y(o,n)}):(i=(e=(s=x(t))==null?void 0:s.metadata)==null?void 0:e.finished_text)!=null?i:""},S=(o,t,n=!1)=>{var m;const s=[];let e={type:h.Thought,thought:{summary:"",content:""}};const i=()=>{e.thought.content.trim()&&(s.push(e),e={type:h.Thought,thought:{summary:e.thought.summary,content:""}})},u=o.split(/( {2}\n)|(\n\n)/).filter(c=>c!=null&&c.trim());if(!n&&u.length<2)return s;let a=!1;for(let c=0;c<u.length;c++){const r=u[c].trim();if(r.toLowerCase()==="none"){d.count(T.COT_SUMMARIZER,"num_none_chunks");continue}const p=r.match(/^\*\*(.*)\*\*$/);if(p)i(),e.thought.summary=(m=p[1])!=null?m:"";else if(r){if(r.startsWith("```")){if(a){e.thought.content+=e.thought.content?"\n".concat(r):r,i(),a=!1;continue}i(),a=!0}e.thought.content.trim()&&!r.startsWith("\\[")&&!r.startsWith("\\(")&&!a&&i(),e.thought.content+=e.thought.content?"\n".concat(r):r}}return e!=null&&e.thought.content.trim()&&s.push(e),n&&t&&s.push({type:h.Recap,content:t}),s},N=(o,t,n)=>{const s=!n,e=f.useMemo(()=>S(o,t,s),[o,t,s]);return f.useEffect(()=>{s&&d.hist(T.COT_SUMMARIZER,"num_cot_chunks",void 0,e.length)},[s]),e},O=({conversation:o,isStreaming:t,finishedText:n,summaryText:s,isFinalAssistantTurn:e,turnIndex:i})=>{const u=N(s,n,t),[a,m]=f.useState(!1);return l.jsx(k,{conversation:o,isStreaming:t,isFinalAssistantTurn:e,chunks:u,isExpanded:a,setIsExpanded:m,turnIndex:i})},j=8,A="\n\n",tt=({conversation:o,messages:t,isStreaming:n,isFinalAssistantTurn:s,turnIndex:e})=>{const i=M(),u=_(),a=C(u,"1214379119"),m=R(t);let c="";return t.forEach(g=>{const r=E(g);c+=c?A+r:r}),a&&!n&&!c&&m<j?null:l.jsx(O,{conversation:o,finishedText:I(i,t,m),summaryText:c,isStreaming:n,isFinalAssistantTurn:s,turnIndex:e})};export{O as LegacyCoT,tt as LegacyCoTMessage};
//# sourceMappingURL=mlipn08v0whyrmd1.js.map
