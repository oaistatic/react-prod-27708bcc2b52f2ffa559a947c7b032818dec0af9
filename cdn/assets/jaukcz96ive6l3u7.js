var k=Object.defineProperty;var A=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var Q=(t,a,o)=>a in t?k(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,c=(t,a)=>{for(var o in a||(a={}))V.call(a,o)&&Q(t,o,a[o]);if(A)for(var o of A(a))Z.call(a,o)&&Q(t,o,a[o]);return t};import{e as J,r as l,a as ee,j as e,f as W,M as r}from"./fg33krlcm0qyi6yw.js";import{c0 as _,a9 as N,aY as te,cS as se,_ as z,m as ae,gK as oe,g2 as U,gJ as ne,P as re}from"./mtk1qztvnb31pw5r.js";import{A as ie}from"./nwdwrv5b1h68xdm5.js";import{C as de}from"./b2l059fz4znz94nm.js";import{fF as v,cx as ce,c7 as le,ez as me,fG as xe,fH as ue}from"./k65njl5wlgspihfr.js";import{C as fe}from"./hvo2u3a2x0n5gdxn.js";import{F as G}from"./ibjz9c01f0uy7k53.js";import{f as pe,e as he,i as ge,a as L,F as je,b as ye,c as be}from"./fwtla2bbxlv5yr7j.js";import{M as Me}from"./he7oe7s4xa3cph5y.js";import{r as we}from"./ojve869uwykk95at.js";import"./ce3hgmw4iyyhicud.js";import"./bio6zqk7sn9h2l92.js";import"./gy1lpvuoewmzh42c.js";import"./jed1ux7qibe55pmj.js";import"./h1em0bjkpkjv8ykw.js";import"./nfccle6oyncifphl.js";import"./hu1bt0oauegdhua6.js";import"./ly75bs3d14n5v622.js";function ve(){re.logEventWithStatsig("chatgpt_web_skill_used","chatgpt_web_skill_used",{referer:"shared"})}function Je({skill:t,onClose:a,onTryIt:o}){"use no forget";var B,D,I,T,H,O;const g=J(),[p,M]=l.useState(null),[S,j]=l.useState(""),[d,u]=l.useState("idle"),[m,X]=l.useState(0),[$,R]=l.useState(!1),q=ee(),h=l.useMemo(()=>{var w;const s=Object.entries((w=t==null?void 0:t.files)!=null?w:{}),i=pe(t==null?void 0:t.files),C=s.filter(([y])=>y!==(i==null?void 0:i[0])).sort(([y],[P])=>y.localeCompare(P)),x=([y,P])=>({path:y,displayName:y,range:P,isSkillMd:y.trim().toLowerCase().endsWith("skill.md")});return[...i?[x(i)]:[],...C.map(x)]},[t==null?void 0:t.files]),{selectedFile:n,selectedFileName:F,editorMetadata:E}=l.useMemo(()=>{var x;const s=(x=h.find(w=>w.path===p))!=null?x:null,i=s?he(s.path):void 0,C=s&&i?ge({filename:i,contentType:"text/plain"}):null;return{selectedFile:s,selectedFileName:i,editorMetadata:C}},[h,p]),K=l.useCallback(()=>{X(s=>s+1)},[]);if(l.useEffect(()=>{if(h.length===0){M(null);return}M(s=>s&&h.some(i=>i.path===s)?s:h[0].path)},[h]),l.useEffect(()=>{if(!n){u("idle"),j("");return}if(!n.range||n.range.length<=0){u("ready"),j("");return}let s=!0;const i=new AbortController;return u("loading"),j(""),(async()=>{if(t)try{const x=await ye(t.id,t==null?void 0:t.sediment_id,n.range);if(!s)return;const w=n.isSkillMd?be(x):x;j(w),u("ready")}catch(x){if(!s)return;z.addError(x),u("error")}})(),()=>{s=!1,i.abort()}},[t,m,n,t==null?void 0:t.id,t==null?void 0:t.sediment_id]),!t)return e.jsx(v.Root,{isOpen:!0,onClose:()=>a(),children:e.jsx(v.Overlay,{showBackground:!0,children:e.jsx(v.Content,{size:"custom",position:"center",removePopoverStyling:!1,shadow:"normal",className:"flex h-[80vh]! max-w-[960px] flex-col items-center justify-center p-0! focus:outline-hidden",children:e.jsx(_,{className:"h-6 w-6"})})})});const Y=n!=null&&n.isSkillMd?g.formatMessage(f.emptyInstructions):g.formatMessage(f.emptyFileContent);return e.jsx(v.Root,{isOpen:!0,onClose:()=>a(),children:e.jsx(v.Overlay,{showBackground:!0,children:e.jsx(v.Content,{size:"custom",position:"center",removePopoverStyling:!1,shadow:"normal",className:"flex h-[80vh]! max-w-[960px] flex-col p-0! focus:outline-hidden",children:e.jsxs("div",{className:"relative flex min-h-0 flex-1 flex-col",children:[e.jsxs("div",{className:"border-token-border-secondary flex items-center justify-between gap-1 border-b-1 py-3 ps-6 pe-4",children:[e.jsx("div",{className:"text-token-text-primary flex min-w-0 flex-1 items-start gap-3 text-2xl leading-tight font-semibold max-sm:text-xl",children:e.jsx(r,{id:"F7wvRm",defaultMessage:"Skill"})}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[(B=t.permissions)!=null&&B.can_write?e.jsx(N,{color:"secondary",onClick:()=>window.location.assign("/skills/editor/".concat(t.id)),icon:ce,children:e.jsx(r,{id:"l9k0pE",defaultMessage:"Edit"})}):null,e.jsx(Se,{skill:t}),e.jsx(te,{onClick:()=>a(),className:"text-token-text-secondary hover:bg-token-bg-secondary active:bg-token-bg-tertiary mt-1 rounded-md p-1.5 ring-0! outline-0!"})]})})]}),e.jsxs("div",{className:"grid min-h-0 flex-1 grid-cols-1 xl:grid-cols-[minmax(360px,1fr)_20rem]",children:[e.jsxs("div",{className:"min-h-0 flex-1 overflow-y-auto px-12 pt-8",children:[d==="loading"&&e.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-2 text-sm",children:[e.jsx(_,{className:"h-5 w-5"}),e.jsx(r,c({},L.canvasLoadingFile))]}),d==="error"&&e.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-3 text-center text-sm",children:[e.jsx("p",{className:"text-token-text-tertiary",children:e.jsx(r,c({},L.canvasLoadFailed))}),e.jsx(N,{size:"small",color:"secondary",onClick:K,children:e.jsx(r,c({},L.canvasRetry))})]}),d==="ready"&&(n!=null&&n.isSkillMd||(I=(D=F==null?void 0:F.toLowerCase())==null?void 0:D.endsWith(".md"))!=null&&I?e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:e.jsx(Me,{remarkPlugins:[we],children:S})}):e.jsx(ie,{id:"shared-file-".concat((T=n==null?void 0:n.path)!=null?T:"skill"),comments:[],commentsMode:de.ALL_HIDDEN,readonlyReason:null,value:S,placeholder:Y,language:(H=E==null?void 0:E.language)!=null?H:void 0,isPreview:!0,hideToolbar:!0,hideAccelerators:!0})),d==="idle"&&e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(r,c({},f.emptyPreview))})]}),e.jsx("div",{className:"xl:border-token-border-light bg-gray-solid-50 dark:bg-gray-solid-1000 flex min-h-0 flex-col gap-4 overflow-y-auto px-5 py-3 xl:border-s",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(G,{children:[e.jsx("div",{className:"mb-2 flex items-center justify-between",children:e.jsx("label",{className:"text-token-text-secondary text-sm font-semibold",children:e.jsx(r,c({},f.nameLabel))})}),e.jsx("p",{className:"text-token-text-primary text-sm",children:t.name||g.formatMessage(f.namePlaceholder)})]}),e.jsxs(G,{children:[e.jsx("div",{className:"mb-2 flex items-center justify-between",children:e.jsx("label",{className:"text-token-text-secondary text-sm font-semibold",children:e.jsx(r,c({},f.descriptionLabel))})}),e.jsx("p",{className:"text-token-text-secondary text-sm whitespace-pre-wrap",children:(O=t.description)!=null?O:g.formatMessage(f.descriptionPlaceholder)})]}),e.jsx("div",{className:"mt-10 mb-4 flex items-center justify-between",children:e.jsx("p",{className:"text-token-text-secondary text-sm font-semibold",children:e.jsx(r,c({},f.filesSectionTitle))})}),e.jsx("div",{className:"space-y-2",children:h.length===0?e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(r,c({},f.emptyFiles))}):h.map(s=>e.jsx(je,{path:s.path,displayName:s.displayName,isSelected:s.path===p,deleteEnabled:!1,canEdit:!1,onSelected:()=>M(s.path)},s.path))})]})})]}),e.jsxs("div",{className:"border-token-border-secondary flex items-center justify-end gap-2 border-t-1 p-4",children:[e.jsx(N,{color:"secondary",onClick:()=>{a(),ve(),o==null||o(t)},icon:le,children:e.jsx(r,{id:"MhFXwo",defaultMessage:"Try in chat"})}),e.jsx(N,{color:t.enabled?"blue":"primary",disabled:t.enabled,icon:t.enabled?se:fe,loading:$,onClick:async()=>{R(!0);try{await me(t.id,!0,q)}finally{R(!1)}},children:t.enabled?e.jsx(r,{id:"gPSaLH",defaultMessage:"Enabled"}):e.jsx(r,{id:"rcyh+y",defaultMessage:"Enable Skill"})})]})]})})})})}function Se({skill:t}){var S,j;const a=J(),[o,g]=l.useState(!1),p=ae(),M=(j=(S=t.permissions)==null?void 0:S.can_export)!=null?j:!0;return e.jsxs(oe,{triggerButton:e.jsx(N,{color:"ghost","aria-label":a.formatMessage(b.moreMenuLabel),icon:ne}),alignOffset:0,children:[e.jsx(U.Item,{onClick:async()=>{var d;g(!0);try{const m=(d=(await xe(t.id)).hazelnuts)==null?void 0:d[0];m!=null&&m.id&&m.id!==t.id&&window.location.assign("/skills/editor/".concat(m.id)),p.success(a.formatMessage(b.cloneSuccess))}catch(u){z.addError(u),p.danger(a.formatMessage(b.cloneFailed))}g(!1)},icon:o?e.jsx(_,{}):void 0,disabled:!(t!=null&&t.id)||!M,children:e.jsx(r,c({},b.cloneButton))}),e.jsx(U.Item,{onClick:async()=>{try{const d=t.base_sediment_id,m=(await ue(t.id,d)).download_url;if(m)window.open(m,"_blank"),p.success(a.formatMessage(b.exportSuccess));else throw new Error("Missing download URL")}catch(d){z.addError(d),p.danger(a.formatMessage(b.exportFailed))}},disabled:!(t!=null&&t.id)||!(t!=null&&t.sediment_id)||!M,children:e.jsx(r,c({},b.exportButton))})]})}const b=W({moreMenuLabel:{id:"3Bs+SO",defaultMessage:"More options"},cloneButton:{id:"0XZop6",defaultMessage:"Clone skill"},cloneSuccess:{id:"2z+96D",defaultMessage:"Skill cloned successfully."},cloneFailed:{id:"JIFFi1",defaultMessage:"Failed to clone skill. Please try again."},exportButton:{id:"2bXkS6",defaultMessage:"Export skill"},exportSuccess:{id:"JoG2M5",defaultMessage:"Skill export started in a new tab."},exportFailed:{id:"Az1lqa",defaultMessage:"Failed to export skill. Please try again."}}),f=W({nameLabel:{id:"ywDnF3",defaultMessage:"Name"},namePlaceholder:{id:"RTsl4v",defaultMessage:"Untitled skill"},descriptionLabel:{id:"bFcE1N",defaultMessage:"Description"},descriptionPlaceholder:{id:"7hiQtx",defaultMessage:"This skill doesn’t include a description."},instructionsLabel:{id:"EKBc6Q",defaultMessage:"Instructions"},emptyInstructions:{id:"sLcVlj",defaultMessage:"This skill doesn’t include instructions."},filesSectionTitle:{id:"wFuF21",defaultMessage:"Files"},emptyFiles:{id:"PTRs2i",defaultMessage:"No supporting files added."},emptyFileContent:{id:"QhDsbu",defaultMessage:"This file is empty."},emptyPreview:{id:"Tp4OYC",defaultMessage:"No files to preview."}});export{Je as SkillSharingModal};
//# sourceMappingURL=jaukcz96ive6l3u7.js.map
