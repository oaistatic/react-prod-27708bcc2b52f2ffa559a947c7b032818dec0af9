import{e as F,r as d,j as e,M as b,a as V}from"./fg33krlcm0qyi6yw.js";import{ct as Z,cu as ee,A as se,cv as ae,cw as te,ci as re,cx as Y,cy as ne,cz as ie,cA as oe,cB as le,cC as ce}from"./k65njl5wlgspihfr.js";import{m as $,H as G,C as de,a9 as H,g2 as h,l as ue}from"./mtk1qztvnb31pw5r.js";import{S as me}from"./exm3n162m2u9ltpu.js";import{a as fe}from"./jdzosouyvpzu0tpb.js";function ge({hazelnutId:a,subjectsRole:m,subjects:f,setSubjects:x,workspacePrincipalRole:s}){const o=V(),[g,t]=d.useState(!1),l=F(),n=$(),c=G(),k=c==null?void 0:c.getWorkspaceId(),C=async()=>{t(!0);try{await pe({hazelnutId:a,subjectsRole:m,subjects:f,intl:l,toaster:n,queryClient:o}),x([])}finally{t(!1)}},y=d.useCallback(async p=>{if(k){t(!0);try{await ee(a,k,p,s,o)}catch(i){n.danger(l.formatMessage({id:"zGJe2u",defaultMessage:"Failed to update workspace access"}))}finally{t(!1)}}},[a,l,o,n,k,s]);return{handleAddPrincipals:C,handleWorkspaceRoleChange:y,handleRoleChange:async(p,i)=>{t(!0);try{await le(a,{principal_type:p.principal_type,principal_id:p.principal_id},i,o)}catch(u){n.danger(l.formatMessage({id:"MqBRcs",defaultMessage:"Failed to update access"}))}finally{t(!1)}},handleRemovePrincipal:async p=>{t(!0);try{await oe(a,{principal_type:p.principal_type,principal_id:p.principal_id},o)}catch(i){n.danger(l.formatMessage({id:"hKBI+n",defaultMessage:"Failed to remove access"}))}finally{t(!1)}},isSubmitting:g}}function be({hazelnutId:a,creatorId:m,isOpen:f,onClose:x}){"use no forget";var O,U,A;const s=F(),o=$(),g=G(),t=g==null?void 0:g.getWorkspaceId(),l=(O=g==null?void 0:g.name)!=null?O:"workspace",[n,c]=d.useState([]),[k,C]=d.useState("reader"),{data:y,isLoading:_,isError:S}=Z({hazelnutId:a,isEnabled:f}),p=d.useMemo(()=>{if(typeof window>"u")return"";const r=new URL("/",window.location.origin);return r.searchParams.set("hazelnut_id",a),r.toString()},[a]),i=d.useCallback(async()=>{try{await navigator.clipboard.writeText(p),o.success(s.formatMessage({id:"UCtYU9",defaultMessage:"Share link copied"}))}catch(r){o.danger(s.formatMessage({id:"L/J4Xm",defaultMessage:"Failed to copy share link"}))}},[p,o,s]),u=d.useCallback(r=>{switch(r){case"owner":return s.formatMessage({id:"3MGlDs",defaultMessage:"Can manage"});case"editor":return s.formatMessage({id:"8BQLzV",defaultMessage:"Can edit"});default:return s.formatMessage({id:"4/TNtO",defaultMessage:"Can chat"})}},[s]),w=d.useCallback(r=>r==="workspace"?s.formatMessage({id:"WnngXG",defaultMessage:"Workspace"}):r==="group"?s.formatMessage({id:"278ksX",defaultMessage:"Group"}):r==="user"?s.formatMessage({id:"C7hcK3",defaultMessage:"User"}):r,[s]);d.useEffect(()=>{!S||!f||o.danger(s.formatMessage({id:"6mNnYG",defaultMessage:"Failed to load current shares"}))},[s,f,S,o]);const{workspacePrincipalRole:v,creatorPrincipal:j,otherPrincipals:I}=d.useMemo(()=>{var E,X;const r=((E=y==null?void 0:y.principals)!=null?E:[]).filter(M=>["workspace","user","group"].includes(M.principal_type)),N=r.find(M=>M.principal_type==="workspace"&&M.principal_id===t),P=(X=N==null?void 0:N.role)!=null?X:"none",T=r.find(M=>M.principal_id===m&&M.principal_type==="user"),W=r.filter(M=>["workspace","user","group"].includes(M.principal_type)&&M.principal_type!=="workspace"&&!(M.principal_type==="user"&&M.principal_id===m));return{workspacePrincipalRole:P,creatorPrincipal:T,otherPrincipals:W!=null?W:[]}},[t,m,y==null?void 0:y.principals]),{handleAddPrincipals:z,handleWorkspaceRoleChange:K,handleRoleChange:q,handleRemovePrincipal:D,isSubmitting:R}=ge({hazelnutId:a,subjectsRole:k,subjects:n,setSubjects:c,workspacePrincipalRole:v}),J=n.length===0||R;return f?e.jsx(de,{isOpen:!0,onClose:x,title:s.formatMessage({id:"H0CHxB",defaultMessage:"Share skill"}),testId:"modal-share-skill",className:"max-w-[520px]",footerContent:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{color:"secondary",onClick:x,disabled:R,children:e.jsx(b,{id:"0GT0SI",defaultMessage:"Cancel"})}),e.jsx(H,{color:"secondary",onClick:i,disabled:!p,children:e.jsx(b,{id:"hjDXiw",defaultMessage:"Get share link"})}),e.jsx(H,{color:"primary",onClick:z,disabled:J,loading:R,children:e.jsx(b,{id:"XaH4Jf",defaultMessage:"Share"})})]}),footerClassName:"mt-5",showCloseButton:!0,size:"custom",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(xe,{subjects:n,setSubjects:c,subjectsRole:k,setSubjectsRole:C}),e.jsxs("div",{children:[e.jsx("p",{className:"text-token-text-secondary text-sm font-medium",children:e.jsx(b,{id:"riVS9H",defaultMessage:"Who has access"})}),e.jsx("div",{className:"mt-2 flex max-h-[240px] flex-col gap-2 overflow-y-auto pe-1",children:_?e.jsx("span",{className:"text-token-text-secondary text-sm",children:e.jsx(b,{id:"2L49KZ",defaultMessage:"Loadingâ€¦"})}):e.jsxs(e.Fragment,{children:[e.jsx(L,{icon:e.jsx(Q,{label:(U=j==null?void 0:j.name)!=null?U:""}),title:(A=j==null?void 0:j.name)!=null?A:"",subtitle:s.formatMessage({id:"iyzzua",defaultMessage:"Creator"}),trailing:e.jsx("span",{className:"text-token-text-secondary",children:u("owner")}),disabled:!0}),l&&e.jsx(L,{icon:e.jsx(Q,{label:l}),title:l,subtitle:w("workspace"),trailing:e.jsx(B,{role:v,onChange:K,triggerClassNames:"text-token-text-secondary",disabled:R,useNotSharedLabel:!0,disallowOwnerOption:!0})}),I.map(r=>{const N="".concat(r.principal_type,":").concat(r.principal_id);return e.jsx(L,{icon:e.jsx(Q,{label:r.name}),title:r.name,subtitle:w(r.principal_type),trailing:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(B,{role:r.role,onChange:P=>P==="none"?D(r):q(r,P),triggerClassNames:"text-token-text-secondary",disabled:R})})},N)})]})})]})]})}):null}async function pe(a){"use no forget";const{hazelnutId:m,subjectsRole:f,subjects:x,intl:s,toaster:o,queryClient:g}=a;if(m)try{const t=[];for(const n of x)(n.kind==="user"||n.kind==="group")&&t.push({principal_type:n.kind,principal_id:n.id,role:f});const l=await ce(m,t,g);o.success(s.formatMessage({id:"xrVQfP",defaultMessage:"Shared with {count} target(s)"},{count:l.attempts.filter(n=>n.success).length}))}catch(t){o.danger(s.formatMessage({id:"O2Fw5N",defaultMessage:"Failed to share skill"}))}}function B({role:a,onChange:m,triggerClassNames:f,includeRemoveOption:x=!0,useNotSharedLabel:s=!1,disallowOwnerOption:o=!1,disabled:g=!1}){"use no forget";const t=F(),l=d.useMemo(()=>{switch(a){case"owner":return t.formatMessage({id:"zQ9Kfi",defaultMessage:"Can manage"});case"editor":return t.formatMessage({id:"ALFnnC",defaultMessage:"Can edit"});case"reader":return t.formatMessage({id:"Mi2QnR",defaultMessage:"Can chat"});default:return t.formatMessage({id:"pyaY7e",defaultMessage:"Not shared"})}},[t,a]),n=c=>c==="none"||c==="reader"||c==="editor"||c==="owner";return e.jsxs(h.Root,{children:[e.jsxs(h.Trigger,{color:"secondary",disabled:g,className:ue("text-token-text-secondary hover:bg-token-interactive-bg-secondary-hover radix-state-open:bg-token-interactive-bg-secondary-press whitespace-nowrap",f),children:[l,e.jsx(te,{className:"icon-sm"})]}),e.jsx(h.Portal,{children:e.jsx(h.Content,{className:"max-w-[320px]",children:e.jsxs(h.RadioGroup,{value:a,onValueChange:c=>{n(c)&&m(c)},children:[e.jsx(h.RadioItem,{value:"reader",color:a==="reader"?"selected":"default",icon:re,trailing:e.jsx(h.RadioItemCheck,{}),label:t.formatMessage({id:"r27H8Y",defaultMessage:"Can chat"}),secondary:e.jsx(b,{id:"HZYFxE",defaultMessage:"Members can use/chat with this skill"})},"reader"),e.jsx(h.RadioItem,{value:"editor",color:a==="editor"?"selected":"default",icon:Y,trailing:e.jsx(h.RadioItemCheck,{}),label:t.formatMessage({id:"F8ZkkR",defaultMessage:"Can edit"}),secondary:e.jsx(b,{id:"XkD5v9",defaultMessage:"Members can edit this skill"})},"editor"),!o&&e.jsx(h.RadioItem,{value:"owner",color:a==="owner"?"selected":"default",icon:Y,trailing:e.jsx(h.RadioItemCheck,{}),label:t.formatMessage({id:"vdBMM+",defaultMessage:"Can manage"}),secondary:e.jsx(b,{id:"JyuN/I",defaultMessage:"Members can manage sharing and editing"})},"owner"),x&&e.jsx(h.RadioItem,{value:"none",color:s?a==="none"?"selected":"default":"danger",icon:s?ne:ie,trailing:e.jsx(h.RadioItemCheck,{}),label:s?t.formatMessage({id:"gO1aY6",defaultMessage:"Not shared"}):t.formatMessage({id:"vCF1ft",defaultMessage:"Remove from sharing"})},"none")]})})})]})}function xe({subjects:a,setSubjects:m,subjectsRole:f,setSubjectsRole:x}){var p;const s=F(),[o,g]=d.useState(""),[t]=fe(o,150),l=G(),n=l==null?void 0:l.getWorkspaceId(),c=se(n,0,t,10),{data:k}=ae(n,t,20,0),C=d.useMemo(()=>{var i,u,w;return(w=(u=(i=c.data)==null?void 0:i.items)==null?void 0:u.map(v=>{var j,I;return{kind:"user",id:v.account_user_id,label:(j=v.name)!=null?j:"Unknown User",sublabel:(I=v.email)!=null?I:""}}))!=null?w:[]},[(p=c.data)==null?void 0:p.items]),y=d.useMemo(()=>{var i;return(i=k==null?void 0:k.items.slice(0,10).map(u=>{var w;return{kind:"group",id:u.id,label:u.name,sublabel:s.formatMessage({id:"em0BXH",defaultMessage:"{count, number} members"},{count:(w=u.num_members)!=null?w:0})}}))!=null?i:[]},[k,s]),_=d.useMemo(()=>{const i=new Set(a.map(u=>"".concat(u.kind,":").concat(u.id)));return[...C,...y].filter(u=>!i.has("".concat(u.kind,":").concat(u.id)))},[C,y,a]),S=d.useCallback(i=>{g(i)},[]);return e.jsxs("div",{children:[e.jsx("p",{className:"text-token-text-secondary mb-2 text-sm font-medium",children:e.jsx(b,{id:"opwiB1",defaultMessage:"Pending invitations"})}),e.jsx(me,{value:a,onChange:i=>m([...i]),onSearch:S,options:_,placeholder:s.formatMessage({id:"oX97UH",defaultMessage:"Search people or groups"}),menuIsOpen:o.trim()!=="",trailingComponent:a.length>0&&e.jsx(B,{role:f,onChange:i=>i!=="none"&&x(i),triggerClassNames:"text-token-text-secondary",includeRemoveOption:!1}),classNames:{control:()=>"h-auto! min-h-[40px]! max-h-[180px] items-start overflow-y-auto p-1! cursor-text!",menuList:()=>"bg-token-bg-primary"}})]})}function L({icon:a,title:m,subtitle:f,trailing:x,disabled:s}){"use no forget";return e.jsxs("div",{className:"flex items-center justify-between gap-3 rounded-xl px-2 py-2 text-sm","data-disabled":s?"true":void 0,children:[e.jsxs("div",{className:"flex min-w-0 items-center gap-3",children:[e.jsx("div",{className:"shrink-0",children:a}),e.jsxs("div",{className:"flex min-w-0 flex-col",children:[e.jsx("span",{className:"truncate font-medium",children:m}),e.jsx("span",{className:"text-token-text-secondary truncate text-xs",children:f})]})]}),x&&e.jsx("div",{className:"shrink-0",children:x})]})}function Q({label:a}){"use no forget";return e.jsx("div",{className:"bg-token-bg-tertiary text-token-text-secondary border-token-border-light flex h-8 w-8 items-center justify-center rounded-full border text-xs font-semibold uppercase",children:a.slice(0,1).toUpperCase()})}export{be as S};
//# sourceMappingURL=jmkoub13urc7hve4.js.map
