var Z=Object.defineProperty,G=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var U=(e,o,n)=>o in e?Z(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,b=(e,o)=>{for(var n in o||(o={}))W.call(o,n)&&U(e,n,o[n]);if(C)for(var n of C(o))B.call(o,n)&&U(e,n,o[n]);return e},z=(e,o)=>G(e,D(o));var Q=(e,o)=>{var n={};for(var r in e)W.call(e,r)&&o.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&C)for(var r of C(e))o.indexOf(r)<0&&B.call(e,r)&&(n[r]=e[r]);return n};import{j as v,n as I,e as J,r as ee,f as te,v as ne}from"./fg33krlcm0qyi6yw.js";import{e2 as L,s3 as q,g$ as oe,bp as se,mN as ie,bH as re,eh as w,bT as ae,bx as ce,dI as de,e1 as ue,bn as le,s4 as me,e4 as H}from"./mtk1qztvnb31pw5r.js";import{ek as fe,el as ge,ed as pe,em as _e,ec as S,en as he,eo as Se}from"./k65njl5wlgspihfr.js";import{C as ye}from"./hakyprpr5m8dolws.js";function Te({messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a}){var l,m,u,f,g;const t=e.find(c=>c.author.role===L.Tool&&c.recipient==="assistant"||c.author.role===L.Assistant&&c.recipient==="user");if(!t)return null;const i=(m=(l=t.metadata)==null?void 0:l.elicitation_metadata)==null?void 0:m.tool_call_message;if(!i)return null;const s=(f=(u=t.metadata)==null?void 0:u.elicitation_metadata)==null?void 0:f.plugin_data;return!s||!s.from_server||!("body"in((g=s.from_server)!=null?g:{}))?null:v.jsx(Me,{messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a,serverActionMessage:s.from_server,toolCallMessage:i})}function Me({messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a,serverActionMessage:t,toolCallMessage:i}){var s;if(!("body"in t))return null;if(t.type=="oauth_required"){const m=((s=t.body.actions)!=null?s:[]).find(Pe);return m?v.jsx(ve,{messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a,toolCallMessage:i,oauthTargetMessageId:m.oauth_redirect.target_message_id}):null}}function ve({messages:e,nextMessage:o,clientThreadId:n,isLastTurnInConversation:r,isLastMessageInTurn:d,onRequestCompletion:a,toolCallMessage:t,oauthTargetMessageId:i}){var x;const[s,l]=I(),m=J(),u=e.find(y=>{var _,M,k;return(k=(M=(_=y.metadata)==null?void 0:_.elicitation_metadata)==null?void 0:M.plugin_data)==null?void 0:k.from_client}),f=q(t==null?void 0:t.recipient),g=(x=q(o==null?void 0:o.recipient))==null?void 0:x.namespace,{connectorId:c,connectorToolStatus:A,connectorStatusMessage:j}=je(f==null?void 0:f.namespace,g,e,r),h=oe(!0,se.JIT_PLUGIN).platformConnectors.get(c!=null?c:""),E=!!(c&&h&&!u&&d),K=ie(),p=re();ee.useEffect(()=>{var _,M,k,F;if(((F=(k=(M=(_=u==null?void 0:u.metadata)==null?void 0:_.elicitation_metadata)==null?void 0:M.plugin_data)==null?void 0:k.from_client)==null?void 0:F.type)==="oauth_success")return;s.get("oauth_success")&&(l(V=>(V.delete("oauth_success"),V),{replace:!0}),N({eventSource:"url",assistantMessage:t,onRequestCompletion:a,actionData:{type:"oauth_success",target_message_id:i},conversationMode:{kind:w.PrimaryAssistant},activeSystemHint:p!=null?p:void 0,messageTextContent:"Login successful."}))},[t,e,n,a,r,s,l,p,i,u]);const Y=ae({skip:!1,fetchValidLinksOnly:!0,productSku:"n7jupd"}),$=Array.from(Y.connectorLinks.values()).some(y=>y.some(_=>_.connector_id===c)),{addSource:X,selectedSources:O}=fe(n),{selectedRepos:R}=ge(n,Se);return v.jsxs(v.Fragment,{children:[j&&v.jsx(pe,{highlightedCommand:h?m.formatMessage(j,{domain:h.name}):v.jsx("br",{}),status:A,showWorkUserSetting:!1}),E&&h&&v.jsx("div",{className:"mb-2 flex gap-2",children:v.jsx(ye,{connector:h,hasWidget:_e(e),onConnect:y=>{if($){X(ce[c!=null?c:""]),N({sourceEvent:y,assistantMessage:t,onRequestCompletion:a,actionData:{type:"oauth_success",target_message_id:i},conversationMode:{kind:w.PrimaryAssistant},activeSystemHint:p!=null?p:void 0,messageTextContent:"Login successful.",selectedSources:O,selectedRepos:R});return}const _=de(n),M=_?new URL(ue(_),window.location.origin):new URL(window.location.href);M.searchParams.set("oauth_success","true"),K({connectorId:h.id,redirectAfter:M.toString(),referrer:le.JitPluginMessage})},onProceedWithoutConnecting:y=>{N({sourceEvent:y,assistantMessage:t,onRequestCompletion:a,actionData:{type:"deny",target_message_id:i},messageTextContent:"Login declined.",conversationMode:{kind:w.PrimaryAssistant},activeSystemHint:p!=null?p:void 0,selectedSources:O,selectedRepos:R})}})})]})}function Pe(e){var o;return(e==null?void 0:e.type)==="oauth_redirect"&&typeof((o=e==null?void 0:e.oauth_redirect)==null?void 0:o.target_message_id)=="string"}function je(e,o,n,r){var m,u,f,g,c,A,j,T,h;var d=(m=me(e))!=null?m:void 0;const a=n[n.length-1],t=(u=a==null?void 0:a.metadata)==null?void 0:u.jit_plugin_data;if(!d&&((f=t==null?void 0:t.from_server)==null?void 0:f.type)==="oauth_required"&&(d=(g=t==null?void 0:t.from_server)==null?void 0:g.body.connector_id),!d)return{connectorId:void 0,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};if(o===e)return{connectorId:d,connectorToolStatus:null,connectorStatusMessage:null,showConnectorConnect:!1};var i=S.Running,s=null,l=!1;return n.some(E=>E.content.content_type===H.SystemError)?(i=S.Error,s=P.error):a?((c=t==null?void 0:t.from_server)==null?void 0:c.type)==="oauth_required"&&r?(i=S.Paused,s=null,l=!0):((A=t==null?void 0:t.from_server)==null?void 0:A.type)==="oauth_required"&&!r?(i=S.Stopped,s=P.connectorDeclined):((j=t==null?void 0:t.from_client)==null?void 0:j.type)==="deny"?(i=S.Stopped,s=P.connectorDeclined):((T=t==null?void 0:t.from_client)==null?void 0:T.type)==="oauth_success"?(i=S.Stopped,s=P.connectorAccepted):(h=a==null?void 0:a.metadata)!=null&&h.invoked_plugin?(i=S.Finished,s=P.finished):(i=S.Stopped,s=P.stopped):(i=S.Running,s=P.running),{connectorId:d,connectorToolStatus:i,connectorStatusMessage:s,showConnectorConnect:l}}function N(m){var u=m,{actionData:e,assistantMessage:o,turnGizmo:n,onRequestCompletion:r,conversationMode:d,activeSystemHint:a,messageTextContent:t,selectedSources:i,selectedRepos:s}=u,l=Q(u,["actionData","assistantMessage","turnGizmo","onRequestCompletion","conversationMode","activeSystemHint","messageTextContent","selectedSources","selectedRepos"]);var g;const f={id:ne(),author:{role:L.Tool,name:o.recipient},content:{content_type:H.Text,parts:[t!=null?t:""]},recipient:"all",metadata:b(b({jit_plugin_data:{from_client:e},gizmo_id:n==null?void 0:n.gizmo.id,elicitation_metadata:{plugin_data:{from_client:e}}},i&&{selected_sources:he(i)}),s&&{selected_github_repos:[...(g=s.selectedRepos)!=null?g:[]],selected_all_github_repos:s.selectedAllRepos}),clientMetadata:{completionSampleFinishTime:Date.now()}};r(z(b({},l),{promptMessage:f,completionMetadata:{conversationMode:d!=null?d:{kind:w.PrimaryAssistant},systemHints:a?[a]:void 0}}))}const P=te({starting:{id:"jitPluginMessage.starting",defaultMessage:"Starting action"},confirmingSimple:{id:"jitPluginMessage.confirming.simple",defaultMessage:"{gizmoName} wants to talk to {domain}"},confirmingSubtitle:{id:"jitPluginMessage.confirming.subtitle",defaultMessage:"Only allow sites you trust."},running:{id:"jitPluginMessage.runningV4",defaultMessage:"Talking to {domain}"},finished:{id:"jitPluginMessage.finishedV4",defaultMessage:"Talked to {domain}"},stopped:{id:"jitPluginMessage.stoppedV4",defaultMessage:"Stopped talking to {domain}"},error:{id:"jitPluginMessage.errorV5",defaultMessage:"Error talking to {domain}"},declined:{id:"jitPluginMessage.declined",defaultMessage:"You declined this action"},ranTest:{id:"jitPluginMessage.ranTest",defaultMessage:"Tested {operationName}"},confirmParamsTitle:{id:"jitPluginMessage.confirmParamsTitleV3",defaultMessage:"{gizmoName} wants to share this info with {domain}"},sentParamsTitle:{id:"jitPluginMessage.sentParamsTitleV2",defaultMessage:"{gizmoName} sent this info to {domain}"},privacyPolicyLink:{id:"jitPluginMessage.privacyPolicyLinkV2",defaultMessage:"Privacy policy"},connectorAccepted:{id:"jitPluginMessage.connectorAccepted",defaultMessage:"Accepted using {domain}"},connectorDeclined:{id:"jitPluginMessage.connectorDeclined",defaultMessage:"Declined connection to {domain}"},rememberForThisConversation:{id:"jitPluginMessage.rememberForThisConversation",defaultMessage:"Remember for this conversation"}});export{Te as APIToolElicitationMessage};
//# sourceMappingURL=bx8ibdo7ycfk88np.js.map
