var Kt=Object.defineProperty,zt=Object.defineProperties;var Gt=Object.getOwnPropertyDescriptors;var qs=Object.getOwnPropertySymbols;var Qt=Object.prototype.hasOwnProperty,Wt=Object.prototype.propertyIsEnumerable;var Us=(e,n,t)=>n in e?Kt(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,J=(e,n)=>{for(var t in n||(n={}))Qt.call(n,t)&&Us(e,t,n[t]);if(qs)for(var t of qs(n))Wt.call(n,t)&&Us(e,t,n[t]);return e},$=(e,n)=>zt(e,Gt(n));import{e as V,j as s,M as us,r as m,a as ze,u as de,b as dt,f as Zt,w as Yt}from"./fg33krlcm0qyi6yw.js";import{hO as Xt,hR as Jt,AQ as Ge,qw as N,qx as U,qz as qe,AR as mt,AS as $t,AT as Vt,nN as en,ru as sn,rM as Ks,v5 as tn,rd as nn,re as an,rg as on,AU as rn,AV as cn,cx as ln,a5 as zs,cw as un,Z as Se,fu as Gs,Y as Qs,ib as dn,kS as mn,ab as fn,ac as gn,AW as Fe,ax as hn,b0 as pn,qB as Cn,e4 as xn,AX as vn,gX as yn,hk as xe,AY as bn,AZ as ft,A_ as Sn,A$ as Tn,B0 as ds,B1 as An,ts as En,B2 as wn,qQ as ve,B3 as _n,B4 as In,l5 as kn,B5 as jn,c as Pn,B6 as Rn,B7 as Mn,B8 as Dn,B9 as Nn,hg as Bn,hh as On,hi as Ln,rK as Ws,jZ as Zs,hj as Ys,Ba as Hn,Bb as Fn,b as qn,Bc as Un,j0 as Kn,pq as zn,aB as Gn,Bd as Xs,hm as Js,Be as is,Bf as $s,Bg as Le,Bh as He,Bi as Vs}from"./k65njl5wlgspihfr.js";import{oH as gt,C as Qn,aY as Wn,M as et,fD as Zn,bg as oe,a9 as st,v9 as Yn,x as Xn,fN as ms,bv as Qe,dF as ht,e2 as tt,dB as Jn,b as We,d as $n,k5 as Vn,l as be,_ as pt,R as G,hh as Ct,Ab as xt,g2 as k,se as ea,dv as nt,T as Ue,H as sa,b9 as ta,hv as na,aW as aa,o as vt,gJ as oa,jQ as ra,fe as ia,fZ as at,gd as ca,kq as la,kh as ua,mI as da,fX as ma,j0 as fa,P as ga}from"./mtk1qztvnb31pw5r.js";import{C as re,u as ha,a as pa,h as Ca,g as xa,A as va,f as ot,D as ya}from"./nk8claqige01rjll.js";import{e as ba}from"./nkg72cggx811q5rc.js";import{C as Sa}from"./kz9vfmj7e59u487z.js";import{A as Ta}from"./nwdwrv5b1h68xdm5.js";import{i as Aa,b as Ea,T as wa,a as _a,g as Ia}from"./kimw6epkq1t36pow.js";import{g as ka}from"./exqqo21frem4no6f.js";import{C as le}from"./b2l059fz4znz94nm.js";import{C as Ke,k as rt,S as it}from"./kkpvfco69f4rm4dl.js";import{u as ja,C as Pa,a as Ra,H as Ma,T as Da}from"./jz17uc4ytadugnwg.js";import{a as Na}from"./hx3pmvu9yrya5xfj.js";import{O as Ba}from"./m5btqmw2ud0umdwr.js";import{D as Oa}from"./gfro8vshyz92jyup.js";import{C as La}from"./kgrrqncjl71482vi.js";import{g as cs,S as Ha}from"./irqko7c1s7qpl41n.js";import{s as ls,B as Fa}from"./j7vr3wxxnh5g6uxz.js";import{N as qa}from"./ce3hgmw4iyyhicud.js";import{L as Ua}from"./bhm7utdivrybcfbl.js";import{i as ct}from"./e7t9iekjqjn15qm6.js";import{g as Ka}from"./bkm8et9bp0kf1c7y.js";var yt=(e=>(e.Close="close",e.Loaded="loaded",e.Streaming="streaming",e.Download="download",e))(yt||{});const za=({isOpen:e,dismissModal:n,closeTextdocEditor:t,textdocVersion:a,clientThreadId:i})=>{const r=V(),o=Xt(i),l=Jt(i),h=gt(),c=Ge(a==null?void 0:a.textdocId),u=async v=>{N.logButtonClick(U.SAVE_TO_CHAT_ON_EDITOR_CLOSE),!((a==null?void 0:a.versionInt)==null||h)&&(l({sourceEvent:v,promptMessage:Zn("",{canvas:{user_created_textdocs:a!=null&&a.status===mt.ATTACHED_PENDING&&c!=null?[{user_created_temp_textdoc_id:a.textdocId,type:a.type,title:a.title,content:a.content,create_source:c.create_source}]:void 0},open_in_canvas_view:{type:"canvas_textdoc",id:a.textdocId}}),completionMetadata:o?{conversationMode:o}:void 0}),c&&qe.markAsSent(c.tempTextdocId),n(),t())};return s.jsx(Qn,{testId:"modal-confirm-close-editor",isOpen:e,size:"custom",className:"max-w-xl",onClose:n,type:"warning",hideSeparator:!0,title:s.jsx("span",{className:"text-xl",children:s.jsx(us,{id:"jgd5rD",defaultMessage:"Are you sure you want to close?"})}),primaryButton:s.jsx(et.Button,{title:r.formatMessage({id:"XE+GiU",defaultMessage:"Save to chat"}),color:"primary",onClick:u}),secondaryButton:s.jsx(et.Button,{title:r.formatMessage({id:"MbWco5",defaultMessage:"Donâ€™t save and close"}),color:"secondary",onClick:()=>{N.logButtonClick(U.CLOSE_WITHOUT_SAVING),c&&qe.removeTempTextdoc(c.tempTextdocId),n(),t()}}),showCloseButton:!0,closeButton:s.jsx(Wn,{onClick:n}),children:s.jsx("div",{className:"text-md text-token-text-secondary -mt-6 pb-2",children:s.jsx(us,{id:"q9rJ+Y",defaultMessage:"Changes will not be saved unless you save this canvas to your chat."})})})};function bt(e){const n=$t();if(!e)return{isCodePreviewable:!1,isCodeExecutable:!1,hasCanvasCodeExecution:n};const t=Aa(e==null?void 0:e.type,e==null?void 0:e.content),a=Ea(e.type);return{isCodePreviewable:t,isCodeExecutable:a,hasCanvasCodeExecution:n}}const Ga=({isTextdocStreaming:e,isRequestActive:n,value:t,comments:a})=>{const[i,r]=m.useState(!1);return m.useEffect(()=>{e&&i&&(r(!1),Ke.reset())},[t,a]),m.useEffect(()=>{n||(r(!1),Ke.reset())},[n]),[i,r]};function Qa({onClickRestore:e,onClickResetLatest:n}){const t=V();return s.jsx(oe.div,{initial:{height:0},animate:{height:"auto"},exit:{height:0},transition:{type:"spring",bounce:0},className:"bg-token-main-surface-primary z-30",children:s.jsx(oe.div,{className:"bg-token-main-surface-primary dark:border-token-border-xlight @container w-full items-center border-t border-gray-100 p-6 shadow-[0_-4px_32px_rgba(0,0,0,0.08)] lg:border-s dark:shadow-[0_-4px_32px_rgba(0,0,0,0.12)]",children:s.jsxs("div",{className:"mx-auto flex max-w-[48rem] flex-col flex-wrap justify-center gap-5 @2xl:flex-row @2xl:justify-between",children:[s.jsxs("div",{className:"flex flex-col px-2 text-center @2xl:text-start",children:[s.jsx("span",{className:"text-md text-token-text-primary font-semibold text-wrap",children:t.formatMessage({id:"gt23pb",defaultMessage:"You are viewing a previous version"})}),s.jsx("span",{className:"text-token-text-secondary text-sm text-wrap",children:t.formatMessage({id:"sAlUJn",defaultMessage:"Restore this version to make edits"})})]}),s.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-4",children:[s.jsx(st,{as:"button",color:"primary",onClick:e,children:t.formatMessage({id:"+cddAb",defaultMessage:"Restore this version"})}),s.jsx(st,{as:"button",color:"secondary",onClick:n,children:t.formatMessage({id:"qCD3eu",defaultMessage:"Back to latest version"})})]})]})})})}const Wa={type:"spring",bounce:.2,duration:.56},Za=({conversation:e,turn:n})=>{const t=Yn();return s.jsxs(oe.div,{className:"absolute start-0 end-0 top-0 z-10 -translate-y-full",children:[s.jsx(oe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"bg-vert-light-gradient dark:from-token-main-surface-primary absolute inset-0 -top-5 dark:bg-linear-to-t dark:to-transparent"}),s.jsx(oe.div,{className:"flex items-center py-2",initial:{opacity:.75,translateX:-50,translateY:"100%"},animate:{opacity:1,translateX:0,translateY:"0"},exit:{opacity:0,filter:"blur(8px)",transition:{delay:.4,duration:.72}},transition:Wa,children:s.jsx(La,{conversation:e,onRequestCompletion:Xn,groupedMessagesToRender:n.messageGroups,allGroupedMessages:n.messageGroups,allMessages:n.messages,isUserTurn:!0,isFinalUserTurn:!1,isFinalAssistantTurn:!1,turnIndex:0,isCompletionRequestInProgress:!1,isFeedbackEnabled:!1,isFinalTurn:!1,hasActiveRequest:t})})]},"user-message")},Ya=({conversation:e})=>{const n=e.id,{lastUserTurn:t,lastAssistantTurn:a}=ms(n,r=>{const o=ht.getConversationTurns(r);let l=null,h=null;for(let c=o.length-1;c>0;c--){const u=o[c];if(!l&&u.role===tt.User?l=u:!h&&u.role===tt.Assistant&&(h=u),l&&h)break}return{lastUserTurn:l,lastAssistantTurn:h}}),i=t&&!(a!=null&&a.messages.some(r=>{var o;return(o=r.recipient)==null?void 0:o.startsWith(Vt)}));return s.jsx(Qe,{initial:!1,children:i&&s.jsx(Za,{turn:t,conversation:e})})},Xa=({isRequestActive:e=!1,clientThreadId:n,readonlyReason:t,onCancel:a,onSubmit:i,onSubmitAccelerator:r,acceleratorActions:o=[]})=>{var P;const l=We(),h=Jn(l,n),[c,u]=m.useState(!1),[v,S]=m.useState(""),[f,A]=m.useState(!0),_=V(),[T,g]=m.useState(!1),x=$n(Vn),b=d=>{i==null||i(d,v),S("")},E=d=>{if(d.nativeEvent.isComposing)return;const{metaKey:w,shiftKey:I,key:j}=d;j==="Enter"&&v.trim()&&!(I||w)&&(b(d),d.preventDefault())};return s.jsxs(s.Fragment,{children:[c&&!x&&s.jsx(Ba,{zIndexKey:"acceleratorsOverlay",className:"bg-white/95 dark:bg-black/85"}),s.jsx("div",{className:"relative mb-3 flex items-end justify-center",children:s.jsxs("div",{className:"relative mx-6 max-w-2xl flex-1",children:[s.jsx(Ya,{conversation:h}),s.jsx("div",{className:"flex flex-auto items-start",children:s.jsx("div",{className:be("dark:bg-token-main-surface-secondary flex min-h-12 flex-auto items-center bg-[#f4f4f4] py-1 ps-6 pe-2",{"rounded-full":f,"rounded-2xl":!f,"bg-transparent":T}),children:s.jsxs("div",{className:"relative flex flex-auto items-center self-stretch",children:[s.jsx(en,{placeholder:_.formatMessage({id:"zrUbTJ",defaultMessage:"Ask ChatGPT to edit"}),disabled:e,value:v,className:be("text-token-text-primary placeholder:text-token-text-secondary w-full resize-none border-0 bg-transparent p-0 outline-0 focus:ring-0 focus-visible:ring-0",{"opacity-0":T}),maxRows:4,onChange:({target:{value:d}})=>S(d),onKeyDown:E,onHeightChange:(d,{rowHeight:w})=>A(Math.floor(d/w)<=1)}),v?s.jsx(oe.button,{className:be("dark bg-token-main-surface-primary h-8 w-8 rounded-full text-center disabled:bg-[#D7D7D7]",{"self-end":!f}),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{type:"tween",duration:.1},onMouseDown:b,children:s.jsx(sn,{className:"text-token-text-primary h-8 w-8"})}):((P=o==null?void 0:o.length)!=null?P:0)>0&&s.jsx(Oa,{disableHint:!0,isVisuallyHidden:(t==null?void 0:t.isReadonly)&&!t.isStreaming,disableOverlay:!0,isEmbeddedInPromptArea:!0,isRequestActive:e,actions:o,onCancel:a,onExpandedChange:d=>{x||g(d),u(d)},onSubmit:r,right:0,bottom:4})]})})})]})})]})};function Ja(e,n){const t=new Set(e.map(l=>l.id)),a=new Set(n.map(l=>l.id)),i=e.filter(l=>!a.has(l.id)).map(l=>$(J({},l),{diffStatus:Ks.REMOVED})),r=n.filter(l=>!t.has(l.id)).map(l=>$(J({},l),{diffStatus:Ks.ADDED})),o=e.filter(l=>a.has(l.id));return i.concat(r,o)}const $a=e=>{const{textdocId:n}=e,t=tn(a=>{var i;return(i=a==null?void 0:a.resolveTempTextdocId[n])!=null?i:n});return m.useMemo(()=>$(J({},e),{textdocId:t}),[t,e])};async function Va({textdocId:e,newTitle:n}){n!=null&&await G.safePost("/textdoc/{textdoc_id}/rename",{parameters:{path:{textdoc_id:e}},requestBody:{title:n}}).catch(t=>{pt.addError("renameCanvasTitle Error:",t)})}const eo=({serverThreadId:e,textdocVersion:n,initialTitle:t="Untitled Document",isEditingTitle:a,setIsEditingTitle:i})=>{const r=ze(),{mutateAsync:o}=de({mutationKey:[e,"textdocs"],mutationFn:Va,onMutate:async({textdocId:g,newTitle:x})=>{await r.cancelQueries({queryKey:[e,"textdocs"]});const b=r.getQueryData([e,"textdocs"]);return r.setQueryData([e,"textdocs"],E=>{if(!E)return E;const P=new Map(E.persistedTextdocVersionById),d=P.get(g);if(d){const R=$(J({},d),{title:x!=null?x:""});P.set(g,R)}const w=E.persistedTextdocVersions.map(R=>R.textdocId===g?$(J({},R),{title:x!=null?x:""}):R),I=new Map(E.persistedTextdocById),j=I.get(g);if(j){const R=$(J({},j),{title:x!=null?x:""});I.set(g,R)}return $(J({},E),{persistedTextdocVersionById:P,persistedTextdocVersions:w,persistedTextdocById:I})}),{previousTextDocData:b}},retry:2,onError:(g,x,b)=>{b!=null&&b.previousTextDocData&&r.setQueryData([e,"textdocs"],b.previousTextDocData),pt.addError("Error updating title:",g)},onSettled:()=>{r.invalidateQueries({queryKey:[e,"textdocs"]})}}),l=async g=>{var x;n&&await o({textdocId:(x=n.textdocId)!=null?x:"",newTitle:g})},[h,c]=m.useState(t),u=m.useRef(null),v=m.useRef(h),S=m.useRef(!1);m.useEffect(()=>{a&&u.current&&(u.current.focus(),u.current.select())},[a]);const f=g=>{c(g.target.value)},A=()=>{v.current=h},_=async()=>{S.current||await l(h),S.current=!1,i(!1)},T=g=>{(g.key==="Enter"||g.key==="Escape")&&g.preventDefault(),g.key==="Enter"?g.currentTarget.blur():g.key==="Escape"&&(c(v.current),S.current=!0,g.currentTarget.blur())};return s.jsx("input",{className:"w-[300px] rounded-lg border-none px-3 py-2 outline-hidden focus:ring-0",ref:u,value:h,onChange:f,onFocus:A,onBlur:_,onKeyDown:T,style:{fontSize:"1.125rem",boxSizing:"border-box",backgroundColor:"var(--global-states-light-element-hover, rgba(0, 0, 0, 0.05))"}})};function so(e){const{voiceName:n}=nn(),t=e?()=>to(e.textdocId,n,on()):null,a="".concat(e==null?void 0:e.textdocId,".").concat(e==null?void 0:e.versionInt,".").concat(n);return an(t,a)}function to(e,n,t){return G.safeGet("/textdoc/{textdoc_id}/synthesize",{parameters:{path:{textdoc_id:e},query:{voice:n,format:t}},skipJsonTransform:!0})}const no=({textdocVersion:e,isPersisting:n=!1,isTextdocAttachedPending:t,isTextdocStreaming:a,hasDebug:i,shouldShowPlayButton:r=!1,hideRenameButton:o=!1,toggleDebugView:l,isDebugVisible:h,toggleConsoleVisibility:c,isConsoleOpen:u,clientThreadId:v})=>{var H,Q;const S=We(),f=V();rn(S),so(e);const[A,_]=m.useState(!1),T=(H=e==null?void 0:e.title)!=null?H:"",g=(Q=Ct(v))!=null?Q:"",x=Ge(e==null?void 0:e.textdocId),b=!T||(x==null?void 0:x.status)===cn.INFERRING,E=()=>{_(!0)},[P,d]=m.useState(!1),{container:w,triggerRef:I}=xt({isOpen:P,onClose:()=>d(!1)}),j=[!x&&!o&&!a?s.jsx(k.Item,{icon:ln,onClick:E,children:f.formatMessage({id:"z/PT9T",defaultMessage:"Rename"})},"rename"):null,null,r?s.jsx(k.Item,{icon:ea,onClick:c,children:u?f.formatMessage({id:"owGHqE",defaultMessage:"Close console"}):f.formatMessage({id:"GPb4WX",defaultMessage:"Open console"})},"console"):null,null].filter(Boolean);if(j.length===0)return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"flex h-6 grow items-center overflow-hidden",children:s.jsx(re.Title,{className:"@[0px]:hidden @[150px]:block",children:b?s.jsx("div",{className:"w-52",children:s.jsx(nt,{lines:1,size:"base",width:100,widthVariance:0})}):T})}),n&&s.jsx(zs,{size:12,className:"text-token-text-tertiary ps-1"})]});const R=e&&s.jsx(k.Portal,{container:w,children:s.jsx(k.Content,{onCloseAutoFocus:se=>se.preventDefault(),children:j})});return s.jsx(s.Fragment,{children:A?s.jsx(eo,{serverThreadId:g,textdocVersion:e,initialTitle:T,isEditingTitle:A,setIsEditingTitle:_}):s.jsxs(s.Fragment,{children:[!1,s.jsxs(k.Root,{open:P,onOpenChange:d,children:[s.jsxs(k.Trigger,{ref:I,className:"hover:bg-token-surface-hover grid grid-cols-[1fr_auto] border-none bg-transparent! pe-2",children:[s.jsx(re.Title,{className:"max-w-[270px] truncate overflow-hidden",children:b?s.jsx("div",{className:"w-52",children:s.jsx(nt,{lines:1,size:"base",width:100,widthVariance:0})}):T}),s.jsx("div",{className:"flex items-center ps-1",children:n?s.jsx(zs,{size:12,className:"text-token-text-tertiary"}):s.jsx(un,{className:"icon-sm text-token-text-tertiary"})})]}),R]})]})})};function ao({textdocVersion:e,clientThreadId:n,color:t}){const{handleCopy:a,Icon:i,copyLabel:r}=ha({textdocVersion:e,clientThreadId:n});return s.jsx(Ue,{label:r,children:s.jsx(Se,{icon:i,onClick:a,color:t})})}function oo({textdocVersion:e,disabled:n,clientThreadId:t}){const a=V(),{handleFileDownload:i,handleBlobDownload:r,isLoading:o,downloadCopyLabel:l,isDocument:h}=pa({textdocVersion:e,clientThreadId:t});return h?s.jsxs(k.Sub,{children:[s.jsx(k.SubMenuTrigger,{icon:Gs,label:l,disabled:o||n}),s.jsx(k.Portal,{children:s.jsxs(k.SubContent,{align:"end",children:[s.jsx(k.Item,{onClick:c=>{c.preventDefault(),i("pdf")},children:a.formatMessage({id:"canvas.download-pdf-button.menu",defaultMessage:"PDF Document (.pdf)"})}),s.jsx(k.Item,{onClick:c=>{c.preventDefault(),i("docx")},children:a.formatMessage({id:"canvas.download-docx-button.menu",defaultMessage:"Microsoft Word Document (.docx)"})}),s.jsx(k.Item,{onClick:c=>{c.preventDefault(),i("md")},children:a.formatMessage({id:"canvas.download-md-button.menu",defaultMessage:"Markdown Document (.md)"})})]})})]}):s.jsx(k.Item,{label:l,icon:Gs,disabled:o||n,onClick:r})}function ro(e){for(const n of io){const t=e.match(n);if(t)return t[0]}return null}const io=[/AKIA[0-9A-Z]{16}/,/AIza[0-9A-Za-z_-]{35}/,/^(?:ghp_[A-Za-z0-9]{36}|github_pat_[A-Za-z0-9]{22}_[A-Za-z0-9]{59}|gho_[A-Za-z0-9]{36}|ghu_[A-Za-z0-9]{36}|ghs_[A-Za-z0-9]{36}|ghr_[A-Za-z0-9]{36})$/,/xox[baprs]-[0-9A-Za-z-]+/,/sk-[A-Za-z0-9]{48}/,/SK[0-9a-fA-F]{32}/,/(sk_live_[0-9a-zA-Z]{24})|(sk_test_[0-9a-zA-Z]{24})/,/-----BEGIN PRIVATE KEY-----/],co="".concat(Ha,"...");function ue(e){return["canvas","textdoc","share",e]}function lo({isLoading:e,isPublishedVersionLatest:n,sharedTextdoc:t,textdocVersion:a,title:i}){const{textdocId:r}=a,[o,l]=m.useState(!1),h=ro(a.content),c=(d,w)=>{d&&na(d,void 0,w).then(()=>{l(!0),setTimeout(()=>{l(!1)},1500)}).catch(()=>{})},u=ze(),{mutate:v,isPending:S}=de({scope:{id:r},mutationFn:d=>G.safePost("/textdoc/{textdoc_id}/share",{parameters:{path:{textdoc_id:d}}}).then(w=>Fe(w.shared_textdoc)),onSuccess:d=>{u.setQueryData(ue(r),d),c(cs(d.sharedTextdocId))}}),{mutate:f,isSuccess:A}=de({scope:{id:r},mutationFn:d=>G.safePost("/textdoc/shared/{shared_textdoc_id}/update_to_latest",{parameters:{path:{shared_textdoc_id:d}}}).then(w=>Fe(w.shared_textdoc)),onSuccess:d=>{u.setQueryData(ue(r),d)}}),{mutate:_}=de({scope:{id:r},mutationFn:({sharedTextdocId:d,access:w})=>G.safePost("/textdoc/shared/{shared_textdoc_id}/update_access",{parameters:{path:{shared_textdoc_id:d}},requestBody:{shared_textdoc_access:w}}).then(I=>Fe(I.shared_textdoc)),onMutate:({access:d})=>{const w=ue(r),I=u.getQueryData(w);return u.setQueryData(w,I&&$(J({},I),{access:d})),{previousAccess:I==null?void 0:I.access}},onSuccess:d=>{u.setQueryData(ue(r),d)},onError:(d,w,I)=>{const j=ue(r),R=u.getQueryData(j);u.setQueryData(j,R&&$(J({},R),{access:I==null?void 0:I.previousAccess}))}}),T=m.useRef(null),g=d=>{var w;(w=T.current)==null||w.focus(),t?(N.logButtonClick(U.COPY_SHARE_LINK,ye(a)),c(cs(t.sharedTextdocId),d)):(N.logButtonClick(U.CREATE_SHARE_LINK,ye(a)),v(r))},x=d=>{t&&(N.logButtonClick(d===hn.PUBLIC?U.UPDATE_SHARE_LINK_PUBLIC:U.UPDATE_SHARE_LINK_PRIVATE,ye(a)),_({sharedTextdocId:t.sharedTextdocId,access:d}))},b=t?cs(t.sharedTextdocId):void 0,E=()=>{t&&(N.logButtonClick(U.UPDATE_SHARE_LINK_TO_LATEST,ye(a)),f(t.sharedTextdocId))},P=h||(t==null?void 0:t.isAnonifyApiKeyDetected);return s.jsx(Fa,{inputRef:T,isLoading:e,isPublishedVersionLatest:n,sharedObject:t&&{id:t.sharedTextdocId,title:i,access:t.access,versionInt:t.versionInt,isModerationBlocked:t.isModerationBlocked,isAnonifyApiKeyDetected:t.isAnonifyApiKeyDetected},title:i,shareTextPlaceholder:co,shareUrl:b,isCopySuccessful:o,didPublishUpdates:A,isCreateLinkRequestInProgress:S,handleUpdateLatestSharedVersion:E,handlePrivacyChange:x,handlePrimaryButtonClick:g,maybeRenderWarndingContent:()=>s.jsx(s.Fragment,{children:P&&s.jsx(mo,{})})})}function ye(e){return{textdocType:e.type,textdocId:e.textdocId}}function uo({textdocVersion:e,isDisabled:n,title:t}){const a=sa(),i=V(),r=e==null?void 0:e.textdocId,{data:o,isLoading:l}=dt({enabled:!!r&&!n,queryKey:ue(r),queryFn:()=>!r||r.startsWith(Cn)?Promise.resolve(null):G.safeGet("/textdoc/{textdoc_id}/share",{parameters:{path:{textdoc_id:r}}}).then(T=>T.shared_textdoc&&Fe(T.shared_textdoc))}),[h,c]=m.useState(!1),{triggerRef:u,container:v}=xt({isOpen:h,onClose:()=>c(!1)}),S=(a==null?void 0:a.isWorkspaceAccount())&&!(a!=null&&a.features.includes(ta.WorkspaceShareLinks));if(n||S||!e)return s.jsx(Ue,{label:S?i.formatMessage(ls.workspaceSharingDisabled):i.formatMessage(ls.share),children:s.jsx(Se,{disabled:!0,icon:Qs})});const f=()=>{N.logButtonClick(U.OPEN_SHARE_MENU,ye(e))},A=(o==null?void 0:o.versionInt)===e.versionInt&&(o==null?void 0:o.title)===e.title,_=({className:T})=>s.jsxs("div",{className:"relative h-fit w-fit",children:[s.jsx(Qs,{className:T}),!A&&o&&s.jsx("div",{className:"absolute end-0 top-[1px] flex items-center gap-1.5",children:s.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-blue-400"})})]});return s.jsxs(dn,{open:h,onOpenChange:c,children:[s.jsx(Ue,{label:i.formatMessage(ls.share),children:s.jsx(mn,{ref:u,asChild:!0,children:s.jsx(Se,{icon:_,onClick:f})})}),s.jsx(Qe,{children:h&&s.jsx(fn,{forceMount:!0,container:v,children:s.jsx(gn,{align:"end",className:"z-50",sideOffset:8,collisionPadding:8,children:s.jsx(lo,{title:t,sharedTextdoc:o,isLoading:l,isPublishedVersionLatest:A,textdocVersion:e})})})})]})}function mo(){return s.jsx(pn,{type:"danger",className:"w-auto md:p-3",children:s.jsx(us,{id:"8NG6sN",defaultMessage:"There may be an API key in your canvas. If you share the canvas, anyone with the link can see its contents."})})}function fo({disabled:e=!1,isShowingChanges:n,onMouseEnter:t,onClick:a,onEsc:i}){const r=V(),o=m.useRef(null);return m.useEffect(()=>{if(n){const l=h=>{h.key==="Escape"&&(i==null||i(),o.current&&o.current===document.activeElement&&o.current.blur())};return window.document.addEventListener("keydown",l),()=>{window.document.removeEventListener("keydown",l)}}},[n,i]),s.jsx(Ue,{label:!e&&r.formatMessage(n?lt.hideChanges:lt.showChanges),children:s.jsx(Se,{icon:xn,ref:o,disabled:e,onClick:a,onMouseEnter:t,className:be("transition-colors enabled:hover:bg-black/5 dark:enabled:hover:bg-white/10",n&&qa)})})}const lt=Zt({showChanges:{id:"3jMGNS",defaultMessage:"Show changes"},hideChanges:{id:"HWiQSk",defaultMessage:"Hide changes"}}),go=({clientThreadId:e,isHistoricalVersion:n,textdocVersion:t,readonlyReason:a,hasDebug:i,isEmbedded:r,isPersisting:o,isShowingChanges:l,hideRunCode:h=!1,hideHistoryActions:c=!1,hideRenameButton:u=!1,onHoverPrevious:v,onHoverShowChanges:S,onToggleShowChanges:f,onClickPrevious:A,onClickNext:_,onClickCodePreview:T,onClose:g,toggleDebugView:x,toggleConsoleVisibility:b,isCodeRunning:E,isTextdocAttachedPending:P,isTextdocStreaming:d,isConsoleOpen:w,isDebugVisible:I})=>{var W,he,Ie,ke;const j=V(),R=aa(),H=Ge(t==null?void 0:t.textdocId),Q=(W=t==null?void 0:t.title)!=null?W:"",{isCodePreviewable:se,isCodeExecutable:F,hasCanvasCodeExecution:O}=bt(t),ne=(he=t==null?void 0:t.metadata)==null?void 0:he.hive_id,M=(Ie=t==null?void 0:t.metadata)==null?void 0:Ie.record_meeting_id,me=We(),Te=(M!=null||ne!=null)&&vt(me,"292227286"),{mutate:Ze,isPending:Ye}=de({scope:{id:(ke=M!=null?M:ne)!=null?ke:""},mutationFn:()=>M?G.safePost("/record/meetings/{meeting_id}/send_summary_to_slack",{parameters:{path:{meeting_id:M}}}):ne?G.safePost("/hive/{hive_id}/send_summary_to_slack",{parameters:{path:{hive_id:ne}}}):Promise.resolve({textdoc_id:""})}),Ae=()=>{!M&&!ne||Ze()},q=!h&&(se||F),ee=t==null?void 0:t.versionInt,ae=ee!=null&&ee>1,fe=n,ge=!c,Ee=se&&E,we=t==null||H!=null||n||a.isStreaming,_e=t==null||a.isStreaming;return s.jsxs(re.Header,{className:be("@container",se&&E&&"bg-transparent!"),children:[s.jsx(re.CloseButton,{onClick:g}),s.jsx("div",{className:"@container flex flex-1 basis-0 items-center truncate leading-[0]",children:s.jsx(no,{hasDebug:i,isConsoleOpen:w,isDebugVisible:I,toggleConsoleVisibility:b,toggleDebugView:x,isPersisting:o,textdocVersion:t,isTextdocAttachedPending:P,isTextdocStreaming:d,shouldShowPlayButton:q,hideRenameButton:u,clientThreadId:e})}),s.jsxs("div",{className:"flex min-w-0 basis-auto items-center leading-[0] select-none",children:[s.jsx(ao,{clientThreadId:e,textdocVersion:t}),s.jsx(uo,{isDisabled:we,textdocVersion:t,title:Q}),ge&&s.jsx(Qe,{children:s.jsx(oe.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,width:0},transition:{type:"spring",bounce:.24,duration:.4},children:s.jsx(fo,{disabled:Ee||a.isStreaming||!ae,isShowingChanges:l,onMouseEnter:S,onClick:f,onEsc:f})})}),s.jsxs(k.Root,{children:[s.jsx(k.BasicTrigger,{children:s.jsx(Se,{icon:oa})}),s.jsx(k.Portal,{children:s.jsxs(k.Content,{align:"end",children:[s.jsx(k.Item,{icon:vn,disabled:!ae,onClick:A,onMouseOver:v,label:j.formatMessage({id:"PoD5+8",defaultMessage:"Previous version"})}),s.jsx(k.Item,{icon:yn,disabled:!fe,onClick:_,label:j.formatMessage({id:"PJ8YVJ",defaultMessage:"Next version"})}),s.jsxs(k.Group,{children:[t&&t.type!==xe.LOADING&&H==null&&s.jsx(oo,{disabled:_e,textdocVersion:t,clientThreadId:e}),Te&&s.jsx(k.Item,{icon:ra,disabled:Ye,onClick:Ae,label:j.formatMessage({id:"CRHbjv",defaultMessage:"Send to Slack"})})]})]})})]}),q&&s.jsx(wa,{clientThreadId:e,isCodePreviewable:se,isDisabled:!O||a.isTextdocStreaming&&!E,disabledTooltip:O?void 0:j.formatMessage({id:"NTZRWe",defaultMessage:"Code execution for canvas is disabled for your workspace. Contact your admin to enable."}),onClick:T,isCodeRunning:E}),!r&&!R&&s.jsx(Ua,{clientThreadId:e})]})]})};function ho(e){const n=/\[([^\]]+)\]\((https?:\/\/[^\s)]+|www\.[^\s)]+)\)/gi,t=new Set,a=e.matchAll(n);for(const i of a){const r=i[2];try{let o=r;o.startsWith("www.")&&(o="http://"+r),new URL(o),t.add(r)}catch(o){}}return t}const po=async({lastVersion:e,textdocId:n,content:t,comments:a})=>{const i=bn(a,t);return(await G.safePost("/textdoc/{textdoc_id}",{parameters:{path:{textdoc_id:n}},requestBody:{version:e,content:t,comments:i}})).version},Co=()=>{const e=m.useRef([]),n=m.useRef(null),{mutateAsync:t,isPending:a}=de({mutationKey:["canvas","textdoc","persist"],mutationFn:po});return[m.useCallback(async(r,o,l)=>{const h=new AbortController,u=(async()=>{var _,T;const[A]=e.current;try{await(A==null?void 0:A.promise)}catch(g){N.logError("Saving document",g)}if(!h.signal.aborted)try{const g=Math.max((_=n.current)!=null?_:0,(T=r.versionInt)!=null?T:ft);let x="";try{ct(o)?x=o():x=o}catch(d){N.logError("Serializing document",d)}let b=[];try{ct(l)?b=l():b=l}catch(d){N.logError("Adjusting comments",d)}const{textdocId:E}=r;Sn({textdocId:E,basedOnVersionInt:g,content:x,comments:b});const P=await t({textdocId:E,lastVersion:g,content:x,comments:b});Tn({textdocId:E,basedOnVersionInt:g,newVersion:P}),n.current=P}catch(g){N.logError("Error saving document",g)}finally{e.current.shift()}})(),v={abort:()=>h.abort(),promise:u},[S,f]=e.current;return f&&(f.abort(),e.current=S?[S]:[]),e.current=S?[S,v]:[v],u},[t]),e,a]},xo=3e3,vo=e=>{const[n,t,a]=Co(),i=V(),r=m.useRef(null),o=m.useCallback(ia(async(c,u,v)=>{if(!ds(c))return n(c,u,v);qe.replaceTempTextdocContent(c.textdocId,typeof u=="string"?u:u())},xo,{leading:!1}),[n]),l=An(e);return m.useEffect(()=>{if(!l)return;const c=at(window,{pagehide:()=>o.flush(),beforeunload:v=>{o.flush(),v.returnValue=i.formatMessage({id:"QZrKwi",defaultMessage:"You have a canvas save in progress."})}}),u=at(document,{visibilitychange:()=>o.flush(),keydown:()=>{r.current="keyboard"},mousemove:()=>{r.current!=="mouse"&&o.flush(),r.current="mouse"}});return()=>{r.current=null,u(),c()}},[i,l,o]),m.useEffect(()=>()=>{o.flush()},[e,o]),En(async()=>{var c,u;await o.flush(),await Promise.allSettled((u=(c=t.current)==null?void 0:c.map(({promise:v})=>v))!=null?u:[])}),[m.useCallback((c,u,v)=>{const{textdocId:S}=c;return ds(c)||wn(S),o(c,u,v)},[o]),o.flush,a||l]};function yo(e,n,t){const a=ze(),i=t!=null&&n!=null,{data:r,error:o,fetchNextPage:l,hasNextPage:h,isFetching:c}=Yt(ut(e,n,i)),u=m.useCallback(async()=>{const _=n!=null;await a.prefetchInfiniteQuery(ut(e,n,_))},[a,e,n]);m.useEffect(()=>{const _=n;return()=>{a.removeQueries({queryKey:St(e,_),exact:!0})}},[a,e,n]);const[v,S,f,A]=m.useMemo(()=>{var T;if(r&&t){const g=r.pages.flatMap(b=>b),x=g.findIndex(b=>{var E;return"beforeVersion"in t?((E=b.versionInt)!=null?E:ft)<t.beforeVersion:b.versionInt===t.version});if(x!==-1)return[x===g.length-1,g[x],x>0?g[x-1]:null,x<g.length-1?g[x+1]:null]}const _=(T=r==null?void 0:r.pages.flatMap(g=>g))!=null?T:[];return[!0,null,null,_.length===0?null:_[0]]},[r,t]);return m.useEffect(()=>{!c&&i&&h&&v&&l()},[c,i,h,v,l]),m.useEffect(()=>{!S&&o&&ve(e)},[S,o,e]),{historicalTextdocVersion:S,nextHistoricalTextdocVersion:f,prefetchHistoricalTextdocVersion:u,previousHistoricalTextdocVersion:A}}function St(e,n=null){return["textdocHistory",e,n]}function ut(e,n,t=!0){return{queryKey:St(e,n),queryFn:({pageParam:a})=>bo(e,a),initialPageParam:n!=null?n:void 0,getNextPageParam:a=>{var r;const i=(r=ca(a))==null?void 0:r.versionInt;if(i&&i>1)return i},enabled:t,staleTime:1/0,retry:2}}async function bo(e,n){return n===void 0||n<=1?[]:(await G.safeGet("/textdoc/{textdoc_id}/history",{parameters:{path:{textdoc_id:e},query:{before_version:n}}})).previous_doc_states.map(({id:a,version:i,textdoc_type:r,title:o,content:l,updated_at:h,comments:c,metadata:u})=>({textdocId:a,versionInt:i,messageId:null,title:o,type:In(r),content:l,status:mt.COMPLETE,createdAt:la(h),comments:_n(c,l),metadata:{content_references:u==null?void 0:u.content_references,hive_id:u==null?void 0:u.hive_id}}))}const Wo=({isFullScreen:e=!1,isEmbedded:n=!1,hideHeader:t=!1,hideRunCode:a=!1,isReadonlyFromQueryParam:i=!1,hideRenameButton:r=!1,clientThreadId:o,focusedTextdoc:l,onClose:h,isAnimating:c=!1,width:u,hideBottomComposer:v=!1})=>{"use no forget";var Os,Ls,Hs,Fs;const S=We(),{textdocId:f,history:A,showChangesAtVersion:_=null,shouldRunCodeOnOpen:T=!1}=$a(l),g=V(),[x,b,E]=vo(f),{targetedContent:P}=kn(),d=jn(S),[w,I]=m.useState(!1),[j,R]=m.useState(!1),H=Pn(f),Q=Rn(),se=ms(o,ht.getRequestId),F=ua(se),{data:O,isLoading:ne}=dt(is(f,_)),[M,me]=m.useState(!1),[Te,Ze]=m.useState(null),Ye=Mn(o),Ae=m.useRef(null),q=(Os=H==null?void 0:H.versions)!=null?Os:[],ee=(Ls=q[0])==null?void 0:Ls.versionInt,{historicalTextdocVersion:ae,nextHistoricalTextdocVersion:fe,previousHistoricalTextdocVersion:ge,prefetchHistoricalTextdocVersion:Ee}=yo(f,ee,A),we=ze();m.useEffect(()=>{Ke.reset()},[f]);const _e=q.length>0?q[q.length-1]:null,W=q.length>1?q[q.length-2]:null,he=Ct(o),{restoreHistoricalTextdocVersion:Ie,optimisticRestoredTextdocVersion:ke}=Dn(he,_e,ae),ie=A!=null,p=ie?ae:_e,Z=_!=null,pe=ja(o,p),je=c?null:O,Pe=(()=>{if(c||p==null)return[];const C=ot(p.comments);return!Z&&ae!=null?ae.comments:!Z||O==null?C:O.contentBefore!==O.contentAfter?[]:Ja(O.commentsBefore,O.commentsAfter)})(),B=(Hs=p==null?void 0:p.type)!=null?Hs:xe.LOADING,fs=Ca({textdocVersion:p,clientThreadId:o}),Tt=m.useCallback(()=>{var y,D;const C=(D=(y=window.getSelection())==null?void 0:y.toString())!=null?D:"";fs({source:"keyboard",selectedText:C,productLogOnly:!0})},[fs]),Xe=Nn(),gs=ds(p),te=Bn(p),Je=On(p),hs=Ln(p),At=hs&&!n,Et=Ws(Q),wt=Ws(F);m.useEffect(()=>{!gs&&q.length===0&&Xe!==Zs.NATIVE&&(!Q&&Et.current||!F&&wt.current||!Q&&!F)&&(h==null||h())},[q.length,Q,F]);const{content:L,currentlyStreamingLineIndex:Re}=(O==null?void 0:O.contentBefore)!=null&&!Ys(B)?{content:O.contentBefore,currentlyStreamingLineIndex:null}:xa(p,W),_t=Hn(he,Array.from(ho(L))),[Me,$e]=Ga({value:L,isRequestActive:F,isTextdocStreaming:te,comments:Pe}),ps=Fn(p),Cs=Xe===Zs.LAST_TURN||Me||E;m.useEffect(()=>{qn().sendMessage({type:yt.Streaming,streaming:Cs})},[Cs]);const It=({getSerializedDocument:C,getAdjustedComments:y})=>{p&&x(p,C,y)},kt=C=>{var D;if(!p)return;const y=C.doc.toString();x(p,y,(D=C.field(ba,!1))!=null?D:[])},xs=(C,y,D,X,ce)=>{$e(!0),pe({sourceEvent:C,action:D,content:y,userMessageType:Le.ASK_CHATGPT,sourceRange:X,selectionMetadata:{selection_type:ce,selection_position_range:X}})},vs=({id:C})=>{ps(C,$s.DISMISS),Ke.reset()},ys=async(C,y)=>{$e(!0);const{id:D,at:X,content:ce}=y;if(await ps(D,$s.ACCEPT)===!1)return $e(!1);pe({sourceEvent:C,content:ce,userMessageType:Le.ACCEPT_COMMENT,sourceRange:X,action:it.EDIT,selectionMetadata:{selection_type:rt.SELECTION,selection_position_range:X}})},Ve=(C,y,D,X)=>{const{action:ce}=X;pe({sourceEvent:C,action:ce,content:D,sourceRange:y,userMessageType:Le.ACCELERATOR,acceleratorMetadata:{action:ce,id:X.id,prompt:D},selectionMetadata:y!=null?{selection_type:rt.SELECTION,selection_position_range:y}:void 0})},jt=(C,y)=>{pe({sourceEvent:C,action:it.EDIT,content:y,userMessageType:Le.FULL_SCREEN_SUBMIT})},es=Un(),bs=C=>{var y;return(y=es==null?void 0:es[C])!=null?y:C},ss=()=>Kn(o,void 0,{clientInitiated:!0,reason:"textdoc_canvas_cancel"}),Pt=()=>{A?He(f,A):ve(f)},K=_a({streamingSource:Xe,isRestoring:ke!=null,isRequestActive:F,isTextdocStreaming:te,isReadonlyFromQueryParam:i,isHistoricalVersion:ie,isShowingChanges:Z});let De=null;const Ss=c||K.isReadonly||Me,Ne=gt()||Ye||i||gs,Ts=()=>c&&Pe.length>0?le.ALL_HIDDEN:Ne?le.COMMENTS_READONLY:K.isReadonly?K.isStreaming?le.ENABLED:K.isReadonlyFromQueryParam||K.isShowingChanges||K.isHistoricalVersion?le.COMMENTS_READONLY:le.ALL_HIDDEN:le.ENABLED,Rt=m.useCallback(async C=>{const{suggestion:y}=await G.safePost("/textdoc/{textdoc_id}/autocomplete",{parameters:{path:{textdoc_id:f}},requestBody:{content:C}});return y},[f]),As=e||c||i;let ts=[];switch(B){case xe.LOADING:De=s.jsx(ya,{});break;case xe.DOCUMENT:De=s.jsx(va,{value:L,comments:Pe,previousValue:W==null?void 0:W.content,getAutocompleteSuggestion:Rt,previousComments:ot(W==null?void 0:W.comments),isRewriting:Je,isAnimatingFromPreview:c,isSendDisabled:Ne,getStableCommentId:bs,diff:je,isRequestActive:F,isDisabled:K.isReadonly||Q,isWaitingForCommentResponse:Me,hideAccelerators:As,hideToolbar:Ss,hideEditOverlay:c,commentsMode:Ts(),readonlyReason:K,onBlur:b,onSave:b,onChange:It,onCancelRequest:ss,targetedContent:P,onAddComment:xs,onAcceptComment:ys,onDismissComment:vs,onSubmitAccelerator:Ve,onExitShowChanges:Pt,safeUrls:_t,width:u,modelCursor:hs||te&&!Je?p==null?void 0:p.modelCursor:void 0,shouldResetSelection:(p==null?void 0:p.versionInt)===1,metadata:H==null?void 0:H.metadata}),ts=Na;break;default:Ys(B)&&(De=s.jsx(Ta,{id:"codemirror",getStableCommentId:bs,language:ka(B),value:L,comments:Pe,hideAccelerators:As,commentsMode:Ts(),hideToolbar:Ss,onSubmitAccelerator:Ve,currentlyStreamingLineIndex:Re!=null?Re:null,readonlyReason:K,isRequestActive:F,isSendDisabled:Ne,isWaitingForCommentResponse:Me,onChange:kt,onCancelRequest:ss,onAddComment:xs,onBlur:b,onSave:b,codemirrorRef:Ae,onDismissComment:vs,onAcceptComment:ys,textdocDiff:je!=null?je:void 0,modelCursor:te&&Re==null?p==null?void 0:p.modelCursor:void 0}),ts=Sa)}const Ce=m.useRef(null),ns=m.useRef(null),{hasCanvasCodeExecution:as,isCodeExecutable:Es,isCodePreviewable:Y}=bt(p),ws=as&&Y,_s=as&&Es,Mt=zn(),Is=m.useCallback(()=>{var C,y;!M&&(ws||_s)?(me(!0),(C=Ce.current)==null||C.runCode(B,L)):((y=Ce.current)==null||y.stopCode(),me(!1))},[ws,_s,M,L,B]),ks=Gn(()=>{Is()});m.useEffect(()=>{T&&ks()},[T,ks]);const z=p==null?void 0:p.versionInt,Dt=z!=null&&z>1,Nt=ie,Be=ge==null?void 0:ge.versionInt,os=fe==null?void 0:fe.versionInt,Bt=()=>{Z?A?He(f,A):ve(f):(N.logButtonClick(U.SHOW_CHANGES,{textdocType:B,textdocId:f,versionInt:z,latestVersionInt:ee}),z&&Vs(f,z,A))},Ot=()=>{N.logButtonClick(U.HISTORY_PREVIOUS,{textdocType:B,textdocId:f,versionInt:z,latestVersionInt:ee,isShowingChanges:Z}),f&&z&&Dt&&He(f,{beforeVersion:z},Z&&Be!=null?Be:void 0)},Lt=()=>{N.logButtonClick(U.HISTORY_NEXT,{textdocType:B,textdocId:f,versionInt:z,latestVersionInt:ee,isShowingChanges:Z}),Nt&&(os?He(f,{version:os},Z?os:void 0):Z&&ee?Vs(f,ee,null):ve(f))},Ht=vt(S,"1804926979"),js=ms(o,Ka(f)),Ft=da(),Ps=Ge(p==null?void 0:p.textdocId),qt=!t&&s.jsx(go,{hideRunCode:a,clientThreadId:o,isHistoricalVersion:ie,textdocVersion:p,readonlyReason:K,hasDebug:d,isEmbedded:n,isPersisting:E,isShowingChanges:Z,isConsoleOpen:j,isDebugVisible:w,hideHistoryActions:i,hideRenameButton:r,onHoverPrevious:()=>{Ee(),Be&&we.prefetchQuery(is(f,Be))},onHoverShowChanges:()=>{Ee(),z&&we.prefetchQuery(is(f,z))},onToggleShowChanges:Bt,onClickPrevious:Ot,onClickNext:Lt,toggleDebugView:()=>I(C=>!C),toggleConsoleVisibility:()=>{j||ga.logEvent("Canvas Open Console Clicked"),R(C=>!C)},onClose:()=>{if(N.logButtonClick(U.CLOSE_TEXTDOC,{textdocType:p==null?void 0:p.type}),Ps&&!e){const{create_source:C,hasUserEdits:y,tempTextdocId:D}=Ps;if(y&&C!==Js.USER_CREATED_COMPOSER){Ds(!0);return}if(qe.removeTempTextdoc(D),C===Js.USER_CREATED_COMPOSER){const X=ma(Ft);fa(X,L)}}h==null||h()},onClickCodePreview:Is,isCodeRunning:M,isTextdocStreaming:te,isTextdocAttachedPending:Xs(p)});let Rs=null;const Oe=!a&&as&&(Es||Y),rs=Ia(B,L);m.useEffect(()=>{var C;Oe&&rs&&((C=ns.current)==null||C.prepareEnvironment(L,rs))},[Oe,rs]),m.useEffect(()=>{var C;Y&&M&&!te&&((C=Ce.current)==null||C.runCode(B,L))},[Y,te,L,B]);const Ms=(Fs=p==null?void 0:p.title)!=null?Fs:"";Oe&&(Rs=s.jsx(Pa,{id:f,title:Ms,onChangeBackgroundColor:Ze,onCodeRunComplete:()=>me(!1),visuallyHidden:!Y||!M,disableNetworkRequests:!Mt,networkAccessDeniedMessage:g.formatMessage({id:"GE4AJf",defaultMessage:"Network requests in canvas are disabled for your workspace. Contact your admin to enable this feature."}),enableTransition:Y&&B!==xe.CODE_HTML,isCodeUpdating:te,ref:ns,onRetryCodeRun:()=>{var C;return(C=Ce.current)==null?void 0:C.runCode(B,L)}}));const[Ut,Ds]=m.useState(!1),Ns=s.jsx(za,{isOpen:Ut,dismissModal:()=>Ds(!1),closeTextdocEditor:()=>{h==null||h()},textdocVersion:p,clientThreadId:o}),Bs=s.jsxs(s.Fragment,{children:[qt,s.jsx(re.Content,{scrollToBottomMode:At?"bottom":"top",shouldScrollToTop:Je,isLoading:ne,hideChildren:Y&&M,overlay:Rs,onCopy:Tt,children:De}),Oe&&s.jsx(Ra,{ref:Ce,sandboxRef:ns,textdocId:f,textdocTitle:Ms,textdocContent:L,isTextdocAttachedPending:Xs(p),highlightLine:C=>{var y;return(y=Ae.current)==null?void 0:y.highlightLine(C)},isRequestActive:F,createTextdocTurn:pe,isOpen:j,onOpenChange:R}),s.jsx(Qe,{children:ie&&!i&&s.jsx(Qa,{onClickRestore:Ie,onClickResetLatest:()=>ve(f)})}),e&&!ie&&!v&&!(M&&Y)&&!Ne&&s.jsx(Xa,{isRequestActive:F,clientThreadId:o,onSubmitAccelerator:Ve,onSubmit:jt,onCancel:ss,readonlyReason:K,acceleratorActions:ts})]});if(Ht&&js&&p){const y=new URLSearchParams(window.location.search).get(Ma),D=y==null?void 0:parseInt(y);return s.jsxs(s.Fragment,{children:[Ns,s.jsx(re,{previewBackgroundColor:Te,isPreviewingCode:Y&&M,children:s.jsxs("div",{className:"flex h-full",children:[s.jsx("div",{className:"relative flex h-full min-h-0 flex-auto grow flex-col",children:Bs}),s.jsx(Da,{hiveId:js,clientThreadId:o,textdocVersion:p,ts:D})]})})]})}return s.jsxs(s.Fragment,{children:[Ns,s.jsx(re,{previewBackgroundColor:Te,isPreviewingCode:Y&&M,children:Bs})]})};export{yt as C,Wo as T};
//# sourceMappingURL=ba5jyp7qj5r8tn2y.js.map
