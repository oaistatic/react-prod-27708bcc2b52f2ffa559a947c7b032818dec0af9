var j=Object.freeze,k=Object.defineProperty;var m=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var E=(e,t,n)=>t in e?k(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,P=(e,t)=>{for(var n in t||(t={}))M.call(t,n)&&E(e,n,t[n]);if(m)for(var n of m(t))b.call(t,n)&&E(e,n,t[n]);return e};var T=(e,t)=>{var n={};for(var a in e)M.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(e!=null&&m)for(var a of m(e))t.indexOf(a)<0&&b.call(e,a)&&(n[a]=e[a]);return n};var N=(e,t)=>j(k(e,"raw",{value:j(t||e.slice())}));import{r as i,j as o,M as w}from"./fg33krlcm0qyi6yw.js";import{aP as V,eG as W,mI as J,lz as O,dH as Q,dF as $,lW as X,en as Y,fD as Z,P as v,dL as q,dR as ee,dI as te,k8 as se,a9 as A,F as ne,dQ as ae}from"./mtk1qztvnb31pw5r.js";import{E as oe}from"./jh2gb364v6b9t61m.js";import{jy as re,jz as ce}from"./k65njl5wlgspihfr.js";function ie({initialText:e,clientThreadId:t,currentLeaf:n,onExitEdit:a,onRequestCompletion:l,disabled:I,attachments:d}){const[g,_]=i.useState(e!=null?e:""),f=i.useRef(null),F=V(),S=W.useStore(),p=g.trim()==="",y=J(),z=i.useCallback(s=>{_(s.currentTarget.value)},[]),h=i.useCallback(s=>{if(p)return;const r={},c=re();d&&(r.attachments=d),c&&(r.__internal={search_settings:c});const C=S.getActiveSystemHintType(),{systemHints:R,extraStreamParams:B}=O(C?[C]:[]),u=Q(t),D=$.getParentNode(u,n).message.id,{composerThinkingEffort$:K}=X(y),U=Y(K);l({sourceEvent:s,parentMessageId:D,promptMessage:Z(g,Object.keys(r).length>0?r:void 0),extraStreamParams:B,completionMetadata:{conversationMode:u==null?void 0:u.mode,systemHints:R},thinkingEffort:U}),a(),v.logEvent("Change Active Node",{intent:"edit_save"})},[p,d,t,S,l,a,n,g,y]),x=i.useCallback(()=>{q(t,s=>{ee.setCurrentBranch(s,n)}),v.logEvent("Change Active Node",{intent:"edit_cancel"}),a(),v.logEvent("Cancel Edit Prompt",{threadId:te(t)})},[n,a,t]);i.useEffect(()=>{const s=f.current;if(s){s.focus();const r=s.value.length;s.setSelectionRange(r,r)}},[]),i.useEffect(()=>{const s=f.current,r=c=>{c.isComposing||(c.key==="Enter"&&c.metaKey?h(c):c.key==="Escape"&&x())};return s&&s.addEventListener("keydown",r),()=>{s&&s.removeEventListener("keydown",r)}},[x,h]);const G=d&&d.length>0&&o.jsx(de,{children:d.map(s=>o.jsx(ce,{width:F?"wide":"normal",file:s.name,contextConnectorInfo:se(s.context_connector_info)},s.id))}),L=o.jsx("div",{className:"m-2 max-h-[25dvh] overflow-auto",children:o.jsx(oe,{ref:f,value:g,onChange:z,onCopy:s=>s.stopPropagation(),className:"m-0 w-full resize-none border-0 bg-transparent focus:ring-0 focus-visible:ring-0"})});return o.jsxs("div",{className:"bg-token-main-surface-tertiary rounded-3xl px-3 py-3",children:[G,L,o.jsxs("div",{className:"flex justify-end gap-2",children:[o.jsx(A,{as:"button",color:"secondary",onClick:x,children:o.jsx(w,{id:"D9gbPp",defaultMessage:"Cancel"})}),o.jsx(A,{as:"button",onClick:h,disabled:I||p,children:o.jsx(w,{id:"KGxIJG",defaultMessage:"Send"})})]})]})}var H;const de=ne.div(H||(H=N(["flex gap-2 flex-wrap"])));function xe(n){var a=n,{message:e}=a,t=T(a,["message"]);var l;return o.jsx(ie,P({currentLeaf:e.id,initialText:ae(e),attachments:(l=e.metadata)==null?void 0:l.attachments},t))}export{xe as TextMessageEditor};
//# sourceMappingURL=j0xewpby56axy54p.js.map
