var J=Object.defineProperty,$=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var A=(s,a,o)=>a in s?J(s,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[a]=o,w=(s,a)=>{for(var o in a||(a={}))se.call(a,o)&&A(s,o,a[o]);if(R)for(var o of R(a))ne.call(a,o)&&A(s,o,a[o]);return s},C=(s,a)=>$(s,ee(a));import{j as e,M as m,i as te,n as re,a as ae,e as ie,r as oe,w as le,u as me,F as ce,ae as de,a0 as ue}from"./fg33krlcm0qyi6yw.js";import{z as pe,ao as he,lj as fe,iJ as xe,gk as ge}from"./k65njl5wlgspihfr.js";import{W as ve}from"./gp2ycmyaevvj2458.js";import{m as je,I as we,b as Ce,eu as Ne,t9 as Ee,bp as Me,bt as be,a9 as Le,c0 as ye,uA as Se,T as ke,l as W}from"./mtk1qztvnb31pw5r.js";import{T as t}from"./hcn3kohxpjzaoxwc.js";import{I as Pe}from"./blmsijdyv0yxybpw.js";import{u as Ie}from"./mbk6r4n07eoyd764.js";import{E as N}from"./n62ntyw00ngcyjjo.js";import{w as _e,i as Te,W as He,k as Re}from"./n0ab5m1z76n8mazm.js";import{W as F}from"./sy1xvqwioh9ks4z8.js";import"./eb2ntjcgqhqizd13.js";import"./hots192vdjsjmkwr.js";import"./efooahjtdr85x1lo.js";import"./km71i01x6ma5r62b.js";import"./f9jzes5xr4mq3zrh.js";import"./j6htuwwuulo7h0p6.js";import"./czn39vd97sciq42g.js";import"./l9v3ntkj34comb67.js";import"./cmaobpdpreyiep8p.js";import"./eqi3xjytwhmszqqa.js";import"./bhm7utdivrybcfbl.js";import"./ohquqctluwabmb5i.js";import"./c2cj1dlcffke3f7m.js";import"./hb1mva1gmw4bcs8w.js";import"./mivow98b53y1taf8.js";import"./krwszi9u3lj63i9v.js";import"./kpobiwwkg2o2u14w.js";import"./ir7nzwbolrsm3ds2.js";import"./mmn9462oogkapcg8.js";import"./ck1u9icgxosmytry.js";import"./bes67zhi4fr5gq8i.js";import"./btdpwmi6j9nv6qc2.js";import"./keo7wnl5i52xco98.js";import"./ek8ypz08ir47cco2.js";import"./kzbknm4lxuyoq9wi.js";import"./jed1ux7qibe55pmj.js";import"./h1em0bjkpkjv8ykw.js";import"./f5ep9o7usovyn4vf.js";import"./ly75bs3d14n5v622.js";import"./hu1bt0oauegdhua6.js";function Ae(){return e.jsx("div",{className:"border-token-border-heavy flex items-center border-b",children:e.jsx("div",{className:"py-2 text-xl leading-7 font-medium",children:e.jsx(m,{id:"wham.environmentsHeader.message",defaultMessage:"Environments"})})})}const O=25,We=100;function Fe({isPinned:s,onToggle:a,intl:o,isCreator:u}){return e.jsx(t.Cell,{className:"content-center pe-1!",children:e.jsx(ke,{side:"bottom",align:"center",className:"block w-full",alignOffset:0,label:u?s?e.jsx(m,{id:"wham.environmentsList.unpin",defaultMessage:"Unpin environment for everyone in your workspace"}):e.jsx(m,{id:"wham.environmentsList.pin",defaultMessage:"Pin environment to the top for everyone in your workspace"}):e.jsx(m,{id:"wham.environmentsList.pin.notCreator",defaultMessage:"You can only pin and unpin environments you created."}),children:e.jsxs("button",{disabled:!u,onClick:a,className:W("group/cell relative flex h-10 w-full items-center px-4 group-hover/row:opacity-100",!s&&"opacity-0",s&&!u&&"opacity-50"),"aria-label":s?o.formatMessage({id:"wham.environmentsList.unpinEnvironment",defaultMessage:"Unpin environment"}):o.formatMessage({id:"wham.environmentsList.pinEnvironment",defaultMessage:"Pin environment"}),children:[s&&e.jsx(fe,{className:"icon absolute opacity-0 group-hover/cell:opacity-100"}),e.jsx(xe,{className:W("icon absolute",s&&"opacity-100 group-hover/cell:opacity-0")})]})})})}function Oe(){var P,I;const s=te(),[a,o]=re(),u=ae(),l=ie(),D=je(),U=Ce(),d=we(U),E=!!(d!=null&&d.isWorkspaceAccount()),M=Ie(),[g,Q]=oe.useState((P=a.get("search"))!=null?P:""),{data:v,isLoading:z,error:b,fetchNextPage:K,hasNextPage:x,isFetchingNextPage:V}=le({queryKey:_e({pageSize:O,enforceRepoAccess:!1}),initialPageParam:null,queryFn:({pageParam:n})=>F.getEnvironmentWithCreators(n?We:O,n),getNextPageParam:n=>{var r;return(r=n.cursor)!=null?r:null}}),{mutate:B}=me({mutationFn:({environmentId:n,isPinned:r})=>(u.setQueriesData({queryKey:He},i=>i&&Ne(i,c=>{for(const h of c.pages)for(const p of h.items)if(p.id===n){p.is_pinned=!p.is_pinned;break}})),u.setQueryData(["wham","environments"],i=>i&&i.map(c=>c.id===n?C(w({},c),{is_pinned:r}):c)),u.setQueryData(Re,i=>i==null?void 0:i.map(c=>c.id===n?C(w({},c),{is_pinned:r}):c)),F.updateEnvironment(n,{is_pinned:r})),onSettled:()=>{Te(u)},onError:()=>{D.danger(l.formatMessage({id:"wham.environmentsList.failedToPinEnvironment",defaultMessage:"Failed to pin environment"}))}}),{isConnected:L,isLoading:G}=Ee(be.GITHUB_CONNECTOR,"github","/codex/settings/environments",Me.CODEX),y=(I=v==null?void 0:v.pages.flatMap(n=>n.items))!=null?I:[],j=g.trim().toLowerCase(),Y=y.filter(n=>n.label.toLowerCase().includes(j)),S=n=>{const r=n.toLowerCase();return r===j?0:r.startsWith(j)?1:2},k=Y.slice().sort((n,r)=>{if(n.is_pinned!==r.is_pinned)return n.is_pinned?-1:1;const i=S(n.label)-S(r.label);return i!==0?i:n.label.localeCompare(r.label)});return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex flex-row justify-between pb-4",children:[e.jsx("div",{className:"flex flex-row gap-2",children:e.jsx(pe,{name:"search-environments",color:"search",containerInputClassName:"w-full",className:"text-token-text-primary flex h-8 w-full items-center rounded-md!",value:g,disabled:G||!L||b!==null,onChange:n=>{const r=n.target.value;Q(r),r?o({search:r},{replace:!0}):o({},{replace:!0})},placeholder:l.formatMessage({id:"wham.environmentsList.searchEnvironmentsPlaceholder",defaultMessage:"Search environments"}),ariaLabel:l.formatMessage({id:"wham.environmentsList.searchEnvironmentsAria",defaultMessage:"Search environments"})})}),e.jsx(Le,{onClick:()=>s("/codex/settings/environment/create"),disabled:!L,color:"primary",icon:he,className:"h-8","aria-label":l.formatMessage({id:"wham.environmentsList.createEnvironmentAriaLabel",defaultMessage:"Link to create a new environment"}),children:e.jsx("span",{className:"hidden md:inline",children:e.jsx(m,{id:"wham.environmentsList.createEnvironment",defaultMessage:"Create environment"})})})]}),z?e.jsx("div",{className:"flex h-full items-center justify-center pt-5",children:e.jsx(ye,{})}):b?e.jsx(N,{title:l.formatMessage({id:"wham.environmentsList.error",defaultMessage:"Failed to load environments"}),description:l.formatMessage({id:"wham.environmentsList.errorDescription",defaultMessage:"Please try refreshing the page, if that does not work, please contact support."})}):y.length===0?e.jsx(N,{title:l.formatMessage({id:"wham.environmentsList.noEnvironments",defaultMessage:"No environments"}),description:l.formatMessage({id:"wham.environmentsList.noEnvironmentsDescription",defaultMessage:"Create an environment for Codex to work in"})}):e.jsxs(e.Fragment,{children:[e.jsxs(t.Root,{className:"overflow-x-auto overflow-y-clip",disableScroll:!0,children:[e.jsxs(t.Header,{children:[e.jsx(t.HeaderCell,{className:"ps-2 text-sm",children:e.jsx(m,{id:"wham.environmentsList.name",defaultMessage:"Name"})}),e.jsx(t.HeaderCell,{className:"text-sm",children:e.jsx(m,{id:"wham.environmentsList.repo",defaultMessage:"Repo"})}),e.jsx(t.HeaderCell,{className:"text-sm",children:e.jsx(m,{id:"wham.environmentsList.numberOfTasks",defaultMessage:"Number of tasks"})}),M&&e.jsx(t.HeaderCell,{className:"text-sm",children:e.jsx(m,{id:"wham.environmentsList.sharing",defaultMessage:"Sharing"})}),e.jsx(t.HeaderCell,{className:"text-sm",children:e.jsx(m,{id:"wham.environmentsList.creator",defaultMessage:"Creator"})}),e.jsx(t.HeaderCell,{className:"text-sm",children:e.jsx(m,{id:"wham.environmentsList.createdAt",defaultMessage:"Created at"})}),E&&e.jsx(t.HeaderCell,{}),e.jsx(t.HeaderCell,{})]}),e.jsx(t.Body,{children:k.length===0&&!x?e.jsx(t.Row,{children:e.jsx(t.Cell,{colSpan:100,children:e.jsx(N,{title:l.formatMessage({id:"wham.environmentsList.search.noEnvironments",defaultMessage:"No matches for {search}"},{search:g}),description:l.formatMessage({id:"wham.environmentsList.search.noEnvironmentsDescription",defaultMessage:"Create an environment for Codex to work in"})})})}):k.map(({id:n,label:r,is_pinned:i,repos:c,repo_map:h,creator:p,created_at:_,task_count:q,share_settings:X})=>{const Z=!!(d!=null&&d.authUserId)&&p.id.includes(d==null?void 0:d.authUserId);return e.jsxs(t.Row,{role:"row",className:"group/row hover:bg-token-bg-tertiary h-14 px-2 text-sm hover:cursor-pointer",onClick:()=>s("/codex/settings/environment/".concat(n)),tabIndex:0,"aria-label":l.formatMessage({id:"wham.environmentsList.environmentAriaLabel",defaultMessage:"View environment {label}"},{label:r}),children:[e.jsx(t.Cell,{divClassName:"flex h-14 items-center group-hover/row:underline ps-2",children:r}),e.jsx(t.Cell,{divClassName:"flex h-14 items-center",children:c.map(f=>{var T,H;return e.jsx("div",{children:(H=(T=h==null?void 0:h[f])==null?void 0:T.repository_full_name)!=null?H:f},f)})}),e.jsx(t.Cell,{divClassName:"flex h-14 items-center",children:q}),M&&e.jsx(t.Cell,{divClassName:"flex h-14 items-center",children:De(l,X)}),e.jsx(t.Cell,{divClassName:"flex h-14 items-center",children:p.email}),e.jsx(t.Cell,{divClassName:"flex h-14 items-center",children:_?e.jsx(ce,{value:new Date(_*1e3),year:"numeric",month:"long",day:"numeric"}):e.jsx(m,{id:"wham.environmentsList.na",defaultMessage:"N/A"})}),E&&e.jsx(Fe,{isPinned:i,isCreator:Z,onToggle:f=>{f.stopPropagation(),B({environmentId:n,isPinned:!i})},intl:l})]},n)})})]}),e.jsx(Pe,{isFetchingNextPage:V,hasNextPage:x!=null?x:!1,fetchNextPage:K})]})]})})}function De(s,a){switch(a){case"public":return s.formatMessage({id:"wham.environmentsList.public",defaultMessage:"Public"});case"private":return s.formatMessage({id:"wham.environmentsList.private",defaultMessage:"Private"});case"workspace":return s.formatMessage({id:"wham.environmentsList.workspace",defaultMessage:"Workspace"});default:Se.assertNever(a)}}function Ue(){const{eligible:s}=ge();return s?e.jsx(de,{to:"/codex"}):e.jsx(ve,{topPadding:!0,children:e.jsxs("div",{className:"mx-auto flex h-full max-w-screen-xl flex-1 flex-col gap-4 ps-4 pe-4 md:pe-12",children:[e.jsx(Ae,{}),e.jsx(Oe,{})]})})}const ks=()=>[{title:"Codex"}],Ps=ue(function(){return e.jsx(Ue,{})});export{Ps as default,ks as meta};
//# sourceMappingURL=fqq30zd0zuj31gp0.js.map
