var Se=Object.defineProperty,Ae=Object.defineProperties;var ke=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var le=(s,a,t)=>a in s?Se(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,P=(s,a)=>{for(var t in a||(a={}))we.call(a,t)&&le(s,t,a[t]);if(re)for(var t of re(a))ye.call(a,t)&&le(s,t,a[t]);return s},T=(s,a)=>Ae(s,ke(a));import{e as D,r as g,j as e,f as W,M as k,i as pe,F as Ee,n as Fe,a0 as Te,a9 as Le}from"./fg33krlcm0qyi6yw.js";import{a as De,b as _e,c as Oe}from"./jex6ulz50fkc86ct.js";import{e as Ie,M as ce}from"./ki4km9ptw66l47xq.js";import{u as fe,a as Ge,b as he,c as Be,d as We,e as Ue,f as He,g as Qe,h as ze}from"./c4y192oww5tqpynf.js";import{C as xe,bX as $e,l as je,c0 as Z,a9 as w,m as Ce,g2 as b,gJ as qe,H as Ve,hj as Xe,o as $,b as Ze,du as Je,vL as Ye,sC as L,uI as V,b4 as Ke,vM as es,T as ss,bO as ts,M as de}from"./mtk1qztvnb31pw5r.js";import{ky as J,nd as as,ca as os,cL as Me,q1 as ns,q2 as is,q3 as me,cr as rs,cx as ls,cI as cs}from"./k65njl5wlgspihfr.js";import{P as be}from"./b0wqcir84sehbt05.js";import{T as l}from"./hcn3kohxpjzaoxwc.js";import{G as Re}from"./en6zlt3w5f6cxktv.js";import{u as ds,g as ms,a as us,E as gs,C as ps,D as fs,R as hs,P as xs,i as ue,U as js}from"./i36dlttiykizcte0.js";import{W as Cs}from"./hspr4v62gc8o4adc.js";import{a as Ms,b as bs}from"./pfks1t2fx5uviwac.js";import{d as ge}from"./l1ka89a9nbqv3utj.js";import{u as Rs,a as vs}from"./qomjt47lfw1l209u.js";import"./c2cj1dlcffke3f7m.js";import"./ohquqctluwabmb5i.js";import"./efooahjtdr85x1lo.js";import"./km71i01x6ma5r62b.js";import"./hb1mva1gmw4bcs8w.js";import"./i1tex5l6gt3gdz3c.js";import"./mcmrxiy9039fw9r6.js";import"./llove4bcy7api840.js";import"./bhm7utdivrybcfbl.js";import"./mivow98b53y1taf8.js";import"./krwszi9u3lj63i9v.js";import"./uwm5r01je8eaqgfc.js";const Ns=({onClose:s,workspaceId:a,roleId:t})=>{const n=D(),[u,i]=g.useState(""),[h,d]=g.useState(0),{groups:c,isLoading:R,isPlaceholderData:r}=Ie({workspaceId:a,currPage:h,groupFilter:u}),{data:C}=fe({workspaceId:a,roleId:t}),{assignGroup:x}=Ge({workspaceId:a,roleId:t}),{unassignGroup:S}=he({workspaceId:a,roleId:t});return e.jsxs(xe,{testId:"modal-role-assignment-modal",isOpen:!0,onClose:s,showCloseButton:!0,size:"large",type:"success",title:n.formatMessage(j.title),primaryButton:e.jsx(w,{onClick:()=>s(),children:n.formatMessage(j.done)}),secondaryButton:e.jsx(w,{color:"secondary",onClick:()=>s(),children:n.formatMessage(j.cancel)}),children:[e.jsxs("div",{className:"bg-token-bg-tertiary text-token-text-primary flex w-full flex-row items-center gap-4 rounded-xl p-4",children:[e.jsx($e,{className:"icon-lg"}),e.jsx("div",{className:"text-token-text-secondary text-sm font-medium",children:n.formatMessage(j.information)})]}),e.jsx(J,{className:"mt-6 mb-6",inputClassName:"w-full",placeholder:n.formatMessage(j.searchPlaceholder),value:u,onChange:p=>i(p.target.value)}),e.jsxs("div",{className:"min-h-[18rem]",children:[e.jsxs(l.Root,{className:"min-w-full",children:[e.jsxs("colgroup",{children:[e.jsx("col",{className:"w-[80%]"}),e.jsx("col",{className:"w-[20%]"})]}),e.jsx(l.Body,{className:je((R||r)&&"opacity-50"),children:c==null?e.jsx(l.Row,{children:e.jsx(l.Cell,{colSpan:5,textAlign:"center",children:e.jsx(Z,{})})}):c.items.length===0?e.jsx(l.Row,{children:e.jsx(l.Cell,{colSpan:5,textAlign:"center",children:u===""?n.formatMessage(j.noGroupFound):n.formatMessage(j.noGroupFoundWithFilter)})}):c.items.filter(({system_use_case:p})=>!p).map(p=>e.jsx(Ps,{group:p,assignedGroups:C||[],onAssign:()=>x(p),onUnassign:()=>S(p.id)},p.id))})]}),c&&e.jsx("div",{className:"text-center",children:e.jsx(as,{length:Math.ceil(c.total/ce),currentPage:Math.min(h,Math.ceil(c.total/ce)),onChangeIndex:p=>d(p)})})]})]})},Ps=({group:s,assignedGroups:a,onAssign:t,onUnassign:n})=>{const[u,i]=g.useState(!1),h=Ce(),d=D(),c=async()=>{i(!0);try{await t(),h.success(d.formatMessage(j.addSuccess),{duration:2})}catch(r){h.danger(j.addFailure,{duration:2,toastId:"role_assignment_modal"})}finally{i(!1)}},R=async()=>{i(!0);try{await n(),h.success(d.formatMessage(j.removedSuccess),{duration:2})}catch(r){h.danger(j.removeFailure,{duration:2,toastId:"role_assignment_modal"})}finally{i(!1)}};return e.jsxs(l.Row,{className:"[&>td]:py-2",children:[e.jsxs(l.Cell,{children:[e.jsx(Re,{group:s}),e.jsxs("div",{children:[e.jsx("div",{children:s.name}),e.jsx("div",{className:"text-token-text-secondary text-xs",children:e.jsx(k,{id:"15cHOa",defaultMessage:"{count} members",values:{count:s.num_members}})})]})]}),e.jsx(l.Cell,{className:"flex items-center justify-end",children:a.some(r=>r.id===s.id)?e.jsx(w,{color:"primary",icon:os,onClick:R,loading:u,children:d.formatMessage(j.added)}):e.jsx(w,{color:"secondary",icon:be,onClick:c,loading:u,children:d.formatMessage(j.add)})})]})},j=W({add:{id:"yso/RZ",defaultMessage:"Add"},added:{id:"O2kZcD",defaultMessage:"Added"},addSuccess:{id:"lQy6C+",defaultMessage:"Role has been successfully assigned to group."},removedSuccess:{id:"lINrRq",defaultMessage:"Role has been successfully removed from group."},addFailure:{id:"VoUYt8",defaultMessage:"Failed to assign role to group."},removeFailure:{id:"Q+GN8A",defaultMessage:"Failed to remove role from group."},noGroupFound:{id:"dE7Tu5",defaultMessage:"No groups found."},noGroupFoundWithFilter:{id:"OA7F5f",defaultMessage:"No groups found. Try changing the search query."},searchPlaceholder:{id:"sUDB3M",defaultMessage:"Search by name"},title:{id:"Rj8nZG",defaultMessage:"Assign groups to role"},information:{id:"J92l5s",defaultMessage:"Custom role permissions will override default permissions."},cancel:{id:"QykMkt",defaultMessage:"Cancel"},done:{id:"Zsm046",defaultMessage:"Done"}}),Ss=({workspaceId:s,roleId:a})=>{const t=D(),[n,u]=g.useState(""),{data:i,isLoading:h,isPlaceholderData:d}=fe({workspaceId:s,roleId:a}),c=i==null?void 0:i.filter(x=>x.name.toLowerCase().includes(n.toLowerCase())),[R,r]=g.useState(!1),{unassignGroup:C}=he({workspaceId:s,roleId:a});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6 mb-3 flex flex-row justify-between gap-2",children:[e.jsx(J,{inputClassName:"w-[250px] rounded-full! text-sm",value:n,onChange:x=>{u(x.target.value)},placeholder:t.formatMessage({id:"workspaceSettings.groups.search",defaultMessage:"Search group name"})}),e.jsx(w,{onClick:()=>r(!0),icon:be,children:t.formatMessage(q.add)})]}),e.jsx("div",{children:e.jsxs(l.Root,{className:"min-w-full",children:[e.jsxs("colgroup",{children:[e.jsx("col",{className:"w-[80%]"}),e.jsx("col",{className:"w-[20%]"})]}),e.jsxs(l.Header,{children:[e.jsx(l.HeaderCell,{children:t.formatMessage(q.name)}),e.jsx(l.HeaderCell,{children:t.formatMessage(q.dateAdded)})]}),e.jsx(l.Body,{className:je((h||d)&&"opacity-50"),children:c==null?e.jsx(l.Row,{children:e.jsx(l.Cell,{colSpan:5,textAlign:"center",children:e.jsx(Z,{})})}):c.length===0?e.jsx(l.Row,{children:e.jsx(l.Cell,{colSpan:5,textAlign:"center",children:n===""?e.jsx(k,{id:"workspaceSettings.groups.noGroups",defaultMessage:"No groups found."}):e.jsx(k,{id:"workspaceSettings.groups.noGroupsWithFIlter",defaultMessage:"No groups found. Try changing the search query."})})}):c.map(x=>e.jsx(As,{group:x,onRemoveAssignment:S=>C(S)},x.id))})]})}),R&&e.jsx(Ns,{onClose:()=>r(!1),workspaceId:s,roleId:a})]})},As=({group:s,onRemoveAssignment:a})=>{const t=pe();return e.jsx(e.Fragment,{children:e.jsxs(l.Row,{className:"[&>td]:py-2",onClick:()=>t("/admin/groups/".concat(s.id)),children:[e.jsxs(l.Cell,{children:[e.jsx(Re,{group:s}),e.jsxs("div",{children:[e.jsx("div",{children:s.name}),e.jsx("div",{className:"text-token-text-secondary text-xs",children:e.jsx(k,{id:"15cHOa",defaultMessage:"{count} members",values:{count:s.num_members}})})]})]}),e.jsx(l.Cell,{children:s.created_time&&e.jsx(Ee,{value:s.created_time,year:"numeric",month:"short",day:"numeric"})}),e.jsx(l.Cell,{className:"text-end",children:e.jsxs(b.Root,{children:[e.jsx(b.Trigger,{className:"-my-2",children:e.jsx(qe,{className:"icon-sm"})}),e.jsx(b.Portal,{children:e.jsx(b.Content,{size:"small",children:e.jsx(b.Item,{onClick:()=>{a(s.id)},icon:e.jsx(Me,{className:"text-token-text-status-error"}),className:"text-token-text-status-error",children:e.jsx(k,P({},q.removeLabel))})})})]})})]})})},q=W({add:{id:"floy3N",defaultMessage:"Add"},name:{id:"IP/+l1",defaultMessage:"Name"},dateAdded:{id:"6BJG0j",defaultMessage:"Date Added"},removeLabel:{id:"uut7wd",defaultMessage:"Remove group from role"}}),ks="https://help.openai.com/en/articles/11750701-rbac",ws=({role:s,onSave:a})=>{var ee,se,te,ae,oe,ne,ie;const t=D(),n=Ve(),u=(ee=n==null?void 0:n.getWorkspaceId())!=null?ee:"",i=Xe(),h=ds(),d=Ze(),c=$(d,"820985683"),R=$(d,"3830295924"),{data:r}=Je((()=>{if(n==null)throw new Error("Account must not be null");const o=n.getWorkspaceId();if(o==null)throw new Error("Workspace ID must not be null");return o})()),C=Ye(d),{permissionsBySection:x,totalPermissionsCount:S}=g.useMemo(()=>{var B,z;const o=$(d,"2968710568"),m=$(d,"2607061589"),N=ms(T(P({isSearchEnabled:s.permissions.includes(L.SearchAccess),isEnterprisey:(B=n==null?void 0:n.isEnterprisey())!=null?B:!1},h),{isQuorum:i,legacyModelsEnabled:(z=r==null?void 0:r.beta_settings.legacy_models)!=null?z:!1,includeConnectorPermissions:C,isCodexEnabledInRBACRole:s.permissions.includes(L.AllowCodexAccess),showProjectSharing:c,isRoleSpecificPage:!0,showDeviceCodeAuthToggle:o,gpt5ThinkingEnabled:s.permissions.includes(L.GPT5ThinkingAccess),isEnhancedCitationsRolledOut:m})).map(F=>T(P({},F),{entries:F.entries.filter(Pe=>Pe.rbac)})).filter(F=>F.entries.length>0),E=N.flatMap(F=>F.entries).length;return{permissionsBySection:N,totalPermissionsCount:E}},[n,h,s.permissions,r==null?void 0:r.beta_settings,C,i,c,d]),[p,_]=g.useState(""),O=x.map(o=>T(P({},o),{entries:o.entries.filter(m=>{const v=typeof m.title=="string"?m.title:t.formatMessage(m.title),N=m.description?typeof m.description=="string"?m.description:t.formatMessage(m.description,m.descriptionValues):"";return m.rbac&&([v,N].join(" ").toLowerCase().includes(p.toLowerCase())||m.permissionName.toLowerCase().includes(p.toLowerCase()))})})).filter(o=>o.entries.length>0),{toggleAllConnectorsPermissionForRole:I,isPending:G}=Be({workspaceId:(se=n==null?void 0:n.getWorkspaceId())!=null?se:""}),{connectorsWithPermission:U,isLoading:H}=We({accountId:(te=n==null?void 0:n.id)!=null?te:"",workspaceId:(ae=n==null?void 0:n.getWorkspaceId())!=null?ae:"",roleId:s.id,enabled:C}),A=Array.from((oe=U.values())!=null?oe:[]).filter(o=>o.connector.status!=="DISABLED_BY_ADMIN"),Q=g.useMemo(()=>[V.CONTEXT_CONNECTOR_GDRIVE,V.CONTEXT_CONNECTOR_O365_PERSONAL,V.CONTEXT_CONNECTOR_O365_BUSINESS].filter(o=>!!(r!=null&&r.beta_settings[o])),[r==null?void 0:r.beta_settings]),f=Ue({workspaceId:(ne=n==null?void 0:n.getWorkspaceId())!=null?ne:"",roleId:s.id,connectorIds:Q,enabled:C}),y=g.useMemo(()=>{var N,E;const m=Array.from((N=A.values())!=null?N:[]).filter(B=>B.permissions.includes(L.UseConnector)),v=Object.entries((E=f.results)!=null?E:{}).filter(([B,z])=>z.includes(L.UseConnector));return[...m,...v]},[A,f.results]),[ve,Y]=g.useState(!1),K=us(h),Ne=o=>{const m=o.permissionName,v=typeof o.title=="string"?o.title:t.formatMessage(o.title);if(o.permissionName===L.UseConnector){const N=y.length>0;return e.jsxs(e.Fragment,{children:[!R&&ve&&e.jsx(hs,{platformConnectorsWithPermission:U,contextConnectorsWithPermission:f.results,workspaceId:u,roleId:s.id,onClose:()=>Y(!1)}),e.jsx(me,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-md",children:v}),o.description&&e.jsx("span",{className:"text-token-text-tertiary text-sm",children:typeof o.description=="string"?o.description:t.formatMessage(o.description,o.descriptionValues)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(H||G)&&e.jsx(Z,{}),o.nestedKey&&(Q.length>0||A.length>0)&&e.jsx("div",{className:"text-token-text-tertiary text-sm",children:R?e.jsx(w,{color:"primary-inverse",as:"link",to:"/admin/ca#".concat(es),children:e.jsx(k,P({},X.configureConnectorAccess))}):e.jsx(w,{color:"primary-inverse",onClick:()=>Y(!0),children:e.jsx(k,{id:"workspaceSettings.roles.selectNestedPermission",defaultMessage:"Select..."})})}),e.jsx(ss,{disabled:A.length!==0,label:t.formatMessage(X.noConnectorsEnabled),children:e.jsx(ts,{size:"normal","aria-label":v,checked:N,onCheckedChange:E=>I({id:s.id,state:E}),disabled:G||H||A.length===0})})]})]})},m)]})}return e.jsx(me,{children:e.jsxs("div",{className:"flex w-full items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-md",children:v}),o.description&&e.jsx("span",{className:"text-token-text-tertiary text-sm",children:typeof o.description=="string"?o.description:t.formatMessage(o.description,o.descriptionValues)})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(xs,{ariaLabel:v,role:s,permissionName:o.permissionName,handleSaveRole:a,disabled:o.disabled||o.disabledForQuorum,disabledReason:o.disabledReason,additionalPermissionNames:o.additionalPermissionNames})})]})},m)};return e.jsxs(ns,{children:[e.jsx("div",{className:"text-token-text-secondary text-sm",children:t.formatMessage(X.customRoleDescription,{link:o=>e.jsx(Ke,{className:"underline",target:"_blank",rel:"noreferrer",href:ks,children:o})})}),e.jsx("div",{className:"flex flex-row items-center justify-between",children:e.jsx(J,{inputClassName:"w-[250px] rounded-full! text-sm",value:p,onChange:o=>{_(o.target.value)},placeholder:t.formatMessage({id:"hRuTvi",defaultMessage:"Search {count} permissions"},{count:S})})}),r&&K.length>0&&e.jsx(gs,{preReleases:K,workspaceId:(ie=n==null?void 0:n.getWorkspaceId())!=null?ie:"",data:r,handleSaveRole:a,role:s,isCustomRole:!1}),O.map(o=>e.jsx(Cs,{title:o.title,description:o.description,descriptionValues:o.descriptionValues,shouldDisableForQuorum:i&&!o.availableForQuorum,children:e.jsx(is,{children:o.entries.map(m=>Ne(m))})},String(o.title.defaultMessage))),u&&e.jsx(ps,{workspaceId:u,roleId:s.id,usageLimitDisplay:fs})]})},X=W({customRoleDescription:{id:"I9hJih",defaultMessage:"Custom role permissions override workplace-level settings. A userâ€™s effective permissions are the sum of all their assigned custom roles. Not all settings are available as role-based permissions. <link>Learn more</link>"},configureConnectorAccess:{id:"cUTDPz",defaultMessage:"Configure Access"},save:{id:"LE9GJk",defaultMessage:"Save"},searchPlaceholder:{id:"EaN6oB",defaultMessage:"Search permissions"},noConnectorsEnabled:{id:"MfYm5J",defaultMessage:"No connectors enabled for the workspace"}}),ys=W({permissionPageTitle:{id:"1Qw6mG",defaultMessage:"Roles & permissions"}}),Es=s=>s==="permissions"||s==="assignments";function Fs({currentWorkspaceId:s,roleId:a}){const t=D(),[n,u]=g.useState(!1),{data:i,refetch:h}=He({roleId:a!=null?a:"",workspaceId:s}),d=Ce(),c=pe(),[R]=Fe(),[r,C]=g.useState(!1),{deleteRole:x}=Qe({workspaceId:s}),S=g.useCallback(async()=>{try{await x(a!=null?a:""),C(!1),d.success(t.formatMessage(M.removeSuccessMessage)),c("/admin/permissions?tab=roles",{replace:!0})}catch(f){d.danger(t.formatMessage(M.removeErrorMessage))}},[x,t,a,d,c]),{updateRole:p}=ze({workspaceId:s}),_=g.useCallback(async f=>{const y=await p(f);y.id!==a&&c({pathname:"/admin/permissions/roles/".concat(y.id)},{replace:!0}),h()},[c,h,a,p]),O=g.useMemo(()=>{const f=[{key:"permissions",label:t.formatMessage(M.rolePermissionsLabel),children:e.jsx(ws,{role:i,onSave:_})}];return i&&!ue(i)&&f.push({key:"assignments",label:t.formatMessage(M.roleAssignmentsLabel),children:e.jsx(Ss,{workspaceId:s,roleId:a!=null?a:""})}),f},[s,t,i,_,a]),I=R.get("tab"),[G,U]=g.useState(I&&Es(I)?I:O[0].key),H=f=>{U(f),c({pathname:window.location.pathname,search:new URLSearchParams({tab:f}).toString()})},A=g.useMemo(()=>{var f;return[{label:t.formatMessage(ys.permissionPageTitle),href:"/admin/permissions?tab=roles"},{label:(f=i==null?void 0:i.name)!=null?f:""}]},[t,i==null?void 0:i.name]),Q=e.jsxs(b.Root,{children:[e.jsx(b.Trigger,{asChild:!0,className:"border-token-border-default! border!",children:e.jsxs("div",{children:[t.formatMessage(M.manageLabel),e.jsx(rs,{className:"icon-sm ms-0.5"})]})}),e.jsx(b.Portal,{children:e.jsxs(b.Content,{children:[e.jsx(b.Item,{onClick:()=>ge(u)(!0),icon:ls,label:t.formatMessage(M.editRoleLabel)}),e.jsx(b.Item,{onClick:()=>ge(C)(!0),icon:Me,label:t.formatMessage(M.deleteRoleLabel),color:"danger"})]})})]});return i?e.jsxs(e.Fragment,{children:[e.jsx(cs,{children:e.jsx("title",{children:i.name})}),e.jsx(De,{navigation:e.jsx(_e,{items:A}),title:i.name,subtitle:i.description,actions:i&&!ue(i)?Q:void 0,tabsHeader:e.jsx(Ms,{items:O,activeTab:G,onTabChange:H})}),e.jsx(Oe,{showSpinner:!1,children:e.jsx(bs,{items:O,activeTab:G})}),n&&e.jsx(js,{onSave:({name:f,description:y})=>_(T(P({},i),{name:f,description:y})),onClose:()=>u(!1),isCreate:!1,defaultData:{name:i.name,description:i.description}}),r&&e.jsx(Ts,{onClose:()=>C(!1),onDeleteConfirm:()=>S()})]}):null}const Ts=({onDeleteConfirm:s,onClose:a})=>{const t=D(),[n,u]=g.useState(!1);return e.jsx(xe,{testId:"modal-remove-member",isOpen:!0,title:t.formatMessage(M.deleteRoleLabel),onClose:a,type:"success",primaryButton:e.jsx(de.Button,{title:t.formatMessage(M.confirm),color:"danger",onClick:async()=>{try{u(!0),await s()}finally{u(!1)}},loading:n}),secondaryButton:e.jsx(de.Button,{title:t.formatMessage(M.cancel),color:"secondary",onClick:a,loading:n}),children:e.jsx("div",{className:"flex flex-col items-center gap-2",children:e.jsx("div",{className:"text-token-text-tertiary",children:t.formatMessage(M.deleteConfirmationText)})})})},M=W({rolePermissionsLabel:{id:"PXsC8s",defaultMessage:"Role permissions"},manageLabel:{id:"zPUmjl",defaultMessage:"Manage"},editRoleLabel:{id:"6pHT9d",defaultMessage:"Edit role"},deleteRoleLabel:{id:"XfDjrE",defaultMessage:"Delete role"},confirm:{id:"mQb6kI",defaultMessage:"Confirm"},cancel:{id:"uNmzc2",defaultMessage:"Cancel"},deleteConfirmationText:{id:"tZZlFY",defaultMessage:"Are you sure you want to delete this role? This action cannot be undone."},removeSuccessMessage:{id:"aBZC2C",defaultMessage:"Role removed successfully."},removeErrorMessage:{id:"KthOn1",defaultMessage:"Failed to remove role."},roleAssignmentsLabel:{id:"sBMwFp",defaultMessage:"Role assignments"}}),rt=Te(function(){const a=Rs(),{roleId:t}=Le();return vs(),e.jsx(Fs,T(P({},a),{roleId:t}))});export{rt as default};
//# sourceMappingURL=kgl3unob0q6ohlyr.js.map
