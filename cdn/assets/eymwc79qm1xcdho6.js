var ye=Object.defineProperty,xe=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var fe=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable;var pe=(t,e,s)=>e in t?ye(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ee=(t,e)=>{for(var s in e||(e={}))Re.call(e,s)&&pe(t,s,e[s]);if(fe)for(var s of fe(e))be.call(e,s)&&pe(t,s,e[s]);return t},te=(t,e)=>xe(t,_e(e));import{c as le,e as ve,j as i,L as je,F as Pe,M as C,a as Me,u as Ae,r as re}from"./fg33krlcm0qyi6yw.js";import we from"./nvdi5lzwa8dbv05v.js";import{l as se,uJ as Ne,bX as Ce,T as oe,o as Te,m as Ee,ag as Ie,H as Se,b as De}from"./mtk1qztvnb31pw5r.js";import{an as K,e8 as ke}from"./k65njl5wlgspihfr.js";import{T as ne}from"./hcn3kohxpjzaoxwc.js";import{b as Ue}from"./ek8ypz08ir47cco2.js";import{W as Le}from"./sy1xvqwioh9ks4z8.js";import{l as Be,C as Oe}from"./n0ab5m1z76n8mazm.js";const Fe=["everyone","team","default"];function qe(t){return Fe.some(e=>e===t)}const We={everyone:{globalReviewPreference:"review_everyone",reviewPreference:"team"},team:{globalReviewPreference:"review_if_enabled",reviewPreference:"team"},default:{globalReviewPreference:"review_if_enabled",reviewPreference:"never"}};function he(t){return t.global_review_preference==="review_everyone"?"everyone":t.review_preference==="team"?"team":"default"}function nt(t){var s,r,u,a;const e=(r=(s=t.repository.id)!=null?s:t.repository.repository_full_name)!=null?r:t.repository.name;return e?e.toString():"".concat((a=(u=t.repository.owner)==null?void 0:u.login)!=null?a:"repo","-").concat(he(t))}function Qe(t){return[{value:"everyone",title:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.always.title",defaultMessage:"Review all PRs"}),description:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.always.description",defaultMessage:"Run auto code reviews on every pull request, even from contributors outside this workspace"}),individual_description:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.always.individual_description",defaultMessage:"Run on every pull request, even from other contributors"})},{value:"team",title:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.team.title",defaultMessage:"Review team PRs"}),individual_title:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.always.individual_title",defaultMessage:"Review my PRs"}),description:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.team.description",defaultMessage:"Only run on pull requests opened by members of this workspace"}),individual_description:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.team.individual_description",defaultMessage:"Only run on pull requests opened by me"})},{value:"default",title:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.individuals.title",defaultMessage:"Follow personal preferences"}),individual_title:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.individuals.individual_title",defaultMessage:"Follow personal preferences"}),description:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.individuals.description",defaultMessage:"Let users opt in with their personal settings"}),individual_description:t.formatMessage({id:"wham.codeReviewPage.teamAutomations.option.individuals.individual_description",defaultMessage:"Run on your own pull requests based on your personal preference"})}]}function Ve(t){"use forget";var Q;const e=le.c(58),{repo:s,value:r,repoReviewOptions:u,isTeamOrEnterprise:a,isLegacyEnterprisey:l,isPlus:d,isPro:f,isDisabledRepo:h,ownerLogin:y,everyoneSetByDifferentAccount:g,updateCodeReviewRepositories:R}=t,p=s.repository.permissions,n=[p==null?void 0:p.admin,p==null?void 0:p.push].some(Boolean),w=r==="everyone",v=w&&!n;let U;if(e[0]!==u||e[1]!==r){let c;e[3]!==r?(c=o=>o.value===r,e[3]=r,e[4]=c):c=e[4],U=u.find(c),e[0]=u,e[1]=r,e[2]=U}else U=e[2];const _=U;let x;if(e[5]!==v||e[6]!==g||e[7]!==a){const c=[];if(g){let o;e[9]!==a?(o=a?i.jsx(C,{id:"wham.codeReviewPage.teamAutomations.everyoneWarningTooltip.differentUser.team",defaultMessage:"This setting was set by a user in a different team."}):i.jsx(C,{id:"wham.codeReviewPage.teamAutomations.everyoneWarningTooltip.differentUser.individual",defaultMessage:"This setting was set by a different user."}),e[9]=a,e[10]=o):o=e[10],c.push(o)}if(v){let o;e[11]===Symbol.for("react.memo_cache_sentinel")?(o=i.jsx(C,{id:"wham.codeReviewPage.teamAutomations.everyoneWarningTooltip.noPermissions",defaultMessage:"You must have repo admin or push permissions to change this setting."}),e[11]=o):o=e[11],c.push(o)}else{let o;e[12]===Symbol.for("react.memo_cache_sentinel")?(o=i.jsx(C,{id:"wham.codeReviewPage.teamAutomations.everyoneWarningTooltip.changeWarning",defaultMessage:"Changing this setting affects auto code reviews for other contributors to this repository."}),e[12]=o):o=e[12],c.push(o)}x=i.jsx(i.Fragment,{children:c.map(Ke)}),e[5]=v,e[6]=g,e[7]=a,e[8]=x}else x=e[8];const T=x;let E;e[13]!==s.repository.id||e[14]!==R?(E=c=>{if(!qe(c))return;const o=We[c];R({repo_review_settings:[{repository:s.repository.id,review_preference:o.reviewPreference,global_review_preference:o.globalReviewPreference}]})},e[13]=s.repository.id,e[14]=R,e[15]=E):E=e[15];const q=h||v,W=!(w&&v)||h,B=a?_==null?void 0:_.title:(Q=_==null?void 0:_.individual_title)!=null?Q:_==null?void 0:_.title;let M;e[16]!==B?(M=i.jsx("div",{className:"flex items-center gap-2 truncate text-sm font-normal",children:B}),e[16]=B,e[17]=M):M=e[17];let I;e[18]!==T||e[19]!==W||e[20]!==M?(I=i.jsx(oe,{label:T,withArrow:!0,side:"top",sideOffset:0,disabled:W,children:M}),e[18]=T,e[19]=W,e[20]=M,e[21]=I):I=e[21];let A;e[22]!==v?(A=v?null:i.jsx(K.Icon,{}),e[22]=v,e[23]=A):A=e[23];let N;e[24]!==I||e[25]!==A?(N=i.jsxs(K.Trigger,{className:"w-full max-w-[250px] min-w-[150px] justify-between",children:[I,A]}),e[24]=I,e[25]=A,e[26]=N):N=e[26];let S;e[27]!==v||e[28]!==T||e[29]!==w?(S=w&&!v&&i.jsx(K.Item,{value:"unselectable",className:"items-start",disabled:!0,children:i.jsx("div",{className:"flex min-w-[220px] flex-col gap-1",children:i.jsx("span",{className:"text-token-text-tertiary text-xs whitespace-normal",children:T})})},"unselectable"),e[27]=v,e[28]=T,e[29]=w,e[30]=S):S=e[30];let j;if(e[31]!==n||e[32]!==l||e[33]!==d||e[34]!==f||e[35]!==a||e[36]!==u){let c;e[38]!==n||e[39]!==l||e[40]!==d||e[41]!==f||e[42]!==a?(c=o=>{var V,L;return i.jsx(K.Item,{value:o.value,className:"items-start",disabled:o.value==="everyone"&&(!n||l||d),children:i.jsx(oe,{label:n?i.jsxs(i.Fragment,{children:[a&&!l&&i.jsx(C,{id:"wham.codeReviewPage.teamAutomations.everyoneCostTooltip.team",defaultMessage:"Reviews in this repo will consume your workspace's credits"}),d&&i.jsx(C,{id:"wham.codeReviewPage.teamAutomations.everyoneCostTooltip.plus",defaultMessage:"Upgrade to Pro."}),f&&i.jsx(C,{id:"wham.codeReviewPage.teamAutomations.everyoneCostTooltip.pro",defaultMessage:"Review in this repo will count against your plan's usage."}),a&&l&&i.jsx(C,{id:"wham.codeReviewPage.teamAutomations.everyoneCostTooltip.legacyEnterprisey",defaultMessage:"Ask your ChatGPT admin to upgrade to flexible pricing to enable."})]}):i.jsx(C,{id:"wham.codeReviewPage.teamAutomations.everyoneDisabledTooltip",defaultMessage:"You must have repo admin or push permissions to select this option"}),disabled:o.value!=="everyone",withArrow:!0,side:"top",sideOffset:0,children:i.jsxs("div",{className:"flex min-w-[220px] flex-col gap-1",children:[i.jsx("span",{className:"text-sm font-normal",children:a?o.title:(V=o.individual_title)!=null?V:o.title}),i.jsx("span",{className:"text-token-text-tertiary text-xs whitespace-normal",children:a?o.description:(L=o.individual_description)!=null?L:o.description})]})})},o.value)},e[38]=n,e[39]=l,e[40]=d,e[41]=f,e[42]=a,e[43]=c):c=e[43],j=u.map(c),e[31]=n,e[32]=l,e[33]=d,e[34]=f,e[35]=a,e[36]=u,e[37]=j}else j=e[37];let D;e[44]!==S||e[45]!==j?(D=i.jsx(K.Portal,{children:i.jsxs(K.Content,{className:"max-w-[340px] min-w-[220px]","data-unbound-width":"",children:[S,j]})}),e[44]=S,e[45]=j,e[46]=D):D=e[46];let O;e[47]!==N||e[48]!==D||e[49]!==E||e[50]!==q||e[51]!==r?(O=i.jsxs(K.Root,{value:r,onValueChange:E,disabled:q,children:[N,D]}),e[47]=N,e[48]=D,e[49]=E,e[50]=q,e[51]=r,e[52]=O):O=e[52];const P=O;if(!h)return P;let k;e[53]!==y?(k=i.jsx(C,{id:"wham.codeReviewPage.teamAutomations.repoDisabledTooltip",defaultMessage:"Update the {installation} GitHub installation to enable code review",values:{installation:y}}),e[53]=y,e[54]=k):k=e[54];let F;return e[55]!==P||e[56]!==k?(F=i.jsx(oe,{label:k,withArrow:!0,side:"top",sideOffset:0,children:P}),e[55]=P,e[56]=k,e[57]=F):F=e[57],F}function Ke(t,e){return i.jsxs("span",{children:[t," "]},e)}function $e(t){"use forget";const e=le.c(19),{columnClassName:s,lastUpdatedBy:r,lastUpdatedRelativeTime:u,tooltipLabel:a}=t;let l;e[0]!==s?(l=se(s,"min-w-0"),e[0]=s,e[1]=l):l=e[1];const d=!u;let f;e[2]!==d?(f=se("min-w-0 truncate text-start",{"col-span-2":d}),e[2]=d,e[3]=f):f=e[3];let h;e[4]!==r||e[5]!==f?(h=i.jsx("span",{className:f,children:r}),e[4]=r,e[5]=f,e[6]=h):h=e[6];let y;e[7]!==u?(y=u?i.jsx("span",{className:"text-token-text-tertiary min-w-0 truncate pe-2 text-end sm:min-w-[6rem]",children:u}):null,e[7]=u,e[8]=y):y=e[8];let g;e[9]!==h||e[10]!==y?(g=i.jsxs("div",{className:"hidden w-full min-w-0 items-center justify-between text-xs sm:text-sm md:flex",children:[h,y]}),e[9]=h,e[10]=y,e[11]=g):g=e[11];let R;e[12]===Symbol.for("react.memo_cache_sentinel")?(R=i.jsx(Ce,{className:"icon-sm text-token-text-secondary shrink-0"}),e[12]=R):R=e[12];let p;e[13]!==a?(p=i.jsx(oe,{className:"flex w-full justify-end md:hidden",label:a,labelTextAlign:"left",labelClassName:"text-xs",align:"start",children:R}),e[13]=a,e[14]=p):p=e[14];let n;return e[15]!==l||e[16]!==g||e[17]!==p?(n=i.jsxs(ne.Cell,{textAlign:"left",className:l,children:[g,p]}),e[15]=l,e[16]=g,e[17]=p,e[18]=n):n=e[18],n}function rt(t){"use forget";var de,ue,ce,me;const e=le.c(81),{repo:s,isTeamOrEnterprise:r,isLegacyEnterprisey:u,isPlus:a,isPro:l,disabledInstallations:d,updateCodeReviewRepositories:f,currentAccountOwnerId:h,currentUserEmail:y,columnWidths:g,layout:R,showDivider:p}=t,n=ve(),w=(de=s.repository.owner)==null?void 0:de.login;let v;e[0]!==d||e[1]!==w?(v=w?d.includes(w):!1,e[0]=d,e[1]=w,e[2]=v):v=e[2];const U=v;let _;e[3]!==s?(_=he(s),e[3]=s,e[4]=_):_=e[4];const x=_,T=x==="everyone"&&s.global_review_account_id!==h;let E;if(e[5]!==x||e[6]!==n||e[7]!==a||e[8]!==l){let m;e[10]!==x||e[11]!==a||e[12]!==l?(m=b=>b.value!=="team"||a||l||x==="team",e[10]=x,e[11]=a,e[12]=l,e[13]=m):m=e[13],E=Qe(n).filter(m),e[5]=x,e[6]=n,e[7]=a,e[8]=l,e[9]=E}else E=e[9];const q=E,W=!!T;let B;e[14]!==x||e[15]!==U||e[16]!==u||e[17]!==a||e[18]!==l||e[19]!==r||e[20]!==w||e[21]!==s||e[22]!==q||e[23]!==W||e[24]!==f?(B=i.jsx(Ve,{repo:s,value:x,repoReviewOptions:q,isTeamOrEnterprise:r,isLegacyEnterprisey:u,isPlus:a,isPro:l,isDisabledRepo:U,ownerLogin:w,everyoneSetByDifferentAccount:W,updateCodeReviewRepositories:f}),e[14]=x,e[15]=U,e[16]=u,e[17]=a,e[18]=l,e[19]=r,e[20]=w,e[21]=s,e[22]=q,e[23]=W,e[24]=f,e[25]=B):B=e[25];const M=B;let I;e[26]!==n||e[27]!==s.repository.name||e[28]!==s.repository.repository_full_name?(I=(ce=(ue=s.repository.repository_full_name)!=null?ue:s.repository.name)!=null?ce:n.formatMessage({id:"wham.codeReviewPage.teamAutomations.unknownRepository",defaultMessage:"Unknown repository"}),e[26]=n,e[27]=s.repository.name,e[28]=s.repository.repository_full_name,e[29]=I):I=e[29];const A=I;if(R==="condensed"){const m=p&&"border-token-border-light border-t";let b;e[30]!==m?(b=se("flex items-center justify-between gap-3 py-3 ps-4 pe-1",m),e[30]=m,e[31]=b):b=e[31];let Z;e[32]===Symbol.for("react.memo_cache_sentinel")?(Z=i.jsx(we,{className:"icon-sm shrink-0"}),e[32]=Z):Z=e[32];let J;e[33]!==A?(J=i.jsxs("div",{className:"flex min-w-0 items-center gap-2",children:[Z,i.jsx("span",{className:"truncate text-sm font-medium",children:A})]}),e[33]=A,e[34]=J):J=e[34];let X;e[35]!==M?(X=i.jsx("div",{className:"flex-shrink-0",children:M}),e[35]=M,e[36]=X):X=e[36];let ae;return e[37]!==J||e[38]!==X||e[39]!==b?(ae=i.jsxs("div",{className:b,children:[J,X]}),e[37]=J,e[38]=X,e[39]=b,e[40]=ae):ae=e[40],ae}let N,S;if(e[41]!==n||e[42]!==s.updated_at){const m=s.updated_at?new Date(s.updated_at):null,b=!!(m&&!Number.isNaN(m.getTime()));N=b&&m?i.jsx(Pe,{value:m,year:"numeric",month:"short",day:"2-digit"}):null,S=b&&m?Ne({givenDate:m,now:new Date,intl:n,format:"descriptive"}):null,e[41]=n,e[42]=s.updated_at,e[43]=N,e[44]=S}else N=e[43],S=e[44];const j=S;let D;e[45]!==N||e[46]!==j?(D=(me=j!=null?j:N)!=null?me:i.jsx(C,{id:"wham.codeReviewPage.teamAutomations.lastUpdatedUnknown",defaultMessage:"Not recorded"}),e[45]=N,e[46]=j,e[47]=D):D=e[47];const O=D;let P=null;if(T&&s.last_updated_by_github_id){const m="https://github.com/".concat(s.last_updated_by_github_id);let b;e[48]!==s.last_updated_by_github_id||e[49]!==m?(b=i.jsx(je,{className:"font-medium",target:"_blank",to:m,children:s.last_updated_by_github_id}),e[48]=s.last_updated_by_github_id,e[49]=m,e[50]=b):b=e[50],P=b}else if(s.last_updated_user_email===y){let m;e[51]===Symbol.for("react.memo_cache_sentinel")?(m=i.jsx(C,{id:"wham.codeReviewPage.teamAutomations.lastUpdatedByUser",defaultMessage:"me"}),e[51]=m):m=e[51],P=m}else r&&(P=s.last_updated_user_email);let k;e[52]!==P||e[53]!==O?(k=i.jsx(C,{id:"wham.codeReviewPage.teamAutomations.lastUpdatedBy",defaultMessage:"{date} by {user}",values:{date:O,user:P}}),e[52]=P,e[53]=O,e[54]=k):k=e[54];const F=k;let Q;e[55]!==g?(Q=g!=null?g:["w-[50%] sm:w-[40%]","w-[30%] sm:w-[35%]","w-[20%] sm:w-[25%] lg:w-[30%]"],e[55]=g,e[56]=Q):Q=e[56];const c=Q;let o;e[57]!==c[0]?(o=se(c[0],"min-w-[150px]"),e[57]=c[0],e[58]=o):o=e[58];let V;e[59]===Symbol.for("react.memo_cache_sentinel")?(V=i.jsx(we,{className:"icon-md shrink-0"}),e[59]=V):V=e[59];let L;e[60]!==A?(L=i.jsxs("div",{className:"flex min-w-0 items-center gap-2",children:[V,i.jsx("p",{className:"truncate text-sm",children:A})]}),e[60]=A,e[61]=L):L=e[61];let $;e[62]!==o||e[63]!==L?($=i.jsx(ne.Cell,{className:o,children:L}),e[62]=o,e[63]=L,e[64]=$):$=e[64];let G;e[65]!==c[1]?(G=se(c[1],"min-w-0"),e[65]=c[1],e[66]=G):G=e[66];let Y;e[67]!==M?(Y=i.jsx("div",{className:"flex w-full max-w-[250px] items-center justify-end sm:justify-start",children:M}),e[67]=M,e[68]=Y):Y=e[68];let H;e[69]!==G||e[70]!==Y?(H=i.jsx(ne.Cell,{textAlign:"left",className:G,children:Y}),e[69]=G,e[70]=Y,e[71]=H):H=e[71];let z;e[72]!==P||e[73]!==j||e[74]!==F||e[75]!==c[2]?(z=i.jsx($e,{columnClassName:c[2],lastUpdatedBy:P,lastUpdatedRelativeTime:j,tooltipLabel:F}),e[72]=P,e[73]=j,e[74]=F,e[75]=c[2],e[76]=z):z=e[76];let ie;return e[77]!==$||e[78]!==H||e[79]!==z?(ie=i.jsxs(ne.Row,{children:[$,H,z]}),e[77]=$,e[78]=H,e[79]=z,e[80]=ie):ie=e[80],ie}function Ge(t){return Te(t,"3220695551")}function Ye(t){return!!t&&typeof t=="object"&&"pages"in t}const ge=(t,e,s,r)=>{const u=te(ee({},t),{review_preference:e.review_preference,updated_at:new Date().toISOString(),last_updated_user_email:s});return e.global_review_preference!==void 0&&(u.global_review_preference=e.global_review_preference,u.global_review_account_id=r),u},He=t=>{var e,s;return(s=(e=t==null?void 0:t.getWorkspaceId())!=null?e:t==null?void 0:t.normalizedAccountUserId)!=null?s:null};function ze(){const t=Me(),e=ve(),s=Ee(),r=Ie(),u=Se();return Ae({mutationFn:a=>Le.updateCodeReviewRepositories(a),onMutate:async a=>{await t.cancelQueries({queryKey:["wham","codeReviewRepositories"]});const l=t.getQueriesData({queryKey:["wham","codeReviewRepositories"]});return t.setQueriesData({queryKey:["wham","codeReviewRepositories"]},d=>{var R,p;if(!d)return d;const f=new Map(((R=a==null?void 0:a.repo_review_settings)!=null?R:[]).map(n=>[n.repository,n])),h=(p=r==null?void 0:r.email)!=null?p:null,y=He(u);if(Ye(d))return te(ee({},d),{pages:d.pages.map(n=>te(ee({},n),{repo_review_settings:n.repo_review_settings.map(w=>{const v=f.get(w.repository.id);return v===void 0?w:ge(w,v,h,y)})}))});const g=d;return te(ee({},g),{repo_review_settings:g.repo_review_settings.map(n=>{const w=f.get(n.repository.id);return w===void 0?n:ge(n,w,h,y)})})}),{previous:l}},onError:(a,l,d)=>{d!=null&&d.previous&&d.previous.forEach(([f,h])=>{t.setQueryData(f,h)}),s.danger(e.formatMessage({id:"wham.codeReviewPage.teamAutomations.toast.onError",defaultMessage:"Error updating code review preferences"}),{duration:2,hasCloseButton:!0})}})}function lt(){"use no forget";const[t,e]=re.useState(""),r=ke(t,300).trim(),u=De(),{data:a,isLoading:l,isFetching:d,fetchNextPage:f,hasNextPage:h,isFetchingNextPage:y}=Be(r),{mutate:g}=ze(),R=re.useMemo(()=>{var _;return((_=a==null?void 0:a.pages)!=null?_:[]).flatMap(x=>{var T;return(T=x.repo_review_settings)!=null?T:[]}).filter(x=>!!x)},[a]),p=re.useMemo(()=>R,[R]),n=t.length===0&&p.length===Oe,w=!l&&p.length>0&&(!!h||!!y),v=Ge(u),U=Ue()&&!v;return{queryInput:t,setQueryInput:e,filteredSettings:p,isLoading:l,isFetching:d,fetchNextPage:f,hasNextPage:h,isFetchingNextPage:y,isLegacyEnterprisey:U,shouldShowMaxSuggestionsNote:n,shouldShowInfiniteScrollRow:w,updateCodeReviewRepositories:g}}export{rt as T,ze as a,nt as g,He as o,lt as u};
//# sourceMappingURL=eymwc79qm1xcdho6.js.map
