var se=Object.defineProperty,ae=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var W=(t,e,n)=>e in t?se(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,j=(t,e)=>{for(var n in e||(e={}))oe.call(e,n)&&W(t,n,e[n]);if(H)for(var n of H(e))ie.call(e,n)&&W(t,n,e[n]);return t},_=(t,e)=>ae(t,re(e));import{r as d,e as le,j as a,y as ce}from"./fg33krlcm0qyi6yw.js";import{h as A,f$ as Q,aW as $,d as O,lw as ue,da as F,pX as me,kq as de,es as fe,dD as he,M as xe,i9 as ge,a9 as V,py as pe,eo as we,b as ve,dH as be,gH as B,iU as U,P as M,iK as Ie,l as K,dF as P,ik as ye,bg as je,jW as _e}from"./mtk1qztvnb31pw5r.js";import{Z as ke,fx as Ne,dU as z,n6 as S,eT as Se,ej as Re,pH as Le,pI as Ee}from"./k65njl5wlgspihfr.js";import{g as Me}from"./nxe574t4em7jpfaw.js";import{g as Ce,u as Te,a as Ae,b as Z}from"./coc2775l3yj92qmf.js";import{g as qe}from"./haneze5lyzwaewf8.js";const X=d.createContext({imageList:[],activeIndex:null,isInFocusMode$:A(!1),isZoomed$:A(!1)}),C=()=>d.useContext(X);function q(){for(var t,e=0,n="",s=arguments.length;e<s;e++)(t=arguments[e])&&typeof t=="string"&&(n+=(n&&" ")+t);return n}const Oe="znHN4a_lightbox",Pe={lightbox:Oe};function ze({imageList:t,forceDarkMode:e=!1,initialIndex:n,isInFocusMode$:s,onClose:o,onScrollToEnd:u,children:m}){var D;const h=le(),x=d.useRef(null),[c,y]=d.useState(n),N=Q(),b=$(),[g]=d.useState(()=>{var r,l;return A(((l=(r=window.visualViewport)==null?void 0:r.scale)!=null?l:1)!==1)}),p=O(()=>g());d.useEffect(()=>{if(p)return ue(()=>{g()||requestAnimationFrame(()=>{var l,f;(f=(l=x.current)==null?void 0:l.querySelector('[data-position="'.concat(c,'"]')))==null||f.scrollIntoView({behavior:"smooth",inline:"center",block:"center"})})})},[p,c,g]),d.useEffect(()=>{var l;const r=()=>{var f,I;return g.set(((I=(f=window.visualViewport)==null?void 0:f.scale)!=null?I:1)!==1)};return(l=window.visualViewport)==null||l.addEventListener("resize",r),()=>{var f;return(f=window.visualViewport)==null?void 0:f.removeEventListener("resize",r)}},[g]),F(()=>{var r,l;(l=(r=x.current)==null?void 0:r.querySelector('[data-position="'.concat(n,'"]')))==null||l.scrollIntoView({behavior:"instant",inline:"center",block:"center"})},[n]);const i=d.useCallback(r=>{y(r),requestAnimationFrame(()=>{var f;const l=(f=t[r])==null?void 0:f.title;l&&me.setLiveRegionPolite(l)}),r===t.length-1&&(u==null||u())},[t,u]);F(()=>{const r=x.current;if(!r)return;const l=new IntersectionObserver(f=>{const I=f.reduce((E,T)=>T.isIntersecting&&(!E||T.intersectionRatio>E.intersectionRatio)?T:E,null);I&&I.target instanceof HTMLElement&&i(de(I.target.dataset.position))},{root:r,rootMargin:"0px -50% 0px -50%",threshold:0});for(const f of r.querySelectorAll(":scope > li"))l.observe(f);return()=>{l.disconnect()}},[t,i]);const w=t.length-1,v=d.useCallback(r=>{const l=Math.min(Math.max(c+r,0),w);i(l),requestAnimationFrame(()=>{var f,I;(I=(f=x.current)==null?void 0:f.querySelector('[data-position="'.concat(l,'"]')))==null||I.scrollIntoView({behavior:N?"instant":"smooth",block:"center",inline:"center"})})},[c,w,N,i]);d.useEffect(()=>{requestAnimationFrame(()=>{const r=document.querySelector("[data-lightbox-close-button]");r instanceof HTMLElement&&r.focus()})},[]),d.useEffect(()=>{const r=l=>{if(s!=null&&s()){l.key==="Escape"&&s.set(!1);return}l.key==="ArrowLeft"?c>0&&(l.preventDefault(),v(-1)):l.key==="ArrowRight"?c<w&&(l.preventDefault(),v(1)):l.key==="Escape"&&o(c)};return window.addEventListener("keydown",r),()=>{window.removeEventListener("keydown",r)}},[c,w,v,o,s]),d.useEffect(()=>{fe(he(),"chatgpt_web_image_library_lightbox_image_viewed")},[c]);const{footer:k,items:L,title:te,headerActions:ne}=qe(m,{title:J,items:Y,footer:ee,headerActions:De});return a.jsx(X.Provider,{value:{imageList:t,activeIndex:c,isInFocusMode$:s,isZoomed$:g},children:a.jsxs(xe.Root,{testId:"modal-image-gen-lightbox",isOpen:!0,onClose:()=>o(c),shouldIgnoreClickOutside:b,className:q(b||e?"dark bg-black":"bg-token-bg-primary","flex h-dvh max-h-full w-dvw max-w-full flex-col place-content-center",Pe.lightbox),children:[a.jsxs("section",{className:"grid grid-cols-[auto_1fr_auto] items-start px-1 pt-1 [view-transition-name:var(--vt-page-title)] max-md:absolute max-md:start-0 max-md:end-0 max-md:top-0 max-md:items-center md:grid-cols-[1fr_auto_1fr] md:px-2 md:pt-2",children:[a.jsx("div",{className:"w-fit",children:a.jsx(ke,{icon:ge,"data-lightbox-close-button":!0,onClick:()=>o(c),"aria-label":h.formatMessage({id:"f08aLO",defaultMessage:"Close"})})}),!p&&te,(D=!p&&ne)!=null?D:a.jsx("div",{className:"w-8 shrink-0 basis-auto"})]}),a.jsxs("div",{className:"no-scrollbar flex h-full snap-y snap-mandatory flex-col overflow-y-scroll scroll-smooth",onScroll:r=>{r.target.scrollTop===0&&!g()&&o(c)},children:[a.jsx("div",{className:"h-[15dvh] flex-shrink-0"}),a.jsxs("ol",{ref:x,className:q("flex max-h-full min-h-0 flex-shrink-0 grow basis-full gap-[min(10dvw,_200px)] overflow-x-auto scroll-smooth [anchor-name:--carousel] [view-transition-name:var(--vt-image-carousel)] max-md:gap-0",b&&"no-scrollbar",!p&&"snap-x snap-mandatory snap-center snap-always py-15"),onClick:r=>{(r.target instanceof HTMLOListElement||r.target instanceof HTMLLIElement)&&(r.preventDefault(),o(c))},children:[a.jsx("li",{className:"w-[50vw] flex-shrink-0"}),L,a.jsx("li",{className:"w-[50vw] flex-shrink-0"})]}),a.jsx("div",{className:"h-[15dvh] flex-shrink-0"})]}),!p&&a.jsxs("div",{className:"pointer-events-none absolute inset-5 z-20 flex items-center justify-between [view-transition-name:var(--vt-scroll-buttons)] max-md:hidden",children:[a.jsx(V,{className:"pointer-events-auto aspect-square",disabled:c===0,color:"secondary",icon:pe,onClick:()=>v(-1),"aria-label":h.formatMessage({id:"iQsFWe",defaultMessage:"Previous image"})}),a.jsx(V,{className:"pointer-events-auto aspect-square",color:"secondary",disabled:c===w,icon:Ne,onClick:()=>v(1),"aria-label":h.formatMessage({id:"W7vnD4",defaultMessage:"Next image"})})]}),!p&&k]})})}function J({children:t}){const{imageList:e,activeIndex:n}=C();if(n==null)return null;const s=e[n];return s?t(s):null}function Y({children:t}){const{imageList:e,isZoomed$:n,activeIndex:s}=C(),o=$(),u=Q(),m=O(()=>n==null?void 0:n());return e.map((h,x)=>{var p;const{width:c,height:y}=h,N=c!=null&&y!=null&&c===y;let b=null;s!=null&&(x===s?b="current":x+1===s?b="before":x-1===s&&(b="after"));const g=!o&&b!=="current";return a.jsx("li",{role:g?"button":void 0,className:q("flex max-h-full max-w-[70dvw] flex-shrink-0 snap-center items-center justify-center transition-opacity duration-0 motion-safe:duration-300 max-md:w-[100dvw] max-md:max-w-[100dvw] max-md:snap-always max-md:opacity-100",N&&"aspect-square",b==="current"||m?"opacity-100":"opacity-40"),"data-position":x,onClick:g?({currentTarget:i})=>i.scrollIntoView({behavior:u?"instant":"smooth",block:"center",inline:"center"}):void 0,children:t(_(j({},h),{index:x,position:b}))},(p=h.id)!=null?p:h.url)})}function ee({children:t}){const{imageList:e,activeIndex:n}=C();if(n==null)return null;const s=e[n];return s?a.jsx("footer",{className:"absolute bottom-0 z-10 flex w-full items-center justify-center px-5 pb-3 [view-transition-name:var(--vt-page-footer)] max-md:pb-6",children:t(s)}):null}function De({children:t}){const e=[];return d.Children.forEach(t,n=>{d.isValidElement(n)&&n.type===He&&e.push(n)}),a.jsx("div",{className:"flex items-center justify-end gap-2",children:e.map((n,s)=>a.jsx(d.Fragment,{children:n},s))})}function He({children:t}){const{imageList:e,activeIndex:n}=C();return n==null||e[n]==null?null:t(e[n])}function We(t,e,n=!1){const s=P.getTurnContentReferences(t,e),o=Le(s),u=Fe(t,e),m=o.concat(u);if(n){const h=Ve(t,e);m.push(...h)}return ye(m,"content_url")}function Fe(t,e){const n=P.getConversationTurnAtIndex(t,e).messages;return n?_e(n.flatMap(s=>{var o,u;return(u=(o=s.metadata)==null?void 0:o.image_results)!=null?u:[]})).map(s=>_(j({},s),{thumbnail_url:s.thumbnail_url.replace(/^http:\/\//,"https://"),content_url:s.content_url.replace(/^http:\/\//,"https://")})):[]}function Ve(t,e){return P.getSuperWidgetMessages(t,e).flatMap(s=>s.content.widgets.images)}function Be(t,e,n,s){const{product:o}=Me({thread:t,messageId:e,contentReferenceStartIndex:n,productIndex:s});return!o||!o.image_urls?[]:o.image_urls.map(u=>({url:u,content_url:u,thumbnail_url:u,title:o.title,content_size:{width:0,height:0},thumbnail_size:{width:0,height:0}}))}function tt({clientThreadId:t}){const e=ve(),n=O(()=>we(e)),s=z.useCurrentImage();if(!s)return null;const{image:o,source:u,analyticsMetadata:m,contentReferenceStartIndex:h,productIndex:x}=s;if(u==null||t==null||(m==null?void 0:m.turnIndex)==null)return a.jsx(R,{image:o,analyticsMetadata:{}});const c=be(t),y=(function(){switch(u){case S.ProductDetails:return Be(c,m.messageId,h,x);case S.SuperWidget:case S.ImageGroup:case S.DilWidget:return s.imageResults;default:return We(c,m.turnIndex,n)}})();return a.jsx(R,{image:o,group:y,analyticsMetadata:m})}function nt(){const t=z.useCurrentImage();if(!t)return null;const{image:e,source:n}=t;if(n==null)return a.jsx(R,{image:e,analyticsMetadata:{}});switch(n){case S.ImagesTab:return a.jsx(Ue,{image:e});case S.Turn:return a.jsx(Ze,{image:e});default:return null}}function Ue({image:t}){const{imageResults:e}=Ae();return a.jsx(R,{image:t,group:e,analyticsMetadata:{}})}function Ze({image:t}){const{imageResults:e}=Te();return a.jsx(R,{image:t,group:e,analyticsMetadata:{}})}const G="flex w-fit shrink-0 items-center gap-8 px-4 py-2 text-sm min-h-20";function R({image:t,group:e,analyticsMetadata:n}){var g,p;const s=d.useRef(null),o=z.useStore();d.useEffect(()=>{var w,v;(v=(w=window==null?void 0:window.history)==null?void 0:w.state)!=null&&v.imageModalOpen||window.history.pushState({imageModalOpen:!0},"",window.location.href);const i=()=>{var k,L;(L=(k=window==null?void 0:window.history)==null?void 0:k.state)!=null&&L.imageModalOpen||o.setCurrentImage(void 0)};return window.addEventListener("popstate",i),()=>window.removeEventListener("popstate",i)},[o]);const u=t.content_url.replace(/^http:\/\//,"https://"),m=(g=e==null?void 0:e.findIndex(i=>B(t,i)))!=null?g:0,h=(p=e==null?void 0:e.length)!=null?p:1,x=m!=null&&h>1,c=_(j({},U(n)),{url:t.url,link_type:"text",section:"image",section_location:"response",section_index:(m+1).toString()});d.useEffect(()=>{s.current!==t.url&&(s.current=t.url,M.logEventWithStatsig("Search Content Reference Shown","search_content_reference_shown",_(j({},U(n)),{type:"full_screen_image",url:t.url,image_url:u})),M.logEvent("link_action",_(j({},c),{action:"show"})))},[u]);const y=()=>{window.history.go(-1),o.setCurrentImage(void 0)},N=e!=null?e:[];ce({queries:N.map(i=>Ce(i.thumbnail_url,"ImageResultModal"))});const b=d.useMemo(()=>e!=null?e:[t],[e,t]);return a.jsxs(ze,{forceDarkMode:!0,imageList:b,initialIndex:m,onClose:y,children:[x&&a.jsx(J,{children:i=>{var w;return a.jsxs("div",{className:"text-token-text-tertiary -mt-0.25 shrink-0 px-4 md:mt-0 md:py-2",children:[((w=e==null?void 0:e.findIndex(v=>B(i,v)))!=null?w:0)+1," /"," ",h]})}}),a.jsx(Y,{children:i=>a.jsx(Ge,{image:i,isNewLightbox:!0})}),a.jsx(ee,{children:i=>{var v,k;const w=(v=i.show_url)!=null?v:!0;return a.jsx("div",{className:"flex w-full justify-start",children:a.jsx("div",{className:"w-fit rounded-xl backdrop-blur-xl",children:w?a.jsx(Ie,{onClick:()=>{M.logEvent("link_action",_(j({},c),{action:"click"}))},onMouseEnter:()=>{M.logEvent("link_action",_(j({},c),{action:"hover"}))},href:i.is_proxied_image?i.content_url:i.url,className:K(G,"hover:opacity-70"),children:a.jsxs("div",{className:"flex grow flex-col gap-0.5 overflow-hidden pe-2",children:[a.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-2 truncate",children:[a.jsx(Re,{url:i.content_url,className:"rounded-sm",size:16}),(k=i.attribution)!=null?k:Se(i.url)]}),a.jsx("div",{className:"truncate font-semibold text-white",children:i.title})]})}):a.jsx("div",{className:G,children:a.jsx("div",{className:"truncate font-semibold text-white",children:i.title})})})})}})]})}function Ge({image:t,isNewLightbox:e=!1}){const n=t.content_url.replace(/^http:\/\//,"https://"),s=t.thumbnail_url.replace(/^http:\/\//,"https://"),o=t.content_size.width/t.content_size.height,{isError:u}=Z(n,"ModalImage_main"),{isError:m}=Z(s,"ModalImage_thumbnail"),h=t.is_proxied_image?t.url:u?s:n;return!m||!u||t.is_proxied_image?a.jsx(je.img,{src:h,alt:t.title,referrerPolicy:"no-referrer",style:{backgroundImage:s?"url(".concat(s,")"):void 0,backgroundSize:"contain",aspectRatio:o,backgroundPosition:"center",backgroundRepeat:"no-repeat"},initial:{opacity:0},animate:{opacity:1},className:K(e?"h-full max-w-full object-contain":"h-full max-w-[100vw] object-contain sm:max-w-[calc(100vw-10rem)]")}):a.jsx("div",{className:"flex h-full grow items-center justify-center",children:a.jsx("div",{className:"flex h-96 w-96 items-center justify-center bg-white/10",children:a.jsx(Ee,{className:"text-token-text-tertiary h-12 w-12"})})})}export{tt as ImageLightbox,nt as ImageLightboxSearchGPT};
//# sourceMappingURL=gywqobhbbetkdxnd.js.map
