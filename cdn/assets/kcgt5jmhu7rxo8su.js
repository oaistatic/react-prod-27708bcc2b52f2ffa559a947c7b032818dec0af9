import{e as I,b as v,f as T,r as q,j as e}from"./fg33krlcm0qyi6yw.js";import{c_ as D,rx as R,hh as C,jY as O,s1 as B,C as N,a9 as K,c0 as U,R as P,A as S,gc as G,gp as Q,gq as W}from"./mtk1qztvnb31pw5r.js";function H({gizmoId:c,fileId:t,fileName:n,onClose:o,clientThreadId:E}){const g=I(),m=!D(),M=R(),d=C(E),{data:s,isLoading:f,isError:F,error:L,refetch:j}=v({queryKey:["file-info",t,d],queryFn:async()=>await P.safeGet("/files/{file_id}/simple",{parameters:{path:{file_id:t},query:{gizmo_id:c,conversation_id:d}},authOption:m?S.Anonymous:void 0})}),a=!!(s&&(s.mime_type==="application/pdf"||O(n)==="pdf")),{data:r,isLoading:u,isError:_,error:p,refetch:b}=v({queryKey:["file-preview",t,c,a],queryFn:async()=>{const h=await Q(t,c,m,d,a);if(h.status===W.Success)return h.download_url;throw new Error("Failed to download file inline preview")},staleTime:G,enabled:!!s}),l=F||_,A=p!=null?p:L,i=l?B({error:A,getErrorMessage:M,fileName:n,fallbackMessage:g.formatMessage(w.previewLoadFailed)}):null,x=i==null?void 0:i.message,y=!!(i!=null&&i.isRetryable),k=()=>{j(),s&&b()};return q.useEffect(()=>{f||u||l||s&&!a&&r&&(window.open(r,"_blank"),o())},[s,r,a,o,f,u,l]),e.jsx(N,{testId:"modal-file-preview",className:"min-h-[90vh] max-w-[75vw] max-w-[1000px]",isOpen:!0,onClose:o,type:"success",title:n,showCloseButton:!0,size:"custom",children:l&&x?e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-center gap-4 px-6 text-center",children:[e.jsx("div",{className:"text-token-text-primary text-base font-medium",children:x}),e.jsx(K,{color:"secondary",onClick:y?k:o,className:"mt-2",children:g.formatMessage(y?w.tryAgain:w.close)})]}):f||u||!a||!r?e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx(U,{})}):e.jsx("iframe",{src:r,title:n,height:"100%",width:"100%"})})}const w=T({previewLoadFailed:{id:"filesModal.previewLoadFailed",defaultMessage:"Unable to load the file preview."},tryAgain:{id:"filesModal.previewTryAgain",defaultMessage:"Try again"},close:{id:"filesModal.previewClose",defaultMessage:"Close"}});export{H as FilePreviewModal};
//# sourceMappingURL=kcgt5jmhu7rxo8su.js.map
