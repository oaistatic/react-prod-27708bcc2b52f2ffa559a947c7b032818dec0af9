const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lthry6zonu767sy8.js","assets/fg33krlcm0qyi6yw.js","assets/mtk1qztvnb31pw5r.js","assets/root-mcq3deyb.css","assets/k65njl5wlgspihfr.js","assets/conversation-small-332fs9rk.css","assets/czwlkhzq2wjwrbr9.js","assets/exbyaee45o0onuld.js","assets/ifr23omr9d78ntp2.js","assets/hcn3kohxpjzaoxwc.js","assets/c5og9r81gzk0nhum.js","assets/hhinqbyeydy6ylpd.js","assets/i3rty9twuhjkv8ax.js","assets/j0xewpby56axy54p.js","assets/jh2gb364v6b9t61m.js","assets/cwhbtosecjtdlg02.js","assets/cu0ig3jox4ha1bc5.js","assets/ctgqahsfx1txd4g6.js","assets/evgr6wx9jd99ot87.js","assets/du98r2zhw5p0hoto.js","assets/e5ksk0bbujs0ac88.js"])))=>i.map(i=>d[i]);
var wn=Object.freeze,An=Object.defineProperty,ni=Object.defineProperties;var ai=Object.getOwnPropertyDescriptors;var Es=Object.getOwnPropertySymbols;var Pn=Object.prototype.hasOwnProperty,kn=Object.prototype.propertyIsEnumerable;var En=(i,e,t)=>e in i?An(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ae=(i,e)=>{for(var t in e||(e={}))Pn.call(e,t)&&En(i,t,e[t]);if(Es)for(var t of Es(e))kn.call(e,t)&&En(i,t,e[t]);return i},Oe=(i,e)=>ni(i,ai(e));var Rn=(i,e)=>{var t={};for(var s in i)Pn.call(i,s)&&e.indexOf(s)<0&&(t[s]=i[s]);if(i!=null&&Es)for(var s of Es(i))e.indexOf(s)<0&&kn.call(i,s)&&(t[s]=i[s]);return t};var Qs=(i,e)=>wn(An(i,"raw",{value:wn(e||i.slice())}));import{_ as Ze,r as _,j as n,M as Le,f as oi,c as es,a as ua,e as ks,E as ii,n as ri}from"./fg33krlcm0qyi6yw.js";import{bh as We,F as ga,dH as vs,gd as U,kh as ma,dF as K,e2 as Z,l as Ce,v9 as ha,bb as li,pV as di,fN as _e,dL as He,dR as ot,dI as Ye,ql as ci,a9 as pa,kM as fa,R as ui,A as gi,aU as jn,_ as et,dZ as va,m as ba,b as bs,va as mi,ba as xa,k as it,c_ as Ia,nm as _a,eO as hi,aW as pi,hj as fi,gy as Ca,d as Ve,gr as st,vb as Fn,V as rt,o as je,cU as Sa,pz as vi,gU as bi,aK as xi,kz as Ii,e as _i,c0 as Ci,P as Fe,$ as Si,ag as Ti,i as yi,gP as Mi,n as Nn,W as Bn,h7 as Dn,kl as wi,kH as Ei,kF as Js,dP as Ai,bI as fs,dp as Pi,mx as ki,hG as Ri,ed as Un,eW as ji,pW as Fi,pU as Ni,id as Ta,dC as Bi,dJ as is,e4 as Di,es as Ps,hh as Ui,vc as Gi,d6 as ya,mO as Oi,eJ as Vi,dQ as Xs,q1 as Li,vd as Gn,fP as Hi,ve as Wi,e7 as On,vf as $i,kw as zi,kx as qi,bj as Ki,bJ as Vn,m3 as As,hX as Qi,f8 as Ji,lX as Xi,bv as Yi,en as Zi,sm as er,pr as sr,gG as Ln,vg as tr,eo as nr,gF as ar,hg as or,kI as ir,qu as rr}from"./mtk1qztvnb31pw5r.js";import{o2 as lr,o3 as tt,d6 as dr,o4 as Hn,o5 as cr,o6 as Wn,o7 as ur,fJ as rs,dP as gr,o8 as mr,o9 as hr,nf as pr,gc as fr,ng as vr,ge as br,oa as xr,a8 as Ir,Y as Ma,ob as wa,oc as Ea,od as _r,oe as Cr,of as Sr,fp as Tr,ca as yr,c$ as Mr,fY as wr,og as Er,oh as Ar,mK as Aa,e$ as Pr,f0 as kr,f1 as Rr,oi as jr,dr as Fr,bq as Nr,k_ as Br,e0 as Pa,oj as Dr,ok as Ur,f3 as Gr,ol as Or,om as Vr,j3 as Lr,on as $n,a$ as Hr,oo as Wr,eJ as nt,op as $r,bB as zr,oq as qr,aA as Kr,or as Qr,os as Jr,ot as Xr,ou as Yr,ov as Zr,ow as zn,ox as el,b1 as qn,oy as sl,oz as tl,oA as nl,oB as al,oC as ol,oD as il,em as rl,oE as ll,oF as dl,oG as cl,oH as ul,oI as gl,oJ as ml,oK as hl,oL as pl,oM as fl,oN as vl,oO as bl,oP as xl,oQ as Il,af as _l,oR as Cl,ag as ka,oS as Sl,oT as Tl,oU as yl,oV as Ml,oW as Kn,oX as wl,oY as El,oZ as Al,o_ as Pl,o$ as Qn,p0 as kl,p1 as Rl,p2 as jl,p3 as Fl,p4 as Nl,p5 as Bl,p6 as Dl,p7 as Ul,ah as Gl,p8 as Ol,p9 as Vl,pa as Ll,pb as Hl,a7 as Wl,pc as $l,pd as zl,pe as ql,pf as Kl,pg as Ql,ph as Jl,pi as Xl,mM as Yl,jt as Zl,pj as ed,mg as sd,pk as td,pl as nd,pm as ad,pn as od,po as id,pp as rd}from"./k65njl5wlgspihfr.js";import{b as ld}from"./ifrwee0bgh9e2but.js";import{C as at}from"./kgrrqncjl71482vi.js";import"./ohquqctluwabmb5i.js";import"./c2cj1dlcffke3f7m.js";import{a as dd,b as cd}from"./mivow98b53y1taf8.js";const Jn=We(()=>Ze(()=>import("./lthry6zonu767sy8.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])).then(i=>i.MemoryActionResult));function Xn(i,e,t){He(i,s=>{ot.updateTree(s,r=>{r.updateNodeMetadata(e,{inlineComparisonRating:t})})})}const Yn=({messages:i})=>{for(const{metadata:e}of i){const{paragen_display_label:t}=e!=null?e:{};if(t)return t;const{augmented_paragen_prompt_label:s}=e!=null?e:{};if(s)return s}};function Zn({displayedMessages:i,message:e,conversationTurnMountTime:t,visibilityState:s}){var c,u;const r={},o=((c=e.clientMetadata)==null?void 0:c.variantsInStreamInfo)==null&&((u=e.metadata)==null?void 0:u.paragen_variants_info)!=null;return i.forEach((m,x)=>{const l=o?{load_first_token_time:t,load_end_time:t}:{load_first_token_time:m.loadFirstTokenTime,load_end_time:m.loadEndTime},T=x===0?{rendered_height:s.left_rendered_height}:{rendered_height:s.right_rendered_height};r[m.messageId]=ae(ae({},l),T)}),r}function ud(i){const e=_.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null,left_rendered_height:null,right_rendered_height:null}),t=_.useRef({left:null,right:null});return i.variantIds.length<2?n.jsx(Ra,ae({setPreferredFeedback:()=>{},leftVariantId:"left-placeholder",rightVariantId:"right-placeholder",leftTurn:null,rightTurn:null,originalTurn:null,hasActiveRequest:!0,visibilityStateRef:e,firstVisibleTokenTimestampsRef:t},i)):n.jsx(gd,Oe(ae({},i),{visibilityStateRef:e,firstVisibleTokenTimestampsRef:t}))}function gd(i){const{conversation:e,variantIds:t,turnIndex:s,firstVisibleTokenTimestampsRef:r}=i;if(t.length!==2)throw new Error("ConversationTurnSideBySideFeedback requires exactly two variant IDs");const o=ha(),c=li(),[u,m]=t,x=_.useMemo(()=>di(u+m)()>=.5,[u,m]),[l,T]=x?[m,u]:[u,m],[C,I,f]=_e(e.id,P=>{var N,V,B,d,O,q,k,Se,oe,ee,fe,$,j,D,Q,M,J,de,z,Te;const A=jn(P).tree.getLeafFromNode(l).id,F=jn(P).tree.getLeafFromNode(T).id,g=K.getConversationTurns(P,A),H=K.getConversationTurns(P,F),G=s<g.length?g[s]:null,b=s<H.length?H[s]:null;return G||et.addError("Paragen Left turn index ".concat(s," out of bounds"),{turnIndex:s,turnCount:g.length,lastTurnRole:(N=U(g))==null?void 0:N.role,lastMessageAuthor:(B=U((V=U(g))==null?void 0:V.messages))==null?void 0:B.author,lastMessageContentType:(O=U((d=U(g))==null?void 0:d.messages))==null?void 0:O.content.content_type,lastMessageMetadata:(k=U((q=U(g))==null?void 0:q.messages))==null?void 0:k.metadata,altTurnCount:H.length,altLastTurnRole:(Se=U(H))==null?void 0:Se.role,altLastMessageRole:(ee=U((oe=U(H))==null?void 0:oe.messages))==null?void 0:ee.author.role}),b||et.addError("Paragen Right turn index ".concat(s," out of bounds"),{turnIndex:s,turnCount:H.length,lastTurnRole:(fe=U(H))==null?void 0:fe.role,lastMessageAuthor:(j=U(($=U(H))==null?void 0:$.messages))==null?void 0:j.author,lastMessageContentType:(Q=U((D=U(H))==null?void 0:D.messages))==null?void 0:Q.content.content_type,lastMessageMetadata:(J=U((M=U(H))==null?void 0:M.messages))==null?void 0:J.metadata,altTurnCount:g.length,altLastTurnRole:(de=U(g))==null?void 0:de.role,altLastMessageRole:(Te=U((z=U(g))==null?void 0:z.messages))==null?void 0:Te.author.role}),[A,G,b]}),[h,y]=x?[f,I]:[I,f],v="skippable_parallel_2_in_stream:a:1.5";_.useEffect(()=>(Wn.setState({displayingSideBySideFeedback:!0}),()=>{Wn.setState({displayingSideBySideFeedback:!1})}),[]);const S=_.useRef({left_visibility_initial:null,left_visibility_max:null,right_visibility_initial:null,right_visibility_max:null,left_rendered_height:null,right_rendered_height:null}),L=_.useCallback((P,{shouldSubmitParagenFeedback:A=!0}={})=>{if(!I||!f||!h||!y)throw new Error("Expected both turns to exist");He(e.id,B=>{ot.setCurrentBranch(B,P)});const F=P===l,g=P===u;h.messages.length>0&&Xn(e.id,h.messages[h.messages.length-1].id,g?"original":"new"),y.messages.length>0&&Xn(e.id,y.messages[y.messages.length-1].id,g?"original":"new");const H=Ye(e.id),G=[I,f].map((B,d)=>{var O,q,k;return{messageId:B.messages[B.messages.length-1].id,loadFirstTokenTime:d===0?r.current.left:r.current.right,loadEndTime:(k=(q=(O=U(B.messages))==null?void 0:O.clientMetadata)==null?void 0:q.completionSampleFinishTime)!=null?k:null}}),b=F?G[0].messageId:G[1].messageId,N=K.getParentPromptNode(vs(e.id),C);if(!N)throw new Error("Expected prompt for side by side feedback");const V=Zn({displayedMessages:G,message:N.message,conversationTurnMountTime:i.conversationTurnMountTime,visibilityState:S.current});A&&aa({params:{conversation_id:H,displayed_message_ids:G.map(B=>B.messageId),message_metadatas:V,rating:"selected",selected_message_id:b,source_timestamp:Date.now(),ui_variant:1,user_prompt_message_id:N.message.id}})},[e.id,l,u,h,y,I,f,C,r,i.conversationTurnMountTime,S]);return _.useEffect(()=>ci(va,{requestCompletion:P=>{const A=Ye(e.id),F=K.getParentPromptNode(vs(e.id),C);if(!F)throw new Error("Expected prompt for side by side feedback");if(!I||!f)throw new Error("Expected both turns to exist");const g=[I,f].map((b,N)=>{var V,B,d;return{messageId:b.messages[b.messages.length-1].id,loadFirstTokenTime:N===0?r.current.left:r.current.right,loadEndTime:(d=(B=(V=U(b.messages))==null?void 0:V.clientMetadata)==null?void 0:B.completionSampleFinishTime)!=null?d:null}}),H=Zn({displayedMessages:g,message:F.message,conversationTurnMountTime:i.conversationTurnMountTime,visibilityState:S.current}),G=P.isForSkippingParagen;aa({params:{conversation_id:A,displayed_message_ids:g.map(b=>b.messageId),message_metadatas:H,rating:G?"explicit_skipped":"skipped",selected_message_id:null,source_timestamp:Date.now(),ui_variant:G?3:1,user_prompt_message_id:F.message.id}}),G&&L(l,{shouldSubmitParagenFeedback:!1})}}),[I,f,C,e.id,i.conversationTurnMountTime,v,h==null?void 0:h.messages,y==null?void 0:y.messages,c,r,L,l,S]),n.jsx(Ra,Oe(ae({},i),{setPreferredFeedback:L,leftVariantId:l,rightVariantId:T,leftTurn:I,rightTurn:f,hasActiveRequest:o,originalTurn:h,visibilityStateRef:S}))}function Ra(x){var l=x,{setPreferredFeedback:i,leftVariantId:e,rightVariantId:t,leftTurn:s,rightTurn:r,hasActiveRequest:o,originalTurn:c,visibilityStateRef:u}=l,m=Rn(l,["setPreferredFeedback","leftVariantId","rightVariantId","leftTurn","rightTurn","hasActiveRequest","originalTurn","visibilityStateRef"]);var fe,$,j;const T=(fe=s&&Yn(s))!=null?fe:null,C=($=r&&Yn(r))!=null?$:null,I=_.useMemo(()=>{var D;return(D=s==null?void 0:s.messages)!=null?D:[]},[s==null?void 0:s.messages]),f=_.useMemo(()=>{var D;return(D=r==null?void 0:r.messages)!=null?D:[]},[r==null?void 0:r.messages]),{avatarClassName:h,firstVisibleTokenTimestampsRef:y}=m,v=_.useMemo(()=>{var D;return(D=s==null?void 0:s.messageGroups)!=null?D:[]},[s==null?void 0:s.messageGroups]),S=_.useMemo(()=>{var D;return(D=r==null?void 0:r.messageGroups)!=null?D:[]},[r==null?void 0:r.messageGroups]),L=lr(),P=vs(m.conversation.id),A=U(s==null?void 0:s.messages),F=U(r==null?void 0:r.messages),g=ma(K.getRequestId(P,(j=A==null?void 0:A.id)!=null?j:F==null?void 0:F.id)),H=g&&!(A!=null&&A.end_turn),G=g&&!(F!=null&&F.end_turn),b=A!=null&&tt(A),N=F!=null&&tt(F),V=b!=null?b:N,B=(s==null?void 0:s.role)===Z.User,d=(r==null?void 0:r.role)===Z.User,O=_.useRef(null),q=_.useRef(null),k=_.useRef(null),Se=s!=null,oe=r!=null;!Se&&y.current.left==null&&(y.current.left=Date.now()),!oe&&y.current.right==null&&(y.current.right=Date.now()),_.useEffect(()=>{if(O.current&&q.current&&k.current){const D=Array(11).fill(0).map((M,J)=>J/10),Q=new IntersectionObserver(M=>M.forEach(J=>{var de,z,Te,ve,Ae,ss;J.target===q.current?((z=(de=u.current).left_visibility_initial)!=null||(de.left_visibility_initial=J.intersectionRatio),u.current.left_visibility_max=Math.max((Te=u.current.left_visibility_max)!=null?Te:0,J.intersectionRatio)):J.target===k.current&&((Ae=(ve=u.current).right_visibility_initial)!=null||(ve.right_visibility_initial=J.intersectionRatio),u.current.right_visibility_max=Math.max((ss=u.current.right_visibility_max)!=null?ss:0,J.intersectionRatio))}),{root:O.current,threshold:D});return Q.observe(q.current),Q.observe(k.current),()=>Q.disconnect()}},[u]),_.useEffect(()=>{const D=q.current,Q=k.current;if(!D||!Q)return;let M=null;const J=()=>{M!=null&&cancelAnimationFrame(M),M=requestAnimationFrame(()=>{if(D.isConnected){const z=Math.round(D.getBoundingClientRect().height);u.current.left_rendered_height=z}if(Q.isConnected){const z=Math.round(Q.getBoundingClientRect().height);u.current.right_rendered_height=z}})},de=new ResizeObserver(J);return de.observe(D),de.observe(Q),J(),()=>{M!=null&&cancelAnimationFrame(M),de.disconnect()}},[u]);const{data:ee}=dr(void 0,!1,L);return n.jsxs("div",{className:"relative flex flex-col",children:[n.jsx("div",{className:"bg-token-main-surface-primary sticky z-1 px-(--thread-content-margin) text-center text-lg text-pretty max-md:top-(--header-height)","data-testid":"paragen-feedback-title",children:n.jsx(Le,{id:"KKeSJV",defaultMessage:"You're giving feedback on a new version of ChatGPT."})}),n.jsx("div",{className:"text-token-text-secondary px-(--thread-content-margin) pt-1 pb-5 text-center text-sm text-pretty",children:n.jsx(Le,{id:"TK934w",defaultMessage:"Which response do you prefer? Responses may take a moment to load."})}),n.jsx("div",{className:Ce(cr(),"horzScrollShadows relative -mb-2 snap-x snap-mandatory overflow-x-auto overflow-y-clip pb-4"),ref:O,children:n.jsxs("div",{className:Ce("mx-auto box-content max-w-[calc(2*var(--thread-content-max-width))] min-w-min px-(--thread-content-margin)","flex items-start gap-4 sm:gap-6"),children:[n.jsxs(ea,{rootElementRef:q,onClick:()=>{i(e)},hasActiveRequest:o,isImageGenInProgress:V,children:[n.jsxs(ta,{children:[n.jsx(Hn,{messages:I,isUserTurn:B,avatarClassName:h}),n.jsx(sa,{children:n.jsx(Le,Oe(ae({},oa.responseNumber),{values:{responseIndex:1,display_label:T?" ".concat(T):""}}))})]}),n.jsxs(n.Fragment,{children:[ee!=null&&!B&&n.jsx(Jn,{clientThreadId:m.conversation.id,messages:I,isParagen:!0}),n.jsx(at,Oe(ae({},m),{allMessages:I,groupedMessagesToRender:v,allGroupedMessages:v,isUserTurn:B,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isCompletionRequestInProgress:H,hasActiveRequest:o,shouldGrowContainer:!1,isParagen:!0})),n.jsx(na,{clientThreadId:m.conversation.id,conversationTurnMountTime:m.conversationTurnMountTime,turn:s,originalTurn:c})]})]}),n.jsxs(ea,{rootElementRef:k,onClick:()=>{i(t)},hasActiveRequest:o,isImageGenInProgress:V,children:[n.jsxs(ta,{children:[n.jsx(Hn,{messages:f,isUserTurn:d,avatarClassName:h}),n.jsx(sa,{children:n.jsx(Le,Oe(ae({},oa.responseNumber),{values:{responseIndex:2,display_label:C?" ".concat(C):""}}))})]}),n.jsxs(n.Fragment,{children:[ee!=null&&!d&&n.jsx(Jn,{clientThreadId:m.conversation.id,messages:f,isParagen:!0}),n.jsx(at,Oe(ae({},m),{allMessages:f,groupedMessagesToRender:S,allGroupedMessages:S,isFinalUserTurn:!1,isFinalAssistantTurn:!1,isUserTurn:d,isCompletionRequestInProgress:G,hasActiveRequest:o,shouldGrowContainer:!1,isParagen:!0})),n.jsx(na,{clientThreadId:m.conversation.id,conversationTurnMountTime:m.conversationTurnMountTime,turn:r,originalTurn:c})]})]})]})})]})}function ea({rootElementRef:i,onClick:e,children:t,hasActiveRequest:s,isImageGenInProgress:r}){const o=_.useRef(null),c=_.useRef(null),u=_.useRef(null);return n.jsx("div",{"data-paragen-root":!0,className:"border-token-border-tertiary @container relative flex min-w-[min(450px,80cqw,80vw)] flex-1 snap-center flex-col gap-1 rounded-xl border text-start shadow-lg shadow-black/3",ref:i,children:n.jsxs("div",{className:Ce(ur,"px-(--thread-content-margin) py-4"),children:[n.jsx("div",{className:Ce("absolute top-48 right-0! left-0! h-px","invisible"),ref:o}),n.jsx("div",{className:Ce("absolute top-48 right-0! bottom-0 left-0!","invisible"),ref:c}),n.jsx("div",{className:Ce("absolute right-0! bottom-0 left-0! h-px","invisible"),ref:u}),t,s||r?null:n.jsx(pa,{className:"mt-4 self-start",onClick:e,"data-testid":"paragen-prefer-response-button",children:n.jsx(Le,{id:"U2EAH6",defaultMessage:"I prefer this response"})})]})})}var da;const sa=ga.div(da||(da=Qs(["text-sm text-token-text-secondary font-semibold"])));var ca;const ta=ga.div(ca||(ca=Qs(["flex gap-4 items-center mb-1"])));function na({clientThreadId:i,conversationTurnMountTime:e,turn:t,originalTurn:s}){var T,C,I,f,h,y;const r=fa();if(!r.showParagenMetadata||!r.showDebugConversationTurns&&!r.forceParagen||t==null)return null;let o=t===s?"ORIGINAL":"NEW";const c=t.messages[t.messages.length-1],u=(T=c==null?void 0:c.metadata)==null?void 0:T.__internal,m=(C=c==null?void 0:c.metadata)==null?void 0:C.paragen_display_label;if(u){const{model_id:v,model_definition_slug:S,model_definition_virtual_model_id:L,alternative_model_selection_rule:P,augmented_paragen_prompt_group_id:A,augmented_paragen_prompt_id:F,augmented_paragen_prompt:g}=u;v&&(o+="\nModel ID: ".concat(v)),S&&(o+="\nModel Slug: ".concat(S)),L&&(o+="\nVirtual Model ID: ".concat(L)),P&&(o+="\nAlternative Model Rule: ".concat(P)),A&&(o+="\nPrompt Group ID: ".concat(A)),F&&(o+="\nPrompt ID: ".concat(F)),g&&(o+="\nPrompt: ".concat(g)),m&&(o+="\nDisplay Label: ".concat(m))}o+="\nMessage ID: ".concat(c.id);const x=K.getParentPromptNode(vs(i),t.messages[0].id);if(!x)throw new Error("Expected prompt for side by side feedback");const l=((I=x.message.clientMetadata)==null?void 0:I.variantsInStreamInfo)==null&&((f=x.message.metadata)==null?void 0:f.paragen_variants_info)!=null;return o+="\nUser prompt message ID: ".concat(x.message.id),o+="\nIs Persisted Paragen? ".concat(l),o+="\nCompletion Sample Finish Time: ".concat(l?"".concat(e," (persisted)"):(y=(h=U(t.messages))==null?void 0:h.clientMetadata)==null?void 0:y.completionSampleFinishTime),n.jsx("div",{className:"text-sm whitespace-pre-wrap text-red-500",children:o})}async function aa({params:i}){await ui.safePost("/paragen_submission",{requestBody:i,authOption:gi.SendIfAvailable})}const oa=oi({responseNumber:{id:"ConversationTurnTwoUpFeedback.responseNumber",defaultMessage:"Response {responseIndex, number}{display_label}"}});function ja({ctx:i,clientThreadId:e,messageId:t,isSharedConversation:s,isAuthoredByCurrentUser:r,serverThreadId:o}){const c=o!=null?o:Ye(e),u=t!=null?t:null,m=rt(i,"1030729005").get("chatgpt_message_feedback_consolidation_enabled",!1);return{canReportMessage:!!(u&&c)&&je(i,"3376455464")&&!m&&!r&&!s,handleReportMessage:()=>{u&&Sa(i,md,{clientThreadId:e,serverThreadId:c!=null?c:void 0,messageId:u})}}}const md=We(()=>Ze(()=>import("./c5og9r81gzk0nhum.js"),__vite__mapDeps([10,1,2,3,4,5])).then(i=>i.ThreadReportMessageModal)),hd=We(async()=>()=>null),pd=i=>{"use forget";const e=es.c(19),{alwaysShow:t,isUserTurn:s,children:r}=i,o=_.useRef(null);let c,u;e[0]!==t?(c=()=>{const v=o.current;v&&(t?requestAnimationFrame(()=>{v&&(v.style.maskPosition=t?"0% 0%":"")}):v.style.maskPosition="")},u=[t],e[0]=t,e[1]=c,e[2]=u):(c=e[1],u=e[2]),_.useEffect(c,u);const m=!t&&"absolute start-0 end-0 flex",x=s?"justify-end":"min-h-[46px] justify-start";let l;e[3]!==m||e[4]!==x?(l=Ce("z-0 flex",m,x),e[3]=m,e[4]=x,e[5]=l):l=e[5];const T=!s&&"touch:w-[calc(100%+--spacing(3.5))] -mt-1 w-[calc(100%+--spacing(2.5))]",C=t&&!s&&"duration-[1.5s]",I=!(t||s)&&"duration-500 group-hover/turn-messages:delay-300";let f;if(e[6]!==s||e[7]!==T||e[8]!==C||e[9]!==I){let v;e[11]!==s?(v=s&&["touch:pointer-events-auto touch:opacity-100","duration-300 group-hover/turn-messages:delay-300","pointer-events-none opacity-0 motion-safe:transition-opacity","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:opacity-100","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:opacity-100","has-data-[state=open]:pointer-events-auto has-data-[state=open]:opacity-100"],e[11]=s,e[12]=v):v=e[12],f=Ce("touch:-me-2 touch:-ms-3.5 -ms-2.5 -me-1 flex flex-wrap items-center gap-y-4 p-1 select-none",T,C,"focus-within:transition-none hover:transition-none",I,!s&&["touch:pointer-events-auto","pointer-events-none [mask-image:linear-gradient(to_right,black_33%,transparent_66%)] [mask-size:300%_100%] [mask-position:100%_0%] motion-safe:transition-[mask-position]","group-hover/turn-messages:pointer-events-auto group-hover/turn-messages:[mask-position:0_0]","group-focus-within/turn-messages:pointer-events-auto group-focus-within/turn-messages:[mask-position:0_0]","has-data-[state=open]:pointer-events-auto has-data-[state=open]:[mask-position:0_0]"],v),e[6]=s,e[7]=T,e[8]=C,e[9]=I,e[10]=f}else f=e[10];let h;e[13]!==r||e[14]!==f?(h=n.jsx("div",{ref:o,className:f,children:r}),e[13]=r,e[14]=f,e[15]=h):h=e[15];let y;return e[16]!==h||e[17]!==l?(y=n.jsx("div",{className:l,children:h}),e[16]=h,e[17]=l,e[18]=y):y=e[18],y},fd=i=>{"use forget";var _s,gs,ns,he,qe,Ke;const e=es.c(106),{activeVariantIndex:t,clientThreadId:s,conversationMode:r,lastMessage:o,messages:c,numVariants:u,onChangeIndex:m,onRate:x,showCanvasButton:l,showCopyButton:T,showPagination:C,showPlayButton:I,showRatingButtons:f,showRegenerateButton:h,turn:y,turnIndex:v,parentPrompt:S,isAgentTurn:L,isKAUR1BR5:P,reportableMessageId:A,isSharedConversation:F,serverThreadIdForReporting:g,projectConversationId:H}=i,G=F===void 0?!1:F,b=bs(),N=ks(),V=ba(),B=ua(),d=xa(it);let O;e[0]!==b?(O=Ia(),e[0]=b,e[1]=O):O=e[1];const q=O;let k;e[2]!==b?(k=!1,e[2]=b,e[3]=k):k=e[3];const Se=k,oe=_a(),ee=(_s=o==null?void 0:o.clientMetadata)==null?void 0:_s.rating,fe=(gs=o==null?void 0:o.clientMetadata)==null?void 0:gs.requestId;let $,j;e[4]!==s||e[5]!==b||e[6]!==G||e[7]!==(o==null?void 0:o.id)||e[8]!==A||e[9]!==g?($=Ye(s),j=ja({ctx:b,clientThreadId:s,messageId:(ns=A!=null?A:o==null?void 0:o.id)!=null?ns:null,isSharedConversation:G,isAuthoredByCurrentUser:!1,serverThreadId:(he=g!=null?g:$)!=null?he:null}),e[4]=s,e[5]=b,e[6]=G,e[7]=o==null?void 0:o.id,e[8]=A,e[9]=g,e[10]=$,e[11]=j):($=e[10],j=e[11]);const{canReportMessage:D,handleReportMessage:Q}=j,{imageGenMessages:M,enableImageGenPostSharing:J,enableMessageSliceSharing:de,hasErrorInTurn:z,isIncomplete:Te}=mr(c),ve=hr.useSelectedIndex();let Ae;e[12]!==c?(Ae=c.filter(hi).filter(Cd),e[12]=c,e[13]=Ae):Ae=e[13];const Pe=Ae.length>0,ie=M.length>0,Rs=pi(),xs=fi(),Is=Ca();let W;e[14]!==b?(W=()=>vi(bi(b)),e[14]=b,e[15]=W):W=e[15];const ls=Ve(W);let ke;e[16]!==o?(ke=o!=null&&st.getAudioAssetPointers(o).length>0,e[16]=o,e[17]=ke):ke=e[17];const ce=ke;let ue;e[18]!==(o==null?void 0:o.id)?(ue=ne=>Ir(ne,o==null?void 0:o.id),e[18]=o==null?void 0:o.id,e[19]=ue):ue=e[19];const ds=_e(s,ue);let ts;e[20]!==ie||e[21]!==Pe||e[22]!==M?(ts=ie&&!Pe&&M.some(Fn),e[20]=ie,e[21]=Pe,e[22]=M,e[23]=ts):ts=e[23];const Ne=ts,cs=$!=null&&!z&&!Te&&!L&&q&&!xs&&!d&&!ls&&!oe,us=$!=null&&!z&&!Te&&!L&&q&&!xs&&!d&&!ds&&!Is&&!oe;let ye=null;if(cs){if(J||de){const ne=(qe=M[ve])==null?void 0:qe.id,te=S==null?void 0:S.id;let R;e[24]!==s||e[25]!==c||e[26]!==ne||e[27]!==te?(R=n.jsx(xd,{clientThreadId:s,imageGenMessageId:ne,messages:c,parentPromptId:te}),e[24]=s,e[25]=c,e[26]=ne,e[27]=te,e[28]=R):R=e[28],ye=R}else if(Rs&&rt(b,"1547743984").get("show_share_button_inline",!1)){let ne;e[29]!==$?(ne=()=>{$&&xi.openSharingModal($)},e[29]=$,e[30]=ne):ne=e[30];let te;e[31]!==N?(te=N.formatMessage({id:"ConversationTurn.shareButtonTooltip",defaultMessage:"Share conversation"}),e[31]=N,e[32]=te):te=e[32];let R;e[33]!==ne||e[34]!==te?(R=n.jsx(rs,{onClick:ne,label:te,className:"sm:hidden",icon:Ma}),e[33]=ne,e[34]=te,e[35]=R):R=e[35],ye=R}}if(o&&tt(o)&&!Fn(o))return null;const ge=d?"small":"med",$e=!!(I&&o&&$&&(ce||!Is));let se;e[36]!==t||e[37]!==u||e[38]!==m||e[39]!==C?(se=C&&n.jsx(wa,{currentPage:t,onChangeIndex:m,length:u}),e[36]=t,e[37]=u,e[38]=m,e[39]=C,e[40]=se):se=e[40];let Be;e[41]!==ge||e[42]!==s||e[43]!==b||e[44]!==Ne||e[45]!==B||e[46]!==T||e[47]!==V||e[48]!==v?(Be=T&&!Ne&&n.jsx(Fa,{size:ge,onClick:ne=>{Ea(b,s,v,V,ne,"mouse",B)}}),e[41]=ge,e[42]=s,e[43]=b,e[44]=Ne,e[45]=B,e[46]=T,e[47]=V,e[48]=v,e[49]=Be):Be=e[49];let De;e[50]!==ge||e[51]!==ee||e[52]!==ie||e[53]!==N||e[54]!==x||e[55]!==f?(De=f&&!ie&&n.jsxs(n.Fragment,{children:[ee!=="thumbsDown"&&n.jsx(rs,{size:ge,onClick:()=>x("thumbsUp"),selected:ee==="thumbsUp",icon:ee==="thumbsUp"?pr:fr,label:N.formatMessage({id:"ConversationTurn.goodResponseTooltip",defaultMessage:"Good response"}),testId:"good-response-turn-action-button"}),ee!=="thumbsUp"&&n.jsx(rs,{size:ge,onClick:()=>x("thumbsDown"),selected:ee==="thumbsDown",icon:ee==="thumbsDown"?vr:br,label:N.formatMessage({id:"ConversationTurn.badResponseTooltip",defaultMessage:"Bad response"}),testId:"bad-response-turn-action-button"})]}),e[50]=ge,e[51]=ee,e[52]=ie,e[53]=N,e[54]=x,e[55]=f,e[56]=De):De=e[56];let Re;e[57]!==o||e[58]!==H?(Re=!1,e[57]=o,e[58]=H,e[59]=Re):Re=e[59];let Me;e[60]!==s||e[61]!==Se||e[62]!==v?(Me=!1,e[60]=s,e[61]=Se,e[62]=v,e[63]=Me):Me=e[63];let Ue;e[64]!==ge||e[65]!==s||e[66]!==r||e[67]!==ie||e[68]!==o||e[69]!==c||e[70]!==S||e[71]!==h?(Ue=h&&o&&n.jsx(bd,{clientThreadId:s,conversationMode:r,lastMessage:o,messages:c,hasImageGenMessage:ie,parentPrompt:S,size:ge}),e[64]=ge,e[65]=s,e[66]=r,e[67]=ie,e[68]=o,e[69]=c,e[70]=S,e[71]=h,e[72]=Ue):Ue=e[72];let me;e[73]!==D||e[74]!==us||e[75]!==s||e[76]!==Q||e[77]!==ie||e[78]!==Pe||e[79]!==M||e[80]!==oe||e[81]!==d||e[82]!==P||e[83]!==ce||e[84]!==o||e[85]!==c||e[86]!==(S==null?void 0:S.id)||e[87]!==fe||e[88]!==ve||e[89]!==l||e[90]!==I||e[91]!==y||e[92]!==v?(me=!d&&n.jsx(xr,{showPlayButton:!!(I&&o&&(Pe||ce)),showCanvasButton:!ie&&l,showBranchButton:us,canShowScheduleButton:!P&&!oe,turnIndex:v,clientThreadId:s,messages:c,imageGenMessageId:(Ke=M[ve])==null?void 0:Ke.id,lastMessage:o,turn:y,requestId:fe,parentPromptId:S==null?void 0:S.id,showReportMessageButton:D,onReportMessage:Q}),e[73]=D,e[74]=us,e[75]=s,e[76]=Q,e[77]=ie,e[78]=Pe,e[79]=M,e[80]=oe,e[81]=d,e[82]=P,e[83]=ce,e[84]=o,e[85]=c,e[86]=S==null?void 0:S.id,e[87]=fe,e[88]=ve,e[89]=l,e[90]=I,e[91]=y,e[92]=v,e[93]=me):me=e[93];let ze;return e[94]!==o||e[95]!==$||e[96]!==ye||e[97]!==$e||e[98]!==se||e[99]!==Be||e[100]!==De||e[101]!==Re||e[102]!==Me||e[103]!==Ue||e[104]!==me?(ze=n.jsxs(_r,{enable:$e,lastMessage:o,serverThreadId:$,children:[se,Be,De,Re,ye,Me,Ue,me]}),e[94]=o,e[95]=$,e[96]=ye,e[97]=$e,e[98]=se,e[99]=Be,e[100]=De,e[101]=Re,e[102]=Me,e[103]=Ue,e[104]=me,e[105]=ze):ze=e[105],ze},vd=i=>{"use forget";const e=es.c(35),{activeVariantIndex:t,clientThreadId:s,numVariants:r,onAnticipateEdit:o,onChangeIndex:c,onEnterEdit:u,showCopyButton:m,showEditMessageButton:x,showPagination:l,turnIndex:T,reportableMessageId:C,reportableMessageAuthoredByCurrentUser:I,isSharedConversation:f,serverThreadIdForReporting:h}=i,y=f===void 0?!1:f,v=bs(),S=ba(),L=ua(),P=ks(),A=I!=null?I:!1,F=h!=null?h:null;let g;e[0]!==s||e[1]!==v||e[2]!==y||e[3]!==C||e[4]!==A||e[5]!==F?(g=ja({ctx:v,clientThreadId:s,messageId:C,isSharedConversation:y,isAuthoredByCurrentUser:A,serverThreadId:F}),e[0]=s,e[1]=v,e[2]=y,e[3]=C,e[4]=A,e[5]=F,e[6]=g):g=e[6];const{canReportMessage:H,handleReportMessage:G}=g;let b;e[7]!==v?(b=mi(v),e[7]=v,e[8]=b):b=e[8];const N=b;let V;e[9]!==s||e[10]!==v||e[11]!==L||e[12]!==m||e[13]!==N||e[14]!==S||e[15]!==T?(V=m&&n.jsxs(n.Fragment,{children:[N&&!1,n.jsx(Fa,{onClick:k=>{Ea(v,s,T,S,k,"mouse",L)}})]}),e[9]=s,e[10]=v,e[11]=L,e[12]=m,e[13]=N,e[14]=S,e[15]=T,e[16]=V):V=e[16];let B;e[17]!==H||e[18]!==G||e[19]!==P?(B=H&&n.jsx(rs,{icon:gr,onClick:k=>{k.stopPropagation(),G()},label:P.formatMessage({id:"ConversationTurn.reportMessageTooltip",defaultMessage:"Report message"}),testId:"report-message-turn-action-button"}),e[17]=H,e[18]=G,e[19]=P,e[20]=B):B=e[20];let d;e[21]!==o||e[22]!==u||e[23]!==x?(d=x&&n.jsx(Cr,{onAnticipateEdit:o,onEnterEdit:u}),e[21]=o,e[22]=u,e[23]=x,e[24]=d):d=e[24];let O;e[25]!==t||e[26]!==r||e[27]!==c||e[28]!==l?(O=l&&n.jsx(wa,{currentPage:t,onChangeIndex:c,length:r}),e[25]=t,e[26]=r,e[27]=c,e[28]=l,e[29]=O):O=e[29];let q;return e[30]!==V||e[31]!==B||e[32]!==d||e[33]!==O?(q=n.jsxs(n.Fragment,{children:[V,B,d,O]}),e[30]=V,e[31]=B,e[32]=d,e[33]=O,e[34]=q):q=e[34],q},bd=i=>{"use forget";const e=es.c(16),{clientThreadId:t,conversationMode:s,messages:r,hasImageGenMessage:o,lastMessage:c,parentPrompt:u,size:m}=i,x=m===void 0?"med":m,l=_i();let T;e[0]!==t||e[1]!==s?(T={clientThreadId:t,conversationMode:s},e[0]=t,e[1]=s,e[2]=T):T=e[2];const C=Ii(T),I=Sr(t,c),f=je(l,"633080887");let h;e[3]!==c||e[4]!==C?(h=S=>{const{sourceEvent:L,requestedModelId:P,appendMessages:A,extraStreamParams:F}=S;c&&C({sourceEvent:L,nodeId:c.id,requestedModelId:P,appendMessages:A,extraStreamParams:F})},e[3]=c,e[4]=C,e[5]=h):h=e[5];const y=h;let v;return e[6]!==I||e[7]!==t||e[8]!==o||e[9]!==c||e[10]!==r||e[11]!==y||e[12]!==u||e[13]!==f||e[14]!==x?(v=o&&!f?n.jsx(hd,{messages:r,onModelSelect:y}):n.jsx(Ar,{className:"text-token-text-secondary hover:bg-token-bg-secondary touch:px-2.5 h-[30px] rounded-md px-1.5",clientThreadId:t,lastMessage:c,onModelSelect:y,canRegenerateResponse:I,parentPrompt:u,size:x,hasImageGenMessage:o,messages:r}),e[6]=I,e[7]=t,e[8]=o,e[9]=c,e[10]=r,e[11]=y,e[12]=u,e[13]=f,e[14]=x,e[15]=v):v=e[15],v},Fa=i=>{"use forget";const e=es.c(10),{onClick:t,size:s}=i,r=s===void 0?"med":s,[o,c]=_.useState(!1),u=Tr(),m=ks();let x;e[0]!==u||e[1]!==t?(x=f=>{f.stopPropagation(),Fe.logEvent("ChatGPT Turn Action Copy Clicked"),t(f),c(!0),setTimeout(()=>{u()&&c(!1)},2e3),Si.logEvent("chatgpt_turn_action_copy")},e[0]=u,e[1]=t,e[2]=x):x=e[2];const l=x,T=o?yr:Mr;let C;e[3]!==m?(C=m.formatMessage({id:"CopyButton.copyTooltip",defaultMessage:"Copy"}),e[3]=m,e[4]=C):C=e[4];let I;return e[5]!==l||e[6]!==r||e[7]!==T||e[8]!==C?(I=n.jsx(rs,{icon:T,onClick:l,label:C,testId:"copy-turn-action-button",size:r}),e[5]=l,e[6]=r,e[7]=T,e[8]=C,e[9]=I):I=e[9],I};function xd(i){"use forget";var A;const e=es.c(21),{clientThreadId:t,imageGenMessageId:s,messages:r,parentPromptId:o}=i,[c,u]=_.useState(!1),m=ks();let x;e:{if(s){x="media_generation";break e}x="message_slice"}const l=x;let T;e[0]!==r?(T=(A=r==null?void 0:r.map(_d))!=null?A:void 0,e[0]=r,e[1]=T):T=e[1];const C=T;let I;e[2]!==t||e[3]!==s||e[4]!==C||e[5]!==o?(I={clientThreadId:t,imageGenMessageId:s,messageSliceIds:C,parentPromptId:o},e[2]=t,e[3]=s,e[4]=C,e[5]=o,e[6]=I):I=e[6];const f=wr(I);let h,y;e[7]!==l?(h=()=>{Fe.logEvent("Share Post: Share Button Shown",{source:"turn_action",attachment_type:l})},y=[l],e[7]=l,e[8]=h,e[9]=y):(h=e[8],y=e[9]),_.useEffect(h,y);let v;e[10]!==l||e[11]!==s||e[12]!==f?(v=()=>{u(!0),Er(async()=>{await f()},Id,()=>{u(!1)}),Fe.logEventWithStatsig("Share Post: Share Button Clicked","chatgpt_post_share_button_clicked",ae({source:"turn_action",attachment_type:l},s?{message_id:s}:{}))},e[10]=l,e[11]=s,e[12]=f,e[13]=v):v=e[13];let S;e[14]!==m?(S=m.formatMessage({id:"ConversationTurn.sharePostButtonTooltip",defaultMessage:"Share"}),e[14]=m,e[15]=S):S=e[15];const L=c?Ci:Ma;let P;return e[16]!==c||e[17]!==v||e[18]!==S||e[19]!==L?(P=n.jsx(rs,{onClick:v,label:S,icon:L,disabled:c}),e[16]=c,e[17]=v,e[18]=S,e[19]=L,e[20]=P):P=e[20],P}function Id(){}function _d(i){return i.id}function Cd(i){return i.recipient==="all"}const Sd=We(()=>Ze(()=>import("./lthry6zonu767sy8.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])).then(i=>i.MemoryActionResult)),Td=We(()=>Ze(()=>import("./hhinqbyeydy6ylpd.js"),__vite__mapDeps([11,1,2,3,12,4,5])).then(i=>i.AutomationSourceHeader)),ia=We(()=>Ze(()=>import("./j0xewpby56axy54p.js"),__vite__mapDeps([13,1,2,3,14,4,5])).then(i=>i.TextMessageEditor)),yd=We(()=>Ze(()=>import("./cwhbtosecjtdlg02.js"),__vite__mapDeps([15,1,2,3,4,5,16,17,18,19,20])).then(i=>i.ChatScreenRetrievalResultsFlyoutContent)),ra=80,Ys=16;function Zs(){return{minHeight:"calc(100dvh - ".concat(Hl,"px - 120px)")}}function Md(i){"use no forget";var jt,Ft,Nt,Bt,Dt,Ut,Gt,Ot,Vt,Lt,Ht,Wt,$t,zt,qt,Kt,Qt,Jt,Xt,Yt,Zt,en,sn,tn,nn,an,on,rn,ln,dn,cn,un,gn,mn,hn,pn,fn,vn,bn,xn;const{turnIndex:e,isFinalTurn:t,conversation:s,onRequestCompletion:r,scrollToMessageId:o,scrollToMessageIsAssistant:c,dateHeaderType:u,hideUserActions:m,disableHorizontalPadding:x}=i,l=bs(),T=Aa(l),C=Ti(),I=_a(),f=xa(a=>it(a)),h=yi(l),y=!!C&&Mi(C),v=Nn(Bn.isBusinessWorkspace),S=Pr(),L=kr(l)||S,P=Rr(l),A=jr(l),{eligible:F}=Fr(Nr.hasSeenAudioParagenPrompt),[g,H,G]=_e(s.id,a=>{const p=K.getConversationTurnAtIndex(a,e),w=e>0?K.getConversationTurnAtIndex(a,e-1):null,E=(w==null?void 0:w.role)===Z.User&&w.messages.some(re=>{var X;return(X=re.metadata)==null?void 0:X.visually_hide_response_from_conversation});return[p,E,w]},{disablePerfDetector:t}),{messages:b,messageGroups:N}=g,V=Br(a=>a.size===0?-1:N.findIndex(p=>p.type===Js?p.groups.some(w=>w.messages.some(E=>a.has(E==null?void 0:E.id))):p.messages.some(w=>a.has(w==null?void 0:w.id)))),B=b[0],d=U(b),O=_.useMemo(()=>Dn(b,a=>wi(a).length>0),[b]),q=_.useMemo(()=>N.some(a=>a.type===Ei.SearchGPTQuery),[N]),k=_.useMemo(()=>b.some(a=>{var p;return(p=a.metadata)==null?void 0:p.n7jupd_message}),[b]),Se=_.useMemo(()=>{var a,p;return(p=(a=U(b))==null?void 0:a.metadata)==null?void 0:p.chatgpt_sdk_suppressed_response},[b]),oe=_.useMemo(()=>k?Dn(b,a=>a.author.name==="n7jupd.metadata"):null,[b,k]),ee=!!((jt=oe==null?void 0:oe.metadata)!=null&&jt.kaur1br5_mode),fe=_e(s.id,a=>!!(a!=null&&a.pulseCardId)),$=Ve(()=>Pa(l).isFeedbackViewOpen$()||fe&&e===1),{messages:j,visibleMessages:D,messageGroups:Q,lastMessageToRender:M}=_.useMemo(()=>{const a=V!==-1&&V+1<N.length,p=a?N.slice(0,V+1):N,w=a?p.flatMap(E=>E.type===Js?E.groups.flatMap(re=>re.messages):E.messages):b;return{messages:w,visibleMessages:w.filter(Ai),messageGroups:p,lastMessageToRender:U(w)}},[b,N,V]),J=V!==-1,de=je(l,"1887864177"),z=_e(s.id,a=>K.getLastMessageSystemHints(a)),Te=_e(s.id,a=>{var p;return(p=a==null?void 0:a.hasIKConvo)!=null?p:!1}),ve=(z==null?void 0:z.includes(fs.Tatertot))&&je(l,"28816792")&&Pi(l),{capabilitySuggestionsEnabled:Ae}=Dr(ve),ss=_.useMemo(()=>({clientThreadId:s.id,turnIndex:e,messageId:d==null?void 0:d.id}),[s.id,e,d==null?void 0:d.id]),[Pe,ie]=_.useState(!1),[Rs,xs]=_.useState(!1),Is=_.useContext(Ur)!=null,W=g.role===Z.User,ls=Ca(),ke=ki(s.id),ce=(Ft=g.gizmoId)!=null?Ft:ke,ue=Ri(ce).data,ds=ce&&!Un(ce)?ue:void 0,ts=ds&&g.gizmoId!=null&&g.gizmoId!==ke&&je(l,"1418300125"),Ne=Ve(()=>ji(s)),cs=Ne.id,us=Fi(s.id),ye=Gr(Ne),ge=Or(Ne,us),$e=Ni(l),[se,Be,De,Re,Me,Ue,me,ze,_s,gs,ns,he,qe,Ke,ne,te,R,Na]=_e(s.id,a=>{var In,_n,Cn,Sn,Tn;const p=K.getParentPromptNode(a,B.id),w=(Sn=(In=p==null?void 0:p.message.clientMetadata)==null?void 0:In.variantsInStreamInfo)!=null?Sn:(_n=p==null?void 0:p.message.metadata)!=null&&_n.paragen_variant_choice||(Cn=p==null?void 0:p.message.metadata)==null?void 0:Cn.paragen_variants_info,E=K.getVariantIds(a,B.id),re=K.getCurrentVariantId(a,B.id),X=re?E.indexOf(re):0,Y=w&&(a==null?void 0:a.tree)!=null&&E.some(Ie=>{var Mn;const{errType:yn}=(Mn=a.tree.getLeafFromNode(Ie).message.clientMetadata)!=null?Mn:{};return yn!=null&&yn!=="info"}),le=K.getConversationTurns(a),Ee=le.findIndex(Ie=>Ie.role===Z.Assistant),Ks=Ln(le,Ie=>Ie.role===Z.Assistant),ti=le.slice(Ee,e+1).every(Ie=>Ie.role===Z.Assistant);return[p,d!=null&&!tr(d.id)&&K.isMessageTurnEnded(a,d.id),Y,Wl(a==null?void 0:a.mode,ue==null?void 0:ue.gizmo.id),le.findIndex(Ie=>Ie.role===Z.User)===e,Ln(le,Ie=>Ie.role===Z.User)===e,Ee===e,Ks===e,ti,K.getRequestId(a,d==null?void 0:d.id),w,E,X,!!(a!=null&&a.continuingFromSharedPostId),a==null?void 0:a.currentLeafId,K.getSuperWidgetMessages(a,e)[0],K.lastUserMessage(a),(Tn=a==null?void 0:a.continuingFromSharedProjectConversationId)!=null?Tn:null]},{disablePerfDetector:t}),Qe=Ta(),Cs=Ve(()=>{const a=Bi(s);return(a==null?void 0:a.value)===is.STREAMING||(a==null?void 0:a.value)===is.REALTIME||(a==null?void 0:a.value)===is.REALTIME_BUSY}),Ba=j.some(a=>a.content.content_type===Di.MultimodalText),Da=rt(l,"3119715334").get("should-enable-skip",!1),lt=!Ia(),dt=g.messages.map(a=>a.id),be=_.useRef(null);wd({clientThreadId:s.id,turn:g,turnIndex:e,conversationTurnWrapperRef:be});const js=!T&&((Nt=o==null?void 0:o.length)!=null?Nt:0)>2&&o!=="finalAgentTurn"&&t,pe=W?U(D):void 0,Fs=pe==null?void 0:pe.id,Ua=_.useCallback(()=>{Fs&&(Fe.logEvent("Edit Prompt",{id:Fs,threadId:Ye(s.id)}),Ps(l,"chatgpt_edit_prompt"),ie(!0))},[l,Fs,s.id]),Ga=_.useCallback(()=>{ie(!1)},[]),{onChangeRating:Oa}=Vr({clientThreadId:s.id,currentModelConfig:Ne}),Va=a=>{var re;if(!d)return;const p=(re=d.clientMetadata)==null?void 0:re.rating,E=(p==="thumbs_up"?"thumbsUp":p==="thumbs_down"?"thumbsDown":p)===a?null:a;if(Oa({nodeId:d.id,messageId:d.id,rating:E}),E){const X=Zi(()=>er(l)),Y=X&&N.some(le=>{var Ee;return le.type!==Js&&((Ee=le.messages)==null?void 0:Ee.some(sr))});Fe.logEventWithStatsig(E==="thumbsDown"?"Message Feedback Thumbs Down Clicked":"Message Feedback Thumbs Up Clicked","chatgpt_thumb_feedback",ae(ae({id:d.id,threadId:Ye(s.id),model:cs,rating:E},X?{isCATriggered:Y}:{}),f?{isSidebar:!0}:{}))}xs(E==="thumbsDown")},[La]=_.useState(()=>Date.now()),we=Ui(s.id),Ha=we!=null?we:null,ct=(Dt=we!=null?we:Na)!=null?Dt:Qe&&(Bt=s.sharedConversationId)!=null?Bt:null,Ns=(Ut=Lr(s.id))==null?void 0:Ut.value,ut=Ns===is.STREAMING,Wa=Ns===is.REALTIME||Ns===is.REALTIME_BUSY,$a=gs!=null,za=ma(gs),qa=$n.useState(a=>$n.isReplayInProgress(a,ne)),xe=!Be&&za||J||ut||Wa||qa&&t||b.some(a=>Hr(a)),Ka=ha(),Bs=_.useRef(!1),gt=_.useRef(void 0),Qa=Gi({clientThreadId:s.id}),Ja=Wr(s.id,d)&&!Qa&&!!we,[,Xa]=ri(),{isOpen:Ss}=nt(),mt=ya(),as=U(G==null?void 0:G.messages.filter(Oi)),ht=Ve(()=>Vi(l)),Ds=$r({conversation:s,threadContent:(Gt=te==null?void 0:te.content)!=null?Gt:null,query:as?Xs(as):null,triggeredSearch:q,messageGroups:Q,allMessages:b,isAdultSearchEnabled:ht}),{isClassifiedAdult:pt,isSafeSearchOff:Ya}=Ds,[Za,Us]=Ve(()=>[Li(l)&&me&&(!z||z.length===0||z.includes(fs.Search))&&!pt,h&&g.role===Z.Assistant&&pt&&Ya&&ht]),Je=(Za||Us)&&Ds.showNavlinksWidget,Gs=j.filter(Gn),eo=Je&&Gs.length===0&&!k,ft=((Ot=R==null?void 0:R.author.metadata)==null?void 0:Ot.real_author)==="onboarding";_.useEffect(()=>{const p=new URLSearchParams(window.location.search).get("message");!(p!=null&&dt.includes(p))||!be.current||(be.current.scrollIntoView({behavior:"instant"}),Xa(E=>(E.delete("message"),E),{replace:!0,preventScrollReset:!0}))},[]),_.useEffect(()=>{o!==gt.current&&(Bs.current=!1,gt.current=o)},[o]),_.useEffect(()=>{if(T)return;const w=new URLSearchParams(window.location.search).get("message")!=null;if(Bs.current||w||o===void 0||!be.current||mt||ft||h&&me){o==="finalAgentTurn"&&t&&He(s.id,E=>{E.scrollToMessageId=void 0});return}(dt.includes(o)||o==="finalAgentTurn"&&t)&&(Bs.current=!0,requestAnimationFrame(()=>{requestAnimationFrame(()=>{var E,re;if(be.current)if(o==="finalAgentTurn"&&t){const X=vs(s.id),Y=(E=X==null?void 0:X.tree.getNodeIfExists(X.currentLeafId))==null?void 0:E.message,Ee=!!((Y==null?void 0:Y.channel)=="final"&&((re=Y.metadata)!=null&&re.mercury_message))?"start":"end";be.current.scrollIntoView({behavior:"instant",block:Ee}),He(s.id,Ks=>{Ks.scrollToMessageId=void 0})}else{const X=be.current.offsetHeight;let Y=0;Ss?Y=-8:h?Y=-1*Ys:c?Y=-8:X>ra&&(Y=ra-X);const le=zr(s).pinnedWidgetHeight$();le!=null&&(Y+=le+Ys),be.current.style.scrollMarginTop="".concat(Y+Ys,"px"),be.current.scrollIntoView({behavior:"smooth"})}})}))},[o,c,be.current,Ss,mt,ft,h,me]);const{showDebugConversationTurns:so}=fa(),to=!Qe&&!Ke&&!ls&&!W,no=(M==null?void 0:M.author.role)===Z.Assistant?M:null,ao=(Lt=(Vt=M==null?void 0:M.metadata)==null?void 0:Vt.system_hints)==null?void 0:Lt.includes(fs.Research),oo=(Wt=(Ht=M==null?void 0:M.metadata)==null?void 0:Ht.system_hints)==null?void 0:Wt.includes(fs.Agent);qr({isCompletionRequestInProgress:xe,isUserTurn:W,message:no});const{isOpen:io}=nt(),ro=Kr(l),Ts=Qr(Re),lo=Hi(a=>a.voiceFeedbackThread),vt=we===lo,co=($t=d==null?void 0:d.metadata)==null?void 0:$t.async_source,ys=t&&$a,Ge=Cs||xe||ut,uo=D.length===0&&j.some(Wi),go=((zt=Jr(D))==null?void 0:zt.author.name)===On.A8KM123&&Xr(D,a=>a.author.name===On.A8KM123||a.channel==="commentary"||a.author.role===Z.Developer),mo=Yr.useIsMultigenParagenVotingActive(),ho=_.useMemo(()=>j.some(a=>{var p,w,E;return a.author.name==="api_tool.call_tool"&&((E=(w=(p=a.metadata)==null?void 0:p.chatgpt_sdk)==null?void 0:w.resource_name)==null?void 0:E.includes("cocoon"))}),[j]),Os=!Pe&&!ho&&!j.every($i)&&!Qe&&!Ke&&!Ts&&!io&&g.role!==Z.Developer&&!(g.role===Z.User&&m)&&!(t&&vt&&Ge)&&!(ys&&Ge)&&!(t&&Cs&&co)&&!(Ge&&k)&&!(go&&!t)&&!((qt=d==null?void 0:d.metadata)!=null&&qt.is_auto_proceed_message)&&!((Kt=d==null?void 0:d.metadata)!=null&&Kt.is_takeover_ended_message)&&!((Qt=d==null?void 0:d.metadata)!=null&&Qt.disable_turn_actions)&&!((Jt=d==null?void 0:d.clientMetadata)!=null&&Jt.isOptimisticPlaceholder)&&!eo&&!g.userContinuationSuccessorTurnId&&!Se&&!mo,po=!Os&&!(ys&&Ge)&&(Qe||Ke)&&!f,fo=j.some(a=>zi(a)===qi.l1239dk1),Vs=_e(s.id,a=>{var E,re;const p=new Set,w=K.getParentPromptNode(a,B.id);return(re=(E=w==null?void 0:w.message.metadata)==null?void 0:E.attachments)==null||re.forEach(X=>{var Y,le,Ee;(Y=X.mime_type)!=null&&Y.startsWith("image/")||p.add((Ee=(le=X.context_connector_info)==null?void 0:le.context_connector)!=null?Ee:"file")}),p}),Ls=Ki(),Hs=Vn(l,"110789670");let Xe;Ls.isLoading?Xe=void 0:Ls.canUpgradeGDrive&&Vs.has(As.GDRIVE)&&Hs.get("enabled",!1)?Xe=As.GDRIVE:Ls.canUpgradeSharepoint&&Vs.has(As.O365_BUSINESS)&&Hs.get("enabled",!1)?Xe=As.O365_BUSINESS:Vs.has("file")&&Hs.get("enabled",!1)&&(Xe="general");const vo=(M==null?void 0:M.author.role)===Z.Assistant&&((Zt=(Yt=(Xt=M==null?void 0:M.metadata)==null?void 0:Xt.content_references)==null?void 0:Yt.length)!=null?Zt:0)>0||Te,bo=ys&&!xe&&!f&&!Qe&&!Ke&&!fo&&(de||Zr(l)||Ae||ve||!!Xe),ms=d!=null&&(!v||ge||y||$e)&&!Ts&&!lt&&!ls&&!((en=d.metadata)!=null&&en.b1de6e2_s),bt=Cs||xe,[xo,Io]=_.useState(!1),_o=!!((sn=R==null?void 0:R.metadata)!=null&&sn.dictation&&((tn=R==null?void 0:R.metadata)!=null&&tn.dictation_asset_pointer)&&!((nn=R==null?void 0:R.metadata)!=null&&nn.dictation_edited)),Co=!!(!F||xo||(an=R==null?void 0:R.metadata)!=null&&an.audio_paragen_result||zn(R==null?void 0:R.id)),xt=_o&&!Co,It=xt&&(!v||$e)&&ms&&!bt&&!f&&!Ss&&R!=null&&me&&je(l,"51772912"),So=el(R==null?void 0:R.id,It),_t=It&&So,hs=!Ts&&to&&t&&(ns==null?void 0:ns.num_variants_in_stream)===2&&he.length<=2&&!((on=d==null?void 0:d.clientMetadata)!=null&&on.inlineComparisonRating)&&!De&&!xt&&!zn(R==null?void 0:R.id),To=!_t&&(!v||$e)&&ms&&(ys||t&&vt)&&!bt&&!f&&!Ss&&!k&&!Se,Ct=!((xe||Cs)&&t)&&he.length>1&&!hs,St=W&&j.some(a=>{var p;return(p=qn(a))==null?void 0:p.shouldHideContent}),yo=W&&pe!=null&&!((rn=pe==null?void 0:pe.metadata)!=null&&rn.async_task_id)&&we!=null&&!Ts&&!Ba&&!St&&!lt&&!ao&&!oo&&!f,Mo=d!=null&&st.getAudioAssetPointers(d).length>0,wo=d!=null&&((dn=(ln=d.clientMetadata)==null?void 0:ln.disclaimers)!=null?dn:[]).length===0&&!f&&(!ls||Mo)&&!I,Tt=_.useCallback(a=>{var p;He(s.id,w=>{ot.setCurrentBranch(w,he[a])}),Fe.logEvent("Change Active Node",{intent:"toggle_between"}),je(l,"4126691920")&&sl({parent_prompt_id:(p=se==null?void 0:se.id)!=null?p:"",prev_branch_id:he[qe],next_branch_id:he[a]},Ye(s.id))},[s.id,he,qe,se==null?void 0:se.id,l]),Eo=Nn(Bn.accountUserId),Ms=_e(s.id,a=>a==null?void 0:a.sharedProjectConversationOwner),Ao=!Qi(l,ce)||(Ms==null?void 0:Ms.id)!=null&&Ms.id===Eo,yt=tl(g,j,so),Mt=k&&nl(j,t),ws=d==null?void 0:d.id,Ws=_.useCallback(()=>{ws&&al(s,{type:"retrievalResults",turnIndex:e,messageId:ws})},[s,ws,e]),os=j.some(a=>{var p,w,E;return((p=a==null?void 0:a.metadata)==null?void 0:p.api_tool_type)==="glaux"||Ji({id:(E=(w=a==null?void 0:a.metadata)==null?void 0:w.model_slug)!=null?E:""},l)}),$s=_.useMemo(()=>ol(g,ye,ce),[g,ye,ce]),Po=_.useMemo(()=>$s&&!os,[$s,os]),ko=_.useMemo(()=>il(g,ce,P),[P,ce,g]),wt=je(l,"2137702454"),Ro=_.useMemo(()=>g.role!==Z.User&&ye&&wt&&!os,[g,ye,wt,os]),jo=Xi()&&CSS.supports("content-visibility: auto")&&!W&&Vn(l,"1011775750").get("enabled",!1)&&(o==null||o==="finalAgentTurn")&&!rl(j),Fo=_.useMemo(()=>j.some(a=>{var p;return((p=qn(a))==null?void 0:p.canRetry)===!1}),[j]),No=(cn=d==null?void 0:d.metadata)==null?void 0:cn.n7jupd_button_type,Bo=k&&d!=null&&d.id!=null&&!No,Do=k&&t&&Ge,Uo=k&&t;if(!yt&&!hs&&!Je)return js?n.jsx("div",{style:Zs()}):null;if(Mt||H)return null;const Go=(un=M==null?void 0:M.metadata)!=null&&un.followup_prompts?M.metadata.followup_prompts.map(a=>({text:a,type:ll.Reply})):[],Oo=(gn=M==null?void 0:M.metadata)==null?void 0:gn.category_suggestions,Vo=(mn=M==null?void 0:M.metadata)==null?void 0:mn.action_suggestions,Lo=!j.some(a=>st.getAudioAssetPointers(a).length>0)&&(!ke||Un(ke))&&!Fo&&!I&&!$&&!!we,Ho=!xe&&j.some(a=>{var p,w;return a.author.role===Z.Assistant&&((w=(p=a.metadata)==null?void 0:p.onboarding)==null?void 0:w.main_usages)});se==null||se.message.id;const zs=j.find(a=>{var p,w;return!!((w=(p=a.metadata)==null?void 0:p.onboarding)!=null&&w.examples)}),qs=(pn=(hn=zs==null?void 0:zs.metadata)==null?void 0:hn.onboarding)==null?void 0:pn.examples,Et=!St&&(!t||!xe);if(!t&&Gs.length===0&&!k&&!Je)return null;let ps="none";W&&Me&&(ps="first");const Wo=G==null?void 0:G.messages.some(Gn);if(W&&!Me&&(Wo?ps="large":ps="none"),t&&(ps="last"),!yt&&!hs&&!Je)return js?n.jsx("div",{style:Zs()}):null;if(Mt||H)return null;const At=h?dl(b):void 0;if(!t&&Gs.length===0&&!k&&!Je)return null;const $o=(()=>{if(g.userContinuationSuccessorTurnId)return"mb-1";if(W&&!Os&&!f)return"mb-10";if(!W&&f&&t)return"pb-[40px]"})(),Pt=cl(b),zo=ul(b),qo=gl(b),Ko=b.some(ml),Qo=b.some(hl),Jo=b.some(pl),Xo=!!Pt,kt=ze&&Ko&&!Jo,Rt=kt&&!Qo&&!Xo,Yo=kt&&!!Pt,Zo=je(l,"1480635292"),ei=Rt&&Zo&&qo.length>0,si=Rt&&zo.length>0||Yo;return n.jsx(fl.Provider,{value:me,children:n.jsxs(vl,{children:[n.jsx(bl,{dateHeaderType:u,turn:g}),n.jsxs("article",{className:Ce("text-token-text-primary w-full focus:outline-none","[--shadow-height:45px] has-data-writing-block:pointer-events-none has-data-writing-block:-mt-(--shadow-height) has-data-writing-block:pt-(--shadow-height) [&:has([data-writing-block])>*]:pointer-events-auto",jo&&"[content-visibility:auto] supports-[content-visibility:auto]:[contain-intrinsic-size:auto_100lvh]",!T&&o==="finalAgentTurn"?"opacity-0":"",{hidden:Is&&Me},W?"scroll-mt-(--header-height)":"scroll-mt-[calc(var(--header-height)+min(200px,max(70px,20svh)))]"),tabIndex:-1,style:js?Zs():void 0,ref:be,dir:"auto","data-turn-id":g.id,"data-testid":"conversation-turn-".concat(e),"data-scroll-anchor":!T&&t,"data-turn":W?"user":"assistant",children:[n.jsx(xl,{role:g.role,gizmo:ds}),n.jsx(Il,{role:g.role,children:n.jsxs(_l,{horizontalPadding:hs||x?"none":"standard",verticalPadding:ps,children:[hs?n.jsxs(n.Fragment,{children:[n.jsx(ud,ae({isFeedbackEnabled:ms,variantIds:he,conversationTurnMountTime:La,currentModelId:cs},i)),Da&&n.jsx("div",{className:"mt-4 flex w-full justify-center",children:n.jsxs(pa,{color:"secondary",className:"text-token-text-primary","data-testid":"paragen-skip-button",onClick:()=>{va.publish({kind:"requestCompletion",isForSkippingParagen:!0})},children:[n.jsx(Cl,{className:"text-token-text-secondary me-1"}),n.jsx(Le,{id:"IuTr+b",defaultMessage:"Skip"})]})})]}):n.jsxs(ka,{tabIndex:-1,className:Ce("group/turn-messages focus-visible:outline-hidden",Je&&"super-widget-visible",$o,Gl({isUserTurn:W})),children:[ts&&n.jsx(Sl,{gizmo:ds}),Je&&n.jsx(Tl,{clientThreadId:s.id,query:as?Xs(as):null,state:Ds,isAssistantResponseSuppressed:!!Us}),Ro&&n.jsx(yl,{handleShowRetrievalResults:Ws,clientThreadId:s.id,turnIndex:e,responseComplete:!Ge,className:"mb-6"}),!W&&n.jsx(Sd,{messages:j,clientThreadId:s.id,gizmoId:ue==null?void 0:ue.gizmo.id}),j.some(a=>{var p,w,E;return(E=(p=a.metadata)==null?void 0:p.async_completion_id)!=null?E:W&&((w=a.metadata)==null?void 0:w.async_task_title)})&&n.jsx(Ml,{message:j.find(a=>{var p,w,E;return(E=(p=a.metadata)==null?void 0:p.async_completion_id)!=null?E:W&&a.author.role===Z.User&&((w=a.metadata)==null?void 0:w.async_task_title)}),clientThreadId:s.id,isUserTurn:W}),ro&&W&&n.jsx(Td,{clientThreadId:s.id,messages:j}),Pe&&pe?n.jsx(ia,{message:pe,clientThreadId:s.id,onRequestCompletion:r,onExitEdit:Ga,disabled:!1}):!Us&&n.jsx(at,Oe(ae({allMessages:b,groupedMessagesToRender:Q,allGroupedMessages:N},i),{isUserTurn:W,isFinalUserTurn:Ue,isFinalAssistantTurn:ze,isWithinFirstAssistantTurns:_s,isCompletionRequestInProgress:xe,isFeedbackEnabled:ms,isFinalTurn:t,isGlauxTurn:os,hasActiveRequest:Ka,isAgentTurn:k,isKAUR1BR5:ee,query:as?Xs(as):null,wasInterrupted:uo,superWidgetContent:(fn=te==null?void 0:te.content)!=null?fn:null,lastAgentMetadataNode:oe,hasSearchSystemHint:(vn=z==null?void 0:z.includes(fs.Search))!=null?vn:!1})),Po&&(L&&ko?n.jsx(yd,{turnIndex:e,clientThreadId:s.id,variant:"bottom"}):n.jsx(Kn,{handleShowRetrievalResults:Ws,clientThreadId:s.id,turnIndex:e,responseComplete:!Ge})),Bo&&n.jsx(wl,{message:d,clientThreadId:s.id,turnIndex:e,referenceMessageId:d.id,responseComplete:!t||!xe}),Ho&&n.jsx(El,{clientThreadId:s.id}),qs&&qs.length>0&&!xe&&n.jsx(Al,{clientThreadId:s.id,examples:qs}),At&&n.jsx(Pl,{message:At,className:"mt-4"}),Os&&n.jsx(pd,{isUserTurn:W,alwaysShow:!0,children:W?f?null:n.jsx(vd,{activeVariantIndex:qe,clientThreadId:s.id,numVariants:he.length,onAnticipateEdit:ia.prefetch,onChangeIndex:Tt,onEnterEdit:Ua,showCopyButton:Et,showEditMessageButton:yo,showPagination:Ct,turnIndex:e,reportableMessageId:(bn=pe==null?void 0:pe.id)!=null?bn:null,reportableMessageAuthoredByCurrentUser:Ao,isSharedConversation:Qe,serverThreadIdForReporting:ct}):n.jsxs(n.Fragment,{children:[n.jsx(fd,{activeVariantIndex:qe,clientThreadId:s.id,conversationMode:Re,lastMessage:d,messages:j,numVariants:he.length,onChangeIndex:Tt,onRate:Va,showCanvasButton:Ja,showCopyButton:Et,showPagination:Ct,showPlayButton:wo,showRatingButtons:ms,showRegenerateButton:Lo,turn:g,turnIndex:e,parentPrompt:se,isAgentTurn:k,isKAUR1BR5:ee,reportableMessageId:(xn=d==null?void 0:d.id)!=null?xn:null,isSharedConversation:Qe,serverThreadIdForReporting:ct,projectConversationId:Ha}),os&&$s?n.jsx(Kn,{handleShowRetrievalResults:Ws,clientThreadId:s.id,turnIndex:e,responseComplete:!Ge}):n.jsx(n.Fragment,{children:!A&&n.jsx(Qn,{clientThreadId:s.id,message:O!=null?O:d,turnIndex:e,isAgentTurn:k})}),!1,ei&&n.jsx(kl,{conversation:s,messages:b})]})}),si&&n.jsx(Rl,{isCompletionRequestInProgress:xe,conversation:s,messages:b}),Do&&n.jsx(jl,{clientThreadId:s.id}),Uo&&n.jsx(Fl,{clientThreadId:s.id,messages:j}),po&&n.jsx(Qn,{clientThreadId:s.id,message:O!=null?O:d,turnIndex:e,isAgentTurn:k}),!1,To&&n.jsx(Nl,{canShowInlineMessageFeedback:Rs,clientThreadId:s.id,messageForRating:d,allGroupedMessages:N,currentModelId:cs}),n.jsx(Yi,{mode:"wait",children:_t&&n.jsx(Bl,{lastUserMessageId:R.id,setIsDismissed:Io})}),bo&&(Xe?n.jsx(Dl,{clientThreadId:s.id,connectorToUpsell:Xe,analyticsMetadata:ss}):n.jsx(Ul,{followups:Go,actionSuggestions:Vo,categorySuggestions:Oo,clientThreadId:s.id,lastMessageId:ws,analyticsMetadata:ss,isTatertotFollowupsEnabled:ve,shouldHideFollowups:vo}))]}),n.jsx(Ol,{clientThreadId:s.id,turn:g,isFinalTurn:t}),n.jsx(Vl,{clientThreadId:s.id,turn:g})]})})]})]})})}const wd=({clientThreadId:i,turn:e,turnIndex:t,conversationTurnWrapperRef:s})=>{const r=Ll();_.useEffect(()=>{if(!r)return;const o=new IntersectionObserver(c=>{c.forEach(u=>{u.isIntersecting?He(i,m=>{var x;m.turnIdsInViewpoint=[...(x=m.turnIdsInViewpoint)!=null?x:[],{turnId:e.id,turnIndex:t,role:e.role}]}):He(i,m=>{var x;m.turnIdsInViewpoint=(x=m.turnIdsInViewpoint)==null?void 0:x.filter(({turnId:l})=>l!==e.id)})})},{root:null,threshold:.1});return s.current&&o.observe(s.current),()=>{He(i,c=>{var u;c.turnIdsInViewpoint=(u=c.turnIdsInViewpoint)==null?void 0:u.filter(({turnId:m})=>m!==e.id)}),o.disconnect()}},[i,s,r,e.id,e.role,t])},Ed=ii.memo(Md),Ad=_.memo(function(e){"use forget";const t=es.c(22),{conversation:s,onRequestCompletion:r,disableScrollToMessage:o,hideUserActions:c,disableHorizontalPadding:u}=e;let m;t[0]!==o?(m=h=>[K.getConversationTurnIds(h),o||h==null?void 0:h.scrollToMessageId,o||h==null?void 0:h.scrollToMessageIsAssistant],t[0]=o,t[1]=m):m=t[1];const[x,l,T]=_e(s.id,m),C=$l(s.id);let I;if(t[2]!==s||t[3]!==x||t[4]!==u||t[5]!==C||t[6]!==c||t[7]!==r||t[8]!==l||t[9]!==T){let h;t[11]!==s||t[12]!==x.length||t[13]!==u||t[14]!==C||t[15]!==c||t[16]!==r||t[17]!==l||t[18]!==T?(h=(y,v)=>n.jsx(Ed,{isFinalTurn:v===x.length-1,turnIndex:v,conversation:s,onRequestCompletion:r,scrollToMessageId:l,scrollToMessageIsAssistant:T,dateHeaderType:C(v),hideUserActions:c,disableHorizontalPadding:u},y),t[11]=s,t[12]=x.length,t[13]=u,t[14]=C,t[15]=c,t[16]=r,t[17]=l,t[18]=T,t[19]=h):h=t[19],I=x.map(h),t[2]=s,t[3]=x,t[4]=u,t[5]=C,t[6]=c,t[7]=r,t[8]=l,t[9]=T,t[10]=I}else I=t[10];let f;return t[20]!==I?(f=n.jsx(n.Fragment,{children:I}),t[20]=I,t[21]=f):f=t[21],f}),la=We(()=>Ze(()=>import("./c5og9r81gzk0nhum.js"),__vite__mapDeps([10,1,2,3,4,5])).then(i=>i.ThreadReportConversationModal));function $d(i){const{prefetchNavlink:e,clearPrefetchNavlink:t,conversation:s,pageLoadSearchQuery:r}=i,o=bs(),c=Aa(o),u=zl(s.id),m=ql(),x=Kl(),[l,T]=Ve(()=>[nr(o),it(o)]),[C]=Ql(),{isOpen:I}=nt(),f=x.store.useContentAreaDimensions(Jl.Header,S=>S!=null&&S.height?S.height:void 0);let h=null;f||(h=!c&&I?"max-sm:pb-25":"pb-25",l?h=C===Xl.Chat?"pb-12":"pb-13":T&&(h="pb-0"));let y=n.jsx(Pd,ae({isNewScrollEnabled:c},i));const v=Yl();return v&&(y=n.jsx(ed,{conversation:s,children:y})),y=n.jsx(Zl,{clientThreadId:s.id,children:y}),n.jsxs("div",{onCopy:u,className:Ce("flex flex-col text-sm",v&&"pt-4",m&&"keyboard-open:pb-[calc(var(--composer-height,100px)+var(--screen-keyboard-height,0))]",h),style:{paddingBottom:f},children:[r&&n.jsx("div",{children:n.jsx(dd,{query:r})}),e?n.jsx(ar,{name:"prefetch-navlink",onError:S=>{et.addError("Error with prefetch navlink",{error:S}),t()},children:n.jsx(_.Suspense,{fallback:null,children:n.jsx(cd,{clientThreadId:s.id,prefetchNavlink:e,clearPrefetchNavlink:t})})}):null,n.jsx(or,{children:y})]})}function Pd({onRequestCompletion:i,conversation:e,scrollContainerRef:t,isNewScrollEnabled:s=!1}){var S,L,P,A,F;const r=bs(),[o,c,u]=_e(e.id,g=>[g==null?void 0:g.pulseCardId,K.hasUserMessage(g),K.isMessageTurnEnded(g)]),m=Pa(r),x=Ve(()=>sd(r)&&m.isCardViewOpen$()),{data:l}=td(o),T=o!=null&&!c,C=Ta(),I=ya(),f=ir();nd({isSharedConversation:C,clientThreadId:e.id}),_.useEffect(()=>{C&&(Ps(r,"chatgpt_continue_conversation_page_loaded"),Fe.logEvent("Continue Conversation: Page Loaded"),Ps(r,"chatgpt_conversation_share_page_loaded"),Fe.logEvent("Share Public Chat: Shared Conversation Loaded"))},[r,C]);const[h,y]=_.useState(!1),v=I&&!f;return n.jsxs(n.Fragment,{children:[v&&n.jsx(ld,{}),C&&n.jsxs(n.Fragment,{children:[n.jsx(ka,{children:n.jsx("p",{className:"text-xs text-gray-500",children:n.jsx(Le,{id:"threadLayout.sharedConversationCopyDisclaimer",defaultMessage:"This is a copy of a conversation between ChatGPT & Anonymous."})})}),n.jsx("div",{className:"text-token-text-primary mb-5 text-center text-xs font-semibold",children:n.jsx("button",{onPointerOver:()=>la.prefetch(),onClick:()=>{Sa(r,la,{clientThreadId:e.id,serverThreadId:e.sharedConversationId,isSharedConversation:!0,isStaticSharedThread:!1}),Ps(r,"chatgpt_conversation_share_report_content_clicked",void 0,{location:"Static Shared Thread Page"}),Fe.logEvent("Share Public Chat: Report Content Clicked",{location:"Dynamic Shared Thread Page"})},children:n.jsx(Le,{id:"thread.reportSharedConversation",defaultMessage:"Report conversation"})})})]}),l&&n.jsx(ad,{imageSrc:(L=(S=l.image)==null?void 0:S.url)!=null?L:"",fallbackSrc:(A=(P=l.image)==null?void 0:P.fallback_url)!=null?A:"",title:(F=l.title)!=null?F:"",cardId:o,hideImage:od(l)==="light"}),n.jsx(id,{children:n.jsx(Ad,{conversation:e,onRequestCompletion:i,disableScrollToMessage:s||T})}),!s&&n.jsxs(n.Fragment,{children:[x&&(t==null?void 0:t.current)&&n.jsx(rr,{setIsScrolledToEdge:g=>{y(!g)},options:{root:t.current,threshold:0,rootMargin:"-30px 0px"}},"pulseCardModalEdgeScrollObserver"),x&&n.jsx(rd,{show:h&&u})]})]})}export{Fa as C,$d as T,Ad as a};
//# sourceMappingURL=mce0eiesimdmeqmr.js.map
