var oe=Object.defineProperty;var z=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var W=(s,a,t)=>a in s?oe(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,q=(s,a)=>{for(var t in a||(a={}))ie.call(a,t)&&W(s,t,a[t]);if(z)for(var t of z(a))de.call(a,t)&&W(s,t,a[t]);return s};import{e as P,r as g,j as e,M as o,f as F,aj as le,a as ce,i as K,F as ue}from"./fg33krlcm0qyi6yw.js";import{m as D,C as I,a9 as G,I as Y,b as L,x as J,R as ee,c0 as H,_ as me,H as se,du as ge,nW as pe,o as xe,l as fe}from"./mtk1qztvnb31pw5r.js";import{dL as he,V as je,A as Me,ne as U,ky as te,ca as we,ao as ae,nd as re,dw as ye,dv as Se,cI as V,e8 as be}from"./k65njl5wlgspihfr.js";import{a as $,c as Q}from"./jex6ulz50fkc86ct.js";import{T as r}from"./hcn3kohxpjzaoxwc.js";import{f as ne,i as O,u as ke,R as Ne}from"./cjhotjke5k7dpw0q.js";import{F as ve}from"./j6lb21vbnpzhe1mm.js";import{G as Ge}from"./en6zlt3w5f6cxktv.js";import{e as Ce,f as Ae,M as X}from"./ki4km9ptw66l47xq.js";function Ee({defaultName:s,placeholder:a,onSave:t,onClose:n}){const i=P(),h=s==null,[u,p]=g.useState(s||""),[c,w]=g.useState(!1),[j,M]=g.useState(null),x=D(),f=async()=>{if(u.trim()===""){M(i.formatMessage({id:"workspaceSettings.groups.emptyName",defaultMessage:"Group name cannot be empty"}));return}w(!0);try{await t(u),x.success(h?i.formatMessage({id:"workspaceSettings.groups.createdGroup",defaultMessage:"Group created successfully"}):i.formatMessage({id:"workspaceSettings.groups.nameChanged",defaultMessage:"Group name changed successfully"})),n()}catch(y){M(i.formatMessage({id:"workspaceSettings.groups.duplicateName",defaultMessage:"Group with this name already exists"}))}finally{w(!1)}};return e.jsx(I,{isOpen:!0,type:"success",onClose:n,title:h?i.formatMessage(Z.newGroupTitle):i.formatMessage(Z.updateNameTitle),testId:"modal-change-group-name",showCloseButton:!0,primaryButton:e.jsx(G,{color:"primary",onClick:()=>f(),loading:c,children:e.jsx(o,{id:"workspaceSettings.groups.save",defaultMessage:"Save"})}),secondaryButton:e.jsx(G,{onClick:n,color:"secondary",children:e.jsx(o,{id:"workspaceSettings.groups.cancel",defaultMessage:"Cancel"})}),children:e.jsxs("div",{className:"mb-3 flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm font-medium",children:e.jsx(o,{id:"workspaceSettings.groups.groupNameLabel",defaultMessage:"Group Name"})}),e.jsx("input",{autoFocus:!0,type:"text",value:u,placeholder:a,onChange:y=>{p(y.target.value),M(null)},className:"border-token-border-secondary focus:border-token-accent bg-token-bg-primary w-full rounded border px-3 py-2 text-sm focus:outline-none",onKeyDown:y=>{y.key==="Enter"&&f()}}),j&&e.jsx("p",{className:"text-xs text-red-500",children:j})]})})}const Z=F({newGroupTitle:{id:"workspaceSettings.groups.newGroup",defaultMessage:"New group"},updateNameTitle:{id:"workspaceSettings.groups.updateNameTitle",defaultMessage:"Update group name"}}),Pe=F({bulkAddMembersError:{id:"workspaceSettings.groups.bulkAddMembers.error",defaultMessage:"Unable to add some members to the group."}}),B=1e3;function _e({group:s,isOpen:a,onClose:t}){const n=P(),i=D(),h=n.formatMessage({id:"workspaceSettings.groups.addMember",defaultMessage:"Add members to the {groupName} group"},{groupName:s.name}),u=L(),p=Y(u),[c,w]=g.useState([]),[j,M]=g.useState(!1);async function x(){var N;const f=p==null?void 0:p.getWorkspaceId();if(!f)throw new Error("No workspace ID found");M(!0);const y=[],b=50;for(let m=0;m<c.length;m+=b)y.push(c.slice(m,m+b));const C=async m=>ee.safePost("/accounts/{account_id}/group/{group_id}/users",{parameters:{path:{account_id:f,group_id:s.id}},requestBody:{email_addresses:m}});try{const v=(await Promise.all(y.map(S=>C(S)))).reduce((S,d)=>S+d.added_group_users.length,0);i.success(n.formatMessage({id:"yU4Zf0",defaultMessage:"Added {numUsers} users to the group"},{numUsers:v})),t==null||t()}catch(m){const v=(N=ne(n,m,{targetIsRestrictedSafeModeGroup:O(s)}))!=null?N:n.formatMessage(Pe.bulkAddMembersError);i.danger(v,{duration:3})}finally{M(!1)}}return e.jsxs(I,{testId:"modal-bulk-add-group-members",isOpen:a,onClose:t!=null?t:J,title:h,type:"success",showCloseButton:!0,primaryButton:e.jsx(G,{onClick:x,disabled:c.length===0||c.length>B,loading:j,children:e.jsx(o,{id:"EpbOzA",defaultMessage:"Add users to group"})}),children:[e.jsx(Fe,{onChange:w}),c.length>B&&e.jsx("div",{className:"text-token-text-error mt-2 text-sm",children:e.jsx(o,{id:"9lp0Tc",defaultMessage:"Email list is limited to {maxEmails} users at once",values:{maxEmails:B}})})]})}function Fe({onChange:s}){const[a,t]=g.useState("");return e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("label",{htmlFor:"group-email-paste",children:[e.jsx(o,{id:"qvGcSC",defaultMessage:"Emails"}),e.jsx("br",{}),e.jsx("span",{className:"text-token-text-tertiary text-sm",children:e.jsx(o,{id:"Fhd+5h",defaultMessage:"Paste email addresses here, one per line:"})})]}),e.jsx(he,{id:"group-email-paste",className:"h-[250px] text-sm",value:a,onChange:n=>{t(n.target.value),s(Re(n.target.value))},placeholder:"jean@example.com\njoohyun@example.com\nmuhammed@example.com\nsusan@example.com"})]})}function Re(s){return s.split("\n").map(a=>a.trim()).filter(a=>a.length>0).filter(a=>je.test(a))}function Ue({group:s,isOpen:a,onClose:t}){var _;const n=P(),i=D(),h=n.formatMessage({id:"workspaceSettings.addGroupsMembersModal.title",defaultMessage:"Add members to the {groupName} group"},{groupName:s.name}),u=L(),p=Y(u),c=p==null?void 0:p.getWorkspaceId(),[w,j]=g.useState(""),[M,x]=g.useState(0),{data:f,isLoading:y}=Me(c,M*U,w,U,le),[b,C]=g.useState([]),[N,m]=g.useState([]),[v,S]=g.useState("interactive"),d=f?Math.ceil(((_=f.total)!=null?_:0)/U):0;async function A(l){var T;m(k=>[...k,l]);try{await Be(c,s.id,l),C(k=>[...k,l])}catch(k){me.addError(k);const R=(T=ne(n,k,{targetIsRestrictedSafeModeGroup:O(s)}))!=null?T:n.formatMessage(De.addMemberError);i.danger(R,{duration:3})}finally{m(k=>k.filter(R=>R!==l))}}return v==="batch"?e.jsx(_e,{group:s,isOpen:a,onClose:t}):e.jsx(I,{testId:"modal-add-group-member",type:"warning",isOpen:a,onClose:t!=null?t:J,title:h,size:"custom",className:"max-w-(--breakpoint-md)",showCloseButton:!0,primaryButton:e.jsx(G,{onClick:t,children:e.jsx(o,{id:"0NAzDq",defaultMessage:"Done"})}),children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-row justify-between",children:[e.jsx("p",{children:h}),e.jsx(G,{onClick:()=>{S("batch")},color:"secondary",children:e.jsx(o,{id:"5GPldp",defaultMessage:"Bulk add users"})})]}),e.jsx(te,{value:w,inputClassName:"w-full",onChange:l=>{j(l.target.value)}}),e.jsxs(r.Root,{className:"min-w-full",children:[e.jsxs(r.Header,{children:[e.jsx(r.HeaderCell,{children:e.jsx(o,{id:"workspaceSettings.groups.addMember.name",defaultMessage:"Name"})}),e.jsx(r.HeaderCell,{children:e.jsx(o,{id:"workspaceSettings.groups.addMember.email",defaultMessage:"Email"})}),e.jsx(r.HeaderCell,{})]}),e.jsxs(r.Body,{children:[!f&&y&&e.jsx(r.Row,{children:e.jsx(r.Cell,{colSpan:3,children:e.jsx(H,{})})}),f==null?void 0:f.items.map(l=>e.jsxs(r.Row,{children:[e.jsx(r.Cell,{children:l.name}),e.jsx(r.Cell,{children:l.email}),e.jsx(r.Cell,{textAlign:"right",className:"pe-1",children:e.jsx(G,{size:"small",color:"secondary",disabled:N.includes(l.id),onClick:()=>{b.includes(l.id)||A(l.id)},icon:b.includes(l.id)?we:ae,children:b.includes(l.id)?e.jsx(o,{id:"workspaceSettings.groups.addMember.addButton",defaultMessage:"Added"}):e.jsx(o,{id:"workspaceSettings.groups.addMember.addedButton",defaultMessage:"Add"})})})]},l.id))]})]}),e.jsx("div",{className:"flex flex-row justify-center",children:e.jsx(re,{currentPage:M,onChangeIndex:l=>{x(l)},length:d})})]})})}async function Be(s,a,t){await ee.safePatch("/accounts/{account_id}/group/{group_id}",{parameters:{path:{account_id:s,group_id:a}},requestBody:{user_id:t}})}const De=F({addMemberError:{id:"EnX2ZH",defaultMessage:"Unable to add member to the group."}});function Ie({workspaceId:s}){const a=P(),t=ce(),n=se(),i=!(n!=null&&n.isAdminOfAccount()||n!=null&&n.isOwnerOfAccount()),h=L(),[u,p]=g.useState(""),c=be(u,300),w=K(),[j,M]=g.useState(0),{groups:x,isLoading:f,isPlaceholderData:y}=Ce({workspaceId:s,currPage:j,groupFilter:c}),[b,C]=g.useState(!1),{data:N}=ke(s,xe(h,"3020999601")),m=d=>{d&&(M(0),p("")),C(d)},{createGroup:v}=Ae({workspaceId:s,currentGroups:x});let S=x?[...x.items]:[];if(N&&x){const d=N.group;if(d){const A=S.filter(({id:_})=>_!==d.id);S=j===0?[d].concat(A):S}}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6 mb-3 flex flex-row justify-between gap-2",children:[e.jsx(te,{inputClassName:"w-[250px] rounded-full! text-sm",value:u,onChange:d=>{p(d.target.value),M(0)},placeholder:a.formatMessage({id:"workspaceSettings.groups.search",defaultMessage:"Search group name"})}),!i&&e.jsx(G,{onClick:()=>m(!0),icon:ae,children:e.jsx(o,{id:"workspaceSettings.groups.create",defaultMessage:"Create group"})})]}),e.jsxs("div",{children:[e.jsxs(r.Root,{className:"min-w-full",children:[e.jsxs("colgroup",{children:[e.jsx("col",{className:"w-[60%]"}),e.jsx("col",{className:"w-[20%]"}),e.jsx("col",{className:"w-[20%]"}),e.jsx("col",{className:"w-16"})]}),e.jsxs(r.Header,{children:[e.jsx(r.HeaderCell,{children:e.jsx(o,{id:"workspaceSettings.groups.groupName",defaultMessage:"Group name"})}),e.jsx(r.HeaderCell,{children:e.jsx(o,{id:"workspaceSettings.groups.members",defaultMessage:"Members"})}),e.jsx(r.HeaderCell,{children:e.jsx(o,{id:"workspaceSettings.groups.created",defaultMessage:"Created"})}),e.jsx(r.HeaderCell,{})]}),e.jsx(r.Body,{className:fe((f||y)&&"opacity-50"),children:x==null?e.jsx(r.Row,{children:e.jsx(r.Cell,{colSpan:5,textAlign:"center",children:e.jsx(H,{})})}):S.length===0?e.jsx(r.Row,{children:e.jsx(r.Cell,{colSpan:5,textAlign:"center",children:u===""?e.jsx(o,{id:"workspaceSettings.groups.noGroups",defaultMessage:"No groups found."}):e.jsx(o,{id:"workspaceSettings.groups.noGroupsWithFIlter",defaultMessage:"No groups found. Try changing the search query."})})}):S.map(d=>e.jsx(Le,{group:d,workspaceId:s,onAddMember:()=>{t.invalidateQueries({queryKey:[s,"groups"]})},readOnly:i},d.id))})]}),x&&e.jsx("div",{className:"text-center",children:e.jsx(re,{length:Math.ceil(x.total/X),currentPage:Math.min(j,Math.ceil(x.total/X)),onChangeIndex:d=>M(d)})})]}),b&&e.jsx(Ee,{onClose:()=>m(!1),onSave:async d=>{const{id:A}=await v({name:d,workspaceId:s});w("/admin/groups/".concat(A))},placeholder:a.formatMessage({id:"workspaceSettings.groups.placeholder",defaultMessage:"E.g. marketing team"})})]})}function Ze({currentWorkspaceId:s}){var j;const a=P(),t=se(),n=!!(t!=null&&t.isFreeWorkspace());let i=!1;const h=t!=null?ye(t.data.role):void 0,u=t!=null?Se(t.data.role):void 0,p=t==null?void 0:t.isEnterprisey(),{data:c,isLoading:w}=ge(s);return n?e.jsxs(e.Fragment,{children:[e.jsx(V,{children:e.jsx("title",{children:a.formatMessage(E.title)})}),e.jsx($,{title:a.formatMessage(E.title),subtitle:e.jsx(o,{id:"NDDzzF",defaultMessage:"Only workspace admins can edit these settings."})}),e.jsx(Q,{children:e.jsx(ve,{})})]}):(u||h||!p?i=!0:i=!!((j=c==null?void 0:c.permissions)!=null&&j.includes("chatgpt.workspace.member.role.view")),w?e.jsx("div",{className:"mt-6 flex min-h-[40vh] items-center justify-center",children:e.jsx(H,{})}):i?e.jsxs(e.Fragment,{children:[e.jsx(V,{children:e.jsx("title",{children:a.formatMessage(E.title)})}),e.jsx($,{title:a.formatMessage(E.title),subtitle:e.jsx(o,{id:"NDDzzF",defaultMessage:"Only workspace admins can edit these settings."})}),e.jsx(Q,{showSpinner:!1,children:e.jsx(Ie,{workspaceId:s})})]}):e.jsx("div",{className:"m-6",children:e.jsxs("div",{className:"border-token-border-medium bg-token-main-surface-secondary text-token-text-primary flex items-center gap-3 rounded-md border px-4 py-3",children:[e.jsx(pe,{className:"icon-sm interactive-label-warning-secondary shrink-0"}),e.jsx(o,q({},E.groupsPagePermissionDenied))]})}))}function Le({group:s,onAddMember:a,readOnly:t}){const[n,i]=g.useState(!1),h=K(),u=O(s);return e.jsxs(e.Fragment,{children:[e.jsxs(r.Row,{className:"[&>td]:py-2",onClick:()=>h("/admin/groups/".concat(s.id)),children:[e.jsxs(r.Cell,{children:[e.jsx(Ge,{group:s}),e.jsx("div",{className:"flex flex-col gap-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.name}),u&&e.jsx(Ne,{})]})})]}),e.jsx(r.Cell,{children:e.jsx(o,{id:"workspaceSettings.groups.memberCount",defaultMessage:"{count} members",values:{count:s.num_members}})}),e.jsx(r.Cell,{children:s.created_time&&e.jsx(ue,{value:s.created_time,year:"numeric",month:"short",day:"numeric"})})]}),n&&!t&&!s.is_scim_managed&&e.jsx(Ue,{isOpen:!0,onClose:()=>{a(s.id),i(!1)},group:s})]})}const E=F({title:{id:"admin.groupsSettings.title",defaultMessage:"Groups"},groupsPagePermissionDenied:{id:"adminPage.groupsPagePermissionDenied",defaultMessage:"You don't have permission to view this groups list."}});export{Ue as A,Ee as U,Ze as W,E as m};
//# sourceMappingURL=jj966504fmjr1tab.js.map
