var Q=Object.defineProperty,Z=Object.defineProperties;var J=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var A=(e,t,a)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,g=(e,t)=>{for(var a in t||(t={}))T.call(t,a)&&A(e,a,t[a]);if(S)for(var a of S(t))F.call(t,a)&&A(e,a,t[a]);return e},j=(e,t)=>Z(e,J(t));var y=(e,t)=>{var a={};for(var n in e)T.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(e!=null&&S)for(var n of S(e))t.indexOf(n)<0&&F.call(e,n)&&(a[n]=e[n]);return a};import{e as I,j as s,r as l,M as O}from"./fg33krlcm0qyi6yw.js";import{s3 as X,ef as ee,iH as se,eq as q,km as te,ej as ae,eU as re,s4 as ne,s5 as ie,s6 as P,cH as U,aC as le,s7 as oe,lc as ce,s8 as ue,bP as de,s9 as me}from"./k65njl5wlgspihfr.js";import{C as xe,a as fe,S as pe}from"./o5wnu7gtgn58rmcv.js";import{l as M,bv as D,bg as V,hA as z,cQ as C,T as he,xm as R,qg as ge,b as W,fN as je,cS as ye,dF as be,gs as Ne,gw as Me,m as we,h_ as L,gn as Se,dL as ke}from"./mtk1qztvnb31pw5r.js";import{M as $}from"./fdmssuqzpk9905my.js";import"./ikh0apjsuisoywnq.js";import"./ctgqahsfx1txd4g6.js";import"./hy5xt98rivxg8tb4.js";import"./d30pfo25z1qctykl.js";import"./l9v3ntkj34comb67.js";import"./h0pbwkfesoibvhzi.js";import"./i1g2kxfbotvbgq93.js";import"./eu6wvuly09f1n3pt.js";import"./evgr6wx9jd99ot87.js";import"./du98r2zhw5p0hoto.js";import"./e5ksk0bbujs0ac88.js";function ve({label:e,tab:t,activeTab:a,setActiveTab:n,caterpillarHeaderRef:r}){const c=l.useCallback(()=>{n(t),r.current&&r.current.scrollIntoView({behavior:"instant",block:"center"})},[n,t,r]),o=a===t;return s.jsx("button",{onClick:c,className:M("btn text-token-text-primary min-h-[36px]! min-w-[100px] rounded-full px-2 py-1 select-none",o?"bg-token-main-surface-primary shadow-sm":"bg-token-main-surface-tertiary!"),children:e})}function _e({activeTab:e,setActiveTab:t,sourcesCount:a,showAuxTab:n=!1,caterpillarHeaderRef:r}){const c=I(),o=[{tab:"activity",label:c.formatMessage({id:"9lnBJU",defaultMessage:"Activity"})},{tab:"sources",label:a>1?c.formatMessage({id:"/Ucokx",defaultMessage:"{sourcesCount} Sources"},{sourcesCount:a}):a===1?c.formatMessage({id:"CCF0z+",defaultMessage:"1 Source"}):c.formatMessage({id:"twjHy3",defaultMessage:"Sources"})}];return n&&o.unshift({tab:"report",label:c.formatMessage({id:"zF7Fu5",defaultMessage:"Report"})}),s.jsx("div",{className:M("border-token-main-surface-tertiary bg-token-main-surface-tertiary flex items-center rounded-full border-[4px] transition-all"),children:o.map(({tab:d,label:u})=>s.jsx(ve,{activeTab:e,tab:d,setActiveTab:t,label:u,caterpillarHeaderRef:r},d))})}const k=({children:e,icon:t,fillIcon:a,className:n})=>s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx("div",{className:M("mt-[3px] inline-flex h-5 w-5 shrink-0 items-center justify-center gap-2.5 rounded-[30px]",a&&"border border-black/10 bg-white",n),children:t}),e]});function b({icon:e,message:t,iconClassName:a}){return s.jsx("div",{className:"loading-shimmer-pure-text flex h-8 gap-1 overflow-hidden",children:s.jsx(k,{fillIcon:!1,icon:e,className:a,children:s.jsx("div",{className:"mt-[.5px] flex h-10",children:t})})})}const Ie=({finalRow:e})=>{var n;const t=I(),a=e.type==="fileOpen"?(n=X[e.iconType])!=null?n:ee:null;return s.jsx(D,{children:s.jsx(V.div,{layout:!0,transition:{type:"spring",stiffness:300,damping:30},className:"flex flex-col items-start justify-start gap-4",children:e.type==="search"?s.jsx(b,{icon:s.jsx(z,{className:"text-token-text-primary relative h-5 w-5 opacity-50"}),message:t.formatMessage({id:"f9wsyE",defaultMessage:"Searching…"})}):e.type==="websiteOpen"?s.jsx(b,{icon:s.jsx(se,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:t.formatMessage({id:"8L6BBp",defaultMessage:"Reading…"})}):e.type==="fileOpen"?s.jsx(b,{icon:s.jsx(a,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:t.formatMessage({id:"h5M4/O",defaultMessage:"Reading file…"})}):e.type==="pythonAnalysis"?s.jsx(b,{icon:s.jsx($,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:t.formatMessage({id:"jZ7gNw",defaultMessage:"Analyzing…"})}):s.jsx(b,{icon:s.jsx(C,{className:"inline-flex h-5 w-5 items-center justify-center opacity-50"}),message:t.formatMessage({id:"bSPYmC",defaultMessage:"Thinking…"})})})})},Ce=({children:e})=>s.jsxs("div",{className:"flex items-start gap-2 text-start text-wrap",children:[s.jsx("div",{className:"mt-[1px] inline-flex h-5 w-5 shrink-0 items-center justify-end gap-2.5 pt-[3px]",children:s.jsx($,{className:"text-token-text-primary relative h-5 w-5"})}),e]}),Ee=({row:e})=>s.jsx(Ce,{children:s.jsx("div",{className:"text-token-text-primary flex text-base",children:e.analysisSummary})}),Ae=({children:e,showIcon:t})=>s.jsxs("div",{className:"flex items-start gap-2 text-start text-wrap",children:[s.jsx("div",{className:"mt-[1px] inline-flex h-5 w-5 shrink-0 items-center justify-end gap-2.5 pt-[3px]",children:t&&s.jsx(z,{className:"text-token-text-primary relative h-5 w-5"})}),e]}),Te=({row:e,showIcon:t})=>{const a=e.query;return a?s.jsx(Ae,{showIcon:t,children:s.jsx("div",{className:"text-token-text-primary flex text-base",children:a})}):null};function Fe({children:e,showIcon:t=!0}){return s.jsx(k,{fillIcon:!1,icon:t?s.jsx(C,{className:"text-token-text-primary inline-flex h-5 w-5 items-center justify-center"}):null,children:e})}const Oe={strong:e=>{const r=e,{node:t,children:a}=r,n=y(r,["node","children"]);return s.jsx("strong",j(g({},n),{className:M(n.className,"text-token-text-primary font-semibold"),children:a}))},p:e=>{const r=e,{node:t,children:a}=r,n=y(r,["node","children"]);return s.jsx("p",j(g({},n),{className:M(n.className,"mb-0! text-base"),children:a}))}};function Re(e){return e.replace(/^#+\s*.*$/gm,"").replace(/^\*\*.*\*\*$/gm,"").trim()}function Le({row:e,showIcon:t=!0}){const a=e.summary;if(!a)return null;const n=Re(a);return n.length===0?null:s.jsx(Fe,{showIcon:t,children:s.jsx(q,{componentOverrides:Oe,className:"w-0! flex-1 leading-6",children:n})})}function Be(e){try{const{hostname:t}=new URL(e);return t}catch(t){return null}}const qe={p:e=>{const r=e,{node:t,children:a}=r,n=y(r,["node","children"]);return s.jsx("p",j(g({},n),{className:"text-token-text-primary text-start text-base",children:a}))},a:e=>{const r=e,{node:t,children:a}=r,n=y(r,["node","children"]);return s.jsx("a",j(g({},n),{className:"text-blue! text-base leading-6",children:a}))}},Pe=({website:e})=>{const t=Be(e.url);return t?s.jsxs("div",{className:"flex items-start justify-start gap-2",children:[s.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:s.jsx(he,{label:t,className:"bg-token-main-surface-primary mt-[3px] flex h-5 w-5 shrink-0 cursor-pointer items-center justify-center",children:s.jsx(te,{url:e.url,size:"xsmall",className:"h-5 w-5",fallback:s.jsx(ae,{url:e.url,className:"h-5 w-5 rounded-2xl border-[.5px] border-black/25",fallback:s.jsx(re,{className:"icon-sm text-token-text-quaternary"})})})})}),s.jsx("div",{className:"text-token-text-primary mt-[1px] flex flex-col text-base",children:s.jsx(q,{componentOverrides:qe,children:e.rowText})})]}):null};function N({children:e}){return s.jsx(V.div,{className:"w-full",initial:{opacity:0},animate:{opacity:1},transition:{duration:1},children:e})}const Ue=({previousRow:e,currentRow:t})=>s.jsx("div",{className:"flex flex-col items-start justify-start gap-4",children:t.type==="search"?s.jsx(N,{children:s.jsx(Te,{row:t,showIcon:!e||e.type!=="search"})},"search_".concat(t.id)):t.type==="summary"?s.jsx(N,{children:s.jsx(Le,{row:t,showIcon:!e||e.type!=="summary"})},"summary_".concat(t.id)):t.type==="websiteOpen"?s.jsx(N,{children:s.jsx(Pe,{website:t})},"website_".concat(t.id)):t.type==="fileOpen"?s.jsx(N,{children:s.jsx(ne,{row:t})},"file_".concat(t.id)):t.type==="pythonAnalysis"?s.jsx(N,{children:s.jsx(Ee,{row:t})},"python_".concat(t.id)):null}),De=120,Ve=1e3*60*2;function B(e){e==null||e.scrollIntoView({block:"center",behavior:"smooth"})}function ze({caterpillarStatusMessageTexts:e}){return s.jsx("div",{className:"p-4",children:s.jsx(U,{type:"error",title:e.failureMessage,content:e.failureBannerContentMessage})})}function We({caterpillarStatusMessageTexts:e}){return s.jsx("div",{className:"p-4",children:s.jsx(U,{title:e.cancelledMessage,content:""})})}function $e({sourcesCount:e,taskInfo:t}){const a=je(t.originalConversationId,r=>{var c,o;return(o=(c=be.findNode(r,d=>{var u,i;return((u=d.message.metadata)==null?void 0:u.b1de6e2_s)===!0&&((i=d.message.metadata)==null?void 0:i.async_task_id)===t.taskId}))==null?void 0:c.message.metadata)==null?void 0:o.async_task_status_messages}),n=l.useMemo(()=>{var r;return a!=null&&a.completed_no_time?s.jsxs(s.Fragment,{children:[(r=a==null?void 0:a.completed_with_time)!=null?r:a==null?void 0:a.completed_no_time,s.jsx(O,{id:"zxfmo/",defaultMessage:" · {sourcesCount} sources",values:{sourcesCount:e}})]}):s.jsx(O,{id:"YG7a0T",defaultMessage:"Completed · {sourcesCount} sources",values:{sourcesCount:e}})},[e,a]);return!t.updatedAt&&!(a!=null&&a.completed)?null:s.jsx(k,{icon:s.jsx(ye,{className:"text-token-text-secondary"}),fillIcon:!1,children:s.jsx("div",{className:"text-token-text-tertiary",children:n})})}function He({taskInfo:e,caterpillarStatusMessageTexts:t,sourcesCount:a,caterpillarHeaderRef:n}){const r=W(),[c,o]=l.useState(!1),d=l.useRef(!1),u=l.useRef(null),i=l.useMemo(()=>{var m;return d.current=!!u.current&&ie(u.current,De),(m=e.rows)!=null?m:[]},[e.rows]);l.useEffect(()=>{if(i.length===0){const m=new Date(e.createdAt).getTime(),f=Date.now()-m,w=Ve-f;if(w>0){const _=setTimeout(()=>{o(!0)},w);return()=>clearTimeout(_)}else o(!0)}else o(!1)},[i,e.createdAt]),l.useEffect(()=>{d.current&&B(u.current)},[i]),l.useEffect(()=>{R(e)||setTimeout(()=>{u.current&&B(u.current)},100)},[]);const x=R(e)||ge(e),h=P(r),v=l.useMemo(()=>i.length&&!x&&!h?i.slice(0,i.length-1):i,[i,x,h]);return s.jsxs("div",{className:"flex flex-col",children:[s.jsx("div",{ref:n},"task-header"),s.jsxs("div",{className:"flex w-full flex-col gap-4",children:[s.jsx("div",{className:"text-base font-medium",children:e.title}),i.length?s.jsxs(D,{initial:!1,children:[v.map((m,f)=>s.jsx(Ue,{previousRow:f>0?i[f-1]:null,currentRow:m},m.id)),!x&&s.jsx(Ie,{finalRow:i[i.length-1]})]}):c?s.jsx(k,{fillIcon:!1,icon:s.jsx(C,{className:"text-token-text-primary inline-flex h-5 w-5 items-center justify-center"}),children:t.waitingInQueueMessage}):s.jsx(xe,{}),e.status==="failed"?s.jsx(ze,{caterpillarStatusMessageTexts:t}):e.status==="cancelled"?s.jsx(We,{caterpillarStatusMessageTexts:t}):e.status==="completed"?s.jsx($e,{caterpillarStatusMessageTexts:t,taskInfo:e,sourcesCount:a}):null]}),s.jsx("div",{ref:u},"task-footer")]})}function us({taskId:e,setWidth:t=void 0,initialTab:a}){const n=W(),r=Ne(p=>Me.getTask(e,p)),{closeThreadSidebar:c}=le(),[o,d]=l.useState(a),u=oe(),i=l.useRef(null),x=!1;l.useEffect(()=>{d(a)},[a]),l.useEffect(()=>{},[r==null?void 0:r.taskId,r==null?void 0:r.status,x]),l.useEffect(()=>{},[r==null?void 0:r.taskId,r==null?void 0:r.status,o]),l.useEffect(()=>{},[t,r,x]);const h=I(),v=we(),m=P(n),f=ce({taskId:r==null?void 0:r.taskId,intl:h,toaster:v}),w=()=>f.mutate(),_=()=>{r&&ke(r.originalConversationId,p=>{p.steeringAsyncTaskId=r.taskId})},{uniqueSources:H,totalSources:E}=l.useMemo(()=>{if(!(r!=null&&r.rows))return{uniqueSources:[],totalSources:0};const p=ue(r.rows),G=p.reduce((Y,K)=>Y+K.count,0);return{uniqueSources:p,totalSources:G}},[r==null?void 0:r.rows]);return s.jsx(de,{ariaLabel:h.formatMessage({id:"region.sidebar.caterpillar",defaultMessage:"Tasks"}),handleClose:c,trailing:r&&m&&L(r)&&s.jsx(pe,{onAddContext:_,onStopTask:w,taskIsFinalizing:r.status===Se.FINALIZING}),leading:s.jsx("div",{className:"flex w-full justify-center",children:s.jsx(_e,{activeTab:o,setActiveTab:d,showAuxTab:x,sourcesCount:E,caterpillarHeaderRef:i})}),children:r&&s.jsxs(fe,{children:[!1,o==="activity"&&s.jsx(He,{taskInfo:r,caterpillarStatusMessageTexts:u,sourcesCount:E,caterpillarHeaderRef:i}),o==="sources"&&s.jsx(me,{taskIsPending:L(r),finalMessage:r.finalMessage,sources:H,caterpillarHeaderRef:i})]})})}export{us as CaterpillarSidebar};
//# sourceMappingURL=irnwnqcx0tccqum9.js.map
