var oe=Object.defineProperty,ie=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var Mt=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var Ht=(e,t,s)=>t in e?oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,qt=(e,t)=>{for(var s in t||(t={}))re.call(t,s)&&Ht(e,s,t[s]);if(Mt)for(var s of Mt(t))le.call(t,s)&&Ht(e,s,t[s]);return e},Wt=(e,t)=>ie(e,ae(t));import{r as p,n as ce,e as de,j as m,c as Yt}from"./fg33krlcm0qyi6yw.js";import{d as kt,b as Z,kq as me,Z as Ut,wn as ue,fN as $t,dF as J,kh as fe,h7 as he,kF as pe,mn as xe,kH as Xt,gF as ge,aK as zt,bv as Ce,wo as Te,bg as I,qt as ve}from"./mtk1qztvnb31pw5r.js";import{hl as jt,qz as be,qA as Jt,hm as ye,C as S,qB as _e,qC as Ie,l5 as Se,qD as we,qE as Ee,qF as Ae,qG as Ne,qy as Re,qH as Fe,qI as De,qJ as qe,qK as Gt,qL as Qt,qw as Oe,u as ke,hf as Lt,qM as Vt,qN as Bt,qO as je,qP as Le,qQ as Pe}from"./k65njl5wlgspihfr.js";import{L as Me}from"./nk8claqige01rjll.js";import{T as He}from"./ba5jyp7qj5r8tn2y.js";import{g as We}from"./bj1ejin6tzi0v3v8.js";import"./m5btqmw2ud0umdwr.js";import"./ce3hgmw4iyyhicud.js";import"./mstl8wgfzorpgdoe.js";import"./f2sn8zvpzei2915e.js";import"./kfdkis1zwf4ccfgg.js";import"./ol9d5wxhynx9q2is.js";import"./mbmcx8v24u1ao1ke.js";import"./ieglwgr2zyuektzv.js";import"./exqqo21frem4no6f.js";import"./l09h2qppleubii6l.js";import"./deakbbf27g8e7ba0.js";import"./j1qri9ykgswuwttk.js";import"./g3lybt7hj0s143gw.js";import"./kl7c6054usfnqmd4.js";import"./k97n0y6ba9c9h39c.js";import"./nkg72cggx811q5rc.js";import"./kkpvfco69f4rm4dl.js";import"./eoxo2x2yyluwv164.js";import"./f76gy0b8ieo4s693.js";import"./fjbpw3a0vshjd395.js";import"./kz9vfmj7e59u487z.js";import"./fdmssuqzpk9905my.js";import"./e509ngenyrgcehf5.js";import"./nwdwrv5b1h68xdm5.js";import"./kimw6epkq1t36pow.js";import"./ns51nblw8ziscsgd.js";import"./b2l059fz4znz94nm.js";import"./jz17uc4ytadugnwg.js";import"./gk1ydinzmvc3mi3f.js";import"./ktlrbeajo849nxci.js";import"./bkm8et9bp0kf1c7y.js";import"./hx3pmvu9yrya5xfj.js";import"./m2li92t79w0k884q.js";import"./f1xfp952knkxhcnw.js";import"./gfro8vshyz92jyup.js";import"./kgrrqncjl71482vi.js";import"./i5jw6wfkpao2rx5t.js";import"./krwszi9u3lj63i9v.js";import"./irqko7c1s7qpl41n.js";import"./j7vr3wxxnh5g6uxz.js";import"./bhm7utdivrybcfbl.js";import"./ohquqctluwabmb5i.js";import"./efooahjtdr85x1lo.js";import"./km71i01x6ma5r62b.js";import"./c2cj1dlcffke3f7m.js";import"./hb1mva1gmw4bcs8w.js";import"./mivow98b53y1taf8.js";import"./e7t9iekjqjn15qm6.js";const Kt="oai/apps/canmoreSidebarWidth",Ue=.25,ze=400,Zt=400;function te(e){return e-ze}function Tt(e,t){return ue(Zt,te(e),t!=null?t:Ue*e)}function Ge(){const e=Z(),t=kt(()=>jt(e).width),s=Tt(t,me(Ut.DANGER_SECRET_FOLDERS_ONLY_getItem(Kt))),r=ee(),[n,a]=p.useState(s);p.useEffect(()=>{(n<Zt||n>te(t))&&a(Tt(t,n))},[t]);function o(d){a(f=>Tt(t,f+=d.delta.x))}function i(d){a(d),Ut.DANGER_SECRET_FOLDERS_ONLY_setItem(Kt,d)}function l(){const d=Tt(t,void 0);i(d)}const c="calc(100vw - ".concat(n,"px)");return r?{chatWidth:n,canvasWidth:t-n,canvasWidthCalc:c,viewportWidth:t,handleDrag:o,handleDoubleClick:l,persist:i}:{chatWidth:0,canvasWidth:t,canvasWidthCalc:"100vw",viewportWidth:t,handleDrag:()=>{},handleDoubleClick:()=>{},persist:()=>{}}}function ee(e){const t=Z();return kt(()=>(e!=null?e:jt(t).width)>1e3)}const Ot="sharedCanvas";function Ve(){const[e,t]=ce(),s=e.get(Ot),r=de();p.useEffect(()=>{const n=s&&be.createRemixTempTextdoc(s,r);if(!n)return;requestAnimationFrame(()=>{Jt(n)});const a=new URLSearchParams(e);a.delete(Ot),t(a);const o=new URL(window.location.href);o.searchParams.delete(Ot),history.replaceState(null,"",o)},[s,e,t,r])}const Be="textdocId",Ke=e=>{const s=new URLSearchParams(window.location.search).get(Be),r=$t(e,n=>{var a,o,i;return(i=(o=(a=J.findNode(n,({message:l})=>{var d;const c=(d=l.metadata)==null?void 0:d.canvas;return(c==null?void 0:c.create_source)===ye.HIVE&&(s?(c==null?void 0:c.textdoc_id)===s:!0)}))==null?void 0:a.message.metadata)==null?void 0:o.canvas)==null?void 0:i.textdoc_id});p.useEffect(()=>{r&&requestAnimationFrame(()=>{Jt(r)})},[r])};function Ye(e,t){let s;return(t==null?void 0:t.type)===S.Textdoc&&(t.textdocId.startsWith(_e)||(s={type:"canvas_textdoc",id:t.textdocId})),Ie(e,{promptMessage:{metadata:{open_in_canvas_view:s}}})}const se=({isFullScreen:e=!1,clientThreadId:t,focusedObject:s,onClose:r,isAnimating:n=!1,width:a})=>{const{setTargetedContent:o}=Se(),i=p.useRef(!1);if(p.useEffect(()=>(i.current&&o(void 0),i.current=!0,()=>{i.current=!1}),[s]),s==null)return null;switch(s.type){case S.Textdoc:return m.jsx(He,{isFullScreen:e,onClose:r,clientThreadId:t,focusedTextdoc:s,isAnimating:n,width:a});case S.ADAVisualization:return null}},$e=300,Xe=e=>{switch(e==null?void 0:e.type){case S.Textdoc:return e.textdocId;default:return null}};function Je({clientThreadId:e,isDisabled:t,disabledTypes:s}){const[r,n,a,o,i]=$t(e,x=>[J.getRequestId(x),J.getConversationLastTurn(x),J.isMessageTurnEnded(x),J.getVariantIds(x).length>1,J.lastUserMessage(x)],{disablePerfDetector:!0}),l=fe(r),c=we(),[d,f]=p.useMemo(()=>{if(n&&o)return[void 0,null];if(t===!0)return[void 0,null];if(i!=null){const C=Ee(i);if(C)return[i.id,{type:S.Textdoc,textdocId:C}]}let x;return!a&&n&&(x=he(n.messageGroups,C=>C.type!==pe)),Qe({groupedMessage:x,isRequestActive:l,latestTextdocId:c,disabledTypes:s})},[a,n,o,t,l,c,s,i]),u=f!=null,bt=Xe(f),yt=Ae("canvas");p.useEffect(()=>{if(f&&d&&!xe()&&(yt(),Ne(f,d),f.type===S.Textdoc)){const{textdocId:x}=f,C=We(x);Re(document.getElementById(C))}},[u,bt])}function Qe({groupedMessage:e,isRequestActive:t,latestTextdocId:s,disabledTypes:r}){var n,a;if(e!=null&&e.type&&r.includes(e.type))return[void 0,null];switch(e==null?void 0:e.type){case Xt.Canmore:{const[o,i]=e.messages;if(!Fe(o))break;const l=De(t,o,i!=null?i:null),c=(n=l.textdocId)!=null?n:s;if(c&&(l.function===qe.CreateTextdoc?((a=l.content)!=null?a:"").length>$e||l.status===Gt.WAITING:l.status===Gt.STREAMING))return[l.messageId,{type:S.Textdoc,textdocId:c}];break}}return[void 0,null]}const vt={type:"spring",bounce:.12},Ze={type:"spring",bounce:0},_={duration:0},ts=e=>{"use forget";const t=Yt.c(112),{clientThreadId:s,focusedObject:r,onClose:n}=e,a=Z(),{chatWidth:o,canvasWidthCalc:i,handleDrag:l,handleDoubleClick:c,persist:d}=Ge();let f;t[0]!==a?(f=Lt(a),t[0]=a,t[1]=f):f=t[1];const u=f,[bt,yt]=p.useState(!u),[x,C]=p.useState(!1),_t=u?_:vt,It=u?_:Ze,T=je(os);let tt;t[2]!==a?(tt=()=>jt(a),t[2]=a,t[3]=tt):tt=t[3];const{height:v,width:w}=kt(tt);let et;t[4]!==o||t[5]!==v||t[6]!==T||t[7]!==w?(et=T!=null?T:{top:0,left:o,width:w-o,height:v},t[4]=o,t[5]=v,t[6]=T,t[7]=w,t[8]=et):et=t[8];let h=et,Pt=!1;if(T&&(h.top<0||h.top+h.height>v)){Pt=!0;const xt=(w-o)*.75,Q=v*.75;let gt;t[9]!==xt||t[10]!==Q?(gt={width:xt,height:Q},t[9]=xt,t[10]=Q,t[11]=gt):gt=t[11];const y=gt,Ft=v/2-y.height/2,Dt=(w-o-y.width)/2+o;let Ct;t[12]!==y.height||t[13]!==y.width||t[14]!==Ft||t[15]!==Dt?(Ct={top:Ft,left:Dt,width:y.width,height:y.height},t[12]=y.height,t[13]=y.width,t[14]=Ft,t[15]=Dt,t[16]=Ct):Ct=t[16],h=Ct}const g=T==null?void 0:T.borderRadius,b=Le(),St=(b==null?void 0:b.history)!=null||(b==null?void 0:b.showChangesAtVersion)!=null,ne=ve();let E;t[17]!==b||t[18]!==St?(E=St&&m.jsx(Me,{onClick:()=>Pe(b.textdocId),zIndexKey:"chatOverlay"}),t[17]=b,t[18]=St,t[19]=E):E=t[19];const wt=ne?-260:0;let A;t[20]!==wt?(A={marginInlineEnd:wt},t[20]=wt,t[21]=A):A=t[21];let st;t[22]===Symbol.for("react.memo_cache_sentinel")?(st={marginInlineEnd:0},t[22]=st):st=t[22];let nt,ot,it;t[23]===Symbol.for("react.memo_cache_sentinel")?(ot={opacity:1},it={opacity:0},nt={opacity:[1,0]},t[23]=nt,t[24]=ot,t[25]=it):(nt=t[23],ot=t[24],it=t[25]);let N;t[26]!==u?(N=u?_:Wt(qt({},vt),{delay:.22}),t[26]=u,t[27]=N):N=t[27];let R;t[28]!==N?(R=m.jsx(I.div,{initial:ot,animate:it,exit:nt,transition:N,className:"bg-token-main-surface-primary pointer-events-none absolute start-0 top-0 z-20 h-full w-full"}),t[28]=N,t[29]=R):R=t[29];let F;t[30]!==i?(F={width:i},t[30]=i,t[31]=F):F=t[31];let at;t[32]===Symbol.for("react.memo_cache_sentinel")?(at={width:0},t[32]=at):at=t[32];let D;t[33]!==u?(D=u?_:{type:"spring",bounce:0},t[33]=u,t[34]=D):D=t[34];let q;t[35]!==F||t[36]!==D?(q=m.jsx(I.div,{className:"relative z-20 h-full",style:F,exit:at,transition:D}),t[35]=F,t[36]=D,t[37]=q):q=t[37];let O;t[38]!==It||t[39]!==R||t[40]!==q||t[41]!==A?(O=m.jsxs(I.div,{initial:A,animate:st,transition:It,children:[R,q]}),t[38]=It,t[39]=R,t[40]=q,t[41]=A,t[42]=O):O=t[42];const Et=Pt?0:1;let k;t[43]!==g||t[44]!==h.height||t[45]!==h.left||t[46]!==h.top||t[47]!==h.width||t[48]!==Et?(k={borderRadius:g,opacity:Et,x:h.left,y:h.top,height:h.height,width:h.width},t[43]=g,t[44]=h.height,t[45]=h.left,t[46]=h.top,t[47]=h.width,t[48]=Et,t[49]=k):k=t[49];let j;t[50]!==i||t[51]!==o||t[52]!==v?(j={opacity:1,x:o,y:0,width:i,height:v,borderRadius:0},t[50]=i,t[51]=o,t[52]=v,t[53]=j):j=t[53];let L;t[54]!==u?(L=u?_:{opacity:{type:"spring",bounce:.1}},t[54]=u,t[55]=L):L=t[55];let P;t[56]!==g||t[57]!==L?(P={scale:.64,opacity:0,filter:"blur(12px)",transition:L,borderRadius:g},t[56]=g,t[57]=L,t[58]=P):P=t[58];const At=x||u?_:vt;let rt;t[59]===Symbol.for("react.memo_cache_sentinel")?(rt=()=>yt(!1),t[59]=rt):rt=t[59];let M;t[60]!==g?(M={borderRadius:g},t[60]=g,t[61]=M):M=t[61];let lt;t[62]===Symbol.for("react.memo_cache_sentinel")?(lt={borderRadius:0},t[62]=lt):lt=t[62];let H;t[63]!==g?(H={borderRadius:g},t[63]=g,t[64]=H):H=t[64];let ct,dt;t[65]===Symbol.for("react.memo_cache_sentinel")?(ct={opacity:.5},dt={opacity:.75,width:"8px",left:"-4px"},t[65]=ct,t[66]=dt):(ct=t[65],dt=t[66]);let W;t[67]!==u?(W=u?_:{type:"tween",duration:.1},t[67]=u,t[68]=W):W=t[68];let mt;t[69]===Symbol.for("react.memo_cache_sentinel")?(mt={x:0,y:0,transform:"translateX(0px)"},t[69]=mt):mt=t[69];let ut,ft,ht;t[70]===Symbol.for("react.memo_cache_sentinel")?(ut={left:0,right:0,top:0,bottom:0},ft=()=>C(!0),ht=()=>C(!1),t[70]=ut,t[71]=ft,t[72]=ht):(ut=t[70],ft=t[71],ht=t[72]);let U;t[73]!==l?(U=(xt,Q)=>l(Q),t[73]=l,t[74]=U):U=t[74];let z;t[75]!==o||t[76]!==d?(z=()=>{C(!1),d(o)},t[75]=o,t[76]=d,t[77]=z):z=t[77];let G;t[78]!==c?(G=()=>c(),t[78]=c,t[79]=G):G=t[79];let V;t[80]!==W||t[81]!==U||t[82]!==z||t[83]!==G?(V=m.jsx(I.div,{drag:"x",className:"bg-token-text-quaternary absolute start-[-2px] z-10 h-full w-[4px] cursor-ew-resize opacity-0",whileHover:ct,whileDrag:dt,transition:W,style:mt,dragMomentum:!1,dragSnapToOrigin:!1,dragElastic:!1,dragConstraints:ut,onPointerDown:ft,onPointerUp:ht,onDrag:U,onDragEnd:z,onDoubleClick:G}),t[80]=W,t[81]=U,t[82]=z,t[83]=G,t[84]=V):V=t[84];let B;t[85]!==x?(B=x&&m.jsx("div",{className:"absolute inset-0 z-10"}),t[85]=x,t[86]=B):B=t[86];const Nt=!u&&bt,Rt=w-o;let K;t[87]!==s||t[88]!==r||t[89]!==n||t[90]!==Nt||t[91]!==Rt?(K=m.jsx(se,{onClose:n,clientThreadId:s,isAnimating:Nt,focusedObject:r,width:Rt}),t[87]=s,t[88]=r,t[89]=n,t[90]=Nt,t[91]=Rt,t[92]=K):K=t[92];let Y;t[93]!==V||t[94]!==B||t[95]!==K?(Y=m.jsxs("div",{className:"h-full",children:[V,B,K]}),t[93]=V,t[94]=B,t[95]=K,t[96]=Y):Y=t[96];let $;t[97]!==M||t[98]!==H||t[99]!==Y||t[100]!==_t?($=m.jsx(I.div,{className:"dark:border-token-border-light border-token-border-medium h-full overflow-hidden border-s",initial:M,animate:lt,exit:H,transition:_t,children:Y}),t[97]=M,t[98]=H,t[99]=Y,t[100]=_t,t[101]=$):$=t[101];let X;t[102]!==k||t[103]!==j||t[104]!==P||t[105]!==At||t[106]!==$?(X=m.jsx(I.div,{className:"bg-token-bg-primary absolute start-0 z-20 h-full overflow-hidden shadow-[0_0_18px_rgba(0,0,0,0.12)] dark:shadow-[0_0_18px_rgba(0,0,0,0.48)]",initial:k,animate:j,exit:P,transition:At,onAnimationComplete:rt,children:$}),t[102]=k,t[103]=j,t[104]=P,t[105]=At,t[106]=$,t[107]=X):X=t[107];let pt;return t[108]!==O||t[109]!==E||t[110]!==X?(pt=m.jsxs(m.Fragment,{children:[E,O,X]}),t[108]=O,t[109]=E,t[110]=X,t[111]=pt):pt=t[111],pt},es=p.memo(ts),ss=e=>{"use forget";const t=Yt.c(9),{clientThreadId:s,focusedObject:r,onClose:n}=e,a=Z(),o=Lt(a);let i,l;t[0]===Symbol.for("react.memo_cache_sentinel")?(i={scale:.98},l={scale:1},t[0]=i,t[1]=l):(i=t[0],l=t[1]);const c=o?_:vt;let d;t[2]!==s||t[3]!==r||t[4]!==n?(d=m.jsx(se,{isFullScreen:!0,clientThreadId:s,focusedObject:r,onClose:n}),t[2]=s,t[3]=r,t[4]=n,t[5]=d):d=t[5];let f;return t[6]!==c||t[7]!==d?(f=m.jsx(Te,{open:!0,className:"fixed inset-0 z-50 h-full w-full",children:m.jsx(I.div,{className:"z-40 h-full w-full overflow-hidden shadow-xl md:border-gray-100 md:dark:border-gray-700",initial:i,animate:l,transition:c,children:d})}),t[6]=c,t[7]=d,t[8]=f):f=t[8],f},ns=({clientThreadId:e,overrideWidth:t,isAutoFocusDisabled:s=!1})=>{const r=Z(),n=ke(),a=ee(t),o=Lt(r);Je({clientThreadId:e,isDisabled:s,disabledTypes:o?[Xt.Canmore]:[]}),Ve(),Ke(e);const i=p.useRef(!1);p.useEffect(()=>{i.current?Qt():i.current=!0},[e]);const l=n&&(a?m.jsx(es,{clientThreadId:e,onClose:Bt,focusedObject:n},"canvas-sidebar"):m.jsx(ss,{clientThreadId:e,onClose:Bt,focusedObject:n},"canvas-modal"));p.useEffect(()=>{if(n)return Vt(d=>Ye(d,n)),()=>Vt(null)},[n]);const c=l!=null;return p.useEffect(()=>(zt.setActiveStageSidebar(c),()=>{c&&zt.setActiveStageSidebar(!1)}),[c]),o?l:m.jsx(Ce,{children:l},e)},rn=e=>{const t=p.useRef(null);return m.jsx(ge,{ref:t,onError:(s,r)=>{Qt(),setTimeout(()=>{var n;(n=t.current)==null||n.resetErrorBoundary()}),Oe.logError("Error boundary hit",s,{componentStack:r})},name:"canmore-focused-view",children:m.jsx(ns,qt({},e))})};function os(e){const{rect:t}=e;return t}export{rn as CanvasFocusedViewManager};
//# sourceMappingURL=kl7k9lkcmwoxg3bk.js.map
