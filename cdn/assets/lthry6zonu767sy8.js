const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/iwjq7ihlx67l3ajk.js","assets/fg33krlcm0qyi6yw.js","assets/mtk1qztvnb31pw5r.js","assets/root-mcq3deyb.css","assets/k65njl5wlgspihfr.js","assets/conversation-small-332fs9rk.css","assets/hcn3kohxpjzaoxwc.js","assets/exbyaee45o0onuld.js","assets/ifr23omr9d78ntp2.js"])))=>i.map(i=>d[i]);
var H=Object.defineProperty,Y=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var R=(t,e,o)=>e in t?H(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,N=(t,e)=>{for(var o in e||(e={}))$.call(e,o)&&R(t,o,e[o]);if(O)for(var o of O(e))X.call(e,o)&&R(t,o,e[o]);return t},U=(t,e)=>Y(t,z(e));import{r as x,a as F,b as J,j as n,M as u,_ as Z,d as ee,u as te}from"./fg33krlcm0qyi6yw.js";import{R as T,d as P,k as oe,b as A,bJ as W,o as ne,sO as se,bh as re,e2 as M,dQ as ie,e4 as E,aK as ae,aL as le,m as de,dI as ue,l as B,a9 as L,p8 as ce,I as me,P as C,dL as q,dR as G,A as fe}from"./mtk1qztvnb31pw5r.js";import{jl as pe,jm as he,jn as ye,jo as xe,dr as ge,bq as v,jp as Me,bp as be,jq as _e,fx as je}from"./k65njl5wlgspihfr.js";import{M as ve}from"./czwlkhzq2wjwrbr9.js";import{G as Te}from"./exbyaee45o0onuld.js";import"./ifr23omr9d78ntp2.js";import"./hcn3kohxpjzaoxwc.js";const S="memories/current_memory_undo_id",D={async getCurrentMemoryUndoId(t){return await T.safeGet("/memories/current_memory_undo_id",{parameters:{query:{gizmo_id:t}}})},async undoMemoryWrite(t,e){return await T.safePost("/memories/undo_memory_write",{requestBody:{gizmo_id:t,memory_undo_id:e}})}},Pe=re(()=>Z(()=>import("./iwjq7ihlx67l3ajk.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])));let I=!1;function K(t){return t.find(e=>{var o;return e.author.role===M.Tool&&((o=e.metadata)==null?void 0:o.pending_memory_info)})}function Se(t){return t.filter((e,o)=>{const s=t[o+1],a=(s==null?void 0:s.recipient)==="assistant"&&(s==null?void 0:s.author.role)===M.Tool&&(s==null?void 0:s.author.name)==="bio"&&ie(s).startsWith("Model set context");return e.author.role===M.Assistant&&e.recipient==="bio"&&a}).flatMap(e=>{const o=e.content.content_type;return o===E.Text?e.content.parts:o===E.Code?[e.content.text]:[]}).map(Ee)}function Ae(t){return t.some(e=>e.author.role===M.Assistant&&e.recipient==="bio"&&e.status==="in_progress")}function Ce(t){var o;const e=t.find(s=>s.author.role===M.Tool&&s.author.name==="bio"&&s.recipient===M.Assistant);return(o=e==null?void 0:e.metadata)==null?void 0:o.current_memory_undo_id}function ke(t){const{eligible:e,isLoading:o}=he(),s=x.useMemo(()=>t.length>0,[t]);x.useEffect(()=>{s&&e&&!o&&ae.openModal(le.GlobalMemoryOnboarding)},[s,e,o])}function we(t){const[e,o]=x.useState(!1);return{isPopoverOpen:e,setIsPopoverOpen:o,handleTogglePopover:r=>{const a=r!=null?r:!e;o(a),a&&C.logEvent("Memory Update Popover Shown",{updateCount:t.length})}}}function Q({memoryWrites:t,popoverState:e,triggerButton:o,isParagen:s,gizmoId:r,memoryUndoId:a,setShowMemoriesModal:l,disableActions:d}){return n.jsxs(_e,{open:e.isPopoverOpen,sideOffset:4,side:"bottom",alignAgainstAnchor:"start",size:"none",className:"z-10 max-w-96 min-w-60 text-sm",onOpenChange:i=>e.handleTogglePopover(i),disableAutofocus:!0,triggerButton:o,children:[n.jsx("div",{className:"border-token-border-default bg-token-main-surface-secondary mb-2 rounded-sm border",children:t.map((i,c)=>n.jsx("div",{className:"border-token-border-default border-b px-3 py-2 first-letter:uppercase last:border-b-0",children:i},c))}),s?n.jsx("div",{className:"text-token-text-tertiary text-xs",children:n.jsx(u,{id:"MemoryActionResult.paragenMessage",defaultMessage:"This memory will be saved if you choose this response."})}):d?null:n.jsxs(n.Fragment,{children:[n.jsx(Ue,{gizmoId:r,memoryUndoId:a}),n.jsx(V,{onClick:()=>{l(!0),C.logEvent("Memory Update Popover Manage Button Clicked",{updateCount:t.length})},children:n.jsx(u,{id:"MemoryActionResult.manageMemories",defaultMessage:"Manage"})})]})]})}function Oe({clientThreadId:t,pendingMessage:e,memoryWrites:o,popoverState:s,setShowMemoriesModal:r,disableActions:a}){const l=de(),d=ue(t),i=ye({clientThreadId:t}),c=o.join(" ");let m=c.slice(0,50).replace(new RegExp("^\\p{L}","u"),p=>p.toLocaleUpperCase()).replace(/\.$/,"");c.length>50&&(m+="...");const b=async p=>{var h;if(!d)throw new Error("Failed to confirm or reject memory update: serverThreadId is not found");const g=(h=e.metadata)==null?void 0:h.pending_memory_info;q(t,f=>{G.updateTree(f,y=>{y.updateNodeMessageMetadata(e.id,{pending_memory_info:U(N({},g),{is_pending:!1,confirm_result:p})})})});try{await T.safePost("/memories/confirm_or_reject",{requestBody:{message_id:e.id,conversation_id:d,is_confirm:p},authOption:fe.SendIfAvailable})}catch(f){l.danger(ee({id:"memory.confirmOrDenyFail",defaultMessage:"Failed to confirm or reject memory update"}),{toastId:"memory_confirm_or_deny_fail"}),q(t,y=>{G.updateTree(y,_=>{_.updateNodeMessageMetadata(e.id,{pending_memory_info:g})})})}};return n.jsxs("div",{className:"flex items-start",children:[n.jsx("div",{className:"text-token-text-tertiary inline-block text-sm font-semibold outline-hidden",children:n.jsx(u,{id:"MemoryActionResult.memoryConfirmation",defaultMessage:"Update memory? {memoryText}",values:{memoryText:n.jsx("div",{className:"inline-block py-1",onMouseOver:()=>s.handleTogglePopover(!0),onMouseOut:()=>s.handleTogglePopover(!1),children:n.jsx(Q,{memoryWrites:o,popoverState:s,disableActions:a,triggerButton:n.jsx("button",{className:B("text-start font-normal",s.isPopoverOpen?"text-token-text-secondary":"text-token-text-tertiary"),children:n.jsx(u,{id:"MemoryActionResult.memoryWrapper",defaultMessage:"“{memoryWrites}”",values:{memoryWrites:m}})}),setShowMemoriesModal:r})})}})}),n.jsx(L,{className:"text-token-text-tertiary hover:text-token-text-primary ms-3",size:"small",color:"secondary",disabled:i,onClick:()=>{b(!0)},children:n.jsx(u,{id:"MemoryActionResult.confirm",defaultMessage:"Yes"})}),n.jsx(L,{className:"text-token-text-tertiary hover:text-token-text-primary ms-2",size:"small",color:"secondary",disabled:i,onClick:()=>{b(!1)},children:n.jsx(u,{id:"MemoryActionResult.deny",defaultMessage:"No"})})]})}function Re({memoryWrites:t,popoverState:e,isParagen:o,memoryUndoId:s,gizmoId:r,setShowMemoriesModal:a,showTooltip:l,disableActions:d}){const i=xe(),{eligible:c,isLoading:m}=ge(v.hasSeenMemoryUpdatedTooltip),b=!P(ce),[p,g]=x.useState(!1),h=A(),f=me(h),y=f==null?void 0:f.hasPlusFeatures();return x.useEffect(()=>{!m&&c&&i&&l===!0&&!I?(g(!0),I=!0):!m&&!c&&g(!1)},[l,m,c,i]),t.length===0?null:n.jsxs("div",{className:"flex items-center",children:[n.jsx(Me,{announcementKey:v.hasSeenMemoryUpdatedTooltip,show:p,onDismiss:()=>{be(h,v.hasSeenMemoryUpdatedTooltip),C.logEventWithStatsig("Memory Updated Tooltip Dismissed","memory_updated_tooltip_dismissed")},dismissOnOutsideClick:!0,side:b?"bottom":"left",sideOffset:4,theme:"bright",badge:"none",title:n.jsx(u,{id:"MoonshineV2Tooltip.heading",defaultMessage:"Memory in ChatGPT has changed"}),description:n.jsxs(n.Fragment,{children:[y?n.jsx(u,{id:"MoonshineV2Tooltip.description",defaultMessage:"ChatGPT can now reference all chats, but you can still manage individual saved memories."}):n.jsx(u,{id:"MoonshineV2Tooltip.description.freeMoonshine",defaultMessage:"ChatGPT can now reference recent chats, but you can still manage individual saved memories."}),n.jsx("br",{}),n.jsx("a",{href:"https://help.openai.com/en/articles/10303002-how-does-memory-use-past-conversations",target:"_blank",rel:"noopener noreferrer",className:"underline",children:n.jsx(u,{id:"MoonshineV2Tooltip.learnMoreLink",defaultMessage:"Learn more"})},"learn-more-link")]}),children:n.jsx("div",{style:{width:1,height:1}})}),n.jsx("div",{className:"inline-block",onMouseOver:()=>e.handleTogglePopover(!0),onMouseOut:()=>e.handleTogglePopover(!1),children:n.jsx(Q,{memoryWrites:t,popoverState:e,isParagen:o,gizmoId:r,memoryUndoId:s,disableActions:d,triggerButton:n.jsxs("button",{className:B("my-1 flex items-center gap-1 text-sm font-semibold outline-hidden",e.isPopoverOpen?"text-token-text-secondary":"text-token-text-tertiary"),children:[n.jsx(ve,{className:"mb-[-1px]"}),t.length===1?n.jsx(u,{id:"MemoryActionResult.memoryWriteSingular.New",defaultMessage:"Updated saved memory"}):n.jsx(u,{id:"MemoryActionResult.memoryWritePlural.New",defaultMessage:"Updated saved memories"})]}),setShowMemoriesModal:a})})]})}function Ne(t){var s,r;const e=K(t),o=(r=(s=e==null?void 0:e.metadata)==null?void 0:s.pending_memory_info)==null?void 0:r.confirm_result;return e==null?null:o===!0?"confirmed":o===!1?"denied":"pending"}function Ke({messages:t,clientThreadId:e,gizmoId:o,isParagen:s}){const r=Se(t),a=we(r),l=Ae(t),d=Ce(t),i=A(),c=P(()=>oe(i));ke(r);const m=K(t),p=W(i,"3983984123").get("is_memory_undo_enabled",!1);ne(i,"1900515849");const g=pe(i),h=P(se(i,e)),f=x.useRef(!1),y=F();x.useEffect(()=>{l&&f.current===!1&&(f.current=!0),!l&&!m&&d&&f.current&&y.invalidateQueries({queryKey:[S,o]})},[l,m,d,o,y]);const{data:_}=J({queryKey:[S,o],queryFn:()=>D.getCurrentMemoryUndoId(o),enabled:p&&!l&&!m}),[k,j]=x.useState(!1),w=Ne(t);return w==="denied"?null:n.jsxs(n.Fragment,{children:[w==="pending"?n.jsx(Oe,{clientThreadId:e,memoryWrites:r,popoverState:a,setShowMemoriesModal:j,pendingMessage:m,disableActions:c}):n.jsx(Re,{memoryWrites:r,popoverState:a,isParagen:s,memoryUndoId:(_==null?void 0:_.current_memory_undo_id)===d?d:void 0,setShowMemoriesModal:j,showTooltip:f.current&&r.length>0,disableActions:c}),k?g?n.jsx(Te,{isOpen:k,initialGizmoId:o,contextScopes:h,onClose:()=>j(!1)}):n.jsx(Pe,{initialGizmoId:o,contextScopes:h,onClose:()=>j(!1)}):null]})}function V({children:t,disabled:e,onClick:o}){return n.jsxs("button",{className:"hover:bg-token-main-surface-secondary flex w-full items-center justify-between rounded-sm px-3 py-2 font-semibold",disabled:e,onClick:o,children:[t,n.jsx(je,{className:"icon text-token-text-tertiary -me-1"})]})}function Ue({gizmoId:t,memoryUndoId:e}){const o=A(),r=W(o,"3983984123").get("is_memory_undo_enabled",!1),a=F(),{isPending:l,mutate:d}=te({mutationFn:i=>D.undoMemoryWrite(t,i),onSuccess:()=>{a.invalidateQueries({queryKey:[S,t]})}});return!r||!e?null:n.jsx(V,{disabled:l,onClick:()=>{e&&d(e)},children:n.jsx(u,{id:"qeyS8G",defaultMessage:"Undo"})})}function Ee(t){const e=["The user ","The user's ","User ","User's "];for(const o of e)if(t.startsWith(o))return t.slice(o.length);return t}export{Ke as MemoryActionResult};
//# sourceMappingURL=lthry6zonu767sy8.js.map
