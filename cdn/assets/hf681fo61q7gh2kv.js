var oe=Object.freeze,ce=Object.defineProperty,Se=Object.defineProperties;var Ve=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var Ae=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var de=(e,t,i)=>t in e?ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,q=(e,t)=>{for(var i in t||(t={}))Ae.call(t,i)&&de(e,i,t[i]);if(re)for(var i of re(t))De.call(t,i)&&de(e,i,t[i]);return e},K=(e,t)=>Se(e,Ve(t));var te=(e,t)=>oe(ce(e,"raw",{value:oe(t||e.slice())}));import{e as ae,r as w,j as a,f as ve,M as ge}from"./fg33krlcm0qyi6yw.js";import{dw as Pe,aP as Te,ai as Oe,at as Fe,aj as Le,ak as Re,ao as Ge,l as V,as as Be,i9 as ze,a9 as X,bX as $e,bv as We,bg as ee,gr as me,hh as be,c_ as Ue,e4 as He,F as je,n as Xe,W as Ye,fN as qe,eh as Ke,$ as Q,P as J,go as Z,m as Qe,hv as Je}from"./mtk1qztvnb31pw5r.js";import{A as Ze}from"./cnrdqaihcmlb57i1.js";import{A as ea}from"./lbbnz7rb7sd2lk50.js";import{kY as aa,kZ as ta,eg as sa,k_ as na,ec as A,iX as ia,k$ as la,l0 as Y,bo as oa,eF as _e,eJ as ra,iM as da,l1 as ca,iN as ga,l2 as ma,gc as ye,ge as Me,fu as ke,l3 as ua,c$ as fa}from"./k65njl5wlgspihfr.js";import{D as Ce,u as xa,I as se}from"./eoe4b0mmb8r0rg3f.js";import{D as ha}from"./je866d95n4n31rpb.js";import"./l9v3ntkj34comb67.js";const pa={enter:e=>({zIndex:0,x:e===-1?"10%":"-10%",opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:e=>({zIndex:0,x:e===1?"10%":"-10%",opacity:0})},Ia={enter:{opacity:0,y:"10%"},visible:{opacity:1,y:0},exit:{opacity:0,y:"10%"}},ue=1e3,fe=1e3,xe=(e,t)=>Math.abs(e)*t;function wa(e){var y,M;const t=ae(),i=Pe(),l=Te(),[f,b]=w.useState({width:0,height:0}),[u,d]=w.useState(!1),[o,x]=w.useState(e.image),[I,j]=w.useState(!1),E=f.width>0&&f.height>0,C=w.useRef(null),[N,r]=w.useState(0);w.useEffect(()=>{if(!o.url)throw new Error("ExpandableImage requires a src");const n=new Image;n.onload=()=>{b({width:n.naturalWidth,height:n.naturalHeight})},n.onerror=()=>{},n.src=o.url},[o.url]),w.useEffect(()=>{const n=C.current;if(I)return n==null||n.addEventListener("keydown",g),()=>{n==null||n.removeEventListener("keydown",g)};x(e.image)},[I]);function c(){x(n=>{const h=(e.images.findIndex(p=>p.url===n.url)+1)%e.images.length;return e.images[h]}),r(-1)}function _(){x(n=>{const m=e.images.findIndex(p=>p.url===n.url),h=m>0?(m-1)%e.images.length:e.images.length-1;return e.images[h]}),r(1)}function s(n){var m;j(n),n&&((m=e.onOpen)==null||m.call(e,o))}function g(n){n.key==="ArrowLeft"?_():n.key==="ArrowRight"&&c()}const v=e.images.findIndex(n=>n.url===o.url);return a.jsxs(Oe,{onOpenChange:s,children:[a.jsx(Fe,{disabled:!E,className:e.className,"aria-label":t.formatMessage(S.showImage),children:e.children}),a.jsx(Le,{container:i==null?void 0:i.document.body,children:a.jsx(Re,{className:"radix-state-open:animate-show fixed inset-0 z-20 flex items-center justify-center bg-black/90 backdrop-blur-xl",children:a.jsxs(Ge,{className:V("radix-state-open:animate-contentShow relative flex h-[100dvh] w-screen justify-stretch divide-x divide-white/10 focus:outline-hidden"),ref:C,children:[a.jsx("div",{className:V("flex flex-1 transition-[flex-basis]",!u&&"md:basis-[75vw]"),children:a.jsxs("div",{className:"flex flex-1 flex-col md:p-6",children:[a.jsxs("div",{className:"flex justify-between px-6 py-2 pt-6 text-white sm:mb-4 md:mt-2 md:px-0 md:py-2",children:[a.jsx(Be,{asChild:!0,children:a.jsx("button",{"aria-label":t.formatMessage(S.closeModal),children:a.jsx(ze,{})})}),a.jsx("div",{children:l&&a.jsxs(a.Fragment,{children:[(M=(y=e.getActions)==null?void 0:y.call(e,o))==null?void 0:M.map((n,m)=>a.jsx(X,{color:"ghost",size:"small",onClick:n.onClick,"aria-label":n.ariaLabel,disabled:n.disabled,icon:n.icon},m)),a.jsx(X,{color:"ghost",size:"small",onClick:()=>d(n=>!n),"aria-label":t.formatMessage(S.toggleSidebar),className:"md:inline-flex",icon:$e})]})})]}),a.jsx("div",{className:"relative flex flex-1 flex-col items-center justify-center overflow-hidden",children:a.jsx(We,{initial:!1,custom:N,children:a.jsxs(ee.div,{className:"absolute grid h-full w-full grid-rows-2",custom:N,variants:pa,drag:"x",dragConstraints:{left:0,right:0},dragElastic:1,onDragEnd:(n,{offset:m,velocity:h})=>{const p=xe(m.x,h.x);p<-ue?c():p>ue&&_()},children:[a.jsx(ee.img,{src:o.url,alt:o.alt,className:"row-span-4 mx-auto h-full object-scale-down",onPanEnd:(n,{offset:m,velocity:h})=>{const p=xe(m.y,h.y);p<-fe?d(!0):p>fe&&d(!1)}},o.url),!l&&u&&a.jsx(ee.div,{className:"flex text-white",variants:Ia,initial:"enter",animate:"visible",exit:"exit",transition:{y:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},children:e.metadataRenderer(o)})]},o.url)})}),e.images.length>1?a.jsxs("div",{className:"flex items-center justify-center gap-4 p-8 text-white",children:[a.jsx(X,{color:"ghost",size:"small",onClick:_,"aria-label":t.formatMessage(S.previousImage),icon:Ze}),e.images.map((n,m)=>{var h;return a.jsx("img",{src:n.url,alt:(h=n.alt)!=null?h:"",className:V("h-12 w-12 cursor-pointer rounded-sm object-cover transition duration-300 hover:opacity-100",n.url===o.url?"ring-2 ring-white ring-offset-4 ring-offset-black":"opacity-25"),onClick:()=>{x(n),r(m<v?1:-1)},"aria-label":t.formatMessage(S.showImage),role:"button"},n.url)}),a.jsx(X,{color:"ghost",size:"small",onClick:c,"aria-label":t.formatMessage(S.nextImage),icon:ea})]}):null]})}),a.jsx("div",{className:V("hidden items-center justify-start overflow-hidden bg-gray-900 text-white transition-[flex-basis] duration-500 md:flex",u?"md:basis-[25vw]":"md:basis-0"),children:a.jsx("div",{className:"w-[25vw] min-w-[25vw]",children:e.metadataRenderer(o)})})]})})})]})}const S=ve({showImage:{id:"imageViewer.showImage",defaultMessage:"Show Image"},closeModal:{id:"imageViewer.closeModal",defaultMessage:"Close Modal"},toggleSidebar:{id:"imageViewer.toggleSidebar",defaultMessage:"Toggle Sidebar"},nextImage:{id:"imageViewer.nextImage",defaultMessage:"Next Image"},previousImage:{id:"imageViewer.previousImage",defaultMessage:"Previous Image"}});function va({withLottie:e}){return a.jsxs("div",{className:"absolute start-0 top-0 flex h-full w-full items-center justify-center rounded-full",children:[a.jsx(ha,{animate:e,matchTextColor:!0,className:"h-6 w-6"}),a.jsx(ba,{})]})}function ba(){const[t,i]=w.useState(new Date);w.useEffect(()=>{i(new Date)},[]);const l=aa(+t,25e3);return a.jsx(ta,{percentage:l,thickness:1.25/23,className:"absolute start-1/2 top-1/2 h-10 w-10 -translate-x-1/2 -translate-y-1/2",backgroundStrokeClassName:"stroke-token-main-surface-tertiary",transitionDuration:"".concat((100-l)/100*.2,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"})}function Fa({messages:e,clientThreadId:t,disableClickThru:i=!1}){const[l,f]=e,b=sa(l),u=na(),d=e.some(I=>u.has(I.id));let o=null;f!=null&&me.isMultimodalTextMessage(f)&&(o=me.getImageAssetPointers(f));let x=A.Running;return o!=null?x=A.Finished:f!=null?x=A.Error:b&&(x=A.Stopped),a.jsx(Ce.Provider,{value:i,children:!d&&a.jsx(_a,{imageAssets:o!=null?o:[],clientThreadId:t,toolStatus:x,toolMessage:f,messageId:l.id})})}const ja="https://help.openai.com/en/articles/8932459",_a=({imageAssets:e,clientThreadId:t,toolMessage:i,toolStatus:l,messageId:f})=>{const b=ae(),u=be(t),d=ia(e,void 0,u),o=Ue(),x=la(t),I=w.useMemo(()=>l===A.Finished&&d.every(r=>!!r.data),[l,d]);if((i==null?void 0:i.content.content_type)===He.SystemError)return null;const j=Ne(e[0]),E=d.map(r=>r.data).filter(r=>r!=null),C=E.map(r=>K(q({},r),{alt:Y(r)})),N=(r=0)=>"".concat(f,"-image-").concat(r);return a.jsxs("div",{children:[a.jsxs(Ca,{$numItems:d.length,className:"my-1 transition-opacity duration-300",children:[d.length===0&&l===A.Running&&a.jsx(he,{layoutId:"loading:placeholder",shape:j,isToolRunning:!0},"loading"),d.map((r,c)=>{const{isLoading:_,data:s,error:g}=r;if(_)return a.jsx(he,{shape:j,layoutId:N(c)},c);if(g!=null||(s==null?void 0:s.url)==null)return a.jsx(ne,{layoutId:N(c),className:"text-token-text-tertiary text-sm",shape:j,children:a.jsx("div",{className:"flex min-h-full flex-col items-center justify-center gap-3 px-4 pb-5",children:b.formatMessage(k.imageLoadError)})},c);if(i&&s){const v=K(q({},s),{alt:Y(s)});return a.jsx(ya,{image:v,allImages:C,clientThreadId:t,toolMessage:i,index:c,onOpenImageEditor:()=>{oa.setFocusedObject({type:_e.Image,image:v,allImages:E,messageId:i.id})}},c)}})]}),o&&I&&a.jsx("div",{className:"text-md text-token-text-tertiary flex flex-row items-center py-2",children:a.jsx("span",{className:"me-2",children:x?a.jsx(ge,{id:"xQcNUs",defaultMessage:"Made with the old version of image generation. <link>Learn more</link>",values:{link:r=>a.jsx("a",{className:"text-token-text-tertiary underline underline-offset-4",href:ja,target:"_blank",rel:"noopener noreferrer",children:r})}}):a.jsx(ge,{id:"hyynYz",defaultMessage:"Made with the old version of image generation. New version <link>available now</link>.",values:{link:r=>a.jsx("a",{className:"text-token-text-tertiary underline underline-offset-4",href:"https://openai.com/index/introducing-4o-image-generation/",target:"_blank",rel:"noopener noreferrer",children:r})}})})})]})};function ya({toolMessage:e,clientThreadId:t,allImages:i,image:l,index:f,onOpenImageEditor:b}){const u=ae(),d=be(t),o=Ne(l),x=w.useContext(Ce),[I,j]=w.useState({}),E=xa({clientThreadId:t});async function C(s){ua(s,d,e.id,x)}function N(s){var g,v,y,M,n,m,h,p,D,P,T,O,F,L,R,G,B,z,$,W,U,H;Q.logEvent("chatgpt_dalle_image_view_full",null,{sourceOperation:(y=(v=(g=s.metadata)==null?void 0:g.dalle)==null?void 0:v.edit_op)!=null?y:"none",hasParent:(n=(M=s.metadata)==null?void 0:M.dalle)!=null&&n.parent_gen_id?"true":"false",model:"dalle"}),J.logEvent("chatgpt_dalle_image_view_full",{conversationId:d,messageId:e.id,generationId:(h=(m=s.metadata)==null?void 0:m.dalle)==null?void 0:h.gen_id,parentGenerationId:(D=(p=s.metadata)==null?void 0:p.dalle)==null?void 0:D.parent_gen_id,fileId:Z(s.asset_pointer),sourceOperation:(T=(P=s.metadata)==null?void 0:P.dalle)==null?void 0:T.edit_op,model:"dalle"}),Q.logEvent("chatgpt_image_view_full",null,{sourceOperation:(L=(F=(O=s.metadata)==null?void 0:O.dalle)==null?void 0:F.edit_op)!=null?L:"none",hasParent:(G=(R=s.metadata)==null?void 0:R.dalle)!=null&&G.parent_gen_id?"true":"false",model:"dalle"}),J.logEvent("chatgpt_image_view_full",{conversationId:d,messageId:e.id,generationId:(z=(B=s.metadata)==null?void 0:B.dalle)==null?void 0:z.gen_id,parentGenerationId:(W=($=s.metadata)==null?void 0:$.dalle)==null?void 0:W.parent_gen_id,fileId:Z(s.asset_pointer),sourceOperation:(H=(U=s.metadata)==null?void 0:U.dalle)==null?void 0:H.edit_op,model:"dalle"})}function r(s,g){var y,M,n,m,h,p,D,P,T,O,F,L,R,G,B,z,$,W,U,H,ie,le;j(Ee=>K(q({},Ee),{[s.asset_pointer]:g}));const v=x?"chatgpt_dalle_image_captioning_rating":"chatgpt_dalle_image_rating";Q.logEvent(v,g?"like":"dislike",{liked:g?"true":"false",sourceOperation:(n=(M=(y=s.metadata)==null?void 0:y.dalle)==null?void 0:M.edit_op)!=null?n:"none",hasParent:(h=(m=s.metadata)==null?void 0:m.dalle)!=null&&h.parent_gen_id?"true":"false",model:"dalle"}),J.logEvent(v,{liked:g,conversationId:d,messageId:e.id,generationId:(D=(p=s.metadata)==null?void 0:p.dalle)==null?void 0:D.gen_id,parentGenerationId:(T=(P=s.metadata)==null?void 0:P.dalle)==null?void 0:T.parent_gen_id,fileId:Z(s.asset_pointer),sourceOperation:(F=(O=s.metadata)==null?void 0:O.dalle)==null?void 0:F.edit_op,model:"dalle"}),Q.logEvent("chatgpt_image_rating",g?"like":"dislike",{liked:g?"true":"false",sourceOperation:(G=(R=(L=s.metadata)==null?void 0:L.dalle)==null?void 0:R.edit_op)!=null?G:"none",hasParent:(z=(B=s.metadata)==null?void 0:B.dalle)!=null&&z.parent_gen_id?"true":"false",model:"dalle"}),J.logEvent("chatgpt_image_rating",{liked:g,conversationId:d,messageId:e.id,generationId:(W=($=s.metadata)==null?void 0:$.dalle)==null?void 0:W.gen_id,parentGenerationId:(H=(U=s.metadata)==null?void 0:U.dalle)==null?void 0:H.parent_gen_id,fileId:Z(s.asset_pointer),sourceOperation:(le=(ie=s.metadata)==null?void 0:ie.dalle)==null?void 0:le.edit_op,model:"dalle"})}function c(s){const g=I[s.asset_pointer],v={label:u.formatMessage(k.likeImage),onClick:()=>r(s,!0),disabled:g===!0,ariaLabel:u.formatMessage(k.likeImage),icon:ye},y={label:u.formatMessage(k.dislikeImage),onClick:()=>r(s,!1),disabled:g===!1,ariaLabel:u.formatMessage(k.dislikeImage),icon:Me},M={label:u.formatMessage(k.downloadImage),onClick:()=>C(s),ariaLabel:u.formatMessage(k.downloadImage),icon:ke};return[g!==!1&&v,g!==!0&&y,M].filter(Boolean)}let _=a.jsx(ka,{image:l,shape:o,rating:I[l.asset_pointer],onDownload:()=>C(l),onRate:(s,g)=>r(s,g),clientThreadId:t,layoutId:void 0});return E?_=a.jsx("div",{role:"button",onClick:b,children:_}):x||(_=a.jsx(wa,{image:l,images:i,metadataRenderer:s=>a.jsx(Ma,{image:s}),onOpen:N,getActions:c,children:_})),a.jsx("div",{className:"flex",children:_},f)}function he({shape:e,layoutId:t,isToolRunning:i=!1}){const{isOpen:l}=ra();return a.jsx(ne,{shape:e,layoutId:l?void 0:t,children:a.jsx("div",{className:"flex min-h-full items-center justify-center",children:a.jsx(va,{withLottie:i})})},"loading")}function Ma({image:e}){const t=ae(),[i,l]=w.useState(!1),f=Qe();function b(u){const d=Y(e);l(!0),Je(d,f,u),setTimeout(()=>{l(!1)},2e3)}return a.jsxs("div",{className:"flex flex-col items-start gap-3 p-6",children:[a.jsx("div",{className:"text-sm text-gray-300 sm:text-base",children:t.formatMessage(k.imageViewerMetadataTitle)}),a.jsx("div",{className:"max-h-32 overflow-y-auto text-sm md:max-h-[80vh] md:text-lg",children:Y(e)}),a.jsx(X,{color:"primary",onClick:b,disabled:i,className:"hidden sm:block",icon:fa,children:i?t.formatMessage(k.imageViewerMetadataCopyButtonCopied):t.formatMessage(k.imageViewerMetadataCopyButton)})]})}function ne({children:e,shape:t,className:i,layoutId:l}){return a.jsxs(ee.div,{layoutId:l,className:V("relative",i,t==="1792x1024"&&"aspect-7/4",t==="1024x1024"&&"aspect-square max-w-[400px]",t==="1024x1792"&&"aspect-4/7 max-w-xs","overflow-hidden rounded-2xl"),children:[a.jsx("div",{className:"bg-token-main-surface-secondary pointer-events-none absolute inset-0"}),a.jsx("div",{className:"relative h-full",children:e})]})}function ka({image:e,shape:t,rating:i,onDownload:l,onRate:f,clientThreadId:b,layoutId:u}){const d=Xe(Ye.isBusinessWorkspace),o=qe(b,c=>c==null?void 0:c.mode),x=da(),I=ca(),j=(I==null?void 0:I.type)===_e.Image&&I.image.asset_pointer===e.asset_pointer,{url:E,width:C,height:N}=e,r=!d&&(o==null?void 0:o.kind)!==Ke.GizmoMagicCreate;return a.jsxs(ne,{shape:t,className:"group/dalle-image",layoutId:j?void 0:u,children:[a.jsx(ga,{alt:Y(e),src:E,width:C,height:N}),a.jsx("div",{className:V("pointer-events-none absolute inset-0 rounded-2xl shadow-[inset_0_0_0_1px_rgba(0,0,0,0.1)] dark:shadow-[inset_0_0_0_1px_rgba(255,255,255,0.1)]",j?"bg-black/50 group-hover/dalle-image:bg-black/70":"group-hover/dalle-image:bg-transparent")}),x?!j&&a.jsx("div",{className:"pointer-events-none invisible absolute end-3 top-3 text-white group-hover/dalle-image:visible",children:a.jsx(ma,{})}):a.jsxs(a.Fragment,{children:[r&&a.jsxs(pe,{children:[i!==!1&&a.jsx(se,{icon:ye,selected:i===!0,onClick:c=>{c.stopPropagation(),f(e,!0)}}),i!==!0&&a.jsx(se,{icon:Me,selected:i===!1,onClick:c=>{c.stopPropagation(),f(e,!1)}})]}),a.jsx(pe,{$rightAlign:!0,children:a.jsx(se,{icon:ke,onClick:c=>{c.stopPropagation(),l()}})})]})]})}var Ie;const pe=je.div(Ie||(Ie=te(["invisible absolute top-3 flex gap-1 group-hover/dalle-image:visible z-2\n",""])),({$rightAlign:e})=>e?"end-3":"start-3");var we;const Ca=je.div(we||(we=te(["grid gap-2\n",""])),({$numItems:e})=>e<=1?"grid-cols-1":"grid-cols-2");function Ne(e){if(!e)return"1024x1024";const{width:t,height:i}=e;return t>i?"1792x1024":t<i?"1024x1792":"1024x1024"}const k=ve({creatingImages:{id:"dalleMessage.creatingImagesV2",defaultMessage:"Creating image"},stopped:{id:"dalleMessage.stoppedV3",defaultMessage:"Stopped creating image"},errorCreating:{id:"dalleMessage.errorCreatingV2",defaultMessage:"Error creating image"},imageLoadError:{id:"dalleMessage.imageLoadError",defaultMessage:"Error loading image"},imageViewerMetadataTitle:{id:"dalleMessage.imageViewerMetadataTitle",defaultMessage:"Prompt"},imageViewerMetadataCopyButton:{id:"dalleMessage.imageViewerMetadataCopyButton",defaultMessage:"Copy"},imageViewerMetadataCopyButtonCopied:{id:"dalleMessage.imageViewerMetadataCopyButtonCopied",defaultMessage:"Copied!"},imageEditButton:{id:"dalleMessage.imageEditButton",defaultMessage:"Edit"},downloadImage:{id:"imageViewer.downloadImage",defaultMessage:"Download Image"},likeImage:{id:"imageViewer.likeImage",defaultMessage:"Like Image"},dislikeImage:{id:"imageViewer.dislikeImage",defaultMessage:"Dislike Image"}});export{Fa as default};
//# sourceMappingURL=hf681fo61q7gh2kv.js.map
