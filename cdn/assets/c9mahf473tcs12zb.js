var E=Object.defineProperty,Q=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var F=(a,r,i)=>r in a?E(a,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[r]=i,l=(a,r)=>{for(var i in r||(r={}))H.call(r,i)&&F(a,i,r[i]);if(W)for(var i of W(r))J.call(r,i)&&F(a,i,r[i]);return a},D=(a,r)=>Q(a,G(r));import{a9 as X,j as o,ae as Y,e as Z,i as V,a as ee,u as te,d as ae,M as P,a0 as se}from"./fg33krlcm0qyi6yw.js";import{N as re}from"./uigmp4vviplizx3p.js";import{m as oe,c0 as ne}from"./mtk1qztvnb31pw5r.js";import{gk as ie}from"./k65njl5wlgspihfr.js";import{W as me}from"./gp2ycmyaevvj2458.js";import{R as ce,I as h,S as R}from"./kodpf00oq0c6g8b3.js";import{E as de,R as T,g as pe}from"./pfpitnv8krpxp6xj.js";import{u as ue}from"./mbk6r4n07eoyd764.js";import{d as le,a as he,e as _e}from"./n0ab5m1z76n8mazm.js";import{W as fe,a as ge,w as Se}from"./sy1xvqwioh9ks4z8.js";import"./dy5lfx8pblnkst90.js";import"./eb2ntjcgqhqizd13.js";import"./hots192vdjsjmkwr.js";import"./efooahjtdr85x1lo.js";import"./km71i01x6ma5r62b.js";import"./f9jzes5xr4mq3zrh.js";import"./j6htuwwuulo7h0p6.js";import"./czn39vd97sciq42g.js";import"./l9v3ntkj34comb67.js";import"./cmaobpdpreyiep8p.js";import"./eqi3xjytwhmszqqa.js";import"./bhm7utdivrybcfbl.js";import"./ohquqctluwabmb5i.js";import"./c2cj1dlcffke3f7m.js";import"./hb1mva1gmw4bcs8w.js";import"./mivow98b53y1taf8.js";import"./krwszi9u3lj63i9v.js";import"./kpobiwwkg2o2u14w.js";import"./ir7nzwbolrsm3ds2.js";import"./mmn9462oogkapcg8.js";import"./ck1u9icgxosmytry.js";import"./bes67zhi4fr5gq8i.js";import"./btdpwmi6j9nv6qc2.js";import"./keo7wnl5i52xco98.js";import"./m1mge0ilkwpbadjy.js";import"./oqrnd1sbz7sw61c1.js";import"./blmsijdyv0yxybpw.js";import"./ht7pa4q84q7i97x2.js";import"./lptwpbjabrvjmhsj.js";import"./ek8ypz08ir47cco2.js";import"./c39l581penbg6uen.js";import"./kg0cp341m64rddpv.js";import"./l09h2qppleubii6l.js";import"./mh627gt08lvdeswk.js";import"./kzbknm4lxuyoq9wi.js";import"./jed1ux7qibe55pmj.js";import"./h1em0bjkpkjv8ykw.js";import"./f5ep9o7usovyn4vf.js";import"./ly75bs3d14n5v622.js";import"./hu1bt0oauegdhua6.js";const ye=a=>typeof(a==null?void 0:a.name)=="string"&&a.name.length>0;function je(){const{environmentId:a}=X(),{eligible:r}=ie();return r?o.jsx(Y,{to:"/codex"}):a?o.jsx(we,{environmentId:a}):o.jsx(re,{})}function we({environmentId:a}){var y,j,w,b,v,k,M,N;const r=Z(),i=oe(),O=V(),_=ee(),{data:e,isLoading:U,isError:B}=le(a),n=e,f=t=>{const s=t.split("::");if(s.length>=2){const[m,...c]=s;return{domain:m||null,name:c.join("::")||t}}return{domain:null,name:t}},p=((y=n==null?void 0:n.secrets_with_domains)!=null?y:[]).filter(ye),g=(()=>{var t;if(p.length){const s={};for(const m of p){const c=(t=m.redacted)!=null?t:"";s[m.name]=c}return s}if(n!=null&&n.secrets){const s={};for(const[m,c]of Object.entries(n.secrets)){if(typeof c!="string")continue;const{name:u}=f(m);u&&(s[u]=c)}return s}return{}})(),$=p.map(t=>{var s;return{name:t.name,domain:(s=t.domain)!=null?s:null}}),S=n!=null&&n.secrets&&!n.secrets_with_domains?Object.keys(n.secrets).map(t=>{const s=f(t);return{name:s.name,domain:s.domain}}):[],I=ue()?"workspace":"private",{mutate:L,isPending:q}=te({mutationFn:t=>fe.updateEnvironment(a,t),onSuccess:async t=>{await he(_,a),_e(_,a,t),i.success(r.formatMessage({id:"wham.editEnvironment.environmentUpdatedSuccessfully",defaultMessage:"Environment updated successfully"})),O("/codex/settings/environment/".concat(a))},onError:t=>{if(t instanceof ge){Se(t,"wham_edit_environment_".concat(a),r,i);return}i.danger(ae({id:"wham.editEnvironment.failedToUpdateEnvironment",defaultMessage:"Failed to update environment"}),{toastId:"wham_edit_environment_failed_to_update_environment"})}});function K(t){var A,C;const s=pe(t.secrets,g,$),m=t.envVars.reduce((d,x)=>(d[x.key]=x.value,d),{}),c=(C=(A=t.share_targets)==null?void 0:A.map(d=>d.trim()))==null?void 0:C.filter(Boolean),u=t.share_settings==="private"?[]:c==null?void 0:c.map(d=>({email:d,permission:"editor",type:"user"})),z=l(D(l({etag:e==null?void 0:e.etag,label:t.label,repos:[t.repositoryId],machine_id:t.machine,setup:t.setupCommands,maintenance_setup:t.maintenanceSetupCommands,workspace_dir:t.workspaceDirectory,agent_network_access:t.agentNetworkAccess,description:t.description,share_settings:t.share_settings,share_targets:u},Array.isArray(s)?{secrets_with_domains:s}:{secrets:s}),{env_vars:m,auto_setup_settings:t.autoSetupSettings,cache_settings:t.cacheSettings}),t.enableAuthtranslator!==void 0?{enable_authtranslator:t.enableAuthtranslator}:{});L(z)}return o.jsx(me,{flex:!0,hideBorder:!0,showSidebar:!1,maxWidth:"w-full",children:U?o.jsx("div",{className:"flex h-full items-center justify-center",children:o.jsx(ne,{})}):B?o.jsx("div",{className:"flex h-full items-center justify-center",children:o.jsx(P,{id:"wham.editEnvironment.errorLoadingEnvironment",defaultMessage:"Error loading environment"})}):e?o.jsxs(o.Fragment,{children:[o.jsxs(ce,{className:"sticky top-0 px-4",children:[o.jsx(h,{label:r.formatMessage({id:"wham.editEnvironment.environments",defaultMessage:"Environments"}),url:"/codex/settings/environments",className:"text-token-text-tertiary"}),o.jsx(R,{}),o.jsx(h,{label:e.label,url:"/codex/settings/environment/".concat(a),className:"font-medium"}),o.jsx(R,{}),o.jsx(h,{label:r.formatMessage({id:"wham.editEnvironment.edit",defaultMessage:"edit"}),className:"text-token-text-tertiary"})]}),o.jsx(de,{initialEnvironmentId:a,existingEnvironment:e,initialValues:{label:e==null?void 0:e.label,description:(j=e==null?void 0:e.description)!=null?j:"",share_settings:(w=e==null?void 0:e.share_settings)!=null?w:I,share_targets:(v=(b=e==null?void 0:e.share_targets)==null?void 0:b.map(t=>t.email))!=null?v:[],machine:e==null?void 0:e.machine_id,repositoryId:e==null?void 0:e.repos[0],workspaceDirectory:(k=e==null?void 0:e.workspace_dir)!=null?k:"",agentNetworkAccess:e==null?void 0:e.agent_network_access,setupCommands:e!=null&&e.setup?Array.isArray(e==null?void 0:e.setup)?e.setup.join("\n"):e.setup:"",maintenanceSetupCommands:e!=null&&e.maintenance_setup?Array.isArray(e==null?void 0:e.maintenance_setup)?e.maintenance_setup.join("\n"):e.maintenance_setup:"",envVars:Object.entries((M=e==null?void 0:e.env_vars)!=null?M:{}).map(([t,s])=>({key:t,value:s})),enableAuthtranslator:(N=n==null?void 0:n.enable_authtranslator)!=null?N:!1,secrets:p.length?p.map(t=>{var s,m;return{key:t.name,value:T,isEditing:!1,domain:(s=t.domain)!=null?s:null,previousDomain:(m=t.domain)!=null?m:null,previousKey:t.name}}):(S.length?S:Object.keys(g).map(t=>({name:t,domain:null}))).map(t=>{var s,m;return{key:t.name,value:T,isEditing:!1,domain:(s=t.domain)!=null?s:null,previousDomain:(m=t.domain)!=null?m:null,previousKey:t.name}}),autoSetupSettings:e==null?void 0:e.auto_setup_settings,cacheSettings:e==null?void 0:e.cache_settings},primaryButtonText:r.formatMessage({id:"wham.editEnvironment.saveEnvironment",defaultMessage:"Save environment"}),onSubmit:K,isPending:q})]}):o.jsx("div",{className:"flex h-full items-center justify-center",children:o.jsx(P,{id:"wham.editEnvironment.environmentNotFound",defaultMessage:"Environment not found"})})})}const jt=()=>[{title:"Codex"}],wt=se(function(){return o.jsx(je,{})});export{wt as default,jt as meta};
//# sourceMappingURL=c9mahf473tcs12zb.js.map
