const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mq7uqtztbvim4zqv.js","assets/fg33krlcm0qyi6yw.js","assets/0z9e17m3c79jxrb9.js","assets/mtk1qztvnb31pw5r.js","assets/root-mcq3deyb.css","assets/f2sn8zvpzei2915e.js","assets/kfdkis1zwf4ccfgg.js","assets/ol9d5wxhynx9q2is.js","assets/mbmcx8v24u1ao1ke.js","assets/bhej3rsa4rgdh46m.js","assets/k65njl5wlgspihfr.js","assets/conversation-small-332fs9rk.css","assets/jcfo2542d2wvunuv.js","assets/sy1xvqwioh9ks4z8.js","assets/kzbknm4lxuyoq9wi.js","assets/jed1ux7qibe55pmj.js","assets/h1em0bjkpkjv8ykw.js","assets/f5ep9o7usovyn4vf.js","assets/ly75bs3d14n5v622.js","assets/hu1bt0oauegdhua6.js","assets/j37p94g6trtb4j3z.js","assets/lad8yx56mqsdspc9.js","assets/bes67zhi4fr5gq8i.js","assets/n0ab5m1z76n8mazm.js","assets/klzrztgvm2c9gs50.js","assets/zqbip2ya77i1mx4s.js","assets/kg0cp341m64rddpv.js","assets/ansi-1f6vhsjh.css","assets/lbbnz7rb7sd2lk50.js","assets/ck1u9icgxosmytry.js","assets/dq5a57hcb44a83mi.js","assets/cmaobpdpreyiep8p.js","assets/lptwpbjabrvjmhsj.js","assets/ose6175gtasqnfv0.js","assets/o51gjyxad96i2yey.js","assets/cv3wsu6uenrjij6h.js","assets/lbq5605sor1ah5hb.js","assets/n0qmvbt3dffalvvl.js","assets/fznnr8l9owxbou6l.js","assets/haneze5lyzwaewf8.js","assets/j4u691tk1tplayl2.js","assets/j0vhwkpwiqu2ejer.js","assets/changed-file-list-onn411v8.css"])))=>i.map(i=>d[i]);
var Wt=Object.freeze,Ut=Object.defineProperty,pn=Object.defineProperties;var gn=Object.getOwnPropertyDescriptors;var Bt=Object.getOwnPropertySymbols;var hn=Object.prototype.hasOwnProperty,xn=Object.prototype.propertyIsEnumerable;var At=(t,e,n)=>e in t?Ut(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,R=(t,e)=>{for(var n in e||(e={}))hn.call(e,n)&&At(t,n,e[n]);if(Bt)for(var n of Bt(e))xn.call(e,n)&&At(t,n,e[n]);return t},ae=(t,e)=>pn(t,gn(e));var Tt=(t,e)=>Wt(Ut(t,"raw",{value:Wt(e||t.slice())}));import{r as x,j as s,M as g,_ as rt,e as B,f as wt,E as _n,L as wn,d as bn,c as ct,h as yn,a as jn,u as kn}from"./fg33krlcm0qyi6yw.js";import{a9 as je,bh as bt,c as vn,l as z,ec as Mn,gd as lt,me as dt,b$ as tt,e2 as Ae,fe as Nn,o as yt,b as ft,nW as Cn,T as nt,aS as Sn,Ao as Fn,h7 as Vt,Z as xt,S as _t,ag as Dn,F as Pn,m as jt,c0 as ut,fh as Ln,C as En,gK as Zt,g2 as J,bb as $n,jR as Be}from"./mtk1qztvnb31pw5r.js";import{U as Rn}from"./klzrztgvm2c9gs50.js";import{BC as On,c9 as qt,ul as Wn,b0 as mt,eq as kt,iH as Bn,pN as An,de as Un,pr as Tn,c$ as Gt,iX as Vn,iO as qn,iN as Hn,dL as zn,gc as Kn,ge as Jn,nN as Yn,BD as Qe,kz as In,fx as Qn}from"./k65njl5wlgspihfr.js";import{W as Xn}from"./zqbip2ya77i1mx4s.js";import{A as vt}from"./kg0cp341m64rddpv.js";import{A as Zn}from"./lbbnz7rb7sd2lk50.js";import{m as Gn}from"./ck1u9icgxosmytry.js";import{u as es}from"./dq5a57hcb44a83mi.js";import{s as ts}from"./cmaobpdpreyiep8p.js";import{c as Mt,i as en,W as tn,a as ns,w as ss,l as Ht,j as as,m as os,d as is,k as rs}from"./sy1xvqwioh9ks4z8.js";import{a as nn,u as ls,W as cs}from"./bes67zhi4fr5gq8i.js";import{a as ds,b as fs}from"./lptwpbjabrvjmhsj.js";import{R as us,h as Ge,j as ms}from"./n0ab5m1z76n8mazm.js";import{JsonViewer as ps}from"./ose6175gtasqnfv0.js";import{M as sn}from"./lbq5605sor1ah5hb.js";import{b as gs}from"./n0qmvbt3dffalvvl.js";import{S as hs,i as an,a as xs,g as _s,D as ws,N as Nt,b as on,c as bs}from"./jcfo2542d2wvunuv.js";import{T as ys,D as Xe}from"./fznnr8l9owxbou6l.js";import{S as zt,U as js}from"./j0vhwkpwiqu2ejer.js";const ks=x.createContext(null);function vs(){"use forget";return x.useContext(ks)}function Ms({setConfirmClose:t,handleClose:e}){return s.jsx(On,{contentClassName:"z-50 dark:border dark:border-token-border-light",title:s.jsx(g,{id:"wham.message.modal.confirmCloseTitle",defaultMessage:"Discard your message"}),description:s.jsx("span",{className:"mb-2",children:s.jsx(g,{id:"wham.message.modal.confirmCloseDescription",defaultMessage:"You have an unsubmitted message, do you want to discard it?"})}),onClose:()=>t(!1),actionButton:s.jsx(je,{color:"primary",onClick:()=>e==null?void 0:e({force:!0}),children:s.jsx(g,{id:"wham.message.modal.confirmCloseButton",defaultMessage:"Discard"})}),cancelButton:s.jsx(je,{color:"secondary",onClick:()=>t(!1),children:s.jsx(g,{id:"wham.message.modal.confirmCloseCancelButton",defaultMessage:"Cancel"})})})}const et="md:max-w-3xl lg:max-w-[40rem] xl:max-w-[48rem]",Ns=bt(async()=>{const[{default:t},{default:e}]=await Promise.all([rt(()=>import("./mq7uqtztbvim4zqv.js"),__vite__mapDeps([0,1])),rt(()=>import("./qlgci16qundnjro1.js"),[])]);return function({className:a,latestEvent:i}){const r=x.useRef(null),[c,o]=x.useState(!0);x.useEffect(()=>{var d;c||(o(!0),(d=r.current)==null||d.goToAndPlay(0))},[i,o]);const{processedAnimationData:l,containerRef:f}=es(e);return s.jsx("div",{ref:f,className:a,children:s.jsx(t,{animationData:l,lottieRef:r,onComplete:()=>o(!1),loop:!1,autoplay:c})})}},{loading:qt,fallback:qt}),Cs=vn(ts,"976c85",16,16),Ss="_5l6rLG_cursorBlink",Fs={cursorBlink:Ss};function rn(){return s.jsx("span",{"aria-hidden":!0,className:"flex min-h-4 min-w-2",children:s.jsx("span",{className:"inline-block h-auto w-2",children:s.jsx("div",{className:z(Fs.cursorBlink,"bg-token-text-primary h-full w-full")})})})}const Ds=new Set(["error","task_started","task_complete","token_count","agent_message_delta","agent_reasoning_delta","agent_reasoning_raw_content","agent_reasoning_raw_content_delta","agent_reasoning_section_break","session_configured","mcp_tool_call_begin","mcp_tool_call_end","web_search_begin","web_search_end","exec_approval_request","apply_patch_approval_request","deprecation_notice","background_event","undo_started","undo_completed","stream_error","turn_diff","get_history_entry_response","mcp_list_tools_response","list_custom_prompts_response","plan_update","turn_aborted","shutdown_complete","entered_review_mode","exited_review_mode","raw_response_item","item_started","item_completed","view_image_tool_call","user_message"]);function ln(t,e){if(!t.length)return[];let n=!0;const a=[],i=[],r=new Map;t.forEach((o,l)=>{var _;const f=l===t.length-1,d=Mn(o),u=lt(i),w=lt(a);n&&d.type!=="log"&&(n=!1,!e||e.mode==="off"?i.push({type:"internet_status",status:"offline",items:[]}):e.preset_allowlist===ds?i.push({type:"internet_status",status:"online",items:[],domainType:"common"}):e.preset_allowlist===fs?i.push({type:"internet_status",status:"online",items:[],domainType:"custom"}):i.push({type:"internet_status",status:"online",items:[],domainType:"all"}));const p=d.type;switch(p){case"log":(w==null?void 0:w.type)==="logs"&&w.logType===d.log.key.type?(w.items.push(d),w.contents=w.items.filter(h=>h.type==="log").sort((h,k)=>Date.parse(h.log.key.created_at)-Date.parse(k.log.key.created_at)).map(h=>h.log.line)):a.push({type:"logs",logType:d.log.key.type,contents:[d.log.line],created_at:d.log.key.created_at,items:[d]});break;case"message":if(Ps(d))i.push(As(d));else if(Ls(d))i.push(Us(d));else{if(Es(d))break;if($s(d))i.push(Ts(d));else{if(Rs(d))break;if(Os(d))i.push(Vs(d));else if(Ws(d))i.push(...Hs(u,d,f));else if(Bs(d))i.push(...qs(u,d));else{const h=d.message;tt.warn("Unexpected work log message: ".concat((_=h.author.name)!=null?_:h.author.role," -> ").concat(h.recipient,": ").concat(h.content.content_type))}}}break;case"app_server_event":Js(u,d,i,r);break;default:dt(p)}});for(const o of i)o.type==="terminal_output"&&(o.contents=zs(o.contents,l=>l.output.every(f=>!f.length||f==="\n")));return[...a.filter(o=>o.type==="logs").sort((o,l)=>Date.parse(o.created_at)-Date.parse(l.created_at)),...i]}function Ps(t){return t.type==="message"&&t.message.author.role===Ae.Assistant&&t.message.recipient==="all"}function Ls(t){return t.type==="message"&&t.message.author.role===Ae.User&&t.message.recipient==="all"}function Es(t){return t.type==="message"&&t.message.author.role===Ae.Assistant&&t.message.recipient==="container.new_session"}function $s(t){return t.type==="message"&&t.message.author.role===Ae.Tool&&t.message.author.name==="container.new_session"}function Rs(t){return t.type==="message"&&t.message.author.role===Ae.Assistant&&t.message.recipient==="container.make_pr"}function Os(t){return t.type==="message"&&t.message.author.role===Ae.Tool&&t.message.author.name==="container.make_pr"}function Ws(t){return t.type==="message"&&t.message.author.role===Ae.Assistant&&t.message.recipient==="container.feed_chars"}function Bs(t){return t.type==="message"&&t.message.author.role===Ae.Tool&&t.message.author.name==="container.feed_chars"}function As(t){let e="";if(t.message.content.content_type==="text")for(const n of t.message.content.parts)typeof n=="string"&&(e+=n);return{type:"assistant_message",content:e,isFinal:t.message.channel==="final",items:[t]}}function Us(t){var i,r;let e="";if(t.message.content.content_type==="text")for(const c of t.message.content.parts)typeof c=="string"&&(e+=c);const n=(r=(i=t.message.metadata)==null?void 0:i.l1239dk1)!=null?r:{},a="inline_comments"in n&&Array.isArray(n.inline_comments)?n.inline_comments:[];return{type:"user_message",content:e.trim(),inlineComments:a,items:[t]}}function Ts(t){let e="";if(t.message.content.content_type==="text"&&t.message.content.parts.length>0)try{e=JSON.parse(t.message.content.parts[0]).session_name}catch(n){tt.error("Failed to parse session name: ".concat(n))}return{type:"new_session",sessionName:e,items:[t]}}function Vs(t){let e="",n="";if(t.message.content.content_type==="code")try{const a=JSON.parse(t.message.content.text);n=a.title,e=a.body}catch(a){tt.error("Failed to parse make_pr message: ".concat(a))}return{type:"make_pr",title:n,body:e,items:[t]}}function qs(t,e){if(e.message.content.content_type!=="text")return[];if(typeof e.message.content.parts[0]!="string")return[];let n;try{const a=JSON.parse(e.message.content.parts[0]);if(!("type"in a)||a.type!=="terminal_output")return[];if(!("session_name"in a)||typeof a.session_name!="string")return[];if(!("output"in a)||!Array.isArray(a.output))return[];n=a,n.output=n.output.filter(i=>typeof i=="string").filter(i=>!/^root@[^\s]*[$#]$/.test(i))}catch(a){return[{type:"terminal_error",error:e.message.content.parts.join(""),items:[e]}]}if((t==null?void 0:t.type)==="terminal_output"&&(t==null?void 0:t.sessionName)===n.session_name){const a=n.start_line_no,i=lt(t.contents),r=i?i.start_line_no+i.output.length:0,c=r-a;return i&&c>0&&(i.output=i.output.slice(0,-c)),a>r?(t.contents.push(n),t.items.push(e),[]):(t.contents.push(n),t.items.push(e),[])}return[{type:"terminal_output",contents:[n],items:[e],sessionName:n.session_name}]}function Hs(t,e,n){if(n){if(e.message.content.content_type!=="code")return[]}else return[];let a;try{a=JSON.parse(e.message.content.text)}catch(c){return[]}const i="chars"in a&&typeof a.chars=="string"?a.chars:null;if(!i||i==="")return[];const r="session_name"in a&&typeof a.session_name=="string"?a.session_name:null;if(!r)return[];if((t==null?void 0:t.type)==="terminal_output")t.contents.push({type:"terminal_output",chunk_id:"assistant-".concat(e.message.id),session_name:r,start_line_no:0,output:[i],num_elided_lines:0}),t.items.push(e);else return[{type:"terminal_output",contents:[{type:"terminal_output",chunk_id:"assistant-".concat(e.message.id),session_name:r,start_line_no:0,output:[i],num_elided_lines:0}],items:[e],sessionName:r}];return[]}function zs(t,e){let n=t.length-1;for(;n>=0&&e(t[n]);)n--;return n===t.length-1?t:t.slice(0,n+1)}function Ks(t){return t.startsWith("**")&&t.endsWith("**")?t.slice(2,-2):t}function it(t,e){if(!t.length)return t;const n=t.replace(/\r\n/g,"\n"),a=n.endsWith("\n"),i=n.split("\n");a&&i.pop();const r=i.map(c=>"".concat(e).concat(c)).join("\n");return a?"".concat(r,"\n"):r}function st(t,e,n){return(t==null?void 0:t.type)==="terminal_output"&&(t==null?void 0:t.sessionName)===n.session_name?(t.contents.push(n),t.items.push(e),[]):[{type:"terminal_output",contents:[n],items:[e],sessionName:n.session_name}]}function Js(t,e,n,a){const i=e.event,r=i.type;switch(r){case"agent_message":n.push(...Kt(i.message,t,e));break;case"agent_reasoning":n.push(...Kt(i.text,t,e));break;case"exec_command_begin":n.push(...Ys(t,e));break;case"exec_command_output_delta":n.push(...Is(t,e,a));break;case"exec_command_end":n.push(...Qs(t,e,a));break;case"patch_apply_begin":n.push(...Xs(t,e));break;case"patch_apply_end":n.push(...Zs(t,e,a));break;default:r&&!Ds.has(r)&&tt.warn("Unhandled app server event type",{appServerEventType:r})}}function Kt(t,e,n){const a=Ks(t!=null?t:"");return e&&e.type==="assistant_message"&&e.content===a?(e.isFinal=!1,e.items=[n],[]):[{type:"assistant_message",content:a,isFinal:!1,items:[n]}]}function Ys(t,e){const n=e.event;if(n.type!=="exec_command_begin")return[];const i=n.command.map(l=>l.trim()).filter(l=>l.length>0).join(" "),r=n.cwd?"".concat(n.cwd,"$ ").concat(i):i,c=n.call_id.toLowerCase(),o={type:"terminal_output",chunk_id:"app_exec_command-".concat(c),session_name:"shell",start_line_no:0,output:[r],num_elided_lines:0};return st(t,e,o)}function Is(t,e,n){var l;const a=e.event;if(a.type!=="exec_command_output_delta")return[];if(!a.chunk)return[];const i=atob(a.chunk),r=a.call_id.toLowerCase();if((t==null?void 0:t.type)==="terminal_output"&&(t==null?void 0:t.contents[t.contents.length-1].output[0])===i)return t.items.push(e),[];n.set(r,((l=n.get(r))!=null?l:"")+i);const c=e.id.toLowerCase(),o={type:"terminal_output",chunk_id:"app_exec_command_output_delta-".concat(r,"-").concat(c),session_name:"shell",start_line_no:0,output:[i],num_elided_lines:0};return st(t,e,o)}function Qs(t,e,n){var l;const a=e.event;if(a.type!=="exec_command_end")return[];const i=a.call_id.toLowerCase(),r=n.get(i);n.delete(i);const c=(l=a.aggregated_output)!=null&&l.length?a.aggregated_output:a.formatted_output.length?a.formatted_output:[a.stdout,a.stderr].filter(Boolean).join("\n");if(!c.length)return[];if(r&&c.trimEnd()===r.trimEnd())return(t==null?void 0:t.type)==="terminal_output"&&(t!=null&&t.contents.some(f=>f.chunk_id.includes(i)))?(t.items.push(e),[]):[];const o={type:"terminal_output",chunk_id:"app_exec_command_result-".concat(i),session_name:"shell",start_line_no:0,output:[c],num_elided_lines:0};return st(t,e,o)}function Xs(t,e){var c,o,l;const n=e.event;if(n.type!=="patch_apply_begin")return[];const a=[];for(const[f,d]of Object.entries(n.changes)){if("add"in d){if(!((c=d.add)!=null&&c.content))continue;a.push("".concat(f,"\n").concat(it(d.add.content,"+")));continue}if("update"in d){if(!((o=d.update)!=null&&o.unified_diff))continue;a.push("".concat(f,"\n").concat(d.update.unified_diff));continue}if("delete"in d){if(!((l=d.delete)!=null&&l.content))continue;a.push("".concat(f,"\n").concat(it(d.delete.content,"-")));continue}switch(d.type){case"add":if(!d.content)break;a.push("".concat(f,"\n").concat(it(d.content,"+")));break;case"update":if(!d.unified_diff)break;a.push("".concat(f,"\n").concat(d.unified_diff));break;case"delete":if(!d.content)break;a.push("".concat(f,"\n").concat(it(d.content,"-")));break}}if(!a.length)return[];const i=n.call_id.toLowerCase(),r={type:"terminal_output",chunk_id:"app_patch_apply-".concat(i),session_name:"apply_patch",start_line_no:0,output:a,num_elided_lines:0};return st(t,e,r)}function Zs(t,e,n){const a=e.event;if(a.type!=="patch_apply_end")return[];const i=a.call_id.toLowerCase(),r=n.get(i),c=[a.stdout,a.stderr].filter(Boolean);if(r&&c.join("").trimEnd()===r.trimEnd())return(t==null?void 0:t.type)==="terminal_output"&&t.contents.some(f=>f.chunk_id.includes(i))&&t.items.push(e),n.delete(i),[];if(n.delete(i),!c.length)return[];const o={type:"terminal_output",chunk_id:"app_patch_apply_result-".concat(i),session_name:"apply_patch",start_line_no:0,output:c,num_elided_lines:0};return st(t,e,o)}function cn(t,e){var b,N,C,D;const n=B(),a=!!e&&Mt(e),[i,r]=x.useState({}),[c,o]=x.useState({}),l=(b=e==null?void 0:e.id)!=null?b:"",f=x.useMemo(()=>{var y;return(y=i[l])!=null?y:{items:[]}},[i,l]),d=x.useMemo(()=>{var y;return(y=c[l])!=null?y:{items:[]}},[c,l]),u=x.useMemo(()=>f.items.length||d.items.length?{items:[...f.items,...d.items]}:null,[f,d]),[w,p]=x.useState(u);x.useEffect(()=>{const y=Nn(()=>p(u),200,{leading:!0});return y(),y.cancel},[u]),x.useEffect(()=>{var M,L;if(!l){p(null);return}r(S=>S[l]?S:ae(R({},S),{[l]:{items:[]}})),o(S=>S[l]?S:ae(R({},S),{[l]:{items:[]}}));const y=(M=i[l])!=null?M:{items:[]},P=(L=c[l])!=null?L:{items:[]};p(y.items.length||P.items.length?{items:[...y.items,...P.items]}:null)},[t,l,i,c]);const{data:_,error:h}=us(t,(N=e==null?void 0:e.id)!=null?N:""),k=x.useMemo(()=>{var S,F,E,U,Y,W;const y=((F=(S=e==null?void 0:e.worklog)==null?void 0:S.messages)!=null?F:[]).map((T,K)=>{var A;return{id:(A=T.id)!=null?A:"message-".concat(K),type:"message",message:T,message_index:K}}),P=(U=(E=e==null?void 0:e.app_server_events)==null?void 0:E.events.map((T,K)=>({id:"app-server-event-".concat(K),type:"app_server_event",event:T})))!=null?U:[],M=(W=(Y=_==null?void 0:_.logs)==null?void 0:Y.map((T,K)=>{var A,X;return{type:"log",id:"log-".concat(K),log:{key:{type:(A=T.key.type)!=null?A:"System",created_at:(X=T.key.created_at)!=null?X:Date.now().toString()},line:T.line}}}))!=null?W:[];return{items:[...!M.length&&h?[{id:"log-error",type:"log",log:{key:{type:"System",created_at:Date.now().toString()},line:n.formatMessage({id:"wham.useWorklog.errorLoadingSetupLogs",defaultMessage:"Error loading setup logs"})}}]:[],...M,...y,...P]}},[e,_,h,n]),v="worklog-".concat(t!=null?t:"","-").concat((C=e==null?void 0:e.id)!=null?C:"");return nn(t!=null?t:"",(D=e==null?void 0:e.id)!=null?D:"",["work_log_message","log","app_server_event"],{subscriberId:v,enabled:!a&&!!t&&!!(e!=null&&e.id),onEvent:y=>{const P=y.item_type;switch(P){case"work_log_message":{o(M=>{var U,Y;const L=(U=M[l])!=null?U:{items:[]};if(L.items.some(W=>W.type==="message"&&"message_index"in W&&W.message_index===y.message_index))return M;const S={type:"message",id:(Y=y.message.id)!=null?Y:"message-".concat(L.items.length),message:y.message,message_index:y.message_index},F=L.items.findIndex(W=>W.type==="message"&&"message_index"in W&&W.message_index>y.message_index),E=F===-1?ae(R({},L),{items:[...L.items,S]}):ae(R({},L),{items:[...L.items.slice(0,F),S,...L.items.slice(F)]});return ae(R({},M),{[l]:E})});break}case"log":r(M=>{var S;const L=(S=M[l])!=null?S:{items:[]};return ae(R({},M),{[l]:ae(R({},L),{items:[...L.items,{type:"log",id:y.id,log:y}]})})});break;case"app_server_event":{o(M=>{var F;const L=(F=M[l])!=null?F:{items:[]};if(L.items.some(E=>E.type==="app_server_event"&&E.id===y.id))return M;const S=ae(R({},L),{items:[...L.items,{type:"app_server_event",id:y.id,event:y.event}]});return ae(R({},M),{[l]:S})});break}default:dt(P)}}}),a?k:w}const dn=bt(()=>rt(()=>import("./0z9e17m3c79jxrb9.js"),__vite__mapDeps([2,1,3,4,5,6,7,8])).then(t=>t.WithScrolling));function Go({taskId:t,focusedAssistantTurn:e,agentNetworkAccess:n,footer:a}){const i=ft(),c=yt(i,"3043007979")&&n&&n.mode!=="off",o=cn(t,e),l=en(e==null?void 0:e.turn_status),f=x.useMemo(()=>{var d;return ln((d=o==null?void 0:o.items)!=null?d:[],n)},[o,n]);return s.jsxs("div",{className:"flex h-full w-full flex-col",children:[s.jsx(Wn,{}),s.jsx("div",{className:z("mx-auto w-full px-4 py-2",et),children:c&&s.jsx(mt,{type:"warning",className:"mb-4 flex h-14 max-h-14 min-h-14 items-center",customIcon:Cn,children:s.jsx(g,{id:"wham.worklog.agentNetworkDisabled",defaultMessage:"Agent network access is temporarily unavailable. This task may not have had full internet access."})})}),s.jsx("div",{className:"min-h-0 flex-1",children:s.jsx(dn,{children:s.jsx("div",{className:z("mx-auto w-full px-4 py-6",et),children:!l&&!f.length?s.jsx(Gs,{}):s.jsx(ea,{groupedWorklog:f})})})}),a]})}function Gs(){const t=B();return s.jsx(Ct,{title:t.formatMessage(He.envSetup),icon:s.jsx(sn,{className:"icon-xs"}),children:s.jsx(rn,{})})}function ea({groupedWorklog:t}){return s.jsx("div",{className:"flex flex-col pb-32",children:t.map((e,n)=>s.jsx(sa,{item:e},ta(e,n)))})}function ta(t,e){return t.items.length?t.items[0].id:"item-".concat(e)}function na({item:t}){const e=B(),n=t.status==="online",a=t.domainType;return s.jsxs("div",{className:"text-token-text-tertiary mb-8 flex w-full items-center gap-2.5",children:[s.jsx("div",{className:"bg-token-border-light h-[1px] flex-1 dark:bg-white/20"}),n?s.jsx(Bn,{className:"icon-xs"}):s.jsx(An,{className:"icon-xs"}),s.jsx(nt,{className:"flex",side:"right",label:s.jsx("p",{className:"text-start",children:n?a==="common"?e.formatMessage(He.internetOnCommonDeps):a==="custom"?e.formatMessage(He.internetOnCustomDeps):e.formatMessage(He.internetOnAllDomains):e.formatMessage(He.internetOff)}),children:s.jsx("span",{className:"text-xs font-medium select-none",children:n?s.jsx(g,{id:"wham.whamWorklog.internetOn",defaultMessage:"Internet on"}):s.jsx(g,{id:"wham.whamWorklog.internetOff",defaultMessage:"Internet off"})})}),s.jsx("div",{className:"bg-token-border-light h-[1px] flex-1 dark:bg-white/20"})]})}function sa({item:t}){const[e,n]=x.useState(!1);return B(),s.jsxs("div",{className:"grid w-full grid-cols-[1fr_auto] gap-1 align-top",children:[e?s.jsx(ps,{json:t.items}):s.jsx(aa,{item:t}),s.jsx("span",{className:"h-min w-min"})]})}function aa({item:t}){switch(t.type){case"assistant_message":return s.jsx(ca,{item:t});case"internet_status":return s.jsx(na,{item:t});case"logs":return s.jsx(oa,{log:t});case"make_pr":return null;case"new_session":return null;case"system_message":return s.jsx(ia,{item:t});case"user_message":return s.jsx(ra,{item:t});case"terminal_output":return s.jsx(da,{item:t});case"terminal_error":return s.jsx(fa,{item:t});default:dt(t)}return null}function oa({log:t}){const e=B();return t.contents.some(n=>n.length)?s.jsx(Ct,{title:e.formatMessage(He.envSetup),icon:s.jsx(sn,{className:"icon-xs"}),children:s.jsx("div",{className:"whitespace-pre",children:s.jsx(vt,{children:t.contents.join("\n")})})}):null}function ia({item:t}){return s.jsx("div",{className:"bg-token-bg-secondary mb-8 flex max-h-[300px] flex-col overflow-y-auto rounded-xl p-6",children:s.jsx(kt,{children:t.content})})}function ra({item:t}){return s.jsxs("div",{className:"ms-24 flex w-fit min-w-0 flex-col items-end gap-2 justify-self-end",children:[s.jsx(la,{comments:t.inlineComments}),!!t.content.length&&s.jsx("div",{className:"bg-token-bg-secondary mb-8 w-fit max-w-full min-w-0 justify-self-end rounded-xl px-6 py-4 text-sm break-all whitespace-pre-wrap",children:t.content})]})}function la({comments:t}){return t.length?s.jsx("div",{className:"text-token-text-tertiary w-full pe-4 text-end text-xs",children:s.jsx(g,{id:"wham.worklog.inlineComments",defaultMessage:"{count, plural,\n            =0 {No comments}\n            one {One comment}\n            other {# comments}\n          }",values:{count:t.length}})}):null}function ca({item:t}){var a;const e=B();if(t.isFinal)return null;const n=(a=ua(t.content))!=null?a:e.formatMessage({id:"wham.whamWorklog.unknown",defaultMessage:"Unknown"});return s.jsx("div",{className:"mb-8 px-4",children:s.jsx(kt,{className:"text-sm",children:n})})}function da({item:t}){if(!t.contents.some(n=>n.output.some(a=>a.length)))return null;const e=Object.fromEntries(t.contents.map(n=>["data-chunk-id-wrapper-".concat(n.chunk_id),""]));return s.jsx("div",ae(R({},e),{children:s.jsx(Ct,{title:t.sessionName,children:t.contents.map(n=>s.jsxs(_n.Fragment,{children:[s.jsx(vt,{className:"whitespace-pre-wrap",children:n.output.join("\n").trim()}),s.jsx("br",{["data-chunk-id-".concat(n.chunk_id)]:""})]},n.chunk_id))})}))}function fa({item:t}){var n;const e=B();return s.jsx(mt,{className:"mb-8",children:s.jsx("span",{className:"whitespace-pre-wrap",children:(n=t.error)!=null?n:e.formatMessage({id:"wham.whamWorklog.terminalError.unknown",defaultMessage:"Error interacting with shell"})})})}function Ct({title:t,children:e,icon:n,rightIcon:a}){return s.jsxs("div",{className:"border-token-border-heavy bg-token-sidebar-surface-primary dark relative mb-8 overflow-clip rounded-xl border-[0.5px] text-xs text-white shadow-sm contain-inline-size",children:[s.jsxs("div",{className:"text-token-text-secondary bg-token-sidebar-surface-primary dark:bg-token-main-surface-secondary flex h-9 items-center justify-between gap-2 rounded-t-[5px] px-4 py-2.5 font-sans text-sm font-semibold select-none",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[n&&n,t]}),a&&a]}),s.jsx(dn,{scrollViewClassName:"max-h-[400px] p-4",children:e})]})}function ua(t){return t.replace(/【[^】]*】/g,"")}const He=wt({envSetup:{id:"wham.whamWorklog.setup",defaultMessage:"Environment setup"},internetOff:{id:"wham.worklog.internet.tooltipMessage.off",defaultMessage:"Internet access is disabled after setup. You can adjust this in environment settings."},internetOnCommonDeps:{id:"wham.worklog.internet.tooltipMessage.onCommonDeps",defaultMessage:"Internet access is on for common dependencies. You can adjust this in environment settings."},internetOnCustomDeps:{id:"wham.worklog.internet.tooltipMessage.customDeps",defaultMessage:"Internet access is on for custom domains. You can adjust this in environment settings."},internetOnAllDomains:{id:"wham.worklog.internet.tooltipMessage.allDomains",defaultMessage:"Internet access is on for all domains. You can adjust this in environment settings."}});function ma({taskId:t,assistantTurn:e,focusedAssistantTurn:n,currentTab:a,onTabChange:i}){var l,f;const r=Mt(e),o=e.turn_status==="pending"||e.turn_status==="in_progress"||!!e.worklog.messages.length||!!Object.keys((f=(l=e.logs)==null?void 0:l.logs)!=null?f:[]).length;return s.jsxs("div",{className:"flex w-full flex-col gap-3",children:[s.jsxs("button",{type:"button",className:"text-token-text-secondary flex flex-row items-center gap-0.5 text-sm select-none",disabled:!o,onClick:()=>i("logs"),children:[s.jsx(pa,{taskId:t,assistantTurn:e}),o&&s.jsx(Sn,{className:"text-token-text-tertiary icon-sm mt-[1px]"})]}),!r&&(!a||e.id!==(n==null?void 0:n.id))&&s.jsx(ga,{taskId:t,assistantTurn:e,onClick:()=>i("logs"),denormalizedEnvironment:e.environment})]})}function pa({taskId:t,assistantTurn:e}){var o;const n=B(),a=ls(t,e.turn_status,e.id),i=x.useMemo(()=>{var d;if(!(e!=null&&e.created_at)||!((d=e==null?void 0:e.latest_event)!=null&&d.created))return null;const l=new Date(e.created_at*1e3),f=new Date(e.latest_event.created*1e3);return f.getTime()<l.getTime()?null:Fn(f,l,n)},[e.created_at,(o=e.latest_event)==null?void 0:o.created,n]),r=e==null?void 0:e.turn_status,c=e.cancellation_requested_at&&r!=="cancelled"?"cancelled":r;switch(c){case"completed":return i?s.jsx(g,{id:"wham.turnStatus.completedIn",defaultMessage:"Worked for {relativeTime}",values:{relativeTime:i}}):s.jsx(g,{id:"wham.turnStatus.completed",defaultMessage:"Completed"});case void 0:case"failed":return s.jsx("span",{className:"text-token-text-error",children:i?s.jsx(g,{id:"wham.turnStatus.failedIn",defaultMessage:"Failed after {relativeTime}",values:{relativeTime:i}}):s.jsx(g,{id:"wham.turnStatus.failed",defaultMessage:"Failed"})});case"cancelled":return i?s.jsx(g,{id:"wham.turnStatus.cancelledIn",defaultMessage:"Cancelled after {relativeTime}",values:{relativeTime:i}}):s.jsx(g,{id:"wham.turnStatus.cancelled",defaultMessage:"Cancelled"});case"pending":case"in_progress":return s.jsxs("div",{className:"text-token-text-primary flex flex-row items-center gap-2",children:[s.jsx(Ns,{className:"h-5 w-5",latestEvent:a}),s.jsx("span",{className:"line-clamp-1 font-medium text-ellipsis",children:Gn(a,30)})]});default:dt(c)}}function ga({taskId:t,assistantTurn:e,onClick:n,denormalizedEnvironment:a}){var p,_,h,k,v,b;const i=Mt(e),r=cn(t,e),c=x.useMemo(()=>r?ln(r.items,a==null?void 0:a.agent_network_access):null,[r,a]),o=!(c!=null&&c.some(N=>N.type==="internet_status"&&N.status==="offline")),l=((h=(_=(p=Vt(c,N=>N.type==="terminal_output"))==null?void 0:p.contents)==null?void 0:_.map(N=>N.output.join("\n")))==null?void 0:h.join("\n"))||((v=(k=Vt(c,N=>N.type==="logs"))==null?void 0:k.contents)==null?void 0:v.join("\n")),f=!!l,d=e.turn_status==="pending"||e.turn_status==="in_progress";x.useEffect(()=>{var P,M;if(!f||!d)return;const N=e.created_at*1e3,C=Date.now(),D=(M=(P=e.latest_event)==null?void 0:P.created)!=null?M:C,y=D-N;!N||!D||y<=7e3||y>3e5||!e.environment_id||wa(e.environment_id,y)},[e,f,d]);const u=e.environment_id,w=u&&!l?ba(u):null;return s.jsx(ha,{contents:(b=l==null?void 0:l.trim())!=null?b:"",hasInternet:o,showCursorOrProgress:!i&&!l,repoDownloadDurationMs:w,environmentId:e.environment_id,startTimeMs:e.created_at*1e3,onClick:n})}function ha({contents:t,hasInternet:e,showCursorOrProgress:n,repoDownloadDurationMs:a,environmentId:i,startTimeMs:r,onClick:c}){const o=B(),l=xa(!!t,a,r);return s.jsxs("div",{className:"bg-token-sidebar-surface-primary dark group relative mb-4 w-full cursor-pointer overflow-clip rounded-xl text-xs text-white",onClick:c,children:[s.jsx("div",{className:"flex h-[400px] flex-col-reverse overflow-y-auto p-4",children:s.jsxs("div",{className:"flex min-h-full shrink-0 flex-col",children:[s.jsx(vt,{className:"whitespace-pre-wrap",children:t}),n&&a&&l!=null&&l<100?s.jsx("pre",{children:_a(l)}):s.jsx(rn,{})]})}),!e&&s.jsx(nt,{className:"absolute end-0 bottom-0 opacity-0 transition-opacity group-hover:opacity-100",side:"left",label:s.jsx("p",{className:"text-start",children:o.formatMessage(He.internetOff)}),children:s.jsx("a",{href:"/codex/settings/environment/".concat(i),target:"_blank",rel:"noreferrer",onClick:f=>f.stopPropagation(),children:s.jsx(Cs,{className:"icon-sm m-3 opacity-70"})})}),s.jsx("div",{className:"absolute end-4 top-4 opacity-0 transition-opacity group-hover:opacity-100",children:s.jsx(je,{className:"dark opacity-0 transition-opacity group-hover:opacity-100",color:"primary",onClick:c,children:s.jsxs("div",{className:"flex flex-row items-center gap-1",children:[s.jsx(g,{id:"wham.turnsStatus.viewLog",defaultMessage:"View log"}),s.jsx(Zn,{className:"icon"})]})})})]})}function xa(t,e,n){const[a,i]=x.useState(null);return x.useEffect(()=>{if(t||!e){i(null);return}const c=Date.now()-n,o=Math.min(Math.max(c,0),e),l=o/e*100;i(l);const f=e-o;if(f<=0)return;const d=performance.now();let u;const w=p=>{const _=p-d,h=Math.min(1,_/f)*(100-l),k=Math.random();i(v=>{const b=l+h+k;return Math.max(v!=null?v:0,Math.min(100,b))}),_<f&&(u=requestAnimationFrame(w))};return u=requestAnimationFrame(w),()=>cancelAnimationFrame(u)},[t,e,n]),a}function _a(t,e=100){const n=Math.min(Math.max(t,0),100),a=Math.round(n/100*e);return"[".concat("#".repeat(a)).concat(" ".repeat(e-a),"]")}function wa(t,e){var i,r;const n=(i=xt.getItem(_t.WhamRepoDownloadDurations))!=null?i:{},a=(r=n[t])!=null?r:0;n[t]=ya(a,e),xt.setItem(_t.WhamRepoDownloadDurations,n)}function ba(t){var n;return((n=xt.getItem(_t.WhamRepoDownloadDurations))!=null?n:{})[t]}function ya(t,e,n=.4){return n*e+(1-n)*t}function ja({focusedAssistantTurn:t}){var a,i;const e=B();if(!t||t&&t.turn_status!=="failed")return null;if(((a=t.error)==null?void 0:a.code)==="startup_script_failed")return s.jsx(ka,{focusedAssistantTurn:t});const n=(i=t.error)!=null&&i.message?t.error.message:e.formatMessage({id:"wham.whamTaskPageFailureMessage.taskFailed",defaultMessage:"Task failed"});return s.jsx(mt,{className:et,type:"danger",children:n})}function ka({focusedAssistantTurn:t}){var i;const e=B(),n=va(t.environment),a=(i=t.error)!=null&&i.message?t.error.message:e.formatMessage({id:"wham.whamTaskPageFailureMessage.setupTaskFailed",defaultMessage:"Unknown setup script error"});return s.jsx(mt,{className:et,type:"danger",children:s.jsxs("div",{className:"flex flex-col",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("p",{className:"flex-1 font-medium",children:s.jsx(g,{id:"wham.whamTaskPageFailureMessage.setupScriptFailed",defaultMessage:"Environment setup failed"})}),t.environment&&n&&s.jsx(nt,{label:e.formatMessage({id:"wham.taskFailure.envSettingsLink",defaultMessage:"Click to edit your environment"}),children:s.jsx("a",{href:n,target:"_blank",rel:"noreferrer",children:s.jsxs("div",{className:"text-token-text-tertiary flex items-center gap-0.5",children:[t.environment.label,s.jsx(Un,{className:"icon-xs"})]})})})]}),a]})})}function va(t){const e=Dn();return t?t.creator_id===(e==null?void 0:e.id)?"/codex/settings/environment/".concat(t.id,"/edit"):"/codex/settings/environment/".concat(t.id):null}var Xt;const Jt=Pn.div(Xt||(Xt=Tt(["self-end bg-token-bg-tertiary text-token-text-primary relative flex w-fit flex-col rounded-[18px] text-sm max-w-[var(--user-chat-width,70%)] @max-[400px]:max-w-full group py-2 scroll-mt-2"])));function Ma({isLoading:t,userTurn:e,containerRef:n}){var _;const a=jt(),i=B(),[r,c]=x.useState("collapsed"),o=x.useRef(null),l=e?Pa(e.input_items):[],f=e?Ea(e.input_items):null,d=(_=e==null?void 0:e.external_post_config)!=null?_:null,u=e?Da(e,f):"",w=Tn(o,n),p=x.useCallback(async()=>{u&&(await navigator.clipboard.writeText(u),a.success(i.formatMessage({id:"wham.whamTaskPageUserMessage.copiedToClipboard",defaultMessage:"Copied to clipboard"})))},[u,a,i]);return t?s.jsx(Jt,{className:"px-4",children:s.jsx(ut,{})}):e?s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx(Na,{userTurn:e}),s.jsx(Fa,{attachments:l}),s.jsx(Ca,{inputItems:e.input_items,slackContext:f,externalPostConfig:d}),u&&s.jsxs(Jt,{ref:w,children:[s.jsx("div",{role:"button",className:z("group max-w-full",r!=="expanded"&&"line-clamp-5 overflow-hidden"),style:{WebkitLineClamp:r==="expanded"?void 0:5},onClick:()=>{var k;const h=(k=window.getSelection)==null?void 0:k.call(window);h&&h.type==="Range"&&h.toString()||(c(v=>v==="collapsed"?"expanded":"collapsed"),r==="collapsed"&&requestAnimationFrame(()=>{var v;(v=o.current)==null||v.scrollIntoView({block:"start"})}))},children:s.jsx("div",{className:"px-4 text-sm break-words whitespace-pre-wrap",children:u})}),s.jsx("div",{className:z("absolute inset-x-0 -bottom-4 flex justify-end gap-1","pointer-events-none opacity-0 transition-opacity group-hover:pointer-events-auto group-hover:opacity-100"),children:s.jsxs("button",{onClick:p,className:"text-token-text-secondary hover:text-token-text-primary flex items-center gap-1 text-xs whitespace-nowrap",children:[s.jsx(Gt,{className:"icon-xs"}),s.jsx(g,{id:"taskPage.copy",defaultMessage:"Copy"})]})})]})]}):null}function Na({userTurn:t}){const e=t.input_items.filter(n=>n.type==="comment");return e.length?s.jsx("div",{className:"text-token-text-tertiary w-full text-end text-xs",children:s.jsx(g,{id:"wham.userMessage.inlineComments",defaultMessage:"{count, plural,\n            =0 {No comments}\n            one {One comment}\n            other {# comments}\n          }",values:{count:e.length}})}):null}function Ca({inputItems:t,slackContext:e,externalPostConfig:n}){const a=B(),i=t.some(u=>u.type==="ide_context"),r=u=>u.type==="prior_conversation",c=t.find(r),o=t.some(u=>u.type==="pre_apply_patch"),l=!!e,f=Wa({slackContext:e}),d=gs(n);return!i&&!c&&!o&&!l&&!d?null:s.jsxs("div",{className:"flex w-full flex-wrap justify-end gap-2",children:[i&&s.jsx(Ze,{label:a.formatMessage({id:"wham.userMessage.ideContextPill.tooltip",defaultMessage:"Contains context from your IDE about open files and highlighted code"}),children:s.jsx(g,{id:"wham.userMessage.ideContextPill.label",defaultMessage:"IDE Context"})}),!!c&&s.jsx(Ze,{label:a.formatMessage({id:"wham.userMessage.priorConversationPill.tooltip",defaultMessage:"Contains a prior conversation with the assistant"}),children:s.jsx(Sa,{taskId:c.prior_task_id,children:s.jsx(g,{id:"wham.userMessage.priorConversationPill.label",defaultMessage:"Prior Conversation"})})}),o&&s.jsx(Ze,{label:a.formatMessage({id:"wham.userMessage.preApplyPatchPill.tooltip",defaultMessage:"Contains local changes to the repository"}),children:s.jsx(g,{id:"wham.userMessage.preApplyPatchPill.label",defaultMessage:"Local Changes"})}),l&&s.jsx(Ze,{label:a.formatMessage({id:"wham.userMessage.slackContextPill.tooltip",defaultMessage:"Contains context from the Slack thread where this task was created"}),children:f?s.jsx("a",{href:f,className:"text-token-text-primary hover:underline",target:"_blank",rel:"noopener noreferrer",children:s.jsx(g,{id:"wham.userMessage.slackContextPill.label",defaultMessage:"Slack Context"})}):s.jsx(g,{id:"wham.userMessage.slackContextPill.label",defaultMessage:"Slack Context"})}),d&&s.jsx(Ze,{label:a.formatMessage({id:"wham.userMessage.githubCommentPill.tooltip",defaultMessage:"Opens the GitHub comment that triggered this task"}),children:s.jsx("a",{href:d,className:"text-token-text-primary hover:underline",target:"_blank",rel:"noopener noreferrer",children:s.jsx(g,{id:"wham.userMessage.githubCommentPill.label",defaultMessage:"GitHub Comment"})})})]})}function Sa({taskId:t,children:e}){const n=x.useRef(null);return t?s.jsx(wn,{ref:n,to:"/codex/tasks/".concat(t),children:e}):e}function Ze({label:t,children:e}){return s.jsx(nt,{label:t,side:"bottom",children:s.jsx("span",{className:"border-token-border-default text-token-text-primary inline-flex h-[24px] items-center rounded-full border px-2 py-1 text-[12px] font-medium",children:e})})}function Fa({attachments:t}){const e=B(),n=Vn(t.map(a=>({content_type:Ln.ImageAssetPointer,asset_pointer:a.asset_pointer,size_bytes:a.size_bytes,width:a.width,height:a.height})));return t.length?s.jsx("div",{className:"flex w-full flex-wrap justify-end gap-2",children:t.map((a,i)=>{const r=n[i];if((r==null?void 0:r.isLoading)||!(r!=null&&r.data))return s.jsx("div",{className:"bg-token-bg-tertiary flex h-16 w-16 items-center justify-center rounded-md",children:s.jsx(ut,{className:"icon-sm"})},a.asset_pointer);const o=e.formatMessage({id:"wham.userMessage.attachmentImageAlt",defaultMessage:"user attachment image"});return s.jsx(qn,{src:r.data.url,alt:o,className:"max-h-32 max-w-32",children:s.jsx(Hn,{alt:o,src:r.data.url,width:a.width,height:a.height,className:"max-h-32 max-w-32 rounded-md"})},a.asset_pointer)})}):null}function Da(t,e){return t.input_items.map(n=>{switch(n.type){case"message":return n.content.map(a=>{switch(a.content_type){case"text":return Oa(a.text,e);default:return""}}).join("");default:return""}}).join("\n").trim()}function Pa(t){return t.filter(n=>n.type==="image_asset_pointer")}function La(t){return t.type==="slack_context"}function Ea(t){const e=t.find(La);return e!=null?e:null}const $a=/<@([^>|]+)(?:\|([^>]+))?>/g,Ra=/<!([^>|]+)(?:\|([^>]+))?>/g;function Oa(t,e){var r;if(!t.includes("<"))return t;const n=(r=e==null?void 0:e.bot_user_id)!=null?r:null,a=(c,o)=>c?c.startsWith("@")||c.startsWith("#")?c:"@".concat(c):o;return t.replace($a,(c,o,l)=>n&&o===n?"@Codex":a(l,"@".concat(o))).replace(Ra,(c,o,l)=>o==="channel"?"@channel":o==="here"?"@here":o.startsWith("subteam^")?a(l,"@group"):a(l,"@".concat(o)))}function Wa({slackContext:t}){var i;if(t!=null&&t.thread_permalink)return t.thread_permalink;const e=t==null?void 0:t.workspace_id,n=t==null?void 0:t.channel_id,a=(i=t==null?void 0:t.current_thread)==null?void 0:i.thread_id;return!e||!n||!a?null:"https://app.slack.com/client/".concat(e,"/").concat(n,"/thread/").concat(n,"-").concat(a)}function Ba({taskTurn:t,thumbRating:e,onClose:n}){const[a,i]=x.useState(!1),[r,c]=x.useState(""),o=B(),l=jt();function f(){n(),c("")}async function d(){i(!0);try{await tn.feedback({thumbRating:e,text:r,taskId:t.task.id,turnId:t.turn.id,shareUrl:null,pullRequestUrl:null,category:""}),l.success(o.formatMessage({id:"wham.whamFeedbackModal.feedbackSent",defaultMessage:"Feedback sent!"}),{duration:3,hasCloseButton:!0}),f()}catch(u){u instanceof ns?ss(u,t.turn.id,o,l):(tt.error(u),l.danger(bn({id:"wham.whamFeedbackModal.failedToSendFeedback",defaultMessage:"Failed to send feedback"}),{duration:3,hasCloseButton:!0,toastId:"wham_feedback_modal_failed_to_send_feedback"}))}finally{i(!1)}}return s.jsx(En,{testId:"modal-wham-feedback",className:"p-4",isOpen:!0,onClose:d,type:"success",size:"normal",noPadding:!0,primaryButton:s.jsx(je,{color:"primary",loading:a,onClick:d,children:s.jsx(g,{id:"wham.whamFeedbackModal.send",defaultMessage:"Send"})}),secondaryButton:s.jsx(je,{color:"secondary",onClick:f,children:s.jsx(g,{id:"wham.whamFeedbackModal.cancel",defaultMessage:"Cancel"})}),children:s.jsxs("div",{className:"flex flex-col items-center p-0.5",children:[s.jsx("h1",{className:"text-token-text-primary mb-2 text-lg font-semibold",children:s.jsx(g,{id:"wham.whamFeedbackModal.shareFeedback",defaultMessage:"Share feedback"})}),s.jsx(zn,{className:"bg-token-bg-primary! w-full resize-none rounded-md",placeholder:e==="thumbs_down"?o.formatMessage(Yt.placeholderImprove):o.formatMessage(Yt.placeholderWentWell),value:r,onKeyDown:u=>{(u.metaKey||u.ctrlKey)&&u.key==="Enter"&&(u.preventDefault(),r.trim()!==""&&!a&&d())},onChange:u=>c(u.target.value)})]})})}const Yt=wt({segmentedControl:{id:"Y03bkm",defaultMessage:"Feedback rating"},thumbsUp:{id:"PeGF+n",defaultMessage:"Thumbs up"},thumbsDown:{id:"vZDtvd",defaultMessage:"Thumbs down"},placeholderWentWell:{id:"jBLzqn",defaultMessage:"What went well?"},placeholderImprove:{id:"VA/J0O",defaultMessage:"What should we improve?"}}),Aa=({permissions:t,taskTurn:e})=>{const[n,a]=x.useState(null),i=B(),r=ft(),c=yt(r,"4190046875");return s.jsxs(s.Fragment,{children:[s.jsx("div",{children:c&&Ht(e)&&t==="write"&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>a("thumbs_up"),className:"text-token-text-secondary hover:bg-token-bg-tertiary group-radix-state-open:bg-token-bg-tertiary rounded-sm p-2 font-semibold","aria-label":i.formatMessage({id:"wham.turnFeedback.thumbsUp",defaultMessage:"Give thumbs up feedback"}),children:s.jsx(Kn,{className:"icon"})}),s.jsx("button",{onClick:()=>a("thumbs_down"),className:"text-token-text-secondary hover:bg-token-bg-tertiary group-radix-state-open:bg-token-bg-tertiary rounded-sm p-2 font-semibold","aria-label":i.formatMessage({id:"wham.turnFeedback.thumbsDown",defaultMessage:"Give thumbs down feedback"}),children:s.jsx(Jn,{className:"icon"})})]})}),n&&Ht(e)&&s.jsx(Ba,{taskTurn:e,thumbRating:n,onClose:()=>a(null)})]})};function It({filePath:t,side:e,lineNumber:n,onSubmit:a,onDelete:i,onClose:r,initialComment:c,readOnly:o=!1}){const l=c?pt(c):"",[f,d]=x.useState(c?pt(c):""),[u,w]=x.useState(!c&&!o),[p,_]=x.useState(!1),h=x.useRef(null),k=B(),v=()=>{var N;if(!f||o||!a)return;const b=c?ae(R({},c),{content:[{content_type:"text",text:f}]}):{id:crypto.randomUUID(),type:"comment",content:[{content_type:"text",text:f}],position:{side:e===hs.old?"left":"right",path:t,line:n}};a(b),w(!1),(N=h.current)==null||N.blur(),r==null||r()};return x.useEffect(()=>{var b;if(o){w(!1);return}!p&&c&&f===l&&setTimeout(()=>{w(!1)},100),p&&(w(!0),(b=h.current)==null||b.focus())},[p,c,f,l,o]),s.jsx("div",{className:"gap-2 bg-gray-100/50 p-4 font-sans dark:bg-gray-900",id:c==null?void 0:c.id,children:s.jsxs("div",{className:z("flex flex-col gap-2",et),children:[s.jsx(Yn,{ref:h,className:"border-token-border-medium bg-token-main-surface-primary text-token-text-primary border-1.5 w-full resize-none rounded-lg p-4 text-sm ring-0 focus:border-black focus:outline-hidden dark:focus:border-white","data-wham-comment-textarea":!0,onFocus:()=>{o||_(!0)},onBlur:()=>{o||_(!1)},placeholder:k.formatMessage({id:"code.diff.addComment",defaultMessage:"Add a comment"}),minRows:1,maxRows:10,autoFocus:!c&&!o,readOnly:o,"aria-readonly":o,onSubmit:()=>{},value:f,onChange:b=>{o||d(b.target.value)},onKeyDown:b=>{o||(b.key==="Enter"&&b.metaKey&&(b.preventDefault(),v()),b.key==="Escape"&&(b.preventDefault(),r==null||r()))}}),!o&&u&&s.jsxs("div",{className:z("mt-2 flex items-center justify-between gap-2",!i&&"justify-end"),children:[i&&s.jsx(je,{color:"danger",onClick:()=>i==null?void 0:i(),children:s.jsx(g,{id:"code.diffComment.delete",defaultMessage:"Delete"})}),s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.jsx(je,{color:"secondary",onClick:()=>{r==null||r(),w(!1),c&&d(pt(c))},children:s.jsx(g,{id:"code.diffComment.cancel",defaultMessage:"Cancel"})}),s.jsx(je,{color:"primary",disabled:!f,onClick:v,children:c?s.jsx(g,{id:"code.diffComment.save",defaultMessage:"Save"}):s.jsx(g,{id:"code.diffComment.comment",defaultMessage:"Comment"})})]})]})]})})}function pt(t){return t.content.map(e=>e.content_type==="text"?e.text:"").join("")}function Ua(t){return t.content.map(e=>e.content_type==="text"?e.text:"").filter(e=>e.length>0).join("\n").trim()}function fn({comment:t,showFileInfo:e=!1}){const n=x.useMemo(()=>Ua(t),[t]),a=t.priority,i=Math.round(t.confidence_score*100),r=t.position.start_line,c=t.position.line,o=!!r&&!!c,l=t.position.side==="left"?"-":"+",f=u=>"".concat(l).concat(u),d=[];return e&&t.position.path&&d.push(s.jsx("span",{className:"text-token-text-primary font-semibold",children:t.position.path},"path")),o&&d.push(r===c?s.jsx(g,{id:"wham.codeDiffReadonlyComment.commentOnSingleLine",defaultMessage:"Comment on line {line}",values:{line:s.jsx("span",{className:"font-semibold",children:f(r)})}},"single"):s.jsx(g,{id:"wham.codeDiffReadonlyComment.commentOnMultipleLines",defaultMessage:"Comment on lines {start} to {end}",values:{start:s.jsx("span",{className:"font-semibold",children:f(r)}),end:s.jsx("span",{className:"font-semibold",children:f(c)})}},"range")),s.jsxs("div",{className:"border-token-border-default bg-token-bg-secondary rounded-lg border px-4 py-3 text-sm",children:[d.length>0&&s.jsx("div",{className:"text-token-text-tertiary border-token-border-subtle mb-3 border-b pb-2 text-xs font-medium",children:s.jsx("div",{className:"flex flex-col gap-1",children:d.map((u,w)=>s.jsx("span",{children:u},w))})}),s.jsxs("div",{className:"text-token-text-tertiary flex flex-wrap items-center gap-2 text-xs",children:[a!=null&&s.jsx("span",{className:"bg-token-bg-tertiary text-token-text-tertiary rounded px-1 py-0.5 font-medium",children:s.jsx(g,{id:"wham.codeDiffReadonlyComment.priority",defaultMessage:"Priority {priority}",values:{priority:a}})}),t.title&&s.jsx("span",{className:"text-token-text-primary font-medium",children:t.title}),i!=null&&s.jsx("span",{className:z("ms-auto",!t.title&&"font-medium"),"data-testid":"codex-comment-confidence",children:s.jsx(g,{id:"wham.codeDiffReadonlyComment.confidence",defaultMessage:"{confidence}% confidence",values:{confidence:i}})})]}),n&&s.jsx("div",{className:"text-token-text-primary mt-2 leading-5 whitespace-pre-wrap",children:n})]})}function Ta({copyDiffToClipboard:t,copyPatchToClipboard:e}){const[n,a]=x.useState(!1),i=B(),r=c=>o=>{o.preventDefault(),o.stopPropagation(),c==="diff"?t():e()};return s.jsxs(Zt,{open:n,onOpenChange:a,contentAlign:"end",sideOffset:8,modal:!0,triggerButton:s.jsx("button",{type:"button",onClick:c=>{c.preventDefault(),c.stopPropagation(),a(!0)},className:"hover:bg-token-border-light rounded p-1","aria-label":i.formatMessage({id:"wham.copyFileActionDropdown.openMenu",defaultMessage:"Open copy menu"}),children:s.jsx(In,{className:"icon"})}),children:[s.jsx(J.Item,{icon:Qe,onClick:r("diff"),children:s.jsx(g,{id:"wham.copyFile.apply",defaultMessage:"Copy git apply"})}),s.jsx(J.Item,{icon:Qe,onClick:r("patch"),children:s.jsx(g,{id:"wham.copyFile.patch",defaultMessage:"Copy patch"})})]})}function Va({diffFile:t,fallback:e=null}){const n=an(t);return xs(t)?s.jsx("div",{className:"-my-1 flex rounded-full bg-green-500/10 px-2 py-1 text-xs text-green-500",children:s.jsx(g,{id:"wham.fileTag.new",defaultMessage:"New"})}):n?s.jsx("div",{className:"-my-1 flex rounded-full bg-red-500/10 px-2 py-1 text-xs text-red-500",children:s.jsx(g,{id:"wham.fileTag.deleted",defaultMessage:"Deleted"})}):e}const qa="M6_DWa_diffView",Ha={diffView:qa},gt="wham-toggle-all-diffs";function za(t){return x.useEffect(()=>{function e(n){t(n.detail.open)}return window.addEventListener(gt,e),()=>{window.removeEventListener(gt,e)}},[t]),x.useCallback(e=>{window.dispatchEvent(new CustomEvent(gt,{detail:{open:e}}))},[])}function Ka(t){return"type"in t&&t.type==="comment"}function Ja(t,e){return t.reduce((n,a)=>{var u,w;const{position:i}=a,{side:r,line:c,path:o}=i;if(c==null||!o)return n;n[o]||(n[o]={oldFile:{},newFile:{}});const l=r==="left"?n[o].oldFile:n[o].newFile,f=(w=(u=l[c])==null?void 0:u.data)!=null?w:[],d=e(a)?{kind:"editable",comment:a}:{kind:"readonly",comment:a};return l[c]={data:[...f,d]},n},{})}function Ya(t,e){var i,r,c,o;const n=t._oldFileName?(r=(i=e[t._oldFileName])==null?void 0:i.oldFile)!=null?r:{}:{},a=t._newFileName?(o=(c=e[t._newFileName])==null?void 0:c.newFile)!=null?o:{}:{};return{oldFile:n,newFile:a}}function Ia(t){"use forget";const e=ct.c(116),{diff:n,viewType:a,stickyHeader:i,enableComments:r,comments:c,buttonClassName:o,onCommentCreate:l,onCommentDelete:f,onCommentUpdate:d,readonlyComments:u}=t,w=r===void 0?!1:r,p=vs(),_=$n(),h=B();let k,v,b;e[0]!==n.diffFile||e[1]!==p?(v=_s(n.diffFile),k=p?"".concat(p.versionKey,"::").concat(v):v,b=p?p.getOpenState(k):void 0,e[0]=n.diffFile,e[1]=p,e[2]=k,e[3]=v,e[4]=b):(k=e[2],v=e[3],b=e[4]);const N=b;let C;e[5]!==n.diffFile?(C=an(n.diffFile),e[5]=n.diffFile,e[6]=C):C=e[6];const D=!C;let y;e[7]!==D||e[8]!==N?(y=()=>N!=null?N:D,e[7]=D,e[8]=N,e[9]=y):y=e[9];const[P,M]=x.useState(y),[L,S]=x.useState(!1),F=jt();let E;e[10]!==k||e[11]!==p?(E=q=>{M(I=>{const te=typeof q=="function"?q(I):q;return p&&p.setOpenState(k,te),te})},e[10]=k,e[11]=p,e[12]=E):E=e[12];const U=E,Y=za(U);let W;e[13]!==D||e[14]!==N?(W=()=>{N!=null?M(N):M(D)},e[13]=D,e[14]=N,e[15]=W):W=e[15];let T;e[16]!==k||e[17]!==D||e[18]!==N?(T=[k,N,D],e[16]=k,e[17]=D,e[18]=N,e[19]=T):T=e[19],x.useEffect(W,T);let K,A;e[20]!==n.diffFile||e[21]!==_?(K=()=>{n.diffFile.initTheme(_?"dark":"light")},A=[n.diffFile,_],e[20]=n.diffFile,e[21]=_,e[22]=K,e[23]=A):(K=e[22],A=e[23]),x.useEffect(K,A);let X;e[24]!==c?(X=c!=null?c:[],e[24]=c,e[25]=X):X=e[25];let V;e[26]!==u?(V=u!=null?u:[],e[26]=u,e[27]=V):V=e[27];let Se;e[28]!==X||e[29]!==V?(Se=[...X,...V],e[28]=X,e[29]=V,e[30]=Se):Se=e[30];const Fe=Se;let ke;e[31]!==Fe?(ke=Ja(Fe,Ka),e[31]=Fe,e[32]=ke):ke=e[32];const m=ke;let ve;e[33]!==n.diffFile||e[34]!==m?(ve=Ya(n.diffFile,m),e[33]=n.diffFile,e[34]=m,e[35]=ve):ve=e[35];const Ue=ve;let Me;e[36]!==n.diffFile._newFileName||e[37]!==n.diffFile._oldFileName?(Me=()=>{const q=n.diffFile._newFileName===Nt?n.diffFile._oldFileName:n.diffFile._newFileName;navigator.clipboard.writeText(q),S(!0),setTimeout(()=>{S(!1)},1e3)},e[36]=n.diffFile._newFileName,e[37]=n.diffFile._oldFileName,e[38]=Me):Me=e[38];const at=Me;let ge;e[39]!==n.hunksText||e[40]!==h||e[41]!==F?(ge=async()=>{n.hunksText&&(await navigator.clipboard.writeText(" (cd \"$(git rev-parse --show-toplevel)\" && git apply --3way <<'EOF' \n".concat(n.hunksText," \nEOF\n)")),F.success(h.formatMessage({id:"wham.message.modal.footer.copiedToClipboard",defaultMessage:"Copied git apply command to clipboard"}),{duration:3,hasCloseButton:!0}))},e[39]=n.hunksText,e[40]=h,e[41]=F,e[42]=ge):ge=e[42];const Te=ge;let De;e[43]!==n.hunksText||e[44]!==h||e[45]!==F?(De=async()=>{n.hunksText&&(await navigator.clipboard.writeText(n.hunksText),F.success(h.formatMessage({id:"wham.codeDiff.copiedPatchToClipboard",defaultMessage:"Copied patch to clipboard"}),{duration:3,hasCloseButton:!0}))},e[43]=n.hunksText,e[44]=h,e[45]=F,e[46]=De):De=e[46];const Pe=De,Le=!n.diffFile.unifiedLineLength&&!n.diffFile.splitLineLength;let Ne;e[47]===Symbol.for("react.memo_cache_sentinel")?(Ne=z("flex flex-col pt-1",Ha.diffView),e[47]=Ne):Ne=e[47];let oe;e[48]!==Y||e[49]!==P||e[50]!==U?(oe=q=>{const I=!P;q.altKey?Y(I):U(I)},e[48]=Y,e[49]=P,e[50]=U,e[51]=oe):oe=e[51];const Ve=i&&"sticky top-0 z-1";let ie;e[52]!==o||e[53]!==Ve?(ie=z("focus-visible:outline-none",Ve,o),e[52]=o,e[53]=Ve,e[54]=ie):ie=e[54];const qe=!P&&"rounded-b-2xl";let re;e[55]!==qe?(re=z("bg-token-bg-primary border-token-border-default relative flex items-center rounded-t-2xl border px-4 py-3 text-sm font-medium before:absolute before:inset-x-[-1px] before:top-[-1px] before:bottom-0 before:z-[-1] before:bg-[var(--right-bg)] before:content-['']",qe),e[55]=qe,e[56]=re):re=e[56];const Ee=P&&"rotate-90";let $e;e[57]!==Ee?($e=z("icon me-3 transition-transform duration-200",Ee),e[57]=Ee,e[58]=$e):$e=e[58];let le;e[59]!==$e?(le=s.jsx(Qn,{className:$e}),e[59]=$e,e[60]=le):le=e[60];let he;e[61]!==v?(he=s.jsx("span",{className:"me-1 truncate text-start select-text",title:v,children:v}),e[61]=v,e[62]=he):he=e[62];let xe;e[63]!==n.diffFile?(xe=s.jsx(Va,{diffFile:n.diffFile}),e[63]=n.diffFile,e[64]=xe):xe=e[64];let ce;e[65]!==h?(ce=h.formatMessage({id:"wham.codeDiff.copiedFileName",defaultMessage:"Copied File Name"}),e[65]=h,e[66]=ce):ce=e[66];let Q;e[67]!==at?(Q=q=>{q.preventDefault(),q.stopPropagation(),at()},e[67]=at,e[68]=Q):Q=e[68];let Z;e[69]!==h?(Z=h.formatMessage({id:"wham.codeDiff.copyFileName",defaultMessage:"Copy file name"}),e[69]=h,e[70]=Z):Z=e[70];let Ce;e[71]===Symbol.for("react.memo_cache_sentinel")?(Ce=s.jsx(Qe,{className:"icon-xs"}),e[71]=Ce):Ce=e[71];let _e;e[72]!==Q||e[73]!==Z?(_e=s.jsx("div",{role:"button",onClick:Q,className:"hover:bg-token-border-light rounded p-1","aria-label":Z,children:Ce}),e[72]=Q,e[73]=Z,e[74]=_e):_e=e[74];let de;e[75]!==L||e[76]!==ce||e[77]!==_e?(de=s.jsx(nt,{label:ce,open:L,children:_e}),e[75]=L,e[76]=ce,e[77]=_e,e[78]=de):de=e[78];let we;e[79]!==n.diffFile.additionLength||e[80]!==n.diffFile.deletionLength?(we=s.jsx(cs,{linesAdded:n.diffFile.additionLength,linesRemoved:n.diffFile.deletionLength}),e[79]=n.diffFile.additionLength,e[80]=n.diffFile.deletionLength,e[81]=we):we=e[81];let fe;e[82]!==Te||e[83]!==Pe||e[84]!==n.isBinary?(fe=!n.isBinary&&s.jsx(Ta,{copyDiffToClipboard:Te,copyPatchToClipboard:Pe}),e[82]=Te,e[83]=Pe,e[84]=n.isBinary,e[85]=fe):fe=e[85];let ue;e[86]!==we||e[87]!==fe?(ue=s.jsxs("div",{className:"ms-auto flex items-center gap-1 ps-1",children:[we,fe]}),e[86]=we,e[87]=fe,e[88]=ue):ue=e[88];let me;e[89]!==re||e[90]!==le||e[91]!==he||e[92]!==xe||e[93]!==de||e[94]!==ue?(me=s.jsxs("div",{className:re,children:[le,he,xe,de,ue]}),e[89]=re,e[90]=le,e[91]=he,e[92]=xe,e[93]=de,e[94]=ue,e[95]=me):me=e[95];let G;e[96]!==oe||e[97]!==ie||e[98]!==me?(G=s.jsx("div",{role:"button",onClick:oe,className:ie,children:me}),e[96]=oe,e[97]=ie,e[98]=me,e[99]=G):G=e[99];let ee;e[100]!==n.diffFile||e[101]!==n.isBinary||e[102]!==w||e[103]!==Ue||e[104]!==_||e[105]!==Le||e[106]!==l||e[107]!==f||e[108]!==d||e[109]!==P||e[110]!==a?(ee=P&&(Le||n.isBinary?s.jsx("div",{className:"text-token-text-secondary bg-token-bg-secondary flex h-full justify-center rounded-b-2xl py-4 text-sm font-medium",children:n.isBinary?s.jsx(g,{id:"wham.diff.binaryFile",defaultMessage:"Binary file not shown"}):s.jsx(g,{id:"wham.diff.noContent",defaultMessage:"No content"})}):s.jsx(ws,{className:z("relative overflow-clip rounded-b-2xl transition-opacity duration-300","after:border-token-border-default after:pointer-events-none after:absolute after:inset-0 after:rounded-b-2xl after:border-s after:border-e after:border-b after:content-['']"),diffViewFontSize:12,diffFile:n.diffFile,diffViewTheme:_?"dark":"light",diffViewHighlight:!0,diffViewMode:a==="split"?3:4,diffViewWrap:!0,diffViewAddWidget:w,extendData:Ue,renderExtendLine:q=>{const{lineNumber:I,side:te,data:pe}=q;return pe.length?s.jsx("div",{className:"flex flex-col gap-2",children:pe.map((se,Oe)=>{if(se.kind==="readonly")return s.jsx(fn,{comment:se.comment},"readonly-".concat(se.comment.position.path,"-").concat(se.comment.position.line,"-").concat(Oe));const be=se.comment,ye=!w;return s.jsx(It,{initialComment:be,onSubmit:ye?void 0:We=>d==null?void 0:d(We),onDelete:ye?void 0:()=>f==null?void 0:f(be),readOnly:ye,filePath:n.diffFile._newFileName,side:te,lineNumber:I},be.id)})}):null},renderWidgetLine:q=>{const{onClose:I,lineNumber:te,side:pe}=q;return!w||!l?null:s.jsx(It,{onSubmit:l,onClose:I,filePath:n.diffFile._newFileName,side:pe,lineNumber:te})}})),e[100]=n.diffFile,e[101]=n.isBinary,e[102]=w,e[103]=Ue,e[104]=_,e[105]=Le,e[106]=l,e[107]=f,e[108]=d,e[109]=P,e[110]=a,e[111]=ee):ee=e[111];let Re;return e[112]!==v||e[113]!==G||e[114]!==ee?(Re=s.jsxs("div",{"data-diff-header":v,className:Ne,children:[G,ee]}),e[112]=v,e[113]=G,e[114]=ee,e[115]=Re):Re=e[115],Re}function Qa({item:t,className:e}){var c;const n=x.useMemo(()=>{var l;const o=(l=t.reviewed_diff)==null?void 0:l.diff;if(!o)return[];try{return on(o)}catch(f){return[]}},[t.reviewed_diff]),a=x.useMemo(()=>{var l;const o=(l=t.reviewed_diff)==null?void 0:l.diff;if(!o)return[];try{return bs.parse(o)}catch(f){return[]}},[(c=t.reviewed_diff)==null?void 0:c.diff]),{diffSections:i,unmatchedComments:r}=x.useMemo(()=>{const o=new Set,l=n.map((d,u)=>{var k,v;const w=new Set([d.diffFile._newFileName,d.diffFile._oldFileName].filter(b=>!!b&&b!==Nt)),p=t.comments.filter(b=>w.has(b.position.path));if(p.length===0)return null;const _=a.find(b=>w.has(b.newPath)||w.has(b.oldPath));let h=[];return _&&(h=p.filter(b=>eo(b,_))),h.length===0?null:(h.forEach(b=>o.add(b)),s.jsx(Xa,{diff:d,comments:h,parsedFile:_},"".concat((v=(k=d.diffFile._newFileName)!=null?k:d.diffFile._oldFileName)!=null?v:u,"-").concat(u)))}).filter(d=>d!=null),f=t.comments.filter(d=>!o.has(d));return{diffSections:l,unmatchedComments:f}},[n,t.comments,a]);return s.jsxs("div",{className:z("flex flex-col gap-4",e),children:[i,r.length>0&&s.jsx("div",{className:"flex flex-col gap-4",children:r.map((o,l)=>s.jsx(fn,{comment:o,showFileInfo:!0},"fallback-".concat(o.position.path,"-").concat(o.position.line,"-").concat(l)))}),n.length===0&&s.jsx("div",{className:"bg-token-bg-primary text-token-text-secondary rounded-2xl border px-4 py-3 text-sm",children:s.jsx(g,{id:"wham.whamTaskTurnGrouping.noDiffSnippet",defaultMessage:"No code changes to display."})}),t.comments.length===0&&s.jsx("div",{className:"bg-token-bg-primary text-token-text-secondary rounded-2xl border px-4 py-3 text-sm",children:s.jsx(g,{id:"wham.whamTaskTurnGrouping.noIssuesFound",defaultMessage:"Codex didn’t flag any issues."})})]})}function Xa({diff:t,comments:e,parsedFile:n}){const a=x.useMemo(()=>{var r;if(!n)return null;try{return(r=Za(n,e))!=null?r:null}catch(c){return null}},[n,e]),i=a!=null?a:t;return s.jsx(Ia,{diff:i,viewType:"unified",stickyHeader:!1,enableComments:!1,readonlyComments:e})}function Za(t,e){var i;const n=Ga(t,e);if(!n.length)return null;const a=to(t,n);if(!a)return null;try{return(i=on(a)[0])!=null?i:null}catch(r){return null}}function Ga(t,e){if(e.length===0)return[];const n=e.map(i=>{var f;const r=(f=i.position.start_line)!=null?f:i.position.line,c=i.position.line,o=Math.min(r,c),l=Math.max(r,c);return{side:i.position.side,start:o,end:l}}),a=[];return t.hunks.forEach(i=>{let r=null;i.changes.forEach(c=>{if(!un(c,n)){r=null;return}r||(r={hunk:i,changes:[]},a.push(r)),r.changes.push(c)})}),a}function eo(t,e){var o;const n=t.position.line;if(n==null)return!1;const a=(o=t.position.start_line)!=null?o:n,i=Math.min(a,n),r=Math.max(a,n),c={side:t.position.side,start:i,end:r};return e.hunks.some(l=>l.changes.some(f=>un(f,[c])))}function un(t,e){for(const n of e){const{start:a,end:i,side:r}=n;if(t.type==="insert"){if(r==="right"&&t.lineNumber>=a&&t.lineNumber<=i)return!0}else if(t.type==="delete"){if(r==="left"&&t.lineNumber>=a&&t.lineNumber<=i)return!0}else{const c=r==="left"&&t.oldLineNumber>=a&&t.oldLineNumber<=i,o=r==="right"&&t.newLineNumber>=a&&t.newLineNumber<=i;if(c||o)return!0}}return!1}function to(t,e){if(!e.length)return null;const n=no(t),a=e.map(i=>so(i)).filter(i=>i!=null);return a.length?[...n,...a].join("\n")+"\n":null}function no(t){var a,i;const e=(r,c)=>r===Nt?r:"".concat(c,"/").concat(r),n=["diff --git a/".concat(t.oldPath," b/").concat(t.newPath)];if(t.oldRevision&&t.newRevision){const r=(i=(a=t.newMode)!=null?a:t.oldMode)!=null?i:"100644";n.push("index ".concat(t.oldRevision,"..").concat(t.newRevision," ").concat(r))}return n.push("--- ".concat(e(t.oldPath,"a")),"+++ ".concat(e(t.newPath,"b"))),n}function so(t){var f,d,u,w;if(!t.changes.length)return null;const e=t.changes.map(p=>ao(p)).filter(p=>p!=null),n=t.changes.map(p=>oo(p)).filter(p=>p!=null),a=e.length>0?e[0]:(d=(f=n[0])!=null?f:t.hunk.oldStart)!=null?d:0,i=n.length>0?n[0]:(w=(u=e[0])!=null?u:t.hunk.newStart)!=null?w:0,r=t.changes.reduce((p,_)=>_.type==="insert"?p:p+1,0),c=t.changes.reduce((p,_)=>_.type==="delete"?p:p+1,0),o="@@ -".concat(Math.max(a,0),",").concat(r," +").concat(Math.max(i,0),",").concat(c," @@"),l=t.changes.map(p=>{const _=p.type==="insert"?"+":p.type==="delete"?"-":" ";return"".concat(_).concat(p.content)});return[o,...l].join("\n")}function ao(t){return t.type==="insert"?null:t.type==="delete"?t.lineNumber:t.oldLineNumber}function oo(t){return t.type==="delete"?null:t.type==="insert"?t.lineNumber:t.newLineNumber}var ht,Qt;function io(){if(Qt)return ht;Qt=1;function t(e){for(var n=-1,a=e==null?0:e.length,i={};++n<a;){var r=e[n];i[r[0]]=r[1]}return i}return ht=t,ht}var ro=io();const lo=yn(ro);function co({taskId:t,attemptIds:e,selectedId:n,focusedId:a,onSelect:i,idToIdxMap:r,hasComments:c,clearComments:o,shadowAttemptIds:l}){"use no forget";const f=B(),d=Ge(C=>C.getTurnsForTask(t).filter(as)),u=lo(d.map(C=>[C.id,C])),w=x.useCallback(C=>{let D=a?u[a]:void 0;for(;D&&D.previous_turn_id;){if(D.previous_turn_id===C)return!0;D=u[D.previous_turn_id]}return!1},[a,u]),p=x.useMemo(()=>{const C=e.find(D=>w(D));return C||null},[e,w]),_=p!=null?p:n;x.useMemo(()=>new Set(l!=null?l:[]),[l]);const h=e.map(C=>{var T;const D=(T=r[C])!=null?T:0,y=u[C],P=y==null?void 0:y.turn_status,M=!!u[C],L=!M,S=y?os(y):!1,F=e.length>1&&M&&(P==="pending"||P==="in_progress"),E=!1,U={index:D+1},Y=e.length>5?f.formatMessage({id:"wham.attemptsTab.attemptLabelShort",defaultMessage:"V{index}"},U):f.formatMessage({id:"wham.attemptsTab.attemptLabel",defaultMessage:"Version {index}"},U);f.formatMessage({id:"wham.attemptsTab.shadowLabel",defaultMessage:"Shadow"});const W=E?f.formatMessage({id:"wham.attemptsTab.shadowAriaLabel",defaultMessage:"View the shadow version of the task"}):f.formatMessage({id:"wham.attemptsTab.attemptAriaLabel",defaultMessage:"View version {index} of the task"},{index:D+1});return{key:C,ariaLabel:W,label:s.jsxs("span",{className:"flex items-center gap-2",children:[Y,F&&s.jsx(ut,{}),S&&s.jsx(Be,{"aria-hidden":"true",className:"icon-sm text-token-text-tertiary"})]}),disabled:L}}),[k,v]=x.useState(null),b=x.useCallback(()=>{k&&(o==null||o(),i(k),v(null))},[k,o,i]),N=x.useCallback(C=>{if(C!==_&&u[C]){if(c){v(C);return}i(C)}},[c,i,_,u]);return s.jsxs("div",{className:"no-scrollbar horizontal-scroll-fade-mask flex w-full items-center overflow-x-auto overflow-y-hidden align-middle [--edge-fade-distance:1rem]",children:[s.jsx(ys,{className:z("flex h-[42px]",e.length>4&&"gap-2!"),tabs:h,currentTab:_,onChange:N,buttonClassName:"text-nowrap",skipTabUnderlineAnimation:!0,withUnderline:!0},e[0]),k&&s.jsx(Ms,{setConfirmClose:()=>v(null),handleClose:b})]})}const fo=bt(()=>rt(()=>import("./bhej3rsa4rgdh46m.js"),__vite__mapDeps([9,1,3,4,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42])).then(t=>t.ChangedFileListFromTaskTurn)),uo=["task_turn_event","work_log_message","log","task_title_generated"];function mo(t){"use forget";const e=ct.c(3),{taskId:n,turnId:a,enabled:i}=t,r="attempt-prefetch-".concat(n!=null?n:"task","-").concat(a),c=i&&!!n;let o;return e[0]!==r||e[1]!==c?(o={enabled:c,subscriberId:r,onEvent:po},e[0]=r,e[1]=c,e[2]=o):o=e[2],nn(n!=null?n:"",a,uo,o),null}function po(){}function go(t){return t.type==="partial_repo_snapshot"}function ho(t){if(t.author.name!=="container.feed_chars"||t.content.content_type!=="text"||!Array.isArray(t.content.parts))return null;const e=lt(t.content.parts);return typeof e=="string"?e:null}function xo(t){"use forget";var k,v,b,N,C,D,y,P;const e=ct.c(21),{assistantTurn:n,outputText:a,className:i}=t,r=n.id,c=(k=n.environment_id)!=null?k:void 0,o=(v=n.branch)!=null?v:void 0;let l;e[0]!==n.output_items?(l=n.output_items.filter(go).flatMap(ko),e[0]=n.output_items,e[1]=l):l=e[1];let f;e[2]!==n.output_items?(f=n.output_items.filter(jo).flatMap(yo).filter(bo).map(wo),e[2]=n.output_items,e[3]=f):f=e[3];let d;e[4]!==((b=n.worklog)==null?void 0:b.messages)?(d=(y=(D=(C=(N=n.worklog)==null?void 0:N.messages)==null?void 0:C.map(ho))==null?void 0:D.filter(_o))!=null?y:[],e[4]=(P=n.worklog)==null?void 0:P.messages,e[5]=d):d=e[5];let u;e[6]!==n.id||e[7]!==c||e[8]!==o||e[9]!==l||e[10]!==f||e[11]!==d?(u={taskId:r,environmentId:c,branch:o,fileSnapshots:l,imagePointers:f,terminalMessageContents:d},e[6]=n.id,e[7]=c,e[8]=o,e[9]=l,e[10]=f,e[11]=d,e[12]=u):u=e[12];const w=u;let p;e[13]!==i?(p=z("p-0!",i),e[13]=i,e[14]=p):p=e[14];let _;e[15]!==a||e[16]!==p?(_=s.jsx(kt,{className:p,disableWordFade:!0,children:a}),e[15]=a,e[16]=p,e[17]=_):_=e[17];let h;return e[18]!==w||e[19]!==_?(h=s.jsx(Xn.Provider,{value:w,children:_}),e[18]=w,e[19]=_,e[20]=h):h=e[20],h}function _o(t){return!!t}function wo(t){return{asset_pointer:t.asset_pointer,width:t.width,height:t.height,size_bytes:t.size_bytes}}function bo(t){return t.content_type==="image_asset_pointer_citation"}function yo(t){return t.content}function jo(t){return t.type==="message"}function ko(t){return t.files}function vo(t){"use forget";var St,Ft,Dt,Pt,Lt,Et,$t,Rt,Ot;const e=ct.c(142),{isLatest:n,task:a,userTurn:i,assistantTurns:r,selectedAssistantId:c,focusedAssistantTurn:o,setFocusedAssistantTurnId:l,onClickFile:f,currentTab:d,onTabChange:u,permissions:w,startOpen:p,hasComments:_,clearComments:h,showFullDiff:k,flushHeaderSeparator:v,attemptIdsOverride:b,idToIndexMapOverride:N,latestUserMessageRef:C}=t,D=v===void 0?!1:v,y=ft();let P;e[0]!==y?(P=!1,e[0]=y,e[1]=P):P=e[1];const M=P;let L;e[2]!==r?(L=r.filter(Po),e[2]=r,e[3]=L):L=e[3];const S=L;let F,E;e[4]!==M||e[5]!==S?(E=[],F=[],S.forEach(j=>{var $,H;if(($=j.debug_metadata)!=null&&$.is_shadow_turn)M&&!F.includes(j.id)&&F.push(j.id);else if(E.push(j.id),M){const ne=(H=j.debug_metadata)==null?void 0:H.shadow_turn_control_for;ne&&!F.includes(ne)&&F.push(ne)}}),e[4]=M,e[5]=S,e[6]=F,e[7]=E):(F=e[6],E=e[7]);let U;e[8]!==F||e[9]!==M||e[10]!==E?(U=M?E.concat(F.filter(j=>!E.includes(j))):E,e[8]=F,e[9]=M,e[10]=E,e[11]=U):U=e[11];const Y=U;let W;e[12]!==F||e[13]!==Y?(W={attemptIds:Y,shadowAttemptIds:F},e[12]=F,e[13]=Y,e[14]=W):W=e[14];const{attemptIds:T,shadowAttemptIds:K}=W,A=b!=null?b:T;let X;e:{if(!M||K.length===0){let ne;e[15]===Symbol.for("react.memo_cache_sentinel")?(ne=[],e[15]=ne):ne=e[15],X=ne;break e}let j;e[16]!==K?(j=new Set(K),e[16]=K,e[17]=j):j=e[17];const $=j;let H;if(e[18]!==A||e[19]!==$){let ne;e[21]!==$?(ne=mn=>$.has(mn),e[21]=$,e[22]=ne):ne=e[22],H=A.filter(ne),e[18]=A,e[19]=$,e[20]=H}else H=e[20];X=H}const V=X,Se=A.length>1||!!b,Fe=S;let ke;e[23]!==Fe||e[24]!==c?(ke=(Ft=(St=Fe.find(j=>j.id===c))!=null?St:Fe[0])!=null?Ft:null,e[23]=Fe,e[24]=c,e[25]=ke):ke=e[25];const m=ke;let ve;e[26]!==S?(ve=S.map(Do),e[26]=S,e[27]=ve):ve=e[27];const Ue=ve;let Me;e[28]!==S?(Me=S.some(Fo),e[28]=S,e[29]=Me):Me=e[29];const ge=n&&Me&&!!(a!=null&&a.id);let Te;e:{if(N){Te=N;break e}let j;e[30]!==A?(j={},A.forEach(($,H)=>{j[$]=H}),e[30]=A,e[31]=j):j=e[31],Te=j}const De=Te;let Pe;e[32]!==m?(Pe=is(m),e[32]=m,e[33]=Pe):Pe=e[33];const Le=Pe;let Ne;e[34]!==(m==null?void 0:m.output_items)?(Ne=(Pt=(Dt=m==null?void 0:m.output_items)==null?void 0:Dt.filter(rs))!=null?Pt:[],e[34]=m==null?void 0:m.output_items,e[35]=Ne):Ne=e[35];const oe=Ne,Ve=oe.length>0;let ie;e[36]!==r?(ie=r.some(So),e[36]=r,e[37]=ie):ie=e[37];const qe=ie,re=(($t=(Et=(Lt=r[0])==null?void 0:Lt.sibling_turn_ids)==null?void 0:Et.length)!=null?$t:0)>0,Ee=V.length>0,$e=!!(b!=null&&b.length)||re||Ee;let le;e[38]!==(o==null?void 0:o.discarded)||e[39]!==(m==null?void 0:m.id)||e[40]!==l?(le=()=>{var j;o!=null&&o.discarded&&l((j=m==null?void 0:m.id)!=null?j:null)},e[38]=o==null?void 0:o.discarded,e[39]=m==null?void 0:m.id,e[40]=l,e[41]=le):le=e[41];const he=o==null?void 0:o.discarded,xe=m==null?void 0:m.id;let ce;e[42]!==l||e[43]!==he||e[44]!==xe?(ce=[he,xe,l],e[42]=l,e[43]=he,e[44]=xe,e[45]=ce):ce=e[45],x.useEffect(le,ce);const Q=Ge(Co),Z=jn();let Ce;e[46]===Symbol.for("react.memo_cache_sentinel")?(Ce=new Set,e[46]=Ce):Ce=e[46];const _e=x.useRef(Ce);let de;e[47]!==Q||e[48]!==M||e[49]!==Z||e[50]!==V||e[51]!==a?(de=()=>{!M||!(a!=null&&a.id)||V.length===0||V.forEach(j=>{if(!j)return;const $=Ge.getState().taskTurnMap[a.id];$!=null&&$[j]||_e.current.has(j)||(_e.current.add(j),Z.fetchQuery(ms(a.id,j)).then(H=>{H&&(H.turn&&Q(a.id,H.turn),H.user_turn&&Q(a.id,H.user_turn))}).catch(No).finally(()=>{_e.current.delete(j)}))})},e[47]=Q,e[48]=M,e[49]=Z,e[50]=V,e[51]=a,e[52]=de):de=e[52];const we=a==null?void 0:a.id;let fe;e[53]!==Q||e[54]!==M||e[55]!==Z||e[56]!==V||e[57]!==we?(fe=[Q,M,Z,V,we],e[53]=Q,e[54]=M,e[55]=Z,e[56]=V,e[57]=we,e[58]=fe):fe=e[58],x.useEffect(de,fe);let ue;e[59]!==m||e[60]!==a?(ue={mutationFn:async()=>{a&&m&&await tn.undoDiscardedTurns(a.id,m.id)},onSuccess:()=>{var j;a&&m&&(Ge.getState().updateTurnDiscarded(a.id,m.id,!1),(j=m.sibling_turn_ids)==null||j.forEach($=>{Ge.getState().updateTurnDiscarded(a.id,$,!1)}))}},e[59]=m,e[60]=a,e[61]=ue):ue=e[61];const me=kn(ue);let G;if(e[62]!==ge||e[63]!==Ue||e[64]!==(a==null?void 0:a.id)){let j;e[66]!==ge||e[67]!==(a==null?void 0:a.id)?(j=$=>s.jsx(mo,{taskId:a==null?void 0:a.id,turnId:$,enabled:ge},$),e[66]=ge,e[67]=a==null?void 0:a.id,e[68]=j):j=e[68],G=Ue.map(j),e[62]=ge,e[63]=Ue,e[64]=a==null?void 0:a.id,e[65]=G}else G=e[65];let ee;e[69]!==n||e[70]!==C||e[71]!==i?(ee=i&&s.jsx(Ma,{isLoading:!1,userTurn:i,containerRef:n?C:void 0},i.id),e[69]=n,e[70]=C,e[71]=i,e[72]=ee):ee=e[72];const Re=$e&&"border-b",q=D&&"-mx-6";let I;e[73]!==Re||e[74]!==q?(I=z("border-token-border-default flex items-center justify-between",Re,q),e[73]=Re,e[74]=q,e[75]=I):I=e[75];let te;e[76]!==A||e[77]!==h||e[78]!==(o==null?void 0:o.id)||e[79]!==_||e[80]!==Ee||e[81]!==re||e[82]!==De||e[83]!==(m==null?void 0:m.id)||e[84]!==l||e[85]!==V||e[86]!==Se||e[87]!==a?(te=a&&Se&&(re?!0:Ee)&&s.jsx(co,{taskId:a.id,attemptIds:A,selectedId:(Rt=m==null?void 0:m.id)!=null?Rt:null,focusedId:(Ot=o==null?void 0:o.id)!=null?Ot:null,onSelect:l,idToIdxMap:De,hasComments:_,clearComments:h,shadowAttemptIds:V}),e[76]=A,e[77]=h,e[78]=o==null?void 0:o.id,e[79]=_,e[80]=Ee,e[81]=re,e[82]=De,e[83]=m==null?void 0:m.id,e[84]=l,e[85]=V,e[86]=Se,e[87]=a,e[88]=te):te=e[88];let pe;e[89]!==qe||e[90]!==me?(pe=qe&&s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"border-token-border-primary ms-2 h-4 w-px border-s","aria-hidden":"true"}),s.jsx(je,{color:"ghost",size:"small",icon:Rn,onClick:()=>me.mutate(),className:"ms-auto",loading:me.isPending,children:s.jsx(g,{id:"wham.attemptsTab.showAll",defaultMessage:"Show all"})})]}),e[89]=qe,e[90]=me,e[91]=pe):pe=e[91];let se;e[92]!==I||e[93]!==te||e[94]!==pe?(se=s.jsxs("div",{className:I,children:[te,pe]}),e[92]=I,e[93]=te,e[94]=pe,e[95]=se):se=e[95];let Oe;e[96]!==r[0]||e[97]!==d||e[98]!==o||e[99]!==u||e[100]!==m||e[101]!==l||e[102]!==a?(Oe=a&&r[0]&&s.jsx(ma,{taskId:a.id,assistantTurn:m!=null?m:r[0],focusedAssistantTurn:o,currentTab:d,onTabChange:j=>{var $;u(j),l(($=m==null?void 0:m.id)!=null?$:null)}}),e[96]=r[0],e[97]=d,e[98]=o,e[99]=u,e[100]=m,e[101]=l,e[102]=a,e[103]=Oe):Oe=e[103];let be;e[104]!==Oe?(be=s.jsx("div",{className:"flex items-center justify-between gap-2",children:Oe}),e[104]=Oe,e[105]=be):be=e[105];let ye;e[106]!==Le||e[107]!==m?(ye=!!Le&&m&&s.jsx(xo,{assistantTurn:m,outputText:Le,className:"px-4 text-sm leading-5"},m.id),e[106]=Le,e[107]=m,e[108]=ye):ye=e[108];let We;e[109]!==oe||e[110]!==Ve||e[111]!==(m==null?void 0:m.id)?(We=Ve&&s.jsx("div",{className:"flex flex-col gap-4",children:oe.map((j,$)=>{var H;return s.jsx(Qa,{item:j},"".concat((H=m==null?void 0:m.id)!=null?H:"turn","-code-review-").concat($))})}),e[109]=oe,e[110]=Ve,e[111]=m==null?void 0:m.id,e[112]=We):We=e[112];let ze;e[113]!==m?(ze=(m==null?void 0:m.error)&&s.jsx(ja,{focusedAssistantTurn:m}),e[113]=m,e[114]=ze):ze=e[114];let Ke;e[115]!==(o==null?void 0:o.id)||e[116]!==f||e[117]!==m||e[118]!==l||e[119]!==k||e[120]!==p?(Ke=(m==null?void 0:m.role)==="assistant"&&m.output_items&&s.jsx(fo,{assistantTurn:m,onClickFile:j=>{l(m.id),f(j)},startOpen:p,isActive:(o==null?void 0:o.id)===m.id,showFullDiff:k}),e[115]=o==null?void 0:o.id,e[116]=f,e[117]=m,e[118]=l,e[119]=k,e[120]=p,e[121]=Ke):Ke=e[121];let Je;e[122]!==r||e[123]!==o||e[124]!==n||e[125]!==w||e[126]!==a?(Je=a&&n&&r.every(Mo)&&s.jsx(Aa,{taskTurn:{task:a,turn:o!=null?o:r[0]},permissions:w}),e[122]=r,e[123]=o,e[124]=n,e[125]=w,e[126]=a,e[127]=Je):Je=e[127];let Ye;e[128]!==Je?(Ye=s.jsx("div",{className:"flex items-center gap-2",children:Je}),e[128]=Je,e[129]=Ye):Ye=e[129];let Ie;e[130]!==Ke||e[131]!==Ye?(Ie=s.jsxs("div",{className:"flex flex-col gap-2",children:[Ke,Ye]}),e[130]=Ke,e[131]=Ye,e[132]=Ie):Ie=e[132];let ot;return e[133]!==G||e[134]!==ee||e[135]!==se||e[136]!==be||e[137]!==ye||e[138]!==We||e[139]!==ze||e[140]!==Ie?(ot=s.jsxs("div",{className:"flex flex-col gap-4",children:[G,ee,se,be,ye,We,ze,Ie]}),e[133]=G,e[134]=ee,e[135]=se,e[136]=be,e[137]=ye,e[138]=We,e[139]=ze,e[140]=Ie,e[141]=ot):ot=e[141],ot}function Mo(t){return t.turn_status==="completed"}function No(){}function Co(t){return t.addTurnToTaskMap}function So(t){return t.discarded}function Fo(t){return!en(t.turn_status)}function Do(t){return t.id}function Po(t){return!t.discarded}const ei=x.memo(vo);function ti({unifiedDiff:t,setUnifiedDiff:e,showFullDiff:n,setShowFullDiff:a}){const i=B(),[r,c]=x.useState(!1);return s.jsxs(Zt,{open:r,onOpenChange:c,contentAlign:"end",sideOffset:8,modal:!0,triggerButton:s.jsx("button",{type:"button",onClick:()=>c(!0),className:"hover:bg-token-border-light flex items-center justify-center rounded p-3","aria-label":i.formatMessage({id:"wham.diffModeDropdown.openMenu",defaultMessage:"Open diff settings menu"}),children:s.jsx(zt,{className:"icon"})}),children:[s.jsxs(J.RadioGroup,{value:t?"unified":"split",onValueChange:o=>e(o==="unified"),onClick:o=>o.stopPropagation(),children:[s.jsx(J.RadioItem,{value:"split",onClick:o=>o.stopPropagation(),children:s.jsxs("div",{className:"text-token-text-primary flex items-center gap-3",children:[s.jsx(zt,{className:"icon"}),s.jsx(g,{id:"wham.message.modal.footer.splitDiff",defaultMessage:"Split diff"})]})}),s.jsx(J.RadioItem,{value:"unified",onClick:o=>o.stopPropagation(),children:s.jsxs("div",{className:"text-token-text-primary flex items-center gap-3",children:[s.jsx(js,{className:"icon"}),s.jsx(g,{id:"wham.message.modal.footer.unifiedDiff",defaultMessage:"Unified diff"})]})})]}),s.jsx(J.Separator,{}),s.jsxs(J.RadioGroup,{value:n?"full":"latest",onValueChange:o=>a(o==="full"),onClick:o=>{o.stopPropagation()},children:[s.jsx(J.RadioItem,{value:"full",children:s.jsx(g,{id:"wham.copyFile.showFullDiff",defaultMessage:"Full diff"})}),s.jsx(J.RadioItem,{value:"latest",children:s.jsx(g,{id:"wham.copyFile.showLatestCommit",defaultMessage:"Incremental diff"})})]})]})}const ni=({copyApplyToClipboard:t,copyPatchToClipboard:e,createPr:n,updateBranch:a,navigateToCreatingPrPage:i,canCreatePr:r,isCreatingPr:c,permissions:o,assistantTurn:l,showOnlyViewPr:f})=>{var _,h;const d=ft(),u=B(),w=yt(d,"296452287"),p=s.jsxs(s.Fragment,{children:[a&&r&&s.jsx(J.Item,{icon:Be,onClick:()=>n(),"aria-label":u.formatMessage(O.createNewPr),children:s.jsx("div",{className:"flex items-center gap-1.5",children:s.jsx(g,R({},O.createNewPr))})}),s.jsx(J.Item,{icon:Qe,onClick:()=>t(),"aria-label":u.formatMessage(O.copyGitApply),children:s.jsx(g,R({},O.copyGitApply))}),s.jsx(J.Item,{icon:Qe,onClick:()=>e(),"aria-label":u.formatMessage(O.copyPatch),children:s.jsx(g,R({},O.copyPatch))})]});return f?(_=l==null?void 0:l.pull_request_data)!=null&&_.url?s.jsx(je,{icon:Be,onClick:()=>{var k;(k=l==null?void 0:l.pull_request_data)!=null&&k.url&&window.open(l.pull_request_data.url,"_blank")},children:s.jsx(g,R({},O.viewPullRequest))}):null:!r||o==="read"?s.jsx(Xe,{buttonIcon:Gt,onClick:()=>t(),triggerButtonAriaLabel:O.openDropdown,dropdownContent:s.jsx(J.Item,{icon:Qe,onClick:()=>e(),"aria-label":u.formatMessage(O.copyPatch),children:s.jsx(g,R({},O.copyPatch))}),children:s.jsx(g,R({},O.copyGitApply))}):c?s.jsx(Xe,{buttonIcon:ut,onClick:i,dropdownContent:p,triggerButtonAriaLabel:O.openDropdown,children:s.jsx(g,R({},O.viewPullRequest))}):(h=l==null?void 0:l.pull_request_data)!=null&&h.url&&(l==null?void 0:l.pull_request_status)!=="externally_created"?s.jsx(Xe,{buttonIcon:Be,as:"a",href:l.pull_request_data.url,dropdownContent:p,triggerButtonAriaLabel:O.openDropdown,children:s.jsx(g,R({},O.viewPullRequest))}):a?s.jsx(Xe,{buttonIcon:Be,onClick:()=>a(),dropdownContent:p,triggerButtonAriaLabel:O.openDropdown,children:s.jsx(g,R({},O.updateExistingBranch))}):s.jsx(Xe,{buttonIcon:Be,onClick:()=>n(),"aria-label":u.formatMessage(O.createPr),triggerButtonAriaLabel:O.openDropdown,dropdownContent:s.jsxs(s.Fragment,{children:[s.jsx(J.Item,{icon:Be,onClick:()=>n("draft"),"aria-label":u.formatMessage(O.createDraftPr),children:s.jsx(g,R({},O.createDraftPr))}),w&&s.jsx(J.Item,{icon:Be,onClick:()=>n("auto_merge"),"aria-label":u.formatMessage(O.createAutoMergePr),children:s.jsx(g,R({},O.createAutoMergePr))}),s.jsx(J.Separator,{}),p]}),children:s.jsx(g,R({},O.createPr))})},O=wt({copyGitApply:{id:"wham.whamTaskPushDiffDropdown.copyGitApply",defaultMessage:"Copy git apply"},copyPatch:{id:"wham.whamTaskPushDiffDropdown.copyPatch",defaultMessage:"Copy patch"},viewPullRequest:{id:"wham.message.modal.footer.viewPr",defaultMessage:"View PR"},createPr:{id:"wham.message.modal.footer.createPrItem",defaultMessage:"Create PR"},createNewPr:{id:"wham.whamTaskPushDiffDropdown.createNewPr",defaultMessage:"Create new PR"},createDraftPr:{id:"wham.message.modal.footer.createDraftPr",defaultMessage:"Create draft PR"},createAutoMergePr:{id:"wham.message.modal.footer.createAutoMergePr",defaultMessage:"Create auto-merged PR"},updateExistingBranch:{id:"wham.whamTaskPushDiffDropdown.updateExistingBranch",defaultMessage:"Update branch"},openDropdown:{id:"wham.whamTaskPushDiffDropdown.openDropdown",defaultMessage:"Open git action menu"}});export{xo as A,Ia as C,ti as D,Va as F,ei as M,ni as P,Go as W,et as a,Pa as b,ks as c,Ms as d,lo as f,vs as u};
//# sourceMappingURL=d0444mle8cdypjta.js.map
