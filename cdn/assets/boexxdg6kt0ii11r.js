var O=Object.defineProperty;var G=(a,e,t)=>e in a?O(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var u=(a,e,t)=>G(a,typeof e!="symbol"?e+"":e,t);import{r as $,j as o,e as Q,i as H,a as K,a9 as X,b as J,M as A,a0 as U}from"./fg33krlcm0qyi6yw.js";import{bb as V,me as Y,m as Z,jR as ee,a9 as te}from"./mtk1qztvnb31pw5r.js";import{A as D}from"./dcp7peq4y6a4kabz.js";import{by as se,gd as re}from"./k65njl5wlgspihfr.js";import{a as ae}from"./gp2ycmyaevvj2458.js";import{j as oe}from"./n0ab5m1z76n8mazm.js";import{W as ne,a as ie,w as ce}from"./sy1xvqwioh9ks4z8.js";import"./eb2ntjcgqhqizd13.js";import"./hots192vdjsjmkwr.js";import"./efooahjtdr85x1lo.js";import"./km71i01x6ma5r62b.js";import"./f9jzes5xr4mq3zrh.js";import"./j6htuwwuulo7h0p6.js";import"./czn39vd97sciq42g.js";import"./l9v3ntkj34comb67.js";import"./cmaobpdpreyiep8p.js";import"./eqi3xjytwhmszqqa.js";import"./bhm7utdivrybcfbl.js";import"./ohquqctluwabmb5i.js";import"./c2cj1dlcffke3f7m.js";import"./hb1mva1gmw4bcs8w.js";import"./mivow98b53y1taf8.js";import"./krwszi9u3lj63i9v.js";import"./kpobiwwkg2o2u14w.js";import"./ir7nzwbolrsm3ds2.js";import"./mmn9462oogkapcg8.js";import"./ck1u9icgxosmytry.js";import"./bes67zhi4fr5gq8i.js";import"./btdpwmi6j9nv6qc2.js";import"./keo7wnl5i52xco98.js";import"./kzbknm4lxuyoq9wi.js";import"./jed1ux7qibe55pmj.js";import"./h1em0bjkpkjv8ykw.js";import"./f5ep9o7usovyn4vf.js";import"./ly75bs3d14n5v622.js";import"./hu1bt0oauegdhua6.js";const F=(a,e)=>a+Math.random()*(e-a),M=(a,e)=>Math.floor(F(a,e)),y=a=>a[M(0,a.length)],le=(a,e,t)=>{const s=Math.sin(a*13.37+e*17.42+t*5e-4)*43758.5453;return s-Math.floor(s)};class de{constructor(e,t,s,n){u(this,"x");u(this,"y");u(this,"glyph","");u(this,"alpha",0);u(this,"last",-1/0);u(this,"active",-1/0);u(this,"fadeDelay",0);u(this,"fadeStartDelay",0);u(this,"drift");u(this,"isBlueChar",!1);this.cellSize=s,this.baseTrail=n,this.x=e*s,this.y=t*s,this.drift=n}trigger(e,t,s,n){this.glyph=t,this.last=this.active=e,this.fadeDelay=n,this.alpha=255,this.isBlueChar=s}update(e,t,s){const n=e-this.last,i=e-this.active;let l=1;i<t&&(l=s+(1-s)*(i/t));const _=this.fadeStartDelay+this.fadeDelay,k=1-Math.max(0,Math.min(1,(n-_)/this.drift));this.alpha=k*l*255}draw(e,t,s){this.alpha<=1||!this.glyph||(e.fillStyle=this.isBlueChar?s?"rgba(60,140,220,".concat((this.alpha/255).toFixed(3),")"):"rgba(0,0,255,".concat((this.alpha/255).toFixed(3),")"):"rgba(".concat(t,",").concat((this.alpha/255).toFixed(3),")"),e.fillText(this.glyph,this.x+this.cellSize/2,this.y+this.cellSize/2))}}function he(a){switch(a){case 0:return"OpenAI";case 1:{const e=["history","memory","log","buffer","stack"];return"let ".concat(y(e)," = [];")}case 2:return y(["LottieAnimation(R.raw.blossom)","<div className='flex flex-col-reverse h-full'>","/bin/bash --login","docker exec -it","# TODO (for codex)","oai deploy codex --force","exec(s:='print(\"exec(s:=%r)\"%s)')","fallocate -l 1T /etc/hosts","guard let codex else { return }",'#pragma GCC diagnostic ignored "-W6d697a"','feed_chars("find . -name AGENTS.md\\n")',"pip install tensorflow",'while State(): Loop(Error("wham"))','echo "I AM DONE"',"connector_client.get_access_token(user)","i  = 0x5f3759df - ( i >> 1 );","try: push_to_prod(); except Exception: pass","biscuit = decode_biscuit(token) # what is a biscuit?","$JAM_TMP_DIR/dl_and_run_daemon.sh","assert s == enc.decode(enc.encode(s))","npm run test || echo 'failed due to env limitations' && echo 'tests pass'",'echo "We are apparently unstoppable! Let\'s proceed with the meltdown."']);case 3:{const e=["decodeThought","decodeSignal","processInput","parseMemory","extractTruth","unpackTrace"];return"let _ = [].flatMap(".concat(y(e),");")}case 4:return"if (codex.hasContext) runSequence();";case 5:{const e=["fetch","post","ping"],t=["api","data","log"],s=["wham","thoughts","memory","pulse","state","history","context","codex","info"];return"".concat(y(e),'("/').concat(y(t),"/").concat(y(s),'");')}case 6:{const e=["i","j","n","t"],t=["data","timeline","sequence"];return"for (let ".concat(y(e)," of ").concat(y(t),") { // ... }")}case 7:return"if (result == void 0) return;";case 8:{const e=M(0,6),t=M(0,10);return"let delay = baseTime * ".concat(e,".").concat(t," + offset;")}case 9:{const e=M(3,6),t=Array.from({length:e},()=>F(.1,5)),s=t.reduce((i,l)=>i+Math.exp(l),0),n=t.map(i=>Math.exp(i)/s);return"const probs = [".concat(n.map(i=>i.toFixed(2)).join(", "),"];")}default:return"// unknown line"}}function ue({children:a,className:e=""}){const t=$.useRef(null),s=V();return $.useEffect(()=>{const n=t.current;if(!n)return;const i=n.getContext("2d");if(!i)return;const l=9,_=6e3,f=5500,k=.25,I=5,b=40,E=90,C=["let","const","if","for","new","return","void","fetch","OpenAI","Codex"];let p,x,d,j,w;const g=[],P=s?"255,255,255":"0,0,0",L=s?"#000":"#fff",T=window.devicePixelRatio||1,B=()=>{const h=M(0,10),c=he(h),r=[...c],m=Array(r.length).fill(0);return C.forEach(v=>{const W=new RegExp("\\b".concat(v,"\\b"),"g");let S;for(;S=W.exec(c);)for(let R=S.index;R<S.index+v.length;R++)m[R]=1}),{chars:r,pattern:m}},N=()=>{p=window.innerWidth,x=window.innerHeight,n.style.width="".concat(p,"px"),n.style.height="".concat(x,"px"),n.width=Math.floor(p*T),n.height=Math.floor(x*T),i.resetTransform(),i.scale(T,T),i.font="500 ".concat(l*1.5,"px monospace"),i.textAlign="center",i.textBaseline="middle",d=Math.floor(p/l),j=Math.floor(x/l),w=Array.from({length:d},(h,c)=>Array.from({length:j},(r,m)=>new de(c,m,l,_)))},z=h=>{const c=M(0,d),r=M(0,j),{chars:m,pattern:v}=B();w[c][r].trigger(h,m[0],v[0]===1,0),g.push({col:c,row:r,idx:0,chars:m,pattern:v,next:h,seed:Math.random()*1e3})},q=h=>{g.length<I&&Math.random()<.02&&z(h);for(let c=g.length-1;c>=0;c--){const r=g[c];if(h>=r.next){if(r.idx>=r.chars.length-1){g.splice(c,1);continue}const m=le(r.idx,r.seed,h);r.next=h+m*(E-b)+b,r.col=(r.col+1)%d,r.idx++;const v=r.idx*50;w[r.col][r.row].trigger(h,r.chars[r.idx],r.pattern[r.idx]===1,v)}}i.fillStyle=L,i.fillRect(0,0,p,x);for(const c of w)for(const r of c)r.update(h,f,k),r.draw(i,P,s);requestAnimationFrame(q)};return N(),requestAnimationFrame(q),window.addEventListener("resize",N),()=>window.removeEventListener("resize",N)},[s]),o.jsxs("div",{className:"relative h-svh w-full overflow-hidden ".concat(e).trim(),children:[o.jsx("canvas",{ref:t,className:"pointer-events-none absolute inset-0 z-0"}),o.jsx("div",{className:"relative z-10 flex h-full w-full flex-col items-center justify-center",children:a})]})}function fe(){var C,p,x;const a=Q(),e=H(),t=K(),{taskId:s,turnId:n}=X(),[i,l]=$.useState(!1),_=$.useMemo(()=>oe(s,n,{refetchInterval:d=>{var w,g,P;const j=(P=(g=(w=d.state)==null?void 0:w.data)==null?void 0:g.turn)==null?void 0:P.pull_request_status;switch(j){case null:case void 0:case"not_created":case"creating":return 2e3;case"failed":case"created":case"updated":case"externally_created":return!1;default:Y(j)}}}),[s,n]),{data:f}=J(_),k=Z(),I=async()=>{if(!(!s||!n))try{l(!0),await ne.createPr(s,n,me()),await t.invalidateQueries({queryKey:["wham","task"]})}catch(d){d instanceof ie&&ce(d,n,a,k)}finally{l(!1)}},b=(p=(C=f==null?void 0:f.turn)==null?void 0:C.pull_request_data)==null?void 0:p.url;$.useEffect(()=>{b&&(window.location.href=b)},[b]);const E=((x=f==null?void 0:f.turn)==null?void 0:x.pull_request_status)==="failed";return o.jsx(ue,{children:o.jsx(se,{children:o.jsxs("div",{className:"flex h-full flex-col",children:[o.jsx(ae,{className:"absolute start-0 end-0 top-0",children:o.jsx("div",{className:"flex w-full justify-end",children:o.jsx(re,{onClick:()=>{window.opener?(window.opener.focus(),window.close()):e("/codex/tasks/".concat(s))},icon:o.jsx(D,{}),label:a.formatMessage({id:"wham.task.pr.header.title",defaultMessage:"Back to task"})})})}),o.jsx("div",{className:"flex grow items-center justify-center p-4",children:o.jsxs("div",{className:"flex flex-col items-center",children:[o.jsx(ee,{className:"mb-4 h-15 w-15"}),E?o.jsxs("div",{className:"flex flex-col items-center gap-2",children:[o.jsx("div",{className:"text-token-text-error flex items-center gap-1",children:o.jsx(A,{id:"wham.task.pr.inProgress.error.description",defaultMessage:"Failed to create pull request. Please try again."})}),o.jsx(te,{color:"secondary",size:"small",icon:D,loading:i,onClick:d=>{d.preventDefault(),d.stopPropagation(),I()},children:o.jsx(A,{id:"wham.task.pr.inProgress.error.button",defaultMessage:"Retry"})})]}):o.jsxs(o.Fragment,{children:[o.jsx("p",{className:"loading-shimmer-pure-text text-lg font-semibold",children:o.jsx(A,{id:"wham.task.pr.inProgress.title",defaultMessage:"Creating pull requestâ€¦"})}),o.jsx("p",{className:"text-token-text-secondary text-sm",children:o.jsx(A,{id:"wham.task.pr.inProgress.description",defaultMessage:"Pull request will automatically open once it has been created."})})]})]})})]})})})}function me(){const e=new URLSearchParams(location.search).get("mode");if(e==="draft")return"draft";if(e==="auto_merge")return"auto_merge"}const Ye=()=>[{title:"Codex"}],Ze=U(function(){return o.jsx(fe,{})});export{Ze as default,Ye as meta};
//# sourceMappingURL=boexxdg6kt0ii11r.js.map
