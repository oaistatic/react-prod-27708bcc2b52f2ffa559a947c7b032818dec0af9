var P=Object.defineProperty;var L=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var T=(t,s,a)=>s in t?P(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,o=(t,s)=>{for(var a in s||(s={}))A.call(s,a)&&T(t,a,s[a]);if(L)for(var a of L(s))E.call(s,a)&&T(t,a,s[a]);return t};import{e as k,j as e,M as d,f as R,b as S,a as j,u as p,F as M}from"./fg33krlcm0qyi6yw.js";import{R as u,a9 as K,C as Q,m as C,gK as O,g2 as H,gJ as B,T as D,e1 as W}from"./mtk1qztvnb31pw5r.js";import{g as U}from"./irqko7c1s7qpl41n.js";import{fZ as w,aw as _,jP as z,ci as G,cL as Y}from"./k65njl5wlgspihfr.js";import{T as n}from"./hcn3kohxpjzaoxwc.js";function $(t){return u.safeDelete("/share/post/{post_id}",{parameters:{path:{post_id:t}}})}function J(){return u.safeDelete("/share/posts/mine")}function V({limit:t}){return u.safeGet("/share/posts/mine",{parameters:{query:{limit:t}}})}const h={sharedConversations:["sharedConversations"],sharedTextdocs:["sharedTextdocs"],sharedPosts:["sharedPosts"]},r=R({name:{id:"sharedConversationModal.name",defaultMessage:"Name"},dateShared:{id:"sharedConversationModal.dateShared",defaultMessage:"Date shared"},type:{id:"YiHQp6",defaultMessage:"Type"},chatType:{id:"0BR1NF",defaultMessage:"Chat"},canvasType:{id:"AalPA+",defaultMessage:"Canvas"},postType:{id:"UXpwgD",defaultMessage:"Post"},imageType:{id:"i6Dtp1",defaultMessage:"Image"},loading:{id:"sharedConversationModal.loading",defaultMessage:"Loading..."},somethingWentWrong:{id:"sharedConversationModal.somethingWentWrong",defaultMessage:"Something went wrong..."},retry:{id:"sharedConversationModal.retry",defaultMessage:"Retry"},noSharedConversations:{id:"sharedConversationModal.noSharedConversations",defaultMessage:"You have no shared links."},title:{id:"sharedConversationModal.title",defaultMessage:"Shared Links"},goToOriginConversation:{id:"sharedConversationModal.goToOriginConversation",defaultMessage:"View source chat"},deleteSharedLink:{id:"sharedConversationModal.deleteSharedLink",defaultMessage:"Delete shared link"},deleteSharedLinkFailed:{id:"sharedConversationModal.deleteSharedLinkFailed",defaultMessage:"Deleting shared link failed"},deleteAllSharedLinks:{id:"sharedConversationModal.deleteSharedAllConversations",defaultMessage:"Delete all shared links"},deleteAllSharedLinksConfirm:{id:"sharedConversationModal.deleteSharedAllConversationsConfirm",defaultMessage:"Are you sure you want to delete all your shared links?"},deleteAllSharedLinksFailed:{id:"sharedConversationModal.deleteSharedAllConversationsFailed",defaultMessage:"Deleting shared links failed"}});function X(){const t=j(),s=k(),a=C(),l=w(!0),{mutate:c}=p({mutationFn:()=>Promise.allSettled([u.safeDelete("/share/all",{requestBody:{confirm:!0}}),u.safeDelete("/shared_textdocs",{}),l()?J():Promise.resolve()]),onSettled:()=>{t.invalidateQueries({queryKey:h.sharedConversations}),t.invalidateQueries({queryKey:h.sharedTextdocs}),t.invalidateQueries({queryKey:h.sharedPosts})},onError:()=>{a.danger(r.deleteAllSharedLinksFailed,{toastId:"delete_all_shared_links_failed"})}});return e.jsx(O,{side:"bottom",sideOffset:4,triggerButton:e.jsx("button",{className:"text-token-text-tertiary hover:text-token-text-secondary radix-state-open:text-token-text-tertiary dark:radix-state-open:text-gray-400",children:e.jsx(B,{className:"icon-sm"})}),children:e.jsx(H.Item,{onClick:()=>{window.confirm(s.formatMessage(r.deleteAllSharedLinksConfirm))&&c()},color:"danger",children:e.jsx(d,o({},r.deleteAllSharedLinks))})})}function Z(){return u.safeGet("/shared_conversations",{parameters:{query:{order:"created"}}})}function ee(){return S({queryKey:h.sharedConversations,queryFn:Z,refetchOnMount:"always"})}function te(){return S({queryKey:h.sharedTextdocs,queryFn:()=>u.safeGet("/shared_textdocs",{}),refetchOnMount:"always"})}function se(){const s=w(!0)();return S({queryKey:h.sharedPosts,queryFn:()=>V({limit:1e4}),refetchOnMount:"always",enabled:s,initialData:s?{items:[],cursor:null}:void 0})}const b=({conversationId:t,onClickDelete:s})=>{const a=k();return e.jsx(n.Cell,{textAlign:"right",children:e.jsxs(n.Actions,{children:[t&&e.jsx(D,{label:a.formatMessage(r.goToOriginConversation),side:"top",children:e.jsx("a",{href:W(t),target:"_blank",rel:"noreferrer","aria-label":a.formatMessage(r.goToOriginConversation),className:"text-token-text-tertiary hover:text-token-text-secondary cursor-pointer",children:e.jsx(G,{className:"icon-sm"})})}),e.jsx(D,{label:a.formatMessage(r.deleteSharedLink),side:"top",className:"flex h-fit",children:e.jsx("button",{onClick:s,"aria-label":a.formatMessage(r.deleteSharedLink),className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(Y,{className:"icon-sm"})})})]})})};function ae({sharedConversation:t}){const s=C(),a=j(),{mutate:l,isPending:c}=p({mutationFn:({sharedConversationId:x})=>u.safeDelete("/share/{shared_conversation_id}",{parameters:{path:{shared_conversation_id:x}}}),onSettled:()=>{a.invalidateQueries({queryKey:h.sharedConversations})},onError:()=>{s.danger(r.deleteSharedLinkFailed,{toastId:"delete_shared_link_failed"})}}),i=t.workspace_id!=null?"/share/e/".concat(t.id):"/share/".concat(t.id);return e.jsxs(n.Row,{disabled:c,children:[e.jsx(n.Cell,{children:e.jsxs("a",{href:i,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 align-top text-blue-500 dark:text-blue-400",children:[e.jsx(_,{className:"icon-sm shrink-0"}),t.title]})}),e.jsx(n.Cell,{children:e.jsx(d,o({},r.chatType))}),e.jsx(n.Cell,{children:t.create_time!=null?e.jsx(M,{value:t.create_time,month:"long",year:"numeric",day:"numeric"}):null}),e.jsx(b,{conversationId:t.conversation_id,onClickDelete:()=>l({sharedConversationId:t.id})})]})}function re({sharedTextdoc:t}){const{conversation_id:s,shared_textdoc_id:a}=t,l=C(),c=j(),{mutate:i,isPending:x}=p({mutationFn:async({sharedTextdocId:g})=>u.safeDelete("/textdoc/shared/{shared_textdoc_id}",{parameters:{path:{shared_textdoc_id:g}}}),onSettled:()=>{c.invalidateQueries({queryKey:h.sharedTextdocs})},onError:()=>{l.danger(r.deleteSharedLinkFailed,{toastId:"delete_shared_link_failed"})}});return e.jsxs(n.Row,{disabled:x,children:[e.jsx(n.Cell,{children:e.jsxs("a",{href:U(a),target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 align-top text-blue-500 dark:text-blue-400",children:[e.jsx(_,{className:"icon-sm shrink-0"}),t.name]})}),e.jsx(n.Cell,{children:e.jsx(d,o({},r.canvasType))}),e.jsx(n.Cell,{children:t.created_at!=null?e.jsx(M,{value:t.created_at,month:"long",year:"numeric",day:"numeric"}):null}),e.jsx(b,{conversationId:s,onClickDelete:()=>i({sharedTextdocId:a})})]})}function ne({sharedPost:t}){var x,g;const s=C(),a=j(),{mutate:l,isPending:c}=p({mutationFn:async({postId:v})=>$(v),onSettled:()=>{a.invalidateQueries({queryKey:h.sharedPosts})},onError:()=>{s.danger(r.deleteSharedLinkFailed,{toastId:"delete_shared_post_failed"})}}),i=((g=(x=t.attachments)==null?void 0:x[0])==null?void 0:g.kind)==="media_generation"?r.imageType:r.postType;return e.jsxs(n.Row,{disabled:c,children:[e.jsx(n.Cell,{children:e.jsxs("a",{href:z(t.id),target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 align-top text-blue-500 dark:text-blue-400",children:[e.jsx(_,{className:"icon-sm shrink-0"}),t.text]})}),e.jsx(n.Cell,{children:e.jsx(d,o({},i))}),e.jsx(n.Cell,{children:t.posted_at!=null?e.jsx(M,{value:t.posted_at*1e3,month:"long",year:"numeric",day:"numeric"}):null}),e.jsx(b,{conversationId:void 0,onClickDelete:()=>l({postId:t.id})})]})}function ue({onClose:t}){const{data:s,isLoading:a,isError:l,refetch:c}=ee(),{data:i,isLoading:x,isError:g,refetch:v}=te(),{data:f,isLoading:I,isError:q,refetch:F}=se(),N=k();let y;return a||x||I?y=e.jsx("div",{className:"text-token-text-secondary pb-8",children:e.jsx(d,o({},r.loading))}):g||l||q?y=e.jsxs("div",{children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(d,o({},r.somethingWentWrong))}),e.jsx("div",{children:e.jsx(K,{color:"secondary",onClick:()=>{c(),v(),F()},children:e.jsx(d,o({},r.retry))})})]}):(s==null?void 0:s.total)===0&&(i==null?void 0:i.shared_textdocs.length)===0&&(f==null?void 0:f.items.length)===0?y=e.jsx("div",{className:"text-token-text-tertiary pb-8",children:e.jsx(d,o({},r.noSharedConversations))}):y=e.jsxs(n.Root,{className:"max-h-[28rem]",size:"compact",children:[e.jsxs(n.Header,{children:[e.jsx(n.HeaderCell,{children:e.jsx(d,o({},r.name))}),e.jsx(n.HeaderCell,{children:e.jsx(d,o({},r.type))}),e.jsx(n.HeaderCell,{children:e.jsx(d,o({},r.dateShared))}),e.jsx(n.HeaderCell,{textAlign:"right",children:e.jsx(X,{})})]}),e.jsxs(n.Body,{children:[s==null?void 0:s.items.map(m=>e.jsx(ae,{sharedConversation:m},m.id)),i==null?void 0:i.shared_textdocs.map(m=>e.jsx(re,{sharedTextdoc:m},m.shared_textdoc_id)),f==null?void 0:f.items.map(m=>e.jsx(ne,{sharedPost:m},m.id))]})]}),e.jsx(Q,{isOpen:!0,onClose:t,size:"custom",className:"max-w-5xl",type:"success",title:N.formatMessage(r.title),testId:"modal-shared-conversations",showCloseButton:!0,children:y})}export{ue as default};
//# sourceMappingURL=oer33mrwvrc3zvya.js.map
