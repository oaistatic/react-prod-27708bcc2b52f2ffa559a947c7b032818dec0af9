var H=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var R=(t,e,a)=>e in t?H(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,m=(t,e)=>{for(var a in e||(e={}))$.call(e,a)&&R(t,a,e[a]);if(_)for(var a of _(e))Z.call(e,a)&&R(t,a,e[a]);return t},P=(t,e)=>X(t,Y(e));import{e as ee,r as M,j as te,d as s}from"./fg33krlcm0qyi6yw.js";import{aJ as ae,I as se,b as oe,pU as le,d as O,sl as ne,kF as ie,pr as de,sm as ce,kz as re,fe as ge,fN as ue,e4 as j,dI as A,P as B,$ as he,R as fe,A as be,f5 as N,kH as d,dQ as me,b9 as pe,dF as ke,e2 as ye}from"./mtk1qztvnb31pw5r.js";import{fD as Me,b1 as we,fE as Se}from"./k65njl5wlgspihfr.js";import{I as Te}from"./m3nchqrpfl8vs80b.js";const z=(...t)=>e=>t.some(a=>a(e)),G=({allGroupedMessages:t})=>t.some(e=>e.type===d.Browsing||e.type===d.RetrievalBrowsing||e.type===d.ParallelBrowsing),U=({allGroupedMessages:t})=>t.some(e=>e.type===d.SearchGPTQuery),Fe=({allGroupedMessages:t})=>t.some(e=>e.type===d.Text&&e.messages.some(a=>{var l,r;return(r=(l=a.metadata)==null?void 0:l.content_references)==null?void 0:r.some(h=>h.type==="products"||h.type==="product_entity")})),ve=({allGroupedMessages:t})=>t.some(e=>{var a,l,r;return e.type===d.Text&&((r=(l=(a=e.messages[0])==null?void 0:a.metadata)==null?void 0:l.followup_prompts)==null?void 0:r.length)}),W=({allGroupedMessages:t})=>t.some(e=>e.type===d.CodeInterpreter),xe=({allGroupedMessages:t})=>t.some(e=>e.type===d.JITPlugin);function Ce(t){return!t||!t.instructions?"":typeof t.instructions=="string"?t.instructions:t.instructions.filter(e=>typeof e=="string").join("")}const J={"Didn't fully follow instructions":{tag:"Didn't fully follow instructions",label:s({id:"Rdlt9V",defaultMessage:"Didn't fully follow instructions"})}},Ie=[{match:Fe,tag:"Shouldn't have shown products",label:s({id:"HMKFPm",defaultMessage:"Shouldn't have shown products"}),forceRefreshExcluding:"commerce"},{match:z(G,U),tag:"Shouldn't have searched the web",label:s({id:"kL047b",defaultMessage:"Shouldn't have searched the web"})},{match:ve,tag:"Don't like the followups",label:s({id:"xAFgPE",defaultMessage:"Don’t like the suggested follow ups"})},{match:z(G,U),tag:"Don't like the source it cited",label:s({id:"OWjzGX",defaultMessage:"Don't like the sources it cited"})},{match:W,tag:"Shouldn't have run code",label:s({id:"53w4ay",defaultMessage:"Shouldn't have run code"})},{match:W,tag:"Couldn't handle my file",label:s({id:"EkFTQ5",defaultMessage:"Couldn't handle my file"})},{match:({allGroupedMessages:t})=>t.some(e=>e.type===d.Dalle),tag:"Shouldn't have created an image",label:s({id:"S8FRsr",defaultMessage:"Shouldn't have created an image"})},{match:xe,tag:"Tool call didn't work",label:s({id:"JvNV9L",defaultMessage:"Tool call didn't work"})},{match:({allGroupedMessages:t})=>t.some(e=>{if(e.type!==d.Text)return!1;const a=e.messages[0],{content:l}=a;return l.content_type===j.Text&&me(a).match(/^```[\S]+\n/gm)}),tag:"Code was incorrect",label:s({id:"4EBdQk",defaultMessage:"Code was incorrect"})},{match:({systemContent:t})=>{var e;return(e=Ce(t).includes("Personality"))!=null?e:!1},tag:"Too chatty or casual",label:s({id:"ATzJKW",defaultMessage:"Too chatty or casual"})},{match:({isBusinessWorkspace:t})=>t,tag:"File upload not working as expected",label:s({id:"Pv0EgM",defaultMessage:"File upload not working as expected"})},{match:({isBusinessWorkspace:t,hasCaConnection:e})=>t&&e,tag:"Should have triggered Internal knowledge",label:s({id:"DJc0pt",defaultMessage:"Should have triggered Internal knowledge"})},{match:({features:t})=>t.includes(pe.Sunshine),tag:"Shouldn't have used Memory",label:s({id:"yfUEiz",defaultMessage:"Shouldn't have used Memory"})},{tag:"Don’t like the personality",label:s({id:"6Yz27f",defaultMessage:"Don’t like the personality"})},{tag:"Don't like the style",label:s({id:"nGxjdj",defaultMessage:"Don't like the style"})},{tag:"Not factually correct",label:s({id:"Ke7JtQ",defaultMessage:"Not factually correct"})},P(m({},J["Didn't fully follow instructions"]),{match:({isBusinessWorkspace:t})=>!t}),{tag:"Refused when it shouldn't have",label:s({id:"2yRS/Q",defaultMessage:"Refused when it shouldn't have"})},{match:({isBusinessWorkspace:t})=>!t,tag:"Being lazy",label:s({id:"14MPmT",defaultMessage:"Being lazy"})},{tag:"Unsafe or problematic",label:s({id:"02pXBl",defaultMessage:"Unsafe or problematic"})},{tag:"Biased",label:s({id:"pK35DW",defaultMessage:"Biased"})},{tag:"Other",label:s({id:"WiIGE+",defaultMessage:"Other"})}],Ee=[{tag:"I disagree with the policy",label:s({id:"oKyDLz",defaultMessage:"I disagree with the policy"})},{tag:"This didn't violate the policy",label:s({id:"7fUkVF",defaultMessage:"This didn't violate the policy"})},{tag:"I don't understand the policy",label:s({id:"4Cdp6N",defaultMessage:"I don't understand the policy"})},{tag:"This didn't take the full context",label:s({id:"vnZJDP",defaultMessage:"This didn't take the full context"})}],De=[{tag:"Shouldn't have triggered Internal knowledge",label:s({id:"ILVpD8",defaultMessage:"Shouldn't have triggered Internal knowledge"})},{tag:"I specified what data to use and it was wrong",label:s({id:"ziFYwZ",defaultMessage:"I specified what data to use and it was wrong"})},{tag:"Missing relevant Internal knowledge",label:s({id:"PobbBn",defaultMessage:"Missing relevant Internal knowledge"})},{tag:"Inaccurate information",label:s({id:"HbcEAV",defaultMessage:"Inaccurate information"})},{tag:"Response not relevant or helpful",label:s({id:"k2/tlU",defaultMessage:"Response not relevant or helpful"})},m({},J["Didn't fully follow instructions"]),{tag:"I don't like the model tone",label:s({id:"PT9XqK",defaultMessage:"I don't like the model tone"})}];function _e(t,e,a){return e.filter(l=>!l.match||l.match(a)).map(l=>({value:l.tag,label:t.formatMessage(l.label),forceRefreshExcluding:l.forceRefreshExcluding}))}function Re(t){const e=we(t);return e!=null&&(e.errCode===N.ContentPolicy||e.errCode===N.ContentOrTos)}function ze({clientThreadId:t,conversationMessage:e,currentModelId:a,allGroupedMessages:l}){var F,v,x;const r=ee(),h=(F=ae())!=null?F:[],i=(v=e.clientMetadata)==null?void 0:v.rating,f=oe(),p=se(f),b=(x=p==null?void 0:p.isWorkspacePlan())!=null?x:!1,w=le(f),S=O(()=>ne(f)),k=M.useMemo(()=>S&&l.some(o=>{var n;return o.type!==ie&&((n=o.messages)==null?void 0:n.some(de))}),[l,S]),y=O(()=>ce(f)),L=re({clientThreadId:t}),T=M.useRef(ge(o=>{L(o)},500)).current,g=ue(t,o=>ke.findNode(o,n=>n.message.author.role===ye.System&&n.message.content.content_type==="system_content")),K=(g==null?void 0:g.message.content.content_type)===j.SystemContent?g==null?void 0:g.message.content:null,Q=M.useCallback(o=>{var I,E,D;const n=A(t);if(!n||o.tags.length===0&&!o.textFeedback)return;const c=o.tags.map(u=>u.value);B.logEvent(o.source==="inline"?"Message Feedback Inline Submitted":"Message Feedback Dialog Submitted",{id:e.id,threadId:n,tags:c,content:o.textFeedback,model:a,rating:i}),he.logEvent(o.source==="inline"?"chatgpt_feedback_inline_submitted":"chatgpt_feedback_dialog_submitted",(I=c==null?void 0:c[0])!=null?I:null,m({id:e.id,threadId:n,tag:(E=c==null?void 0:c[0])!=null?E:"",content:(D=o.textFeedback)!=null?D:"",model:a!=null?a:"",rating:i!=null?i:""},y?{isCaTriggered:String(k)}:{})),i&&(b&&w?Me({rating:Se(i),text:o.textFeedback,tags:c,tag_choices:o.tagChoices},n,e.id):b||fe.safePost("/conversation/message_feedback",{requestBody:{message_id:e.id,conversation_id:n,rating:i,text:o.textFeedback,tags:c,tag_choices:o.tagChoices},authOption:be.SendIfAvailable}));const C=o.tags.map(u=>u.forceRefreshExcluding).filter(u=>!!u);C.length>0&&T({sourceEvent:o.event,nodeId:e.id,extraStreamParams:{forceDisableFeatures:C}})},[t,e.id,a,T,y,b,k,w,i]),V=()=>{B.logEvent("Message Feedback More Options Clicked",{id:e.id,threadId:A(t),model:a,rating:i})},q=_e(r,Re(e)?Ee:k?De:Ie,{allGroupedMessages:l,features:h,currentModelId:a!=null?a:"",systemContent:K,isBusinessWorkspace:b,hasCaConnection:y});return i==="thumbsUp"?null:te.jsx(Te,{tagOptions:q,onSubmit:Q,onMoreClicked:V})}export{ze as default};
//# sourceMappingURL=jma9zspxcel79hob.js.map
