var E=Object.defineProperty,L=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var k=(s,e,t)=>e in s?E(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,q=(s,e)=>{for(var t in e||(e={}))z.call(e,t)&&k(s,t,e[t]);if(A)for(var t of A(e))B.call(e,t)&&k(s,t,e[t]);return s},g=(s,e)=>L(s,Z(e));import{b as w,y as W,c as F,a as h,u as K,e as P}from"./fg33krlcm0qyi6yw.js";import{tk as M,R as m,tl as f,tm as R,m as v,sC as C,tn as U}from"./mtk1qztvnb31pw5r.js";const G=(s,e)=>[s,"role-metadata",e],$=(s,e)=>[s,"role-credit-recommendation",e],J=({workspaceId:s,roleId:e})=>w({queryKey:[s,"role",e],enabled:!!e,queryFn:async()=>(await m.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}",{parameters:{query:{account_id:s,consistency:"strong"},path:{workspace_id:s,role_id:e}}})).role,staleTime:1e3*60*5}),V=({workspaceId:s,enabled:e=!0})=>w({queryKey:[s,"roles"],queryFn:()=>m.safeGet("/rbac/workspace/{workspace_id}/roles",{parameters:{query:{account_id:s,consistency:"strong"},path:{workspace_id:s}}}),enabled:e}),X=({workspaceId:s,roleId:e})=>w({queryKey:[s,e,"role-groups"],queryFn:async()=>(await m.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}/principals",{parameters:{query:{account_id:s,consistency:"strong"},path:{workspace_id:s,role_id:e}}})).groups}),Y=({accountId:s,workspaceId:e,roleId:t,enabled:a=!0})=>{var l;const{data:i,isLoading:r,isFetching:n,error:c,refetch:o}=w({queryKey:f(e,t),queryFn:()=>m.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}/connectors",{parameters:{query:{account_id:s,consistency:"strong"},path:{workspace_id:e,role_id:t}}}),enabled:a});return{connectorsWithPermission:new Map((l=i==null?void 0:i.connectors_with_permissions)==null?void 0:l.map(y=>[y.connector.id,y])),isLoading:r,isFetching:n,error:c,refetch:o}},x=({workspaceId:s,roleId:e,enabled:t=!0})=>w({queryKey:G(s,e),enabled:t&&!!e,queryFn:()=>m.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}/metadata",{parameters:{query:{account_id:s},path:{workspace_id:s,role_id:e}}})}),I=({workspaceId:s,roleId:e,enabled:t=!0})=>w({queryKey:$(s,e),enabled:t&&!!e,queryFn:()=>m.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}/credit-recommendation",{parameters:{query:{account_id:s},path:{workspace_id:s,role_id:e}}})}),ee=s=>{"use forget";const e=F.c(10),{workspaceId:t,connectorId:a,enabled:i}=s,r=i===void 0?!0:i;let n;e[0]!==a||e[1]!==t?(n=R(t,a),e[0]=a,e[1]=t,e[2]=n):n=e[2];let c;e[3]!==a||e[4]!==t?(c=()=>m.safeGet("/rbac/workspace/{workspace_id}/connector/{connector_id}/roles",{parameters:{query:{account_id:t,consistency:"strong"},path:{workspace_id:t,connector_id:a}}}),e[3]=a,e[4]=t,e[5]=c):c=e[5];let o;return e[6]!==r||e[7]!==n||e[8]!==c?(o={queryKey:n,queryFn:c,enabled:r},e[6]=r,e[7]=n,e[8]=c,e[9]=o):o=e[9],w(o)},se=s=>{"use forget";const e=F.c(4),{workspaceId:t,connectorId:a}=s,i=h();let r;return e[0]!==a||e[1]!==i||e[2]!==t?(r=()=>i.invalidateQueries({queryKey:R(t,a)}),e[0]=a,e[1]=i,e[2]=t,e[3]=r):r=e[3],r},O=({workspaceId:s,roleId:e,connectorId:t})=>m.safeGet("/rbac/workspace/{workspace_id}/roles/{role_id}/connectors/{connector_id}",{parameters:{query:{account_id:s,consistency:"strong"},path:{workspace_id:s,role_id:e,connector_id:t}}}),te=({workspaceId:s,roleId:e,connectorIds:t,enabled:a=!0})=>W({queries:t.map(i=>({queryKey:M(s,i,e),queryFn:async()=>{var r,n,c;try{return await O({workspaceId:s,connectorId:i,roleId:e})}catch(o){if(((c=(n=o==null?void 0:o.status)!=null?n:(r=o==null?void 0:o.response)==null?void 0:r.status)!=null?c:o==null?void 0:o.code)===404)return{permissions:[]};throw o}},enabled:a})),combine:i=>{const r={};return i.forEach((n,c)=>{const o=t[c];n.data?r[o]=n.data.permissions:r[o]=[]}),{results:r,isLoading:i.some(n=>n.isLoading),isFetching:i.some(n=>n.isFetching),isError:i.some(n=>{var c;return n.isError&&((c=n.error)==null?void 0:c.status)!==404}),errors:i.map(n=>n.error).filter(n=>(n==null?void 0:n.status)!==404)}}}),re=s=>{"use forget";const e=F.c(22),{workspaceId:t,currentRoles:a,bootstrapResources:i}=s,r=h(),n=v(),c=P();let o;e[0]!==i||e[1]!==t?(o=Q=>m.safePost("/rbac/workspace/{workspace_id}/roles",{parameters:{query:{account_id:t},path:{workspace_id:t}},requestBody:{role_name:Q.name,description:Q.description,bootstrap_resources:i}}),e[0]=i,e[1]=t,e[2]=o):o=e[2];let u;e[3]!==a||e[4]!==r||e[5]!==t?(u=Q=>{const{name:T,description:b}=Q;r.cancelQueries({queryKey:[t,"roles"]});const S=a;return r.setQueryData([t,"roles"],D=>(D||(D={data:[],object:"list",has_more:!1}),g(q({},D),{data:[{id:"new",name:T,permissions:[],resource_type:"workspace",predefined_role:!1,description:b,created_at:Date.now(),updated_at:Date.now(),created_by:"system",metadata:{}},...D.data]}))),{previousRoles:S}},e[3]=a,e[4]=r,e[5]=t,e[6]=u):u=e[6];let l;e[7]!==c||e[8]!==r||e[9]!==n||e[10]!==t?(l=(Q,T,b)=>{r.setQueryData([t,"roles"],b==null?void 0:b.previousRoles),r.invalidateQueries({refetchType:"all",queryKey:[t,"roles"]}),Q.message==="Role with this name already exists."&&n.warning(c.formatMessage({id:"Hn9Qxu",defaultMessage:"Role with this name already exists"}),{duration:1})},e[7]=c,e[8]=r,e[9]=n,e[10]=t,e[11]=l):l=e[11];let y;e[12]!==r||e[13]!==t?(y=()=>{r.invalidateQueries({refetchType:"all",queryKey:[t,"roles"]}),r.invalidateQueries({refetchType:"all",queryKey:f(t)})},e[12]=r,e[13]=t,e[14]=y):y=e[14];let d;e[15]!==o||e[16]!==u||e[17]!==l||e[18]!==y?(d={mutationFn:o,onMutate:u,onError:l,onSuccess:y},e[15]=o,e[16]=u,e[17]=l,e[18]=y,e[19]=d):d=e[19];const{mutateAsync:p}=K(d);let _;return e[20]!==p?(_={createRole:p},e[20]=p,e[21]=_):_=e[21],_},ae=s=>{"use forget";const e=F.c(10),{workspaceId:t}=s,a=h();let i;e[0]!==t?(i=async u=>await m.safeDelete("/rbac/workspace/{workspace_id}/roles/{role_id}",{parameters:{query:{account_id:t},path:{workspace_id:t,role_id:u}}}),e[0]=t,e[1]=i):i=e[1];let r;e[2]!==a||e[3]!==t?(r=()=>{a.invalidateQueries({refetchType:"all",queryKey:[t,"roles"]}),a.invalidateQueries({refetchType:"all",queryKey:f(t)})},e[2]=a,e[3]=t,e[4]=r):r=e[4];let n;e[5]!==i||e[6]!==r?(n={mutationFn:i,onSuccess:r},e[5]=i,e[6]=r,e[7]=n):n=e[7];const{mutateAsync:c}=K(n);let o;return e[8]!==c?(o={deleteRole:c},e[8]=c,e[9]=o):o=e[9],o},ne=({workspaceId:s})=>{const e=h(),t=v(),a=P(),{mutateAsync:i}=K({mutationFn:async r=>(r.permissions.includes(C.SearchAccess)||(r.permissions=r.permissions.filter(n=>n!==C.AgentModeAccess&&n!==C.DeepResearchAccess)),r.permissions.includes(C.GPT5ThinkingAccess)||r.permissions.includes(C.GPT5ThinkingMiniAccess)||r.permissions.push(C.GPT5ThinkingMiniAccess),await m.safePatch("/rbac/workspace/{workspace_id}/roles/{role_id}",{parameters:{query:{account_id:s},path:{workspace_id:s,role_id:r.id}},requestBody:{role_name:r.name,description:r.description,permissions:r.permissions}})),onMutate:({id:r,name:n,permissions:c})=>{const o=e.getQueryData([s,"role",r]);return e.setQueryData([s,"role",r],u=>g(q({},u),{name:n,permissions:c})),{previousRoles:o}},onError:(r,n,c)=>{e.setQueryData([s,"role",n.id],c==null?void 0:c.previousRoles),r.message==="Role with this name already exists."?t.warning(a.formatMessage({id:"EDzkz/",defaultMessage:"Role with this name already exists"}),{duration:1}):t.danger(a.formatMessage({id:"ezIZZO",defaultMessage:"Failed to update permission"}),{duration:1})},onSuccess:()=>{e.invalidateQueries({refetchType:"all",queryKey:[s,"roles"]}),t.success(a.formatMessage({id:"L59KWu",defaultMessage:"Successfully updated permission"}),{duration:1})}});return{updateRole:i}},ie=s=>{"use forget";const e=F.c(17),{workspaceId:t,roleId:a}=s,i=h();let r;e[0]!==a||e[1]!==t?(r=G(t,a),e[0]=a,e[1]=t,e[2]=r):r=e[2];const n=r;let c;e[3]!==a||e[4]!==t?(c=async p=>await m.safePut("/rbac/workspace/{workspace_id}/roles/{role_id}/metadata",{parameters:{query:{account_id:t},path:{workspace_id:t,role_id:a}},requestBody:p}),e[3]=a,e[4]=t,e[5]=c):c=e[5];let o,u;e[6]!==i||e[7]!==n?(o=p=>{i.setQueryData(n,_=>{var Q;return _?!_.metadata||!p.metadata?g(q({},_),{metadata:(Q=p.metadata)!=null?Q:null}):g(q({},_),{metadata:g(q({},_.metadata),{soft_alert_credit_limit:p.metadata.soft_alert_credit_limit,hard_cap_credit_limit:p.metadata.hard_cap_credit_limit})}):p})},u=()=>{i.invalidateQueries({queryKey:n})},e[6]=i,e[7]=n,e[8]=o,e[9]=u):(o=e[8],u=e[9]);let l;e[10]!==c||e[11]!==o||e[12]!==u?(l={mutationFn:c,onSuccess:o,onSettled:u},e[10]=c,e[11]=o,e[12]=u,e[13]=l):l=e[13];const y=K(l);let d;return e[14]!==y.isPending||e[15]!==y.mutateAsync?(d={upsertRoleMetadata:y.mutateAsync,isPending:y.isPending},e[14]=y.isPending,e[15]=y.mutateAsync,e[16]=d):d=e[16],d},oe=({workspaceId:s,roleId:e})=>{const t=h(),{mutateAsync:a}=K({mutationFn:async({id:i})=>await m.safePost("/rbac/workspace/{workspace_id}/role-assignments",{parameters:{query:{account_id:s},path:{workspace_id:s}},requestBody:{role_id:e,principal_id:i,principal_type:"group"}}),onSuccess:(i,r)=>{const n=[s,e,"role-groups"];t.setQueryData(n,c=>{var o,u;return[...c,{id:r.id,name:(o=r.name)!=null?o:"",num_members:(u=r.num_members)!=null?u:0,created_time:new Date().toDateString()}]}),t.invalidateQueries({refetchType:"all",queryKey:n})}});return{assignGroup:a}},ce=({workspaceId:s,roleId:e})=>{const t=h(),{mutateAsync:a}=K({mutationFn:async i=>await m.safeDelete("/rbac/workspace/{workspace_id}/role-assignments",{parameters:{query:{account_id:s,role_id:e,principal_id:i,principal_type:"group"},path:{workspace_id:s}}}),onSuccess:(i,r)=>{const n=[s,e,"role-groups"];t.setQueryData(n,c=>c?c.filter(o=>o.id!==r):[]),t.invalidateQueries({refetchType:"all",queryKey:n})}});return{unassignGroup:a}},ue=({workspaceId:s,roleId:e,showToast:t=!0})=>{const a=h(),i=v(),r=P(),{mutateAsync:n,isPending:c,variables:o}=K({mutationFn:async u=>await m.safePatch("/rbac/workspace/{workspace_id}/roles/{role_id}/connectors/{connector_id}",{parameters:{query:{account_id:s},path:{workspace_id:s,role_id:e,connector_id:u.connectorId}},requestBody:{permissions:u.permissions}}),onMutate:({connectorId:u,permissions:l})=>{a.cancelQueries({queryKey:f(s,e)}),a.cancelQueries({queryKey:R(s,u)}),a.cancelQueries({queryKey:M(s,u,e)});const y=a.getQueryData(f(s,e));return a.setQueryData(f(s,e),d=>g(q({},d),{connectors_with_permissions:d==null?void 0:d.connectors_with_permissions.map(p=>p.connector.id===u?g(q({},p),{permissions:l}):p)})),{previousConnectors:y}},onError:(u,l,y)=>{a.setQueryData(f(s,e),y==null?void 0:y.previousConnectors),t&&i.danger(r.formatMessage({id:"ezIZZO",defaultMessage:"Failed to update permission"}),{duration:1})},onSuccess:(u,l)=>{a.invalidateQueries({refetchType:"all",queryKey:f(s,e)}),a.invalidateQueries({refetchType:"all",queryKey:R(s,l.connectorId)}),a.invalidateQueries({refetchType:"all",queryKey:M(s,l.connectorId,e)}),t&&i.success(r.formatMessage({id:"L59KWu",defaultMessage:"Successfully updated permission"}),{duration:1})}});return{updateRoleConnectorPermission:n,isPending:c,variables:o}},le=({workspaceId:s,connectorId:e,showToast:t=!0})=>{const a=h(),i=v(),r=P(),{mutateAsync:n,isPending:c,variables:o}=K({mutationFn:async u=>await m.safePatch("/rbac/workspace/{workspace_id}/roles/{role_id}/connectors/{connector_id}",{parameters:{query:{account_id:s},path:{workspace_id:s,role_id:u.roleId,connector_id:e}},requestBody:{permissions:u.permissions}}),onMutate:({roleId:u,permissions:l})=>{a.cancelQueries({queryKey:R(s,e)}),a.cancelQueries({queryKey:f(s,u)}),a.cancelQueries({queryKey:M(s,e,u)});const y=a.getQueryData(R(s,e));return a.setQueryData(R(s,e),d=>{var p;return g(q({},d),{roles_with_permissions:(p=d==null?void 0:d.roles_with_permissions)==null?void 0:p.map(_=>_.role.id===u?g(q({},_),{connector_permissions:l}):_)})}),{previousRoles:y}},onError:(u,l,y)=>{a.setQueryData(R(s,e),y==null?void 0:y.previousRoles),t&&i.danger(r.formatMessage({id:"ezIZZO",defaultMessage:"Failed to update permission"}),{duration:1})},onSuccess:(u,l)=>{a.invalidateQueries({refetchType:"all",queryKey:R(s,e)}),a.invalidateQueries({refetchType:"all",queryKey:f(s,l.roleId)}),a.invalidateQueries({refetchType:"all",queryKey:M(s,e,l.roleId)}),t&&i.success(r.formatMessage({id:"L59KWu",defaultMessage:"Successfully updated permission"}),{duration:1})}});return{updateConnectorRolePermission:n,isPending:c,variables:o}},ye=({workspaceId:s,showToast:e=!0})=>{const t=v(),a=P(),i=h(),r=U(),{mutateAsync:n,isPending:c,variables:o}=K({mutationFn:async u=>await m.safePatch("/rbac/workspace/{workspace_id}/roles/{role_id}/connectors",{parameters:{query:{account_id:s},path:{workspace_id:s,role_id:u.id}},requestBody:{state:u.state}}),onError:()=>{e&&t.danger(a.formatMessage({id:"ezIZZO",defaultMessage:"Failed to update permission"}),{duration:1})},onSuccess:(u,l)=>{i.invalidateQueries({refetchType:"all",queryKey:f(s,l.id)}),i.invalidateQueries({refetchType:"all",queryKey:["permissions",s]}),r(),e&&t.success(a.formatMessage({id:"L59KWu",defaultMessage:"Successfully updated permission"}),{duration:1})}});return{toggleAllConnectorsPermissionForRole:n,isPending:c,variables:o}};export{oe as a,ce as b,ye as c,Y as d,te as e,J as f,ae as g,ne as h,V as i,re as j,ue as k,x as l,I as m,ie as n,ee as o,le as p,se as q,X as u};
//# sourceMappingURL=c4y192oww5tqpynf.js.map
