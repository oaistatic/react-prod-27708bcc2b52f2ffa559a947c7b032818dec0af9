var Nt=Object.defineProperty;var at=Object.getOwnPropertySymbols;var yt=Object.prototype.hasOwnProperty,_t=Object.prototype.propertyIsEnumerable;var rt=(e,s,i)=>s in e?Nt(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i,F=(e,s)=>{for(var i in s||(s={}))yt.call(s,i)&&rt(e,i,s[i]);if(at)for(var i of at(s))_t.call(s,i)&&rt(e,i,s[i]);return e};import{j as t,e as ut,M as nt,r as h}from"./fg33krlcm0qyi6yw.js";import{o as _,b as L,ba as Tt,eo as Pt,l as g,a9 as Ct,d as Et,dJ as vt,dI as It,gd as At,dQ as $t,m as zt,kL as Dt,gs as Ft,gw as Lt,h_ as st,p7 as Ot,P as H,dL as ot,R as Bt,dF as Wt,dH as Gt,fN as Ht,gn as Rt,gl as Kt,dR as lt}from"./mtk1qztvnb31pw5r.js";import{kY as xt,kZ as ft,pC as ht,pD as Qt,fx as qt,j3 as Jt,pE as Yt,la as Zt,pF as Vt,oB as dt,le as Xt,pG as Ut,ht as Mt,lb as te}from"./k65njl5wlgspihfr.js";import{CoT as ee}from"./bj1xayv0ee02amky.js";import{M as ct}from"./krwszi9u3lj63i9v.js";import"./jskmg2zu1nebndza.js";import"./d30pfo25z1qctykl.js";import"./l9v3ntkj34comb67.js";import"./h0pbwkfesoibvhzi.js";import"./ikh0apjsuisoywnq.js";import"./ctgqahsfx1txd4g6.js";import"./hy5xt98rivxg8tb4.js";import"./i1g2kxfbotvbgq93.js";import"./qcr0k45a8ay8c0b9.js";import"./eu6wvuly09f1n3pt.js";import"./ju642fjyg5h2qo49.js";import"./fjbpw3a0vshjd395.js";import"./pbl95wx6493wq92j.js";import"./ir7nzwbolrsm3ds2.js";import"./je866d95n4n31rpb.js";import"./li70yj6yb4gouarj.js";import"./dcp7peq4y6a4kabz.js";function mt({message:e,isCircular:s=!1}){var m,f,k;const i=5.333333333333334;let r=(f=(m=e==null?void 0:e.metadata)==null?void 0:m.pro_progress)!=null?f:0;const u=((k=e==null?void 0:e.metadata)==null?void 0:k.model_slug)==="o1-pro"?480*1e3:1200*1e3,l=e!=null&&e.create_time?e.create_time*1e3:Date.now(),p=xt(l,u);r=Math.max(p,r);const n=L(),c=_(n,"3208967109");return c&&(r=Math.max(r,i)),s?t.jsx(ft,{percentage:r,className:"me-4 w-full!",sizeOverride:20,thickness:1/8,transitionDuration:"".concat((100-r)/100*5,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"}):t.jsx(ht,{percentage:r,className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary dark:bg-token-border-default rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:"".concat((100-r)/100*5,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:c?4:8})}function pt({message:e,simulatedDuration:s=480*1e3,maxFill:i=100,isCircular:r=!1}){var c;((c=e==null?void 0:e.metadata)==null?void 0:c.model_slug)!=="o1-pro"&&(s=1200*1e3);const u=e!=null&&e.create_time?new Date(e.create_time*1e3):Date.now(),l=xt(+u,s),p=L(),n=_(p,"3208967109");return r?t.jsx(ft,{percentage:l,className:"me-4 w-full!",transitionDuration:"".concat((100-l)/100*5,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",sizeOverride:20}):t.jsx(ht,{percentage:Math.min(l,i),className:"me-4 w-full!",backgroundClassName:"bg-token-sidebar-surface-secondary rounded-full",barClassName:"bg-token-text-secondary rounded-full",transitionDuration:"".concat((100-l)/100*.2,"s"),transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)",height:n?4:8})}function ie({title:e,content:s,buttons:i,time:r,icon:u,size:l="default",progressBar:p,disabled:n=!1,onClick:c}){const m=l==="small"?"w-full flex max-w-[calc(0.8*var(--thread-content-max-width,40rem))] ps-[20px] pt-[13px] pb-[10px] ".concat(n?"":"gap-4"):"w-full gap-4 px-[22px] pb-[22px] pt-[18px]",f=c?"cursor-pointer":"",k=l==="small"?"text-[15px]":"",b=Tt(Pt);return t.jsxs("div",{className:g("relative inline-flex flex-col items-start justify-start rounded-2xl border","bg-token-bg-primary border-token-border-default box-content rounded-2xl border bg-clip-padding px-5 py-4",!b&&"mx-[calc(--spacing(-2)-1px)] -my-[1px] @max-3xl:-top-2 @3xl:-start-3 @3xl:-top-4",m,f,k),onClick:c,children:[t.jsxs("div",{className:g("flex flex-col items-start justify-start self-stretch",l!=="small"&&"gap-1.5"),children:[t.jsxs("div",{className:g("inline-flex items-start justify-start self-stretch",l!=="small"&&"gap-2"),children:[t.jsx("div",{className:g("shrink grow basis-0 leading-normal font-medium","text-token-text-secondary hover:text-token-text-primary"),children:e}),t.jsx("div",{className:"relative h-6 w-6"}),!n&&(u||t.jsx(Qt,{className:"relative h-6 w-6"}))]}),t.jsx("div",{className:g("flex w-full flex-col items-start justify-start",l==="small"&&"mt-[-2px]"),children:t.jsx("div",{className:g("inline-flex w-full items-start justify-start self-stretch rounded-sm",l==="small"?"gap-1":"gap-2.5 py-1"),children:t.jsx("div",{className:g("w-full leading-relaxed font-normal",n?"text-token-text-tertiary":"text-token-text-secondary"),children:s})})})]}),p?t.jsxs("div",{className:g("mb-2 inline-flex items-center justify-between self-stretch",(i==null?void 0:i.length)&&"mt-[-10px]"),children:[p,i]}):t.jsxs("div",{className:"inline-flex items-center justify-end self-stretch",children:[r&&t.jsx("div",{className:"text-token-text-tertiary shrink grow basis-0 text-[15px] leading-normal font-normal",children:r}),t.jsx("div",{className:"flex gap-2",children:i})]})]})}function ae({errorNotice:e,onOpenSidebarSummarizer:s,isReceivingUpdates:i,lastMessage:r,latestTitle:u,summarizationHeadline:l,handleSkipClick:p}){var T,P,j,I,A,a,C;const n=L(),c=ut(),m=_(n,"4094234945"),f=_(n,"3208967109"),k=_(n,"3327816228"),b=m?mt:pt,S=i&&k&&((T=r==null?void 0:r.metadata)==null?void 0:T.pro_progress),O=(((P=r==null?void 0:r.metadata)==null?void 0:P.pro_skipped)||((j=r==null?void 0:r.clientMetadata)==null?void 0:j.proSkipPending))&&i;if(f){if(O)return t.jsx("span",{className:"result-streaming pulse relative pt-1",children:t.jsx("span",{})});const w=(A=i?u:(I=r==null?void 0:r.metadata)==null?void 0:I.finished_text)!=null?A:c.formatMessage({id:"hgnsat",defaultMessage:"Thinking"});return t.jsxs("div",{className:"flex items-start gap-3 pb-2",children:[t.jsxs("div",{className:"flex w-full flex-col",children:[t.jsxs("div",{className:"flex w-full items-center justify-between",children:[t.jsx("button",{type:"button",onClick:s,className:"group inline-flex max-w-full items-center rounded-md focus:outline-none",children:t.jsxs("span",{className:i?"loading-shimmer text-token-text-secondary inline-flex max-w-full items-center gap-0.5 truncate text-base leading-5 font-medium md:text-base":"text-token-text-tertiary hover:text-token-text-primary inline-flex max-w-full items-center gap-0.5 truncate text-base leading-5 font-medium md:text-base",children:[w,t.jsx(qt,{className:"icon-xs text-token-text-tertiary group-hover:text-token-text-primary"})]})}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:p,className:"text-token-text-tertiary hover:text-token-text-primary whitespace-nowrap transition-opacity duration-1000 ease-out ".concat(S?"pointer-events-auto opacity-100":"pointer-events-none opacity-0"),"aria-hidden":!S,tabIndex:S?0:-1,children:t.jsx("span",{className:"flex items-center gap-0.5 underline decoration-dotted decoration-[8%]",children:t.jsx(nt,{id:"xMM6dg",defaultMessage:"Answer now"})})}),i&&t.jsx("div",{className:"ms-1 shrink-0 self-start md:hidden",children:t.jsx(b,{message:r,isCircular:!0})})]})]}),i&&t.jsx("div",{className:"mt-[22px] mb-2 hidden self-stretch md:inline-flex",children:t.jsx("div",{className:"w-full max-w-[150px]",children:t.jsx(b,{message:r,isCircular:!1})})})]}),e]})}return t.jsxs("div",{className:"flex pb-2",children:[t.jsx(ie,{buttons:i?[t.jsx(Ct,{onClick:w=>{w.stopPropagation(),s()},color:"secondary",className:"text-token-text-secondary h-[38px]! text-[15px] font-normal",children:t.jsx("div",{className:"px-1",children:t.jsx(nt,{id:"wQcuK8",defaultMessage:"Details"})})},"Details")]:[],time:null,title:l,icon:i?t.jsx("div",{className:""}):null,content:i?"".concat(u,"..."):(C=(a=r==null?void 0:r.metadata)==null?void 0:a.finished_text)!=null?C:"",size:"small",disabled:!i,onClick:s,progressBar:i?m?t.jsx(mt,{message:r}):t.jsx(pt,{message:r}):null}),e]})}const re=/\*\*(.*?)(?:\*\*|\n|$)/g,ne=e=>{let s=null,i;for(;(i=re.exec(e))!=null;)s=i[1].trim();return s};function Ee({messages:e,isStreaming:s,isCompletionRequestInProgress:i,hasActiveRequest:r,isLastMessage:u,isFinalTurn:l,isFeedbackEnabled:p,conversation:n,currentGroupedMessageIndex:c,turnIndex:m}){var q,J,Y,Z,V,X,U,M,tt,et,it;const f=L(),[k,b]=h.useState(""),[S,O]=h.useState(!1),[T,P]=h.useState(!1),j=Et(n.serverId$),I=((q=Jt(n.id))==null?void 0:q.value)===vt.STREAMING,A=Yt(It(n.id)),a=At(e),C=a==null?void 0:a.id,w=(J=a==null?void 0:a.metadata)==null?void 0:J.initial_text,$=(Y=a==null?void 0:a.metadata)==null?void 0:Y.summarization_headline,z=e.map(d=>$t(d)).join("\n\n"),B=ut(),W=zt(),x=(Z=a==null?void 0:a.metadata)==null?void 0:Z.async_task_id;Zt(x,a,n.id),Dt(x);const o=Ft(d=>Lt.getTask(x!=null?x:"",d)),D=Vt(f),R=h.useCallback(()=>{x&&D?dt(n,{type:"cot",turnIndex:m,reasoningGroupIndex:c}):dt(n,{type:"summarizer",currentGroupedMessageIndex:c,turnIndex:m})},[n,c,m,x,D]),kt=(V=o==null?void 0:o.taskId)==null?void 0:V.startsWith("thinking"),K=D&&o&&st(o)&&!kt;h.useEffect(()=>{if(!K){P(!1);return}T||(Ot()&&Xt(n,{type:"cot",turnIndex:m,reasoningGroupIndex:c}),P(!0))},[n,K,R,T,c,m]);const bt=h.useCallback(()=>{if(!j||!(a!=null&&a.id))return;H.logEventWithStatsig("chatgpt_web_pro_skip_clicked","chatgpt_web_pro_skip_clicked",{conversationId:j,messageId:a.id});const d=a.id,y=a.clientMetadata?F({},a.clientMetadata):void 0,E=a.metadata?F({},a.metadata):void 0;ot(n.id,G=>{lt.updateTree(G,v=>{v.updateNodeMetadata(d,{proSkipPending:!0}),v.updateNodeMessageMetadata(d,{pro_skipped:!0})})}),Bt.safePost("/pro_mode/{conversation_id}/skip",{parameters:{path:{conversation_id:j}}}).catch(()=>{W.danger(B.formatMessage({id:"summmarizer.skip.toast",defaultMessage:"Failed to answer now. Please try again."}),{hasCloseButton:!0,toastId:"summarizer_skip_failed"}),ot(n.id,G=>{lt.updateTree(G,v=>{v.updateNodeMetadata(d,{proSkipPending:y==null?void 0:y.proSkipPending}),v.updateNodeMessageMetadata(d,{pro_skipped:E==null?void 0:E.pro_skipped})})})})},[n.id,j,B,a,W]),Q=_(f,"3208967109"),gt=Ut({taskId:o==null?void 0:o.taskId,intl:B,toaster:W});h.useEffect(()=>{const d=ne(z);if(d){b(d);return}if(Q&&$!=null){b($);return}w!=null&&b(w)},[z,$,Q,w]),h.useEffect(()=>{z.length>0&&O(!0)},[z]),h.useEffect(()=>{S&&H.logEvent("Tool: Received a8km123 message",{client_thread_id:n.id,message_id:C,conversationId:n.serverId$()})},[S]);const jt=l&&u&&(I||s),wt=Wt.isLastActorMessage(Gt(n.id),e[0].id),St=!!Ht(n.id,d=>d==null?void 0:d.sharedConversationMetadata),N=Mt(e[0],wt,i||r,St);if(x&&D){const d=o?st(o):!1,y=(x.startsWith("thinking")||x.startsWith("pro"))&&d&&(o==null?void 0:o.status)!==Rt.SKIPPING,E=()=>{H.logEventWithStatsig("chatgpt_web_pro_skip_clicked","chatgpt_web_pro_skip_clicked",{conversationId:n.id,messageId:C}),gt.mutate()};return t.jsx(ee,{isStreaming:d,isFinalAssistantTurn:l,isAgentTurn:!1,taskType:o?Kt(o):void 0,activeTask:o,messageGroups:te((X=o==null?void 0:o.rows)!=null?X:[]).groups,conversation:n,turnIndex:m,currentGroupedMessageIndex:c,latestError:N?F({messageId:e[0].id,conversation:n},N):void 0,isAutoswitchOptOutEnabled:y,handleSkipClick:y?E:void 0})}return!A&&((M=(U=a==null?void 0:a.metadata)==null?void 0:U.finish_details)==null?void 0:M.type)==="interrupted"&&((et=(tt=a==null?void 0:a.metadata)==null?void 0:tt.finish_details)==null?void 0:et.reason)!=="server_timeout"||(it=a==null?void 0:a.clientMetadata)!=null&&it.err?t.jsx("div",{children:N&&t.jsx(ct,{errorState:N,nodeId:e[0].id,isFeedbackEnabled:p,conversation:n,isUserTurn:!1})}):t.jsx(ae,{errorNotice:N&&t.jsx(ct,{errorState:N,nodeId:e[0].id,isFeedbackEnabled:p,conversation:n,isUserTurn:!1}),onOpenSidebarSummarizer:R,isReceivingUpdates:jt,lastMessage:a,latestTitle:k,summarizationHeadline:$,handleSkipClick:bt})}export{Ee as default};
//# sourceMappingURL=cao64vjbtd73v4mi.js.map
