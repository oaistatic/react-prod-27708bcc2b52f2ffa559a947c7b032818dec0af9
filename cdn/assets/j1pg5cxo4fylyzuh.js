var ie=Object.defineProperty,le=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var ht=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var bt=(t,o,s)=>o in t?ie(t,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[o]=s,xt=(t,o)=>{for(var s in o||(o={}))de.call(o,s)&&bt(t,s,o[s]);if(ht)for(var s of ht(o))me.call(o,s)&&bt(t,s,o[s]);return t},Et=(t,o)=>le(t,ce(o));import{r as h,j as e,e as Dt,f as Ht,M as ue}from"./fg33krlcm0qyi6yw.js";import{c as fe,a as pe,s as ge,g as he,b as be,d as xe,P as nt,T as Tt}from"./kl35ww3o5audytcy.js";import{fZ as Ee,bb as Te,l as V,uZ as At,xi as Ae,b as K,da as ve,xj as vt,td as Ne,tf as Nt,bg as H,kq as Ie,aU as Vt,wP as Wt,oa as Oe,bv as J,_ as Me,de as Ce,d as It,mR as _e,oO as Ot}from"./mtk1qztvnb31pw5r.js";import{g as Pe,u as Xt,D as Re}from"./gfro8vshyz92jyup.js";import{a as we,T as Se,A as Mt,u as ye,i as Le,C as je,g as Ct}from"./cgotviy5lzzhvf4u.js";import{a as ke}from"./exqqo21frem4no6f.js";import{C as at}from"./b2l059fz4znz94nm.js";import{h as lt,i as Be,j as Gt,f as Z}from"./kkpvfco69f4rm4dl.js";import{T as _t,Z as De,C as He}from"./ce3hgmw4iyyhicud.js";import{M as Ve,S as We,b as Xe,c as Ge,d as Pt,e as Fe}from"./nk8claqige01rjll.js";import{cG as Ft,hf as zt,qw as C,rW as ze,b as Ue,qx as j,as as Ye,fy as $e,dH as Ze,hl as Ut,nj as qe}from"./k65njl5wlgspihfr.js";import{u as Yt}from"./l09h2qppleubii6l.js";import{a as Rt}from"./ck40inivrzkot78b.js";import{t as Je,B as Ke,I as Qe}from"./j509ay9g77d9nkrt.js";import{H as to,P as eo}from"./n1g1ac9g2671vjzk.js";import{D as oo,a as so}from"./hx3pmvu9yrya5xfj.js";import{T as no,a as D}from"./acd1cl9alifs5fnh.js";import{B as ao,I as ro}from"./c7uslvzbaqks7omp.js";import{T as io}from"./m2li92t79w0k884q.js";import"./ju642fjyg5h2qo49.js";import"./fjbpw3a0vshjd395.js";import"./5mkn81r14jsz61px.js";import"./f76gy0b8ieo4s693.js";import"./e4usrdpxs4x6g5aq.js";import"./g3lybt7hj0s143gw.js";import"./jed1ux7qibe55pmj.js";import"./h1em0bjkpkjv8ykw.js";import"./lep2wptoy14cfe2w.js";import"./njh1hro7jxhbut4d.js";import"./cu0ig3jox4ha1bc5.js";import"./i1g2kxfbotvbgq93.js";import"./bkm8et9bp0kf1c7y.js";import"./m5btqmw2ud0umdwr.js";import"./dxf0nhie0kb80o3m.js";import"./eoxo2x2yyluwv164.js";import"./mstl8wgfzorpgdoe.js";import"./f2sn8zvpzei2915e.js";import"./kfdkis1zwf4ccfgg.js";import"./ol9d5wxhynx9q2is.js";import"./mbmcx8v24u1ao1ke.js";import"./ieglwgr2zyuektzv.js";import"./deakbbf27g8e7ba0.js";import"./j1qri9ykgswuwttk.js";import"./kl7c6054usfnqmd4.js";import"./k97n0y6ba9c9h39c.js";import"./d3oudxt8f92bezmy.js";import"./coc2775l3yj92qmf.js";import"./nfccle6oyncifphl.js";import"./hu1bt0oauegdhua6.js";import"./ojve869uwykk95at.js";import"./gy1lpvuoewmzh42c.js";import"./ly75bs3d14n5v622.js";import"./f5ep9o7usovyn4vf.js";import"./f1xfp952knkxhcnw.js";function lo(t,o){h.useEffect(()=>{const s=t==null?void 0:t.current;if(s!=null)return Ee(s,{mousedown:d=>{var m;((m=o.current)==null?void 0:m.maybeFocusOnEditor(d))===!0&&d.preventDefault()}})},[o,t])}const co=({wrapperClassName:t,value:o="",width:s,comments:d,paddingBottom:m})=>{const E=h.useRef(null),b=h.useRef(null),c=Te();return h.useEffect(()=>{const{current:n}=E;if(n)return b.current=fe({mount:n,comments:d,value:o,isDarkMode:c}),()=>{var r;(r=b.current)==null||r.destroy()}},[]),h.useEffect(()=>{var r;const n=pe(o,d);(r=b.current)==null||r.updateState(n)},[o,d]),e.jsx("div",{className:t,children:e.jsx("div",{ref:Ft(E),className:V(ge.main,"markdown prose dark:prose-invert focus:outline-hidden"),style:{width:s,paddingBottom:m}})})},$t=t=>!t||"docView"in t&&t.docView==null||we(t.state.doc),q=100,mo={type:"spring",duration:1.5,bounce:.1},uo={type:"spring",duration:.5,bounce:0},wt={type:"spring",duration:.2},St={type:"spring",duration:1,delay:.1},fo={type:"spring",duration:1},po={type:"spring",duration:.5,bounce:0},go=({isRewriting:t=!1,value:o,previousValue:s,previousComments:d,documentWidth:m,paddingBottom:E,onStart:b})=>{const c=K(),n=lt(),r=At(0),x=At(-q),v=h.useRef(!1),[g,f]=Ae(),[{height:I},R]=Yt(),i=zt(c);ve(()=>{const a=n();return a&&(a.dom.style.clipPath="inset(0 0 100% 0)"),()=>{const l=n();l&&(l.dom.style.clipPath="")}},[]),h.useEffect(()=>{var l;const a=n();if(!a||$t(a))return g||f==null?void 0:f();try{const T=(l=Be(a.state.doc))==null?void 0:l.end;if(T==null||T>o.length)return;const{top:N}=a.coordsAtPos(0),{top:_,bottom:M}=a.coordsAtPos(Math.max(a.state.doc.content.size-1,0),-1),A=M-N,O=_-N;if(r.set(A-O),!g){vt(x,A+2*r.get(),uo).then(()=>f==null?void 0:f());return}vt(x,A,mo)}catch(T){C.logError("Failed to set rewrite animation position",T),f==null||f()}},[g,o]);const p=Ne(x,a=>Ie(a)-q+2);return Nt(x,"change",a=>{const l=n();!l||!a||!v.current||(l.dom.style.clipPath="inset(0 0 calc(100% - ".concat(a,"px) 0)"))}),Nt(x,"animationStart",()=>{t&&(b==null||b())}),e.jsxs(e.Fragment,{children:[i&&e.jsx(H.div,{style:{visibility:"hidden",pointerEvents:"none",height:I},initial:!1,exit:{height:0},transition:{delay:.1,duration:.8,ease:"easeOut"}}),e.jsx(H.div,{className:"absolute top-0 z-10 w-full origin-bottom bg-linear-to-t from-[var(--canvas-bg,var(--bg-primary))] from-10% to-transparent",style:{translateY:p,height:q},initial:{opacity:0},animate:{opacity:1,transition:wt},exit:{opacity:0,transition:St},onAnimationComplete:()=>v.current=!0},"wash-top"),e.jsx(H.div,{className:"absolute top-0 z-10 w-full bg-linear-to-b from-[var(--canvas-bg,var(--bg-primary))] to-transparent",style:{translateY:x,height:q},initial:{opacity:0},animate:{opacity:1,transition:wt},exit:{opacity:0,transition:St}},"wash-bottom"),e.jsx(H.div,{ref:R,className:"pointer-events-none absolute z-0 max-w-full min-w-0",initial:{opacity:1},animate:{opacity:.3,transition:fo},exit:{opacity:0,transition:po},children:e.jsx(co,{value:s,width:m,comments:d,wrapperClassName:"h-fit flex",paddingBottom:E})},"previousValue")]})};function yt(t,o){if(t==null)return!1;const s=t.state.schema.marks[o];return s==null?!1:Je(t.state,t.dispatch,s)}function rt(t,o){if(t==null)return!1;const{state:s,dispatch:d}=t,m=Vt(s.schema.nodes[to.proseMirrorNodeName()]);return Wt(m,{level:o})(s,d)}function ho(t){if(t==null)return!1;const{state:o,dispatch:s}=t,d=Vt(o.schema.nodes[eo.proseMirrorNodeName()]);return Wt(d)(o,s)}const bo=({availableWidth:t,onAddComment:o,isSendDisabled:s=!1,isWaitingForCommentResponse:d=!1,onSubmitAccelerator:m,showAskChatGPT:E})=>{const b=K(),c=Dt(),n=lt(),r=Gt(),x=ze(b),v=h.useCallback(i=>{const{width:p,height:a}=i,l=n();if(!r||!l||$t(l))return null;const{to:T,empty:N,head:_}=r.selection,{platform:M}=Ue(),A=M==="web"?_:T,O=A===T;if(N||!Rt(l.state.doc,A))return null;const{right:Q,left:W,top:G}=l.coordsAtPos(0);let w=A,S=l.state.doc.nodeAt(w);const F=O?-1:1;for(;!(S!=null&&S.isText)&&Rt(l.state.doc,w+F);)w+=F,S=l.state.doc.nodeAt(w);const{left:z,bottom:k,top:U}=l.coordsAtPos(w,O?-1:1),tt=Q-W;function B(){if(O)return Math.max(z-W-p,0);let L=z-W;return L+p>tt&&(L=-(p-tt)),L}function y(){const L=window.innerHeight-k>a*2;return O&&L?{top:k-G+8,aboveOrBelow:Mt.BELOW}:{top:U-G-a-8,aboveOrBelow:Mt.ABOVE}}const X=y();return{left:B(),top:X.top,aboveOrBelow:X.aboveOrBelow,toolbarSize:i}},[r,n]),g=h.useCallback(()=>{var i,p;return(p=(i=n())==null?void 0:i.dom)!=null?p:null},[n]),f=[{label:c.formatMessage(P.heading1),className:"text-5xl font-semibold",onClick:()=>{C.logButtonClick(j.TOOLBAR_FORMAT_HEADER1),rt(n(),1)}},{label:c.formatMessage(P.heading2),className:"text-3xl font-semibold",onClick:()=>{C.logButtonClick(j.TOOLBAR_FORMAT_HEADER2),rt(n(),2)}},{label:c.formatMessage(P.heading3),className:"text-2xl font-semibold",onClick:()=>{C.logButtonClick(j.TOOLBAR_FORMAT_HEADER3),rt(n(),3)}},{label:c.formatMessage(P.body),className:"text-base",onClick:()=>{C.logButtonClick(j.TOOLBAR_FORMAT_PARAGRAPH),ho(n())}}],I=()=>{const i=n();if(!i)return null;const{state:p}=i,{from:a,to:l,sourceFrom:T,sourceTo:N}=Pe(p);return a==null||l==null||T==null||N==null?(C.logError("Prosemirror getSelectionRange has null values",null,{from:a,to:l,sourceFrom:T,sourceTo:N}),null):{from:a,to:l,sourceFrom:T,sourceTo:N}},R=(i,p,a)=>{const l=n(),T=I();if(T==null)return;const{sourceFrom:N,sourceTo:_}=T,M={start:N,end:_};if(r&&l){const A=r.tr.setSelection(Oe.create(r.doc,r.selection.anchor));l.dispatch(A)}C.logButtonClick(j.TOOLBAR_FORMAT_STYLE,{action:{action:a.action,id:a.id,title:a.title},prompt:p,sourceFrom:N,sourceTo:_}),m==null||m(i,M,c.formatMessage(p),a)};return e.jsxs(Se,{showAskChatGPT:E,isWaitingForCommentResponse:d,isSendDisabled:s,onAddComment:o,toolbarType:no.WRITING,getToolbarPosition:v,getEditorDom:g,getSelectionRange:I,children:[x&&e.jsxs(e.Fragment,{children:[e.jsx(D.Separator,{}),e.jsx(D.Popover,{label:c.formatMessage(P.format),hideLabel:t<=400,icon:Ye,align:"center",children:e.jsx("div",{className:V("bg-token-main-surface-primary flex w-48 flex-col items-stretch rounded-xl border p-1",_t),children:oo.map(i=>{const{title:p,icon:a}=i;return e.jsxs("button",{onClick:l=>{"prompt"in i&&R(l,i.prompt,i)},className:"bg-token-main-surface-primary dark:hover:bg-token-main-surface-secondary flex flex-row items-center gap-x-2 rounded-md p-3 hover:bg-[#f5f5f5]",children:[e.jsx("div",{className:"flex",children:e.jsx(a,{className:"icon"})}),e.jsx("div",{className:"line-clamp-1 flex-auto text-start text-sm",children:c.formatMessage(p)})]},i.id)})})})]}),e.jsx(D.Separator,{}),e.jsx(D.Action,{label:c.formatMessage(P.bold),hideLabel:!0,icon:ao,onClick:()=>{C.logButtonClick(j.TOOLBAR_FORMAT_BOLD),yt(n(),Ke.proseMirrorMarkName())},onMouseDown:i=>i.preventDefault()}),e.jsx(D.Action,{label:c.formatMessage(P.italic),hideLabel:!0,icon:ro,onClick:()=>{C.logButtonClick(j.TOOLBAR_FORMAT_ITALIC),yt(n(),Qe.proseMirrorMarkName())},onMouseDown:i=>i.preventDefault()}),e.jsx(D.Popover,{label:c.formatMessage(P.format),hideLabel:!0,icon:io,children:e.jsx("div",{className:V("border-token-border-default bg-token-main-surface-primary flex flex-col items-stretch rounded-xl border p-1",_t),children:f.map(({label:i,className:p,onClick:a})=>e.jsx("button",{onClick:a,className:"hover:bg-token-main-surface-secondary w-full rounded-xl p-4 text-start",children:e.jsx("div",{className:p,children:i})},i))})})]})},P=Ht({bold:{id:"qqbk91",defaultMessage:"Bold"},italic:{id:"5oh4LV",defaultMessage:"Italic"},format:{id:"z8IGv0",defaultMessage:"Transform"},heading1:{id:"AR5o30",defaultMessage:"Heading 1"},heading2:{id:"zb/wrc",defaultMessage:"Heading 2"},heading3:{id:"xZJvLM",defaultMessage:"Heading 3"},body:{id:"Hi6z3L",defaultMessage:"Body"},caption:{id:"VXpL7v",defaultMessage:"Caption"},bullets:{id:"2vznKX",defaultMessage:"Bullets"},outline:{id:"Xmbt6r",defaultMessage:"Outline"},table:{id:"0UjL6P",defaultMessage:"Table"}});function Lt({position:t,numEdits:o,closestEditId:s}){const d=Xt(),m=Dt(),E=t==="top"?$e:Ze,b=()=>{const n=d();if(!n||!s)return;const r=he(n,s);if(r.length===0){Me.addError("Edit could not be found while attempting to scroll",{closestEditId:s});return}r[t==="top"?0:r.length-1].scrollIntoView({behavior:"smooth",block:"center"})},c=t==="top"?-4:4;return e.jsx(J,{children:o>0&&e.jsx(H.div,{className:V("absolute start-1/2 z-20 select-none",{"bottom-[20px]":t==="bottom","top-[20px]":t==="top"}),initial:{scale:.95,translateY:c,translateX:"-50%",opacity:0},animate:{scale:1,translateY:0,translateX:"-50%",opacity:1},exit:{scale:.95,translateY:c,translateX:"-50%",opacity:0},transition:{type:"spring",duration:.3},children:e.jsxs("div",{className:V("flex items-center justify-center rounded-full border px-4 py-2","border-token-main-surface-tertiary bg-token-main-surface-primary hover:bg-token-main-surface-secondary shadow-md"),"aria-label":m.formatMessage(jt.ariaLabel),role:"button",onClick:b,children:[e.jsx(ue,Et(xt({},jt.label),{values:{count:o}})),e.jsx(E,{className:"icon-sm ms-2"})]})})})}const jt=Ht({label:{id:"Pf30w4",defaultMessage:"{count, plural, one {1 more edit} other {{count} more edits}}"},ariaLabel:{id:"qTJjzl",defaultMessage:"Button to scroll the next edit into view."}});function xo({diff:t=null}){var n;const o=K(),s=Xt(),[d,m]=h.useState([]),[E,b]=h.useState([]),c=h.useCallback(()=>{const r=s();if(!r||!t)return;const x=[],v=[];for(const g of t.edits){const f=be(r,g.id);if(f.length>0){const I=xe(f);I.bottom<0?x.push([g.id,I]):I.top>Ut(o).height&&v.push([g.id,I])}}x.sort(([,g],[,f])=>g.bottom-f.bottom),v.sort(([,g],[,f])=>g.top-f.top),m(x.map(([g])=>g)),b(v.map(([g])=>g))},[o,t,s]);return ye((n=t==null?void 0:t.edits)!=null?n:[],c),h.useEffect(()=>{const r=setTimeout(c,500);return()=>{clearTimeout(r)}},[c]),e.jsxs(e.Fragment,{children:[e.jsx(Lt,{position:"top",numEdits:d.length,closestEditId:d[d.length-1]}),e.jsx(Lt,{position:"bottom",numEdits:E.length,closestEditId:E[0]})]})}const it=Ce(()=>({rejectedEdits:new Set,hoveredEditId:null})),{setState:Ms}=it,Eo=({pos:t})=>{var p;const o=lt()(),s=Gt();if(!o||!s||t==null)return null;const{doc:d}=s,{top:m,left:E}=o.coordsAtPos(0),{top:b,left:c}=o.coordsAtPos(t),n=d.nodeAt(t),r=t+((p=n==null?void 0:n.nodeSize)!=null?p:0)-1,{top:x}=o.coordsAtPos(t+1),{top:v,bottom:g,right:f}=o.coordsAtPos(r),R=(x>=v?f:o.dom.getBoundingClientRect().right)-c,i=g-b+4;return e.jsx(H.div,{style:{top:b-m,left:c-E,height:i,width:R},className:V("absolute after:absolute after:inset-x-[-4px] after:inset-y-0 after:z-0 after:rounded-md after:bg-[Highlight] after:content-[''] dark:after:bg-[Highlight]",De.blockCommentHover),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}})},To=({pos:t})=>e.jsx(J,{children:t!=null&&e.jsx(Eo,{pos:t})}),kt=24,Ao=16,vo=0,No=8,Bt=4,Cs=({comments:t,diff:o,readonlyReason:s,isDisabled:d=!1,isRewriting:m=!1,isSendDisabled:E=!1,previousComments:b,previousValue:c,isPreview:n=!1,isRequestActive:r=!1,isWaitingForCommentResponse:x=!1,targetedContent:v=null,onAcceleratorsExpandedChange:g,getAutocompleteSuggestion:f,getStableCommentId:I=qe,onBlur:R,onCancelRequest:i,onChange:p,onSave:a,onAddComment:l,onSubmitAccelerator:T,onAcceptComment:N,onDismissComment:_,onExitShowChanges:M,value:A,commentsMode:O=at.ENABLED,hideAccelerators:Q=!1,hideToolbar:W=!1,hideEditOverlay:G=!1,safeUrls:w,width:S,modelCursor:F,shouldResetSelection:z,metadata:k})=>{var ft,pt;const U=K(),B=zt(U)&&n,y=h.useRef(null),X=h.useRef(null);lo(X,y);const[{width:L},Zt]=Yt(),ct=h.useRef(null),[et,dt]=h.useState(!1),qt=ct.current,Jt=(ft=Le(qt))!=null?ft:!1,mt=It(()=>B?_e()?Ve:We:Ot()?Xe:Ge),Y=(()=>{if(S==null){const u=Jt?0:Ct();return L-u}return S-mt*2-Ct()})(),ot=B?Y:Y>=Pt+ke?Pt:Fe,Kt=Y-ot,Qt=Z(({commentingOn:u})=>u),te=Z(({hoveredCommentId:u})=>u),ee=Z(({focusedCommentId:u})=>u),oe=Z(({hoveredBlockCommentLauncherPos:u})=>u),se=it(u=>u.hoveredEditId),ne=it(u=>u.rejectedEdits);h.useEffect(()=>{var u;v==null&&((u=y.current)==null||u.revertChanges())},[v]),h.useEffect(()=>{var u,$;(u=y.current)==null||u.flushChanges(),($=y.current)==null||$.UNSAFE_setValue(A)},[A]);const ae=It(()=>{if(B)return Bt;if(!Ot())return n?vo:Ao;if(n)return kt;const u=No/100*Ut(U).height;return Math.max(kt,u)}),re=({currentTarget:u,nativeEvent:$})=>{const gt=$.composedPath();for(const st of gt.slice(0,gt.indexOf(u)))if(st instanceof HTMLElement&&(st.id===Tt.PROSEMIRROR_EDITOR_CONTAINER||st.id===Tt.PROSEMIRROR_CONTEXT_CHILDREN))return;M==null||M()},ut=B?Bt:n?"1rem":"max(3rem,24vh)";return e.jsx("div",{className:"h-full w-full",ref:X,onClick:re,children:e.jsx("div",{className:He.document,style:{margin:"0 ".concat(mt,"px"),paddingTop:ae},children:e.jsx("div",{ref:Ft(Zt,ct),className:"z-0 flex w-full flex-col items-center",children:e.jsxs(nt,{comments:t,diff:o,editorRef:y,hoveredCommentId:te,focusedCommentId:ee,hoveredEditId:se,rejectedEdits:ne,value:m&&!et?"":A,commentingOn:Qt,isDisabled:d||m||et,onBlur:R,onChange:p,onSave:a,width:ot,safeUrls:w,wrapperClassName:"relative z-10 flex max-w-full h-fit",paddingBottom:ut,modelCursor:F,shouldResetSelection:z,transparentBackground:!et,contentReferences:(pt=k==null?void 0:k.contentReferences)!=null?pt:[],getAutocompleteSuggestion:f,children:[e.jsxs(nt.EditorChildren,{children:[e.jsx(J,{onExitComplete:()=>dt(!1),children:m&&e.jsx(go,{isRewriting:m,documentWidth:ot,previousValue:c,previousComments:b,value:A,paddingBottom:ut,onStart:()=>dt(!0)})}),!W&&e.jsx(bo,{availableWidth:Y,isWaitingForCommentResponse:x,isSendDisabled:E,onAddComment:l,onSubmitAccelerator:T}),O===at.ENABLED&&e.jsx(To,{pos:oe}),e.jsx(J,{children:O!==at.ALL_HIDDEN&&e.jsx(je,{availableWidth:Kt,comments:t,commentsMode:O,isRequestActive:r,onAddComment:l,onAcceptComment:N,onDismissComment:_,isWaitingForCommentResponse:x,disableBlockComments:r,getStableCommentId:I})})]}),e.jsxs(nt.ContextChildren,{children:[!G&&o&&e.jsx(xo,{diff:o}),!Q&&e.jsx(Re,{isRequestActive:r,onSubmit:T,isVisuallyHidden:E||!!(s!=null&&s.isStreamingFromNative)||(s==null?void 0:s.isReadonly)&&!s.isStreaming,actions:so,onCancel:i,onExpandedChange:g})]})]})})})})};export{Cs as DocumentComposer};
//# sourceMappingURL=j1pg5cxo4fylyzuh.js.map
