import{r as S,j as a}from"./fg33krlcm0qyi6yw.js";import{C as U}from"./xix5le8wcon7ef24.js";import{D as Y}from"./gfro8vshyz92jyup.js";import{T as Z,A as R,u as $,i as y,C as z,g as tt}from"./cgotviy5lzzhvf4u.js";import{C as et,a as ot}from"./exqqo21frem4no6f.js";import{C as k}from"./b2l059fz4znz94nm.js";import{b as rt,d as nt,e as st,f as M}from"./kkpvfco69f4rm4dl.js";import{C as it}from"./ce3hgmw4iyyhicud.js";import{T as lt}from"./acd1cl9alifs5fnh.js";import{b as ct,hf as at,cG as q,nj as mt}from"./k65njl5wlgspihfr.js";import{aU as ut,b as dt}from"./mtk1qztvnb31pw5r.js";import{u as ft}from"./l09h2qppleubii6l.js";import{C as pt}from"./kz9vfmj7e59u487z.js";import"./fjbpw3a0vshjd395.js";import"./nkg72cggx811q5rc.js";import"./ju642fjyg5h2qo49.js";import"./ck40inivrzkot78b.js";import"./n1g1ac9g2671vjzk.js";import"./f76gy0b8ieo4s693.js";import"./m5btqmw2ud0umdwr.js";import"./dxf0nhie0kb80o3m.js";import"./eoxo2x2yyluwv164.js";import"./fdmssuqzpk9905my.js";import"./e509ngenyrgcehf5.js";function Ct(t,e){const s=t.doc.lineAt(e.from);return e.from===s.from&&e.to-1===s.to}function gt(t){const e=t.dom.querySelector(".cm-gutters");return e?e.offsetWidth:0}const ht=({onAddComment:t,isSendDisabled:e=!1,isWaitingForCommentResponse:s=!1})=>{const r=rt(),p=nt(),o=st(),x=S.useCallback(i=>{const{height:n,width:l}=i,m=r();if(!p||!m)return null;const u=p.selection.asSingle();if(u.ranges.length===0)return null;const c=u.ranges[0],{empty:I,to:L}=c;let{head:C}=c;const{platform:N}=ct();C=N==="web"?C:L;const g=C===L;let O=C;if(g&&Ct(p,c)&&(O-=1),I)return null;const{left:v,top:h,bottom:_}=m.contentDOM.getBoundingClientRect(),{left:w,top:G,bottom:E}=ut(m.coordsAtPos(O,g?-1:1)),b=gt(m);function A(){if(g)return Math.max(w-v+b-l,b);let d=w-v+b;return d+l>o&&(d=-(l-o)),d}function V(d){const W=n*2,j=d.contentHeight-(E-_)>W&&window.innerHeight-E>W,B=E-h+8,D=G-h-n-8;return g&&j||D<0?{top:B,aboveOrBelow:R.BELOW}:{top:D,aboveOrBelow:R.ABOVE}}const T=V(m);return{left:A(),top:T.top,aboveOrBelow:T.aboveOrBelow,toolbarSize:i}},[p,r,o]),H=S.useCallback(()=>{var i,n;return(n=(i=r())==null?void 0:i.dom)!=null?n:null},[r]);return a.jsx(Z,{onAddComment:t,isWaitingForCommentResponse:s,isSendDisabled:e,toolbarType:lt.CODE,getToolbarPosition:x,getEditorDom:H,getSelectionRange:()=>{const i=r();if(!i)return null;const{state:n}=i,l=n.selection.asSingle();if(l.ranges.length===0)return null;const m=l.ranges[0],{from:u,to:c}=m;return u==null||c==null?null:{from:u,to:c,sourceFrom:u,sourceTo:c}}})};function Et({diff:t}){var e;return $((e=t==null?void 0:t.edits)!=null?e:[]),null}function bt(t,e,s){const r=s?tt():0;return t<=1e3-r?t-(e?et:0):t-(e?ot:0)}const qt=({comments:t,currentlyStreamingLineIndex:e,isPreview:s=!1,isWaitingForCommentResponse:r=!1,isSendDisabled:p=!1,readonlyReason:o,isRequestActive:x=!1,language:H,placeholder:i,value:n,textdocDiff:l,maxLength:m,onAcceleratorsExpandedChange:u,onAddComment:c,onAcceptComment:I,onDismissComment:L,onBlur:C,onSave:N,onChange:g,onCancelRequest:O,getStableCommentId:v=mt,commentsMode:h=k.ENABLED,hideToolbar:_,hideAccelerators:w=!1,onSubmitAccelerator:G,modelCursor:E,codemirrorRef:b})=>{var P;const A=S.useRef(null),V=dt(),T=at(V),[{width:d},W]=ft(),j=S.useRef(null),B=t.length>0,D=j.current,F=bt(d,B,(P=y(D))!=null?P:!1),J=M(({commentingOn:f})=>f),K=M(({hoveredCommentId:f})=>f),Q=M(({focusedCommentId:f})=>f);S.useEffect(()=>{var f;(f=A.current)==null||f.UNSAFE_setValue(n||"")},[n]);const X=d-F;return a.jsx("div",{className:it.code,ref:q(W,j),style:T&&s?{margin:"0 16px"}:{},children:a.jsxs(U,{id:"codemirror",comments:h===k.ALL_HIDDEN?void 0:t,commentingOn:J,currentlyStreamingLineIndex:e,hoveredCommentId:K,focusedCommentId:Q,language:H,placeholder:i,readonlyReason:o,onChange:g,maxLength:m,value:n,textdocDiff:l,editorRef:q(A,b),width:F,modelCursor:E,isPreview:s,hideLineNumbers:T&&s,onBlur:C,onSave:N,children:[a.jsxs(U.EditorChildren,{children:[!_&&a.jsx(ht,{onAddComment:c,isSendDisabled:p,isWaitingForCommentResponse:r}),h!==k.ALL_HIDDEN&&a.jsx("div",{className:B?"me-4":"",children:a.jsx(z,{getStableCommentId:v,availableWidth:X,comments:t,commentsMode:h,onAddComment:c,onAcceptComment:I,onDismissComment:L,isWaitingForCommentResponse:r,isRequestActive:x,disableBlockComments:!0})})]}),a.jsxs(U.ContextChildren,{children:[l&&a.jsx(Et,{diff:l}),!w&&a.jsx(Y,{isRequestActive:x,isVisuallyHidden:p||!!(o!=null&&o.isStreamingFromNative)||(o==null?void 0:o.isReadonly)&&!o.isStreaming,onSubmit:G,onCancel:O,actions:pt,onExpandedChange:u})]})]})})};export{qt as CodeComposer};
//# sourceMappingURL=fzk48c64zangeags.js.map
