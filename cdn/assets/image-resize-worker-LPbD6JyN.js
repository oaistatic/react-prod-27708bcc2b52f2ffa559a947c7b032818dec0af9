function D(e,o,n){return Math.max(o,Math.min(n,e))}function j(e){return e==="image/png"?"png":e==="image/webp"?"webp":"jpg"}function b(e,o){const n=j(o);return/\.[a-z0-9]+$/i.test(e)?e:"".concat(e,".").concat(n)}function A(e,o,n){const l=Math.max(1,Math.floor(n)),t=Math.max(e,o);if(t<=l)return{w:e,h:o,scale:1};const i=l/t,a=Math.max(1,Math.round(e*i)),u=Math.max(1,Math.round(o*i));return{w:a,h:u,scale:i}}function C(e){const o=e instanceof Error?e.message:String(e);return"Failed to decode input image. This can happen if the browser/OS does not support the codec (e.g., HEIC/HEIF). Original error: ".concat(o)}const z=2048,L=1*1024*1024;self.onmessage=async e=>{const o=performance.now(),{id:n,type:l}=e.data;try{const{file:t,maxEdge:i,format:a,quality:u,filename:r}=e.data;let s;try{s=await createImageBitmap(t)}catch(g){const F=performance.now()-o,_={id:n,ok:!1,error:C(g),resultType:"resize",durationMs:F};self.postMessage(_);return}if(l==="analyze"){const g={id:n,ok:!0,resultType:"analyze",width:s.width,height:s.height};self.postMessage(g);return}const E=s.width>z||s.height>z||t.size>L,S=r!=null&&r.trim()?r.trim():"resized-".concat(Date.now()),x=b(S,t.type);if(!E){const g={id:n,ok:!0,resultType:"resize",buffer:await t.arrayBuffer(),type:t.type,width:s.width,height:s.height,inputBytes:t.size,outputBytes:t.size,bytesSavedKb:0,durationMs:performance.now()-o,name:x};self.postMessage(g)}const{w:f,h}=A(s.width,s.height,i),d=new OffscreenCanvas(f,h),c=d.getContext("2d");if(!c)throw new Error("2D context unavailable in worker.");c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",a==="image/jpeg"?(c.fillStyle="#ffffff",c.fillRect(0,0,f,h)):c.clearRect(0,0,f,h),c.drawImage(s,0,0,f,h),s.close();const y=a==="image/jpeg"||a==="image/webp"?D(u!=null?u:.9,0,1):void 0,m=await d.convertToBlob(y!=null?{type:a,quality:y}:{type:a}),p=await m.arrayBuffer(),w=t instanceof File?t.size:p.byteLength,M=p.byteLength,B=Math.max(0,w-M),k=Math.round(B/1e3),I=performance.now()-o,T=r!=null&&r.trim()?r.trim():"resized-".concat(Date.now()),v=b(T,m.type),$={id:n,ok:!0,resultType:"resize",buffer:p,type:m.type,width:f,height:h,inputBytes:w,outputBytes:M,bytesSavedKb:k,durationMs:I,name:v};self.postMessage($,[p])}catch(t){const i=performance.now()-o,a={id:n,ok:!1,error:t instanceof Error?t.message:String(t),durationMs:i,resultType:"resize"};self.postMessage(a)}};
//# sourceMappingURL=image-resize-worker-LPbD6JyN.js.map
