var Be=Object.defineProperty,Re=Object.defineProperties;var Te=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable;var ie=(a,t,s)=>t in a?Be(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s,y=(a,t)=>{for(var s in t||(t={}))ye.call(t,s)&&ie(a,s,t[s]);if(re)for(var s of re(t))Ae.call(t,s)&&ie(a,s,t[s]);return a},le=(a,t)=>Re(a,Te(t));import{e as Q,j as e,f as De,r as d,M as z,E as We}from"./fg33krlcm0qyi6yw.js";import{fu as Y,lg as R,i as Ue,hB as $e,cR as Fe,lh as x,fF as A,cH as Ve,aw as Ge,g2 as Xe}from"./k65njl5wlgspihfr.js";import{g2 as I,c0 as W,P as U,m as ze,I as me,b as fe,o as ce,dH as q,dF as K,dI as He,l as D,bv as Je,aY as Ye,bX as qe,R as Ke,_ as H}from"./mtk1qztvnb31pw5r.js";import{P as Qe,a as Ze}from"./jqmv39tyqoumt55b.js";import{X as Oe,L as es,R as ss}from"./hod0x7g0nytg7mip.js";import{d as de}from"./kl7c6054usfnqmd4.js";import{g as ts}from"./k97n0y6ba9c9h39c.js";import{u as as}from"./gi9hyxr9tw3nqr5l.js";const J=De({download:{id:"postSharingModal.download",defaultMessage:"Download"},downloadPdfButtonMenu:{id:"postSharingModal.download-pdf-button.menu",defaultMessage:"PDF Document (.pdf)"},downloadDocxButtonMenu:{id:"postSharingModal.download-docx-button.menu",defaultMessage:"Microsoft Word Document (.docx)"}}),ns=({downloading:a,onOdysseyFileDownload:t,disabled:s,icon:o,label:i,odysseyShareIntent:n})=>{const l=Q();return n.fileName.endsWith("md")?e.jsxs(I.Root,{open:!s&&!a?void 0:!1,children:[e.jsx(I.BasicTrigger,{asChild:!0,children:e.jsxs("button",{onClick:()=>{U.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:"download"})},disabled:s,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:a?e.jsx(W,{}):o})}),e.jsx("div",{className:"w-full text-center text-xs",children:i})]})}),e.jsx(I.Portal,{children:e.jsxs(I.Content,{align:"end",children:[e.jsx(I.Item,{onClick:c=>{c.preventDefault(),t==null||t(n.fileName,n.fileId,n.messageId,"pdf")},children:l.formatMessage(J.downloadPdfButtonMenu)}),e.jsx(I.Item,{onClick:c=>{c.preventDefault(),t==null||t(n.fileName,n.fileId,n.messageId,"docx")},children:l.formatMessage(J.downloadDocxButtonMenu)})]})})]},"download"):e.jsxs("button",{onClick:()=>{t==null||t(n.fileName,n.fileId,n.messageId,null),U.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:"download"})},disabled:s,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:e.jsx(Y,{})})}),e.jsx("div",{className:"w-full text-center text-xs",children:l.formatMessage(J.download)})]},"download")};function ue(a){const t=d.useCallback(o=>R.subscribe(o),[]),s=d.useCallback(()=>{if(a)return R.get(a)},[a]);return d.useSyncExternalStore(t,s,s)}function os(a){const{shareTargetId:t,shareType:s,generateShareLinkFn:o}=a,i=ue(t),n=d.useCallback(async()=>{if(!t||!o){const l=new Error("Share target not ready");return Promise.reject(l)}return(i==null?void 0:i.status)==="processing"||(i==null?void 0:i.status)==="succeeded"?i.promise:R.start(t,s,o)},[o,i,t,s]);return{request:i,ensureShareRequest:n}}function rs({shareTargetId:a,durationMs:t=3e3}={}){const s=ue(a),[o,i]=d.useState(!1),n=d.useDeferredValue(o),l=d.useRef(null),c=d.useCallback(p=>{d.startTransition(()=>{i(p)})},[]),m=d.useCallback(()=>{l.current!=null&&(clearTimeout(l.current),l.current=null)},[]);return d.useEffect(()=>{if(!a||!(s!=null&&s.copiedAt)){m(),c(!1);return}const p=Date.now()-s.copiedAt,w=Math.max(0,t-p);if(m(),w<=0){c(!1);return}return c(!0),l.current=window.setTimeout(()=>{i(!1),l.current=null},w),()=>{m(),c(!1)}},[s==null?void 0:s.copiedAt,a,t,m,c]),d.useEffect(()=>m(),[m]),n}function is({showLinkCopied:a,isGeneratingShareLink:t,onClick:s,postText:o,showDownloadButton:i,odysseyShareIntent:n,isDownloadingOdyssey:l,onOdysseyFileDownload:c,disabled:m,downloadVariant:p,isConversationDownloading:w}){const k=Q(),_=fe(),g=me(_),$=g==null?void 0:g.isWorkspaceAccount();let j=[{id:"copy",icon:t?e.jsx(W,{}):e.jsx(Ge,{}),label:a?k.formatMessage(x.linkCopied):k.formatMessage(x.copyLink),action:"copy"}];$?i&&j.push({id:"download",icon:p==="conversation"&&w?e.jsx(W,{}):e.jsx(Y,{}),label:k.formatMessage({id:"postSharingModal.download",defaultMessage:"Download"}),action:"download",downloadVariant:p}):j=j.concat({id:"x",href:u=>"https://twitter.com/intent/tweet?url=".concat(encodeURIComponent(u),"&text=").concat(o?encodeURIComponent(o):""),icon:e.jsx(Oe,{initialFillColor:"var(--text-primary)"}),label:k.formatMessage({id:"postSharingModal.x",defaultMessage:"X"}),action:"share"},{id:"linkedin",href:u=>"https://www.linkedin.com/shareArticle?url=".concat(encodeURIComponent(u),"&text=").concat(o?encodeURIComponent(o):""),icon:e.jsx(es,{initialFillColor:"var(--text-primary)"}),label:k.formatMessage({id:"postSharingModal.linkedin",defaultMessage:"LinkedIn"}),action:"share"},{id:"reddit",href:u=>"https://www.reddit.com/submit?url=".concat(encodeURIComponent(u),"&title=").concat(o?encodeURIComponent(o):""),icon:e.jsx(ss,{initialFillColor:"var(--text-primary)"}),label:k.formatMessage({id:"postSharingModal.reddit",defaultMessage:"Reddit"}),action:"share"},...i?[{id:"download",icon:p==="conversation"&&w?e.jsx(W,{}):e.jsx(Y,{}),label:"[oai] Download as PDF",action:"download",downloadVariant:p}]:[]);const E=!!l;return e.jsx(e.Fragment,{children:j.map(u=>u.id==="download"&&n?e.jsx(ns,{downloading:E,onOdysseyFileDownload:c,disabled:m!=null?m:!1,icon:u.icon,label:u.label,odysseyShareIntent:n},u.id):e.jsxs("button",{onClick:async()=>{try{await s(u)}finally{U.logEventWithStatsig("Share Post: Social Clicked","chatgpt_post_share_link_social_clicked",{platform:u.id})}},disabled:m||u.downloadVariant==="conversation"&&w,className:"relative flex flex-col gap-y-4 disabled:opacity-50 max-sm:gap-y-2",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full shadow-lg max-sm:h-12 max-sm:w-12 max-sm:shadow-md dark:shadow-md",children:e.jsx("div",{className:"pointer-events-none flex h-8 w-8 items-center justify-center max-sm:h-6 max-sm:w-6",children:u.icon})}),e.jsx("div",{className:"w-full max-w-16 text-center text-xs",children:u.label})]},u.id))})}function ls(a,t){const s=q(a);return s?{id:"tmp",kind:"message_slice",messages:t.map(i=>{const n=K.findNode(s,({message:l})=>l.id===i);return n?n.message:null}).filter(Boolean)}:null}function cs(a){return{id:"tmp",kind:"message_slice",messages:[a.previewMessage]}}function Cs({postSharingData:a,onClose:t}){const{clientThreadId:s,postText:o,generateShareLinkFn:i,coverImageUrl:n,messageSliceIds:l,odysseyShareIntent:c,shareTargetId:m,shareType:p}=a,[w,k]=d.useState(!1),_=Q(),g=ze(),[$,j]=d.useState(!0),E=fe(),u=me(E),F=u==null?void 0:u.isWorkspaceAccount();ce(E,"3453150529");const{request:P,ensureShareRequest:Z}=os({shareTargetId:m,shareType:p,generateShareLinkFn:i}),he=(P==null?void 0:P.status)==="processing",ge=rs({shareTargetId:m});d.useEffect(()=>{U.logEventWithStatsig("Share Post: Post Sharing Modal Shown","chatgpt_post_share_modal_shown")},[]);const N=d.useMemo(()=>c?cs(c):n||!l||l.length===0?null:ls(s,l),[n,s,l,c]),L=d.useMemo(()=>{const r=q(s);return r?K.getConversationTurns(r).flatMap(h=>h.messages):[]},[s]),pe=d.useMemo(()=>{if(!l||l.length===0)return[];const r=new Set(l);return L.filter(h=>typeof h.id=="string"&&r.has(h.id))},[L,l]),xe=!1;d.useEffect(()=>{if(!l||l.length===0)return;const r=q(s);l.filter(C=>!K.findNode(r,({message:S})=>S.id===C)).length>0&&Ue(s)},[s,l]);const{hasImage:we,hasScreenshot:ke}=d.useMemo(()=>{let r=!1,h=!1;if(L.length){const C=L,S=/\.(jpe?g|png|gif|webp|bmp|tiff)$/i,B=M=>{if(!Array.isArray(M))return!1;for(const f of M)if(f.type==="image_inline"&&f.clicked_from_url&&(h=!0),f.type==="file"&&"file_name"in f){const b=f.file_name.toLowerCase();(b.endsWith(".pptx")||S.test(b))&&(r=!0)}};C.forEach(M=>{var T,ae,ne,oe;const f=M.metadata;if(!f)return;const b=[...Object.values((T=f.n7jupd_crefs_by_file)!=null?T:{}).flat(),...Object.values((ae=f.content_references_by_file)!=null?ae:{}).flat()],X=[...(ne=f.n7jupd_crefs)!=null?ne:[],...(oe=f.content_references)!=null?oe:[]];B(b),B(X)})}return{hasImage:r,hasScreenshot:h}},[L]),O=He(s),ee=d.useCallback(()=>{var h;if(!m)return Promise.reject(new Error("Missing share target"));const r=(h=R.get(m))!=null?h:P;return(r==null?void 0:r.status)==="processing"?r.promise:(r==null?void 0:r.status)==="succeeded"?Promise.resolve(r):Z()},[P,Z,m]),V=d.useCallback(async r=>{await ds({shareTargetId:m,resolveShareRequest:ee,toaster:g,intl:_,setIsResolvingShareLink:k,task:r})},[_,ee,m,g]),_e=d.useCallback(async()=>{m&&await V(r=>ms({link:r,shareTargetId:m,toaster:g,intl:_}))},[_,V,m,g]),je=async r=>{if(O){if(r.action==="download"){if(r.downloadVariant==="conversation"){await Ie();return}r.downloadVariant==="image"&&n&&Xe({url:n,fileName:"".concat(o,".png")});return}if(r.action==="copy"){await _e();return}if(r.action==="share"&&r.href){const h=r.href;await V(C=>{window.open(h(C),"_blank","noopener,noreferrer")});return}}},ve=e.jsx("div",{className:D("flex w-full justify-center rounded-xl",n||N&&(c!=null&&c.isStandaloneAttachment)?"max-xs:max-h-[260px] h-[30vh] max-h-[550px] max-sm:max-h-[300px]":"aspect-[1200/630]",!n&&!(c!=null&&c.isStandaloneAttachment)&&"outline-token-border-light overflow-hidden shadow-sm outline outline-1"),children:n?e.jsx("img",{src:n,alt:o}):c!=null&&c.isStandaloneAttachment&&N?e.jsx($e,{attachments:[N],variant:"unfurl",className:"h-full w-full",clientThreadId:s}):N?e.jsx(Fe,{attachments:[N],clientThreadId:s,className:"h-full"}):null}),Ce="normal",[Se,G]=d.useState(!1),{presentationMap:Me}=as(),v=_.formatMessage(x.downloadFileError),[be,us]=d.useState(!1),Ie=d.useCallback(async()=>{},[pe,xe,o,_,g,v]),Ee=async(r,h,C,S)=>{var M;const B=O;if(!(!r||!h||!B))if(G(!0),r.endsWith("md")){if(!S)return;try{const f=await Ke.safePost("/export_doc/n7jupd",{requestBody:{conversation_id:B,message_id:C,file_id:h,export_type:S},skipJsonTransform:!0});f.ok||(g.danger(v,{toastId:"post_sharing_modal_download_error",loggingTitle:v,loggingDescription:"Error message when a file download fails"}),H.addError("post_sharing_modal_download_error",{statusText:f.statusText,status:f.status}));const b=await f.blob(),X=f.headers.get("Content-Disposition"),T=(M=ts(X))!=null?M:"Agent.".concat(S);de(b,T)}catch(f){g.danger(v,{toastId:"post_sharing_modal_download_error",loggingTitle:v,loggingDescription:"Error message when a file download fails"}),H.addError(f)}finally{G(!1)}}else{const f=Me[h];if(!f||!f.fileBlob){g.danger(v,{toastId:"post_sharing_modal_download_error",loggingTitle:v,loggingDescription:"Error message when a file download fails"}),H.addError("post_sharing_modal_download_error"),G(!1);return}de(f.fileBlob,r)}},se=n?"image":void 0,Pe=!!se||!!c,te=he||w,Ne=p==="conversation"&&!!a.piiDetected&&ce(E,"2705290984"),Le=e.jsxs(e.Fragment,{children:[e.jsx("div",{className:D("flex flex-wrap justify-center space-y-4 space-x-12 max-sm:space-x-6","mt-12 max-sm:mt-6"),children:e.jsx(is,{showLinkCopied:ge,isGeneratingShareLink:te,disabled:te,onClick:je,postText:o,showDownloadButton:Pe,odysseyShareIntent:c,isDownloadingOdyssey:Se,onOdysseyFileDownload:Ee,downloadVariant:se,isConversationDownloading:be})}),fs(we,ke,F!=null?F:!1)]});return e.jsx(Je,{onExitComplete:t,children:$&&e.jsx(A.Root,{isOpen:!0,onClose:()=>{j(!1)},className:"max-w-[664px] px-4",children:e.jsx(A.Overlay,{showBackground:!0,children:e.jsxs(A.Content,{size:"normal",position:"center",className:D("flex flex-col pb-4 focus:outline-hidden",{"max-w-[640px]":Ce==="normal"}),removePopoverStyling:!1,shadow:"normal",children:[e.jsx(A.Header,{title:o,type:"success",closeButton:e.jsx(Ye,{onClick:()=>j(!1)})}),Ne&&e.jsx("div",{children:e.jsx(Ve,{title:Ze,content:Qe,icon:e.jsx(qe,{"aria-hidden":!0}),type:"info"})}),e.jsxs("div",{children:[e.jsx("div",{className:D("flex justify-center",!c&&"pointer-events-none"),children:ve}),Le]})]})})})})}async function ds(a){const{shareTargetId:t,resolveShareRequest:s,toaster:o,intl:i,setIsResolvingShareLink:n,task:l}=a;if(t){n(!0);try{let c;try{({link:c}=await s())}catch(m){o.danger(i.formatMessage(x.failedToGenerateShareLink),{toastId:"failed_to_generate_share_link",hasCloseButton:!0});return}await l(c)}finally{n(!1)}}}async function ms(a){const{link:t,shareTargetId:s,toaster:o,intl:i}=a;if(s)try{await navigator.clipboard.writeText(t),R.setCopied(s),o.success(i.formatMessage(x.linkCopied),{hasCloseButton:!0})}catch(n){o.danger(i.formatMessage(x.failedToCopyShareLink),{toastId:"failed_to_copy_share_link",hasCloseButton:!0})}}function fs(a,t,s){const o=[];return s&&o.push(e.jsx(z,y({},x.shareLinkVisibleToWorkspaceOnly),"workspace")),t&&o.push(e.jsx(z,y({},x.screenshotDisclaimer),"screenshot")),a&&o.push(e.jsx(z,le(y({},x.imageLicenseDisclaimer),{values:{nbsp:" ",link:i=>e.jsx("a",{href:"https://help.openai.com/",target:"_blank",rel:"noopener noreferrer",className:"underline",children:i})}}),"image")),o.length?e.jsx("p",{className:"text-token-text-tertiary text-center text-sm sm:mt-2",children:o.map((i,n)=>e.jsxs(We.Fragment,{children:[n>0&&e.jsx(e.Fragment,{children:" "}),i]},n))},"image-disclaimer"):null}export{Cs as PostSharingModal};
//# sourceMappingURL=kwbusk11a4k5oqj9.js.map
