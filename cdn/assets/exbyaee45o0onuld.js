var ss=Object.freeze,os=Object.defineProperty,Fs=Object.defineProperties;var Us=Object.getOwnPropertyDescriptors;var ts=Object.getOwnPropertySymbols;var Ls=Object.prototype.hasOwnProperty,Is=Object.prototype.propertyIsEnumerable;var rs=(t,s,r)=>s in t?os(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,R=(t,s)=>{for(var r in s||(s={}))Ls.call(s,r)&&rs(t,r,s[r]);if(ts)for(var r of ts(s))Is.call(s,r)&&rs(t,r,s[r]);return t},re=(t,s)=>Fs(t,Us(s));var Re=(t,s)=>ss(os(t,"raw",{value:ss(s||t.slice())}));import{h as zs,e as ne,a as pe,u as Me,f as ve,r as m,j as e,M as n,i as ys,b as ps,c as Ps,d as qs}from"./fg33krlcm0qyi6yw.js";import{d4 as Bs,d5 as Ws,uM as Vs,zq as Qs,zr as Ks,zs as $s,jm as Ys,kd as Js,J as Xs,m as be,R as ee,zt as ye,U as Zs,zu as et,l as se,g2 as y,gJ as ze,P as V,b as je,iK as ge,b6 as Le,I as vs,a9 as oe,C as we,bg as st,T as Ie,nW as tt,bb as rt,o as as,b5 as ot,d3 as at,hv as nt,hA as ns,F as bs,M as is}from"./mtk1qztvnb31pw5r.js";import{yk as js,yl as it,ym as lt,yn as ws,d7 as ce,d8 as ue,fy as dt,cL as Pe,d9 as me,o2 as ks,yo as Cs,yp as ct,yq as mt,d5 as Ns,jo as _s,d6 as Ss,wC as ut,yr as ft,ys as ht,cV as Rs,ca as xt,c$ as gt,y as Mt,cx as yt,cw as pt,da as vt}from"./k65njl5wlgspihfr.js";import{S as bt}from"./ifr23omr9d78ntp2.js";import{T as Z}from"./hcn3kohxpjzaoxwc.js";var Te,ls;function jt(){if(ls)return Te;ls=1;var t=Bs(),s=Ws(),r="[object RegExp]";function o(a){return s(a)&&t(a)==r}return Te=o,Te}var He,ds;function wt(){if(ds)return He;ds=1;var t=jt(),s=Vs(),r=Qs(),o=r&&r.isRegExp,a=o?s(o):t;return He=a,He}var De,cs;function kt(){if(cs)return De;cs=1;var t=Ks(),s=t("length");return De=s,De}var Ge,ms;function Ct(){if(ms)return Ge;ms=1;var t="\\ud800-\\udfff",s="\\u0300-\\u036f",r="\\ufe20-\\ufe2f",o="\\u20d0-\\u20ff",a=s+r+o,d="\\ufe0e\\ufe0f",c="["+t+"]",i="["+a+"]",N="\\ud83c[\\udffb-\\udfff]",p="(?:"+i+"|"+N+")",E="[^"+t+"]",v="(?:\\ud83c[\\udde6-\\uddff]){2}",D="[\\ud800-\\udbff][\\udc00-\\udfff]",b="\\u200d",_=p+"?",j="["+d+"]?",w="(?:"+b+"(?:"+[E,v,D].join("|")+")"+j+_+")*",x=j+_+w,u="(?:"+[E+i+"?",i,v,D,c].join("|")+")",T=RegExp(N+"(?="+N+")|"+u+x,"g");function k(g){for(var G=T.lastIndex=0;T.test(g);)++G;return G}return Ge=k,Ge}var Ee,us;function Nt(){if(us)return Ee;us=1;var t=kt(),s=js(),r=Ct();function o(a){return s(a)?r(a):t(a)}return Ee=o,Ee}var Oe,fs;function _t(){if(fs)return Oe;fs=1;var t=$s(),s=it(),r=js(),o=Ys(),a=wt(),d=Nt(),c=lt(),i=Js(),N=Xs(),p=30,E="...",v=/\w*$/;function D(b,_){var j=p,w=E;if(o(_)){var x="separator"in _?_.separator:x;j="length"in _?i(_.length):j,w="omission"in _?t(_.omission):w}b=N(b);var u=b.length;if(r(b)){var T=c(b);u=T.length}if(j>=u)return b;var k=j-d(w);if(k<1)return w;var g=T?s(T,0,k).join(""):b.slice(0,k);if(x===void 0)return g+w;if(T&&(k+=g.length-k),a(x)){if(b.slice(k).search(x)){var G,q=g;for(x.global||(x=RegExp(x.source,N(v.exec(x))+"g")),x.lastIndex=0;G=x.exec(q);)var h=G.index;g=g.slice(0,h===void 0?k:h)}}else if(b.indexOf(t(x),k)!=k){var B=g.lastIndexOf(x);B>-1&&(g=g.slice(0,B))}return g+w}return Oe=D,Oe}var St=_t();const Ts=zs(St),Rt="https://help.openai.com/en/articles/8590148-memory-faq";function Hs({memory:t,gizmo:s,className:r,readOnly:o,showDivider:a,inlineComponent:d}){var J,ae;const c=ne(),i=be(),N=pe(),p=je(),E=ws(p),{mutate:v,isPending:D}=Me({mutationFn:async({memoryId:O,status:X})=>{const{success:$}=await ee.safePatch("/memories/{memory_id}/status",{parameters:{path:{memory_id:O}},requestBody:{status:X}});if(!$)throw new Error("An error occurred while updating the memory status")},onSettled:()=>{N.invalidateQueries({queryKey:ce(s==null?void 0:s.id)}),N.invalidateQueries({queryKey:ue()})},onError:()=>{i.danger(I.somethingWentWrong,{id:"memoryUpdateStatusFailed",toastId:"memory_update_status_failed"})}}),{mutate:b,isPending:_}=Me({mutationFn:async O=>{const{success:X}=await ee.safeDelete("/memories/{memory_id}",{parameters:{path:{memory_id:O}},requestBody:{gizmo_id:s==null?void 0:s.id}});if(!X)throw new Error("An error occurred while deleting the memory")},onSettled:()=>{N.invalidateQueries({queryKey:ce(s==null?void 0:s.id)}),N.invalidateQueries({queryKey:ue()})},onError:()=>{i.danger(I.deleteFailed,{id:"memoryDeleteFailed",toastId:"memory_delete_failed"})}}),[j,w]=m.useState(!1);function x(O){const X=new Date,$=O.getFullYear()===X.getFullYear();try{return c.formatDate(O,R({month:"long",day:"numeric"},$?{}:{year:"numeric"}))}catch(f){const M={month:"long",day:"numeric"};return $||(M.year="numeric"),O.toLocaleDateString(void 0,M)}}const u=c.formatMessage(I.moreOptions),k=((J=t.status)!=null?J:ye)==="cold",g=k?()=>{V.logEvent("Memory Manage Modal Memory Unarchive Clicked"),v({memoryId:t.id,status:"warm"},{onSuccess:()=>{i.successNeutral(c.formatMessage(I.memoryPrioritized),{duration:4,hasCloseButton:!1})}})}:void 0,G=()=>{V.logEvent("Memory Manage Modal Memory Delete Clicked"),w(!0)},q=k&&t.last_updated?I.deprioritizedOnNoReason:null,h=k&&t.last_updated?{actor:t.last_updated.actor==="user"?c.formatMessage(I.you):"ChatGPT",date:t.last_updated.timestamp!=null?(()=>{const O=Zs(t.last_updated.timestamp);return x(O)})():c.formatMessage(I.unknownDate)}:void 0,B=t.conversation_id,A=B?"/c/".concat(B):void 0,W=t.updated_at?(()=>{const O=et(t.updated_at);return x(O)})():void 0,te=k?null:A?W?I.savedOnFromChat:I.savedFromChat:W?I.savedOnNoChat:null,Q=k?void 0:A?{date:W,link:O=>e.jsx("a",{href:A,className:"underline",target:"_blank",rel:"noreferrer",children:O})}:W?{date:W}:void 0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:se("group border-token-border-default flex w-full flex-row items-center justify-between gap-3 border-b px-3",a===!1&&"border-b-0",(_||D)&&"pointer-events-none opacity-50",r),children:[e.jsxs("div",{className:"flex min-w-0 flex-1 flex-row items-center gap-2",children:[e.jsx("div",{className:se("min-w-0 flex-initial py-3 [overflow-wrap:anywhere] whitespace-pre-wrap",k&&"text-token-text-tertiary"),children:t.content}),d||null]}),e.jsx("div",{className:"flex shrink-0 justify-end",children:e.jsx(Z.Actions,{children:!o&&e.jsxs(y.Root,{children:[e.jsx(y.Trigger,{asChild:!0,children:e.jsx("button",{"aria-label":u,className:"text-token-text-tertiary hover:text-token-text-secondary pointer-events-none size-8! opacity-0 group-hover:pointer-events-auto group-hover:opacity-100",children:e.jsx(ze,{className:"icon"})})}),e.jsx(y.Portal,{children:e.jsxs(y.Content,{align:"start",size:"small",className:"max-w-[280px] min-w-0",children:[g&&E&&e.jsx(y.Item,{icon:dt,onClick:g,children:c.formatMessage(I.prioritizeThisMemory)}),e.jsx(y.Item,{icon:Pe,color:"danger",onClick:G,children:c.formatMessage(I.delete)}),q&&h&&e.jsx(y.Group,{children:e.jsx("div",{className:"text-token-text-tertiary px-4 py-2 text-[13px] leading-4",children:e.jsx(n,re(R({},q),{values:h}))})}),te&&Q&&e.jsx(y.Group,{children:e.jsx("div",{className:"text-token-text-tertiary px-4 py-2 text-[13px] leading-4",children:e.jsx(n,re(R({},te),{values:Q}))})})]})})]})})})]}),!o&&j&&e.jsx(me,{isOpen:!0,primaryButtonColor:"danger",title:c.formatMessage(I.deleteConfirmTitle),confirmText:c.formatMessage(I.delete),onConfirm:()=>{V.logEvent("Memory Manage Modal Memory Delete Confirmed"),b(t.id,{onSuccess:()=>{i.successNeutral(c.formatMessage(I.memoryDeleted),{duration:4,hasCloseButton:!1})}}),w(!1)},onClose:()=>{w(!1)},children:e.jsx("div",{className:"mb-2 text-sm",children:c.formatMessage(I.deleteConfirmDescription,{name:(ae=s==null?void 0:s.name)!=null?ae:"ChatGPT",title:e.jsx("strong",{children:Ts(t.content,{length:130,omission:"..."})}),link:O=>e.jsx("a",{href:Rt,target:"_blank",rel:"noreferrer",className:"underline",children:O})})})})]})}const I=ve({deprioritizedOnNoReason:{id:"MemoryRow.deprioritizedOnNoReason",defaultMessage:"Deprioritized by {actor} on {date}."},deprioritizedOnWithReason:{id:"MemoryRow.deprioritizedOnWithReason",defaultMessage:"Deprioritized by {actor} on {date} because {reason}."},delete:{id:"MemoryRow.delete",defaultMessage:"Delete"},deleteConfirmTitle:{id:"MemoryRow.deleteConfirmTitle",defaultMessage:"Delete this memory?"},deleteConfirmDescription:{id:"MemoryRow.deleteConfirmDescription",defaultMessage:'"{title}" will be deleted. {name} may not remember this information going forward. <link>Learn more</link>'},deleteFailed:{id:"MemoryRow.deleteFailed",defaultMessage:"Failed to forget memory"},moreOptions:{id:"MemoryRow.moreOptions",defaultMessage:"More options"},savedFromChat:{id:"MemoryRow.savedFromChat",defaultMessage:"Saved from a <link>chat</link>."},savedOnFromChat:{id:"MemoryRow.savedOnFromChat",defaultMessage:"Saved on {date} from a <link>chat</link>."},savedOnNoChat:{id:"MemoryRow.savedOnNoChat",defaultMessage:"Saved on {date}."},somethingWentWrong:{id:"MemoryRow.somethingWentWrong",defaultMessage:"Something went wrong..."},memoryPrioritized:{id:"MemoryRow.memoryPrioritized",defaultMessage:"Memory prioritized"},memoryDeleted:{id:"MemoryRow.memoryDeleted",defaultMessage:"Memory deleted"},prioritizeThisMemory:{id:"MemoryRow.prioritizeThisMemory",defaultMessage:"Prioritize this memory"},unknownDate:{id:"MemoryRow.unknownDate",defaultMessage:"Unknown date"},you:{id:"MemoryRow.you",defaultMessage:"You"}}),Tt=80,Ht=100;function Dt(t){const s=ks(),r=Cs();return s&&!r&&t!=null&&t>Tt}function Gt({memoryFullPct:t,className:s}){if(!Dt(t))return null;const o=t;return e.jsx("div",{className:se("flex items-center justify-center",s),children:e.jsx("div",{className:se("flex items-center justify-center gap-0.5 rounded-[8px] p-1 text-sm leading-4 font-semibold whitespace-nowrap",o>=Ht?"bg-token-bg-status-error text-token-interactive-label-danger-secondary-default":"bg-token-bg-status-warning text-token-text-status-warning"),children:e.jsx(n,{id:"R17Ykc",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:o}})})})}const Ae=ve({disableOptimizeTitle:{id:"personalizationSettings.disableOptimizeTitle",defaultMessage:"Turn off automatic memory management?"},turnOff:{id:"common.turnOff",defaultMessage:"Turn off"},disableOptimizeDescription:{id:"personalizationSettings.disableOptimizeDescription",defaultMessage:"Once memory is full, ChatGPT won't save new memories, and responses may feel less personal. {link}"}}),Et=({isOpen:t=!1,setShowDisableOMConfirm:s,goldenHourMutation:r})=>{const o=ne();return e.jsx(me,{isOpen:t,title:o.formatMessage(Ae.disableOptimizeTitle),confirmText:o.formatMessage(Ae.turnOff),primaryButtonColor:"danger",onConfirm:()=>{r.mutate({setting:Le.GoldenHour,value:!1}),s(!1)},onClose:()=>{s(!1)},children:e.jsx("div",{className:"mb-2 text-sm",children:e.jsx(n,re(R({},Ae.disableOptimizeDescription),{values:{link:a=>e.jsx(ge,{href:"https://help.openai.com/en/articles/8590148-memory-faq",className:"underline",children:a})}}))})})};function Ot({label:t,active:s,onClick:r}){return e.jsx("button",{onClick:r,className:"rounded-lg px-3 py-2.5 text-start text-sm "+(s?"dark:bg-token-interactive-bg-secondary-press dark:hover:bg-token-interactive-bg-secondary-hover bg-[#0000000f] hover:bg-[#0000000a]":"dark:hover:bg-token-interactive-bg-secondary-hover hover:bg-[#0000000a]"),children:e.jsx("div",{className:"font-semibold text-wrap",children:t})})}function At({isOpen:t,onClose:s}){const r=ne(),o=je();vs(o);const a=pe(),{data:d,isLoading:c,isFetching:i,refetch:N}=ct(50,t),p=m.useMemo(()=>Array.isArray(d==null?void 0:d.history)?d.history:[],[d]),E=c||i&&!d,[v,D]=m.useState(null),[b,_]=m.useState(!1),[j,w]=m.useState(!1),[x,u]=m.useState(!1),[T,k]=m.useState(!1),g=m.useCallback(async()=>{await N()},[N]),G=m.useCallback(f=>{const M=new Date((f||0)*1e3),C=M.getFullYear()===new Date().getFullYear();try{const U=r.formatDate(M,R({month:"long",day:"numeric"},C?{}:{year:"numeric"})),F=r.formatTime(M,{hour:"numeric",minute:"2-digit"});return"".concat(U,", ").concat(F)}catch(U){const F={month:"long",day:"numeric"};C||(F.year="numeric");const S=M.toLocaleDateString(void 0,F),z=M.toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit"});return"".concat(S,", ").concat(z)}},[r]),q=m.useMemo(()=>p.map(f=>{var M;return{id:(M=f.id)!=null?M:"__current__",label:G(f.snapshot_time)}}),[p,G]),h=m.useMemo(()=>{var M,C,U;if(p.length===0)return null;if(v==null)return(C=(M=p.find(F=>F.id==null))!=null?M:p[0])!=null?C:null;const f=v==="__current__"?null:v;return(U=p.find(F=>{var S;return((S=F.id)!=null?S:"__current__")===(f!=null?f:"__current__")}))!=null?U:null},[p,v]),B=m.useMemo(()=>h?G(h.snapshot_time):"",[h,G]),A=m.useCallback(()=>{!h||h.id==null||u(!0)},[h]),W=m.useCallback(async()=>{if(!(!h||h.id==null)){k(!0);try{const{success:f}=await ee.safeDelete("/memories/history/{memory_history_id}",{parameters:{path:{memory_history_id:h.id}}});if(!f)throw new Error("failed");await g(),D(null)}catch(f){}finally{k(!1),u(!1)}}},[h,g]),te=(v!=null?v:"__current__")==="__current__",Q=(h==null?void 0:h.id)!=null&&!te;m.useEffect(()=>{if(!t||E)return;if(p.length===0){D(C=>C===null?C:null);return}const f=new Set(p.map(C=>{var U;return(U=C.id)!=null?U:"__current__"})),M=f.has("__current__");D(C=>{var F,S;const U=C!=null?C:"__current__";return f.has(U)?C:M?null:(S=(F=p[0])==null?void 0:F.id)!=null?S:null})},[t,E,p]);function J(f){var S,z;const M=f.updated_at!=null?Date.parse(f.updated_at):NaN;let C=(S=f.last_updated)==null?void 0:S.timestamp;C=C!=null?C:(z=f.created_timestamp)!=null?z:void 0;const U=C!=null?C*1e3:NaN,F=Math.max(Number.isFinite(M)?M:-1/0,Number.isFinite(U)?U:-1/0);return Number.isFinite(F)?F:0}const{currentMemories:ae,deprioritizedMemories:O}=m.useMemo(()=>{var F,S;const f=(F=h==null?void 0:h.memories)!=null?F:[],M=[],C=[];for(const z of f)((S=z.status)!=null?S:ye)==="cold"?C.push(z):M.push(z);const U=(z,ie)=>J(ie)-J(z);return{currentMemories:M.sort(U),deprioritizedMemories:C.sort(U)}},[h]),X=m.useMemo(()=>[...ae,...O],[ae,O]);let $=null;return E?$=e.jsxs("div",{className:"border-token-border-default flex w-full flex-col rounded-lg border",children:[e.jsxs("div",{className:"border-token-border-default relative flex flex-row items-center justify-between gap-3 px-4 py-5",children:[e.jsxs("div",{className:"flex w-48 flex-col gap-2 px-3",children:[e.jsx("div",{className:"bg-token-bg-tertiary h-5 w-48 animate-pulse rounded"}),e.jsx("div",{className:"bg-token-bg-tertiary h-3 w-28 animate-pulse rounded"})]}),e.jsx("div",{className:"bg-token-bg-tertiary h-8 w-36 animate-pulse rounded-full"}),e.jsx("span",{className:"sr-only",children:e.jsx(n,R({},P.loading))})]}),e.jsx("div",{className:"flex flex-1 overflow-y-auto px-4",children:e.jsx("div",{className:"w-full",children:Array.from({length:6}).map((f,M)=>{const C=Math.floor(Math.random()*193)+128;return e.jsx("div",{className:"border-token-border-default flex items-start gap-3 border-b py-4",children:e.jsx("div",{className:"bg-token-bg-tertiary h-6 animate-pulse rounded",style:{width:"".concat(C,"px")}})},M)})})})]}):h?$=e.jsxs("div",{className:"border-token-border-default flex w-full flex-col rounded-lg border",children:[e.jsxs("div",{className:"border-token-border-default group relative flex flex-row items-center justify-between gap-2 px-4 py-5",children:[e.jsx("div",{className:"min-w-0 flex-1 px-3",children:e.jsx("div",{className:"text-lg font-semibold",children:B})}),e.jsxs("div",{className:"flex h-full shrink-0 items-start gap-2 pe-1",children:[Q?e.jsxs(y.Root,{children:[e.jsx(y.Trigger,{asChild:!0,children:e.jsx("button",{"aria-label":r.formatMessage(P.moreOptions),className:"text-token-text-tertiary hover:text-token-text-secondary size-8!",children:e.jsx(ze,{className:"icon"})})}),e.jsx(y.Portal,{children:e.jsx(y.Content,{align:"start",size:"small",className:"max-w-[200px] min-w-0",children:e.jsx(y.Item,{icon:Pe,color:"danger",onClick:A,className:"gap-2.5! pe-3!",children:r.formatMessage(P.deleteSnapshot)})})})]}):null,e.jsx(oe,{color:"secondary",onClick:()=>_(!0),disabled:te,style:{pointerEvents:te?"none":void 0},children:h.id==null?e.jsx(n,R({},P.currentVersion)):e.jsx(n,R({},P.restoreThisVersion))})]})]}),ae.length+O.length===0?e.jsx("div",{className:"text-token-text-tertiary flex flex-1 items-center justify-center p-4 text-sm",children:e.jsx(n,R({},P.noMemories))}):e.jsx("div",{className:"flex flex-1 overflow-y-auto px-4",children:e.jsx("div",{className:"w-full text-sm",children:X.map((f,M)=>e.jsx(Hs,{memory:f,gizmo:void 0,readOnly:!0,showDivider:M!==X.length-1},f.id))})})]}):$=e.jsx("div",{className:"border-token-border-default text-token-text-tertiary flex h-full w-full items-center justify-center rounded-lg border p-4 text-sm",children:e.jsx(n,R({},P.noMemories))}),e.jsxs(e.Fragment,{children:[e.jsx(we,{testId:"modal-saved-memories-history",isOpen:t,onClose:s,size:"custom",className:"max-h-[85vh] max-md:min-h-[60vh] md:h-[740px] md:max-w-[960px]",type:"success",title:r.formatMessage(P.title),showCloseButton:!0,children:e.jsxs("div",{className:"flex h-full min-h-0 gap-4",children:[e.jsx("div",{className:"w-60 shrink-0 overflow-y-auto",children:e.jsx("div",{className:"flex flex-col pb-2",children:E?Array.from({length:6}).map((f,M)=>e.jsx("div",{className:"rounded px-3 py-2.5",children:e.jsx("div",{className:"bg-token-bg-tertiary h-4 w-40 animate-pulse rounded"})},M)):e.jsxs(e.Fragment,{children:[q.map(f=>{const M=(v!=null?v:"__current__")===f.id;return e.jsx(Ot,{label:f.label,active:M,onClick:()=>D(f.id)},f.id)}),q.length===0?e.jsx("div",{className:"text-sm",children:e.jsx(n,R({},P.noHistory))}):null]})})}),e.jsx("div",{className:"flex min-w-0 flex-1 overflow-hidden",children:$})]})}),x&&(h==null?void 0:h.id)!=null&&e.jsx(me,{isOpen:!0,title:r.formatMessage(P.confirmDeleteTitle),confirmText:r.formatMessage(P.confirmDeleteCta),primaryButtonColor:"danger",loading:T,onConfirm:W,onClose:()=>{T||u(!1)},children:e.jsx("div",{className:"text-token-text-secondary mb-2 text-sm",children:e.jsx(n,R({},P.confirmDeleteBody))})}),b&&e.jsx(me,{isOpen:!0,title:r.formatMessage(P.confirmRestoreTitle),confirmText:r.formatMessage(P.confirmRestoreCta),primaryButtonColor:"danger",loading:j,onConfirm:async()=>{if(!(!h||h.id==null)){w(!0);try{const{success:f}=await ee.safePost("/memories/history/{memory_history_id}/revert",{parameters:{path:{memory_history_id:h.id}}});if(!f)throw new Error("failed");await g(),D(null),a.invalidateQueries({queryKey:["memories"]})}catch(f){}finally{_(!1),w(!1)}}},onClose:()=>_(!1),children:e.jsx("div",{className:"mb-2 text-sm",children:e.jsx(n,R({},P.confirmRestoreBody))})})]})}const P=ve({title:{id:"SavedMemoriesHistoryModal.title",defaultMessage:"Saved memories history"},loading:{id:"SavedMemoriesHistoryModal.loading",defaultMessage:"Loading..."},noHistory:{id:"SavedMemoriesHistoryModal.noHistory",defaultMessage:"No checkpoints"},noMemories:{id:"SavedMemoriesHistoryModal.noMemories",defaultMessage:"No memories"},currentVersion:{id:"SavedMemoriesHistoryModal.currentVersion",defaultMessage:"Current version"},restoreThisVersion:{id:"SavedMemoriesHistoryModal.restoreThisVersion",defaultMessage:"Restore this version"},confirmRestoreTitle:{id:"SavedMemoriesHistoryModal.confirmRestoreTitle",defaultMessage:"Restore this version?"},confirmRestoreBody:{id:"SavedMemoriesHistoryModal.confirmRestoreBody",defaultMessage:"This will replace your current saved memories."},confirmRestoreCta:{id:"SavedMemoriesHistoryModal.confirmRestoreCta",defaultMessage:"Restore"},cancel:{id:"common.cancel",defaultMessage:"Cancel"},moreOptions:{id:"SavedMemoriesHistoryModal.moreOptions",defaultMessage:"More options"},deleteSnapshot:{id:"SavedMemoriesHistoryModal.deleteSnapshot",defaultMessage:"Delete this version"},confirmDeleteTitle:{id:"SavedMemoriesHistoryModal.confirmDeleteTitle",defaultMessage:"Delete this version?"},confirmDeleteBody:{id:"SavedMemoriesHistoryModal.confirmDeleteBody",defaultMessage:"This cannot be undone."},confirmDeleteCta:{id:"SavedMemoriesHistoryModal.confirmDeleteCta",defaultMessage:"Delete"}}),Ft=80,ke=100;function Ds(t){return t<ke?"bg-token-bg-status-warning text-token-text-status-warning":"bg-token-bg-status-error text-token-interactive-label-danger-secondary-default"}function Gs(t){return ks()&&t!=null&&t>Ft}function Xt({memoryFullPct:t,className:s,children:r,showInfoLabel:o,onManageMemories:a}){return Gs(t)?e.jsx("div",{className:se("border-token-border-default rounded-lg border p-1 text-sm",s),children:e.jsxs(st.div,{className:se("flex h-7 items-center gap-1 overflow-hidden rounded-sm px-1.5 font-medium whitespace-nowrap",Ds(t)),initial:{width:0},animate:{width:"".concat(t,"%")},transition:{duration:.5},children:[e.jsx(mt,{className:"icon-sm ms-1"}),e.jsx(n,{id:"6D2etG",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:t}}),r,o&&e.jsx(Ie,{interactive:!0,label:t<ke?e.jsx("div",{className:"whitespace-normal",children:e.jsx(n,{id:"gxY4wi",defaultMessage:"ChatGPT's almost out of space for new saved memories. <memoryModalLink>Manage saved memories</memoryModalLink> to create more space.",values:{memoryModalLink:c=>e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:i=>{i.preventDefault(),a==null||a()},children:c})}})}):e.jsx("div",{className:"whitespace-normal",children:e.jsx(n,{id:"1JxMf3",defaultMessage:"ChatGPT's out of space for saved memories. <memoryModalLink>Manage saved memories</memoryModalLink> to create more space.",values:{memoryModalLink:c=>e.jsx("a",{href:"#",className:"cursor-pointer underline",onClick:i=>{i.preventDefault(),a==null||a()},children:c})}})}),children:e.jsx(tt,{className:"icon-sm ms-1"})})]})}):null}function Ut({memoryFullPct:t,className:s,showUpgradeCTA:r=!1,isPaid:o=!1,onUpgrade:a}){return Gs(t)?e.jsxs("div",{className:se("border-token-border-default bg-token-main-surface-primary flex items-center justify-between gap-4 rounded-lg border p-[14px]",s),children:[e.jsxs("div",{className:"inline-block gap-1",children:[e.jsx("div",{className:se("mb-1 inline-block rounded-[6px] px-[6px] py-[2px] text-sm font-semibold",Ds(t!=null?t:0)),children:e.jsx(n,{id:"56hzv4",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:t}})}),e.jsx("div",{className:"text-token-text-secondary text-sm",children:(t!=null?t:0)>=ke?o?e.jsx(n,{id:"HaCKNx",defaultMessage:"New memories can't be saved, so responses may feel less personalized. Delete existing memories to free up space."}):e.jsx(n,{id:"MXPinw",defaultMessage:"New memories can't be saved, so responses may feel less personalized. Upgrade to expand memory, or delete existing memories."}):o?e.jsx(n,{id:"obgK9b",defaultMessage:"Once memory is full, responses may feel less personalized. Delete existing memories to free up space."}):e.jsx(n,{id:"PDLzFM",defaultMessage:"Once memory is full, responses may feel less personalized. Upgrade to expand memory, or delete existing memories."})})]}),r&&!o&&e.jsx(oe,{color:"primary",size:"medium",onClick:a,children:e.jsx(n,{id:"1rRvWt",defaultMessage:"Upgrade"})})]}):null}function Lt({memoryFullPct:t,className:s,onUpgrade:r}){const o=(t!=null?t:0)>=ke,a=o?"bg-token-bg-status-error text-token-interactive-label-danger-secondary-default":"bg-token-bg-status-warning text-token-text-status-warning";return e.jsxs("div",{className:se("border-token-border-default bg-token-main-surface-primary flex items-center justify-between gap-4 rounded-2xl border p-[14px]",s),children:[e.jsxs("div",{className:"inline-block gap-1",children:[e.jsx("div",{className:se("mb-1 inline-block rounded-[6px] px-[6px] py-[2px] text-sm font-semibold",a),children:e.jsx(n,{id:"56hzv4",defaultMessage:"{memoryFullPct}% full",values:{memoryFullPct:t}})}),e.jsx("div",{className:"text-token-text-secondary text-xs",children:o?e.jsx(n,{id:"MXPinw",defaultMessage:"New memories can't be saved, so responses may feel less personalized. Upgrade to expand memory, or delete existing memories."}):e.jsx(n,{id:"PDLzFM",defaultMessage:"Once memory is full, responses may feel less personalized. Upgrade to expand memory, or delete existing memories."})})]}),e.jsx(oe,{color:"primary",size:"medium",onClick:r,children:e.jsx(n,{id:"1rRvWt",defaultMessage:"Upgrade"})})]})}var gs;const xe=bs.div(gs||(gs=Re(["flex h-full items-center justify-center pb-8 text-sm text-token-text-tertiary rounded-lg border border-token-border-default"])));function hs(t){var d,c;const s=t.updated_at!=null?Date.parse(t.updated_at):NaN;let r=(d=t.last_updated)==null?void 0:d.timestamp;r=r!=null?r:(c=t.created_timestamp)!=null?c:void 0;const o=r!=null?r*1e3:NaN,a=Math.max(Number.isFinite(s)?s:-1/0,Number.isFinite(o)?o:-1/0);return Number.isFinite(a)?a:0}function Zt({isOpen:t,onClose:s,initialGizmoId:r,contextScopes:o,requiredContextScopes:a}){var Ke,$e,Ye,Je,Xe,Ze,es;const d=je(),c=ys(),i=ne(),N=rt(),p=be(),E=Ns(),[v,D]=m.useState(r),[b,_]=m.useState(!1),[j,w]=m.useState(""),[x,u]=m.useState(!1),[T,k]=m.useState(!1),[g,G]=m.useState(!1),[q,h]=m.useState(!1),[B,A]=m.useState(!1),[W,te]=m.useState(!1),Q=m.useRef(null),J=_s(),ae=(Ke=as(d,"3453210147"))!=null?Ke:!1;as(d,"1900515849");const O=ws(d),{data:X,isLoading:$}=ot(Le.GoldenHour),f=X!==void 0&&O,M=Cs(),C=at(!0),U=m.useCallback(l=>{if(!l&&M){A(!0);return}C.mutate({setting:Le.GoldenHour,value:l}),V.logEventWithStatsig("Personalization Settings Automatic Memory Management ".concat(l?"Enabled":"Disabled"),"chatgpt_personalization_settings_automatic_memory_management_".concat(l?"enabled":"disabled"))},[C,M]),F=$||C.isPending,{data:S,isLoading:z,isError:ie,refetch:qe}=Ss(v,!0,E,o,a),Be=($e=S==null?void 0:S.memories)!=null?$e:[],Ce=Be.length,fe=[...Be].sort((l,L)=>(b?1:-1)*(hs(l)-hs(L))),Ne=(()=>{const l=j.trim();if(l==="")return fe;const L=new Set(ut(fe,l,Y=>({targets:[Y.content]}),{locale:i.locale,maxResults:fe.length}).map(Y=>Y.id));return fe.filter(Y=>L.has(Y.id))})(),We=Ne.filter(l=>{var L;return((L=l.status)!=null?L:ye)!=="cold"}),Ve=Ne.filter(l=>{var L;return((L=l.status)!=null?L:ye)==="cold"}),le=m.useMemo(()=>[...We,...Ve],[We,Ve]);m.useEffect(()=>()=>{Q.current&&(clearTimeout(Q.current),Q.current=null)},[]);const Es=m.useCallback(async l=>{if(le.length===0)return;const L=le.map(Y=>{var he;return(he=Y.content)!=null?he:""}).join("\n");try{await nt(L,p,l),te(!0),Q.current&&clearTimeout(Q.current),Q.current=setTimeout(()=>{te(!1),Q.current=null},2e3)}catch(Y){}},[le,p]),{data:_e,refetch:Bt}=ps({queryKey:["memory_gizmos"],queryFn:()=>ee.safeGet("/memories/gizmos"),refetchOnMount:"always"}),Se=ft(d,(Ye=S==null?void 0:S.memoryFullPct)!=null?Ye:0)!=="control",K=[{id:void 0,name:"ChatGPT",iconUrl:null},...(Je=_e==null?void 0:_e.items.map(({gizmo:l})=>{var L;return{id:l.id,name:l.display.name,iconUrl:(L=l.display.profile_picture_url)!=null?L:null}}))!=null?Je:[]].find(l=>l.id===v);m.useEffect(()=>{!z&&!ie&&v!==void 0&&Ce===0&&D(void 0)},[z,ie,v,Ce]);const Os=J&&M?H.descriptionOptimizeOn:J&&f?H.descriptionPaid:J?H.descriptionFreeMoonshine:H.descriptionFree,Qe=i.formatMessage(W?H.copiedAll:H.copyAll),As=l=>e.jsx(ge,{href:Fe,className:"underline",children:l});let de;return z?de=e.jsx(xe,{className:"border-none",children:e.jsx(n,R({},H.loading))}):ie?de=e.jsx(xe,{className:"border-none",children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(n,{id:"MemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."})}),e.jsx("div",{children:e.jsx(oe,{color:"secondary",size:"small",onClick:()=>{qe()},children:e.jsx(n,{id:"MemoriesModal.retry",defaultMessage:"Retry"})})})]})}):Ce===0?de=e.jsx(xe,{className:"text-token-text-primary border-none",children:E?e.jsxs("div",{className:"flex h-full max-w-sm flex-col items-center justify-center gap-0.5 text-center text-base",children:[e.jsx(ht,{className:"icon-xl"}),e.jsx(n,re(R({},H.noMemories),{values:{name:(Xe=K==null?void 0:K.name)!=null?Xe:"ChatGPT"}}))]}):e.jsx("div",{className:"flex h-full max-w-sm items-center justify-center text-center",children:e.jsx(n,R({},H.noMemoriesAndDisabled))})}):j.trim()!==""&&Ne.length===0?de=e.jsx(xe,{className:"text-token-text-tertiary border-none",children:e.jsxs("div",{className:"flex h-full max-w-sm flex-col items-center justify-center gap-2 text-center text-base",children:[e.jsx(ns,{className:"icon-lg"}),e.jsx("div",{children:e.jsx(n,re(R({},H.searchNoResults),{values:{query:j.trim()}}))}),e.jsx("div",{children:e.jsx(oe,{color:"secondary",size:"small",onClick:()=>{G(!0)},children:e.jsx(n,R({},H.viewHistory))})})]})}):de=e.jsx(Z.Root,{size:"compact",children:e.jsx(Z.Body,{children:le.map((l,L)=>{const Y=K?{id:K.id,name:K.name}:void 0,he={memory:l,gizmo:Y,showDivider:L!==le.length-1};return e.jsx(Hs,R({},he),l.id)})})}),e.jsxs(e.Fragment,{children:[e.jsxs(we,{testId:"modal-golden-hour-memories",isOpen:t,size:"custom",className:"max-h-[85vh] px-2 py-2 max-md:min-h-[60vh] md:h-[740px] md:max-w-[680px]",headerClassName:"shrink-0",contentClassName:"h-full flex flex-col",type:"success",onClose:s,title:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{children:i.formatMessage(H.title)}),!Se&&e.jsx(Gt,{memoryFullPct:S==null?void 0:S.memoryFullPct})]}),description:!Se&&e.jsx("div",{className:"text-token-text-secondary",children:i.formatMessage(Os,{link:As})}),showCloseButton:!0,isScrollable:!1,children:[e.jsxs("div",{className:"border-token-border-default w-full border-b pb-4",children:[Se&&e.jsx(Lt,{memoryFullPct:S==null?void 0:S.memoryFullPct,onUpgrade:()=>{var l;V.logEventWithStatsig("Memories Upgrade Button Clicked","chatgpt_memories_upgrade_button_clicked_settings",{memory_full_pct:(l=S==null?void 0:S.memoryFullPct)!=null?l:0}),Rs(c,"chatgpt_memories_upgrade_button")},className:"mb-6"}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"relative min-w-0 flex-1",children:[e.jsx("div",{className:"pointer-events-none absolute start-3 top-1/2 flex h-5 w-5 -translate-y-1/2 items-center justify-center",children:e.jsx(ns,{className:"icon text-token-text-tertiary"})}),e.jsx("input",{type:"text",id:"memories-search",name:"memories-search",placeholder:i.formatMessage(H.searchPlaceholder),className:"border-token-border-default placeholder:text-token-text-tertiary/70 h-9.5 w-full max-w-[320px] rounded-full border bg-transparent ps-10 pe-3 text-sm outline-none focus:shadow-none focus:ring-0 focus:outline-none",value:j,onChange:l=>w(l.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[ae&&e.jsx("button",{type:"button","aria-label":Qe,title:Qe,disabled:le.length===0,onClick:Es,className:"text-token-text-tertiary hover:text-token-text-secondary hover:bg-token-interactive-bg-tertiary-hover inline-flex size-8! items-center justify-center rounded-md disabled:cursor-not-allowed disabled:opacity-40",children:W?e.jsx(xt,{className:"icon"}):e.jsx(gt,{className:"icon"})}),e.jsxs(y.Root,{children:[e.jsx(y.Trigger,{asChild:!0,children:e.jsx("button",{"aria-label":i.formatMessage(H.sortAria),className:"text-token-text-tertiary hover:text-token-text-secondary hover:bg-token-interactive-bg-tertiary-hover inline-flex size-8! items-center justify-center rounded-md",children:e.jsx(bt,{className:"icon"})})}),e.jsx(y.Portal,{children:e.jsxs(y.Content,{align:"start",size:"auto",className:"max-w-[280px] min-w-[165px]",children:[e.jsx(y.Group,{children:e.jsx("div",{className:"text-token-text-tertiary px-4 pt-2.5 pb-2 text-[13px] leading-4",children:e.jsx(n,R({},H.sortHeader))})}),e.jsxs(y.RadioGroup,{value:b?"oldest":"newest",onValueChange:l=>_(l==="oldest"),children:[e.jsx(y.RadioItem,{value:"newest",children:e.jsx(n,R({},H.newestFirst))}),e.jsx(y.RadioItem,{value:"oldest",children:e.jsx(n,R({},H.oldestFirst))})]})]})})]}),e.jsxs(y.Root,{children:[e.jsx(y.Trigger,{asChild:!0,children:e.jsx("button",{"aria-label":i.formatMessage(H.moreOptionsAria),className:"text-token-text-tertiary hover:text-token-text-secondary hover:bg-token-interactive-bg-tertiary-hover inline-flex size-8! items-center justify-center rounded-md",children:e.jsx(ze,{className:"icon"})})}),e.jsx(y.Portal,{children:e.jsxs(y.Content,{align:"start",size:"small",className:"max-w-[280px] min-w-0",children:[f&&e.jsx(y.Group,{children:e.jsx(y.CheckboxItem,{label:i.formatMessage(H.autoManageTitle),checked:M,disabled:F,onCheckedChange:l=>{U(l===!0)}})}),e.jsxs(y.Group,{children:[e.jsx(y.Item,{onClick:()=>{G(!0)},children:e.jsx(n,R({},H.viewHistory))}),e.jsx(y.Item,{color:"danger",onClick:()=>{k(!1),u(!0)},children:e.jsx(n,R({},H.deleteAllMemories))})]})]})})]})]})]})]}),e.jsx("div",{className:"h-full min-w-sm overflow-y-auto",children:de}),x&&e.jsx(me,{isOpen:!0,primaryButtonColor:"danger",title:i.formatMessage(H.deleteAllConfirmTitle),confirmText:i.formatMessage(H.deleteAllConfirmCta),loading:q,onConfirm:async()=>{h(!0);try{const l={gizmo_id:v,context_scopes:o,required_context_scopes:a,delete_history:T};v===void 0&&(l.delete_history=T),await ee.safeDelete("/settings/clear_account_user_memory",{requestBody:l}),await qe()}catch(l){}finally{h(!1),u(!1)}},onClose:()=>u(!1),children:e.jsxs("div",{className:"mb-2 flex flex-col gap-5 text-sm",children:[e.jsx("div",{className:"text-sm",children:J?e.jsx(n,re(R({},H.deleteAllConfirmDescriptionUpdated),{values:{name:(Ze=K==null?void 0:K.name)!=null?Ze:"ChatGPT",link:l=>e.jsx(ge,{href:Fe,className:"underline",children:l})}})):e.jsx(n,re(R({},H.deleteAllConfirmDescription),{values:{name:(es=K==null?void 0:K.name)!=null?es:"ChatGPT",link:l=>e.jsx(ge,{href:Fe,className:"underline",children:l})}}))}),e.jsxs("div",{className:"border-token-border-default flex flex-row gap-3 rounded-2xl border px-4 py-4 text-sm",children:[e.jsx(Mt,{id:"delete-past-versions",checked:T,onChange:l=>k(l.target.checked),className:"border-token-border-default! h-5 w-5 shrink-0 rounded-full! border ring-0 ring-offset-0 focus:ring-0 focus:ring-offset-0 focus:outline-none",style:{backgroundColor:T?N?"transparent":"black":"transparent"}}),e.jsx("span",{children:i.formatMessage(H.alsoDeletePastVersions)})]})]})})]}),e.jsx(At,{isOpen:g,onClose:()=>G(!1)}),f&&B&&e.jsx(Et,{isOpen:B,setShowDisableOMConfirm:A,goldenHourMutation:C})]})}const Fe="https://help.openai.com/en/articles/8983136-what-is-memory",H=ve({descriptionFree:{id:"GoldenHourMemoriesModalFree.description",defaultMessage:"ChatGPT remembers useful details about you and your preferences so it can be more helpful. <link>Learn more</link>"},descriptionFreeMoonshine:{id:"GoldenHourMemoriesModal.description.freeMoonshine",defaultMessage:"ChatGPT tries to remember your recent chats, but it may forget things over time. Saved memories are never forgotten. <link>Learn more</link>"},descriptionPaid:{id:"GoldenHourMemoriesModal.description",defaultMessage:"ChatGPT automatically remembers useful information from chats, making responses more relevant and personal. <link>Learn more</link>"},descriptionOptimizeOn:{id:"GoldenHourMemoriesModal.description.optimizeOn",defaultMessage:"ChatGPT remembers and automatically manages useful information from chats, making responses more relevant and personal. <link>Learn more</link>"},copyAll:{id:"GoldenHourMemoriesModal.copyAll",defaultMessage:"Copy all"},copiedAll:{id:"GoldenHourMemoriesModal.copiedAll",defaultMessage:"Copied"},delete:{id:"GoldenHourMemoriesModal.delete",defaultMessage:"Delete"},deleteDescription:{id:"GoldenHourMemoriesModal.deleteDescription",defaultMessage:'"{title}" will be deleted. {name} may not remember this information going forward. <link>Learn more</link>'},history:{id:"GoldenHourMemoriesModal.history",defaultMessage:"History"},historyIntro:{id:"GoldenHourMemoriesModal.historyIntro",defaultMessage:"Revert to a previous version of your saved memories."},historyModalTitle:{id:"GoldenHourMemoriesModal.historyModalTitle",defaultMessage:"Saved memories history"},loading:{id:"GoldenHourMemoriesModal.loading",defaultMessage:"Loading..."},noHistory:{id:"GoldenHourMemoriesModal.noHistory",defaultMessage:"No checkpoints"},noMemories:{id:"GoldenHourMemoriesModal.noMemories",defaultMessage:"No saved memories"},noMemoriesAndDisabled:{id:"GoldenHourMemoriesModal.noMemoriesAndDisabled",defaultMessage:"Memory is disabled. ChatGPT won't use or save memories."},autoManageTitle:{id:"GoldenHourMemoriesModal.autoManageTitle",defaultMessage:"Automatically manage"},remove:{id:"GoldenHourMemoriesModal.remove",defaultMessage:"Remove"},retry:{id:"GoldenHourMemoriesModal.retry",defaultMessage:"Retry"},somethingWentWrong:{id:"GoldenHourMemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."},title:{id:"GoldenHourMemoriesModal.title",defaultMessage:"Saved memories"},unknownGizmo:{id:"GoldenHourMemoriesModal.unknownGizmo",defaultMessage:"Unknown GPT"},viewHistoryTooltip:{id:"GoldenHourMemoriesModal.viewHistoryTooltip",defaultMessage:"View saved memories history"},viewingSnapshot:{id:"GoldenHourMemoriesModal.viewingSnapshot",defaultMessage:"Viewing snapshot from {date}"},searchPlaceholder:{id:"GoldenHourMemoriesModal.searchPlaceholder",defaultMessage:"Search memories"},searchNoResults:{id:"GoldenHourMemoriesModal.searchNoResults",defaultMessage:'No results found for "{query}"'},sortAria:{id:"GoldenHourMemoriesModal.sortAria",defaultMessage:"Sort"},sortHeader:{id:"GoldenHourMemoriesModal.sortHeader",defaultMessage:"Sort"},newestFirst:{id:"GoldenHourMemoriesModal.newestFirst",defaultMessage:"Newest first"},oldestFirst:{id:"GoldenHourMemoriesModal.oldestFirst",defaultMessage:"Oldest first"},moreOptionsAria:{id:"GoldenHourMemoriesModal.moreOptionsAria",defaultMessage:"More options"},viewHistory:{id:"GoldenHourMemoriesModal.viewHistory",defaultMessage:"View history"},deleteAllMemories:{id:"GoldenHourMemoriesModal.deleteAllMemories",defaultMessage:"Delete all memories"},deleteAllConfirmTitle:{id:"GoldenHourMemoriesModal.deleteAllConfirmTitle",defaultMessage:"Delete all memories?"},deleteAllConfirmCta:{id:"GoldenHourMemoriesModal.deleteAllConfirmCta",defaultMessage:"Delete all"},deleteAllConfirmDescription:{id:"GoldenHourMemoriesModal.deleteAllConfirmDescription",defaultMessage:"{name} may not remember this information going forward. To fully remove this information from memory, also delete any related chats. <link>Learn more</link>"},deleteAllConfirmDescriptionUpdated:{id:"GoldenHourMemoriesModal.deleteAllConfirmDescriptionUpdated",defaultMessage:"{name} may not remember this information going forward. To fully remove this information from memory, also delete any related chats. <link>Learn more</link>"},alsoDeletePastVersions:{id:"GoldenHourMemoriesModal.alsoDeletePastVersions",defaultMessage:"Also delete all past versions of saved memories. This cannot be undone."}});function xs({description:t,onClose:s,onConfirm:r}){const o=ne();return e.jsx(we,{testId:"modal-confirm-reset-memory",isOpen:!0,onClose:s,type:"success",title:o.formatMessage({id:"MemoriesModal.resetModalTitle",defaultMessage:"Are you sure?"}),description:t,primaryButton:e.jsx(is.Button,{title:o.formatMessage({id:"MemoriesModal.resetModalConfirm",defaultMessage:"Clear memory"}),color:"danger",onClick:r,"data-testid":"confirm-reset-memories-button"}),secondaryButton:e.jsx(is.Button,{title:o.formatMessage({id:"MemoriesModal.resetModalCancel",defaultMessage:"Cancel"}),color:"secondary",onClick:s})})}function It(t){"use forget";const s=Ps.c(19),{onReset:r,gizmoId:o,memoryName:a,contextScopes:d,requiredContextScopes:c}=t,[i,N]=m.useState(!1),p=ne(),E=be(),v=_s();let D;s[0]!==d||s[1]!==o||s[2]!==p||s[3]!==r||s[4]!==c||s[5]!==E?(D=async()=>{V.logEvent("Memory Manage Reset Button Confirmed");try{const u={context_scopes:d,required_context_scopes:c};o&&(u.gizmo_id=o),await ee.safeDelete("/settings/clear_account_user_memory",{requestBody:u}),E.success(p.formatMessage({id:"ResetMemoriesButton.resetSuccess",defaultMessage:"Memory cleared."})),r&&r(),N(!1)}catch(u){E.danger(qs({id:"ResetMemoriesButton.resetFailed",defaultMessage:"Failed to clear memory."}),{toastId:"reset_memories_button_reset_failed"})}},s[0]=d,s[1]=o,s[2]=p,s[3]=r,s[4]=c,s[5]=E,s[6]=D):D=s[6];const b=D;let _;s[7]===Symbol.for("react.memo_cache_sentinel")?(_=()=>{V.logEvent("Memory Manage Reset Button Clicked"),N(!0)},s[7]=_):_=s[7];let j;s[8]!==o?(j=e.jsx(oe,{color:"danger-outline",onClick:_,"data-testid":"reset-memories-button",children:o?e.jsx(n,{id:"ResetMemoriesButton.resetGizmo",defaultMessage:"Clear this GPT's memory"}):e.jsx(n,{id:"ResetMemoriesButton.resetChatGPT",defaultMessage:"Delete all"})}),s[8]=o,s[9]=j):j=s[9];let w;s[10]!==b||s[11]!==v||s[12]!==p||s[13]!==a||s[14]!==i?(w=i&&(v?e.jsx(xs,{description:p.formatMessage({id:"MemoriesModal.resetGizmoModalDescriptionUpdated",defaultMessage:"Deleting your saved memories means {name} may not remember this information going forward. To fully remove this information from {name}'s memory, please delete any related chats. <link>Learn more</link>"},{name:a,link:zt}),onClose:()=>N(!1),onConfirm:b}):e.jsx(xs,{description:p.formatMessage({id:"MemoriesModal.resetGizmoModalDescription",defaultMessage:"{name} will forget everything it has remembered from your chats. This cannot be undone."},{name:a}),onClose:()=>N(!1),onConfirm:b})),s[10]=b,s[11]=v,s[12]=p,s[13]=a,s[14]=i,s[15]=w):w=s[15];let x;return s[16]!==j||s[17]!==w?(x=e.jsxs(e.Fragment,{children:[j,w]}),s[16]=j,s[17]=w,s[18]=x):x=s[18],x}function zt(t){return e.jsx("a",{className:"underline",href:"https://help.openai.com/en/articles/8983136-what-is-memory",children:t})}function Pt({gizmo:t,memory:s}){var x;const r=ne(),o=be(),a=pe(),[d,c]=m.useState(!1),[i,N]=m.useState(s.content),p=m.useRef(null);m.useEffect(()=>{if(d&&p.current){const u=p.current,T=u.value.length;u.focus(),u.setSelectionRange(T,T)}},[d]);const{mutate:E,isPending:v}=Me({mutationFn:async u=>{const{success:T}=await ee.safeDelete("/memories/{memory_id}",{parameters:{path:{memory_id:u}},requestBody:{gizmo_id:t==null?void 0:t.id}});if(!T)throw new Error("An error occurred while deleting the memory")},onSettled:()=>{a.invalidateQueries({queryKey:ce(t==null?void 0:t.id)}),a.invalidateQueries({queryKey:ue()})},onError:()=>{o.danger({id:"MemoriesModal.deleteFailed",defaultMessage:"Failed to forget memory",description:"Toast message when deleting memory fails"},{id:"memoryDeleteFailed",toastId:"memory_delete_failed"})}}),{mutate:D,isPending:b}=Me({mutationFn:async()=>await ee.safePatch("/memories/{memory_id}",{parameters:{path:{memory_id:s.id}},requestBody:{gizmo_id:t==null?void 0:t.id,content:i}}),onSuccess:u=>{const{memory_max_tokens:T,memory_num_tokens:k}=u;a.setQueryData(ce(t==null?void 0:t.id),g=>{if(!g||typeof g!="object")return g;const G=g,q=Math.min(Math.floor(100*k/T),100);return re(R({},G),{memory_max_tokens:T,memory_num_tokens:k,memoryFullPct:q})}),a.invalidateQueries({queryKey:ce(t==null?void 0:t.id)}),a.invalidateQueries({queryKey:ue()}),c(!1)},onError:()=>{o.danger({id:"MemoriesModal.editFailed",defaultMessage:"Failed to update memory",description:"Toast message when editing memory fails"},{id:"memoryEditFailed",toastId:"memory_edit_failed"})}}),[_,j]=m.useState(!1),w=r.formatMessage({id:"N0czuB",defaultMessage:"Remove"});return e.jsxs(e.Fragment,{children:[e.jsx(Z.Row,{disabled:v||b,children:d?e.jsxs(Z.Cell,{colSpan:2,className:"relative pe-0",children:[e.jsx("input",{ref:p,autoFocus:!0,value:i,onChange:u=>N(u.target.value),className:"w-full rounded border-2 border-transparent py-2 pe-36 focus:outline-none",maxLength:500,onKeyDown:u=>{if(!u.nativeEvent.isComposing&&u.key==="Enter"){if(i.trim()===""){V.logEvent("Memory Manage Modal Memory Delete Clicked"),j(!0);return}D()}}}),e.jsxs("div",{className:"absolute end-1 top-1/2 flex -translate-y-1/2 gap-1",children:[e.jsx(oe,{color:"secondary",size:"small",onClick:()=>{N(s.content),c(!1)},children:e.jsx(n,{id:"TTo8Tw",defaultMessage:"Cancel"})}),e.jsx(oe,{size:"small",onClick:()=>{if(i.trim()===""){V.logEvent("Memory Manage Modal Memory Delete Clicked"),j(!0);return}D()},disabled:b,children:e.jsx(n,{id:"mDcKbU",defaultMessage:"Save"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Z.Cell,{className:"pe-0",divClassName:"min-h-[40px] items-center w-full",children:e.jsx("div",{className:"border-2 border-transparent py-2 whitespace-pre-wrap",children:s.content})}),e.jsx(Z.Cell,{textAlign:"right",children:e.jsxs(Z.Actions,{children:[(()=>{const u=r.formatMessage({id:"EditableMemoriesModal.edit",defaultMessage:"Edit"});return e.jsx("button",{onClick:()=>c(!0),"aria-label":u,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(Ie,{label:u,side:"top",className:"leading-none",children:e.jsx(yt,{className:"icon-sm"})})})})(),e.jsx("button",{onClick:()=>{V.logEvent("Memory Manage Modal Memory Delete Clicked"),j(!0)},"aria-label":w,className:"text-token-text-tertiary hover:text-token-text-secondary",children:e.jsx(Ie,{className:"leading-none",label:w,side:"top",children:e.jsx(Pe,{className:"icon-sm"})})})]})})]})}),_&&e.jsx(me,{isOpen:!0,primaryButtonColor:"danger",title:w,confirmText:r.formatMessage({id:"fCn0ar",defaultMessage:"Forget"}),onConfirm:()=>{V.logEvent("Memory Manage Modal Memory Delete Confirmed"),E(s.id),j(!1)},onClose:()=>{j(!1),N(s.content),c(!1)},children:e.jsx(n,{id:"j2cZHW",defaultMessage:'Remove "{title}" from {name}’s saved memories. This can’t be undone. <link>Learn more</link>',values:{name:(x=t==null?void 0:t.name)!=null?x:"ChatGPT",title:e.jsx("strong",{children:Ts(s.content,{length:130,omission:"..."})}),link:u=>e.jsx("a",{href:"https://help.openai.com/en/articles/8590148-memory-faq",target:"_blank",className:"underline",rel:"noreferrer",children:u})}})})]})}function qt({selectedGizmoId:t,onSelect:s,items:r}){const o=r.find(d=>d.id===t);function a(d){var c;return e.jsx(vt,{isFirstParty:d.id===void 0,src:(c=d.iconUrl)!=null?c:null,className:"icon"})}return e.jsx("div",{className:"border-token-border-medium mb-2 inline-flex rounded-md border",children:e.jsxs(y.Root,{children:[e.jsx(y.Trigger,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[o?e.jsxs(e.Fragment,{children:[a(o),e.jsx("span",{className:"text-token-text-primary",children:o.name})]}):e.jsx(n,{id:"MemoriesModal.unknownGizmo",defaultMessage:"Unknown GPT"}),e.jsx(pt,{className:"icon-sm text-token-text-tertiary"})]})}),e.jsx(y.Portal,{children:e.jsx(y.Content,{children:r.map(d=>e.jsxs(y.Item,{className:"flex items-center gap-3",onClick:()=>{s(d.id)},children:[a(d),d.name]},d.id))})})]})})}var Ms;const Ue=bs.div(Ms||(Ms=Re(["flex h-full items-center justify-center pb-8 text-sm text-token-text-tertiary rounded-lg border border-token-border-default"])));function er({onClose:t,initialGizmoId:s,contextScopes:r,requiredContextScopes:o}){var q,h,B;const a=ne(),d=pe(),c=Ns(),[i,N]=m.useState(s),p=je(),E=ys(),v=vs(p),D=v==null?void 0:v.hasPlusFeatures();m.useEffect(()=>{V.logEvent("Memory Modal Shown")},[]);const{data:b,isLoading:_,isError:j,refetch:w}=Ss(i,!0,c,r,o),x=b==null?void 0:b.memories,{data:u,refetch:T}=ps({queryKey:["memory_gizmos"],queryFn:()=>ee.safeGet("/memories/gizmos"),refetchOnMount:"always"}),k=[{id:void 0,name:"ChatGPT",iconUrl:null},...(q=u==null?void 0:u.items.map(({gizmo:A})=>{var W;return{id:A.id,name:A.display.name,iconUrl:(W=A.display.profile_picture_url)!=null?W:null}}))!=null?q:[]],g=k.find(A=>A.id===i);m.useEffect(()=>{!_&&!j&&i!==void 0&&(!x||x.length===0)&&N(void 0)},[_,j,x,i]);let G;return _?G=e.jsx(Ue,{children:e.jsx(n,{id:"MemoriesModal.loading",defaultMessage:"Loading..."})}):j?G=e.jsx(Ue,{children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"mb-4 text-red-500",children:e.jsx(n,{id:"MemoriesModal.somethingWentWrong",defaultMessage:"Something went wrong..."})}),e.jsx("div",{children:e.jsx(oe,{color:"secondary",onClick:()=>{w()},children:e.jsx(n,{id:"MemoriesModal.retry",defaultMessage:"Retry"})})})]})}):!x||x.length===0?G=e.jsx(Ue,{children:e.jsx("div",{className:"max-w-sm text-center",children:c?e.jsx(n,{id:"MemoriesModal.noMemories.1",defaultMessage:"As you chat with {name}, the details and preferences it saves will be shown here.",values:{name:(h=g==null?void 0:g.name)!=null?h:"ChatGPT"}}):e.jsx(n,{id:"MemoriesModal.noMemoriesAndDisabled",defaultMessage:"Memory is disabled. ChatGPT won't use or save memories."})})}):G=e.jsx(Z.Root,{className:"border-token-border-default h-full",size:"compact",bordered:!0,children:e.jsx(Z.Body,{children:x.map(A=>e.jsx(Pt,{gizmo:g?{id:g.id,name:g.name}:void 0,memory:A},A.id))})}),e.jsxs(we,{testId:"modal-memories",isOpen:!0,onClose:t,size:"custom",className:"max-w-5xl",type:"success",title:a.formatMessage({id:"MemoriesModal.title",defaultMessage:"Saved memories"}),showCloseButton:!0,children:[D&&k.length>1&&e.jsx("div",{className:"mb-4",children:e.jsx(qt,{selectedGizmoId:i,items:k,onSelect:A=>{d.invalidateQueries({queryKey:ce(A)}),d.invalidateQueries({queryKey:ue()}),N(A)}})}),e.jsx(Ut,{memoryFullPct:b==null?void 0:b.memoryFullPct,className:"mb-5",showUpgradeCTA:!1,isPaid:D,onUpgrade:()=>{V.logEventWithStatsig("Memories Upgrade Button Clicked","chatgpt_memories_upgrade_button_clicked_settings"),Rs(E,"chatgpt_memories_upgrade_button")}}),e.jsx("div",{className:"h-[24rem]",children:G}),e.jsx("div",{className:"mt-5 flex justify-end",children:e.jsx(It,{onReset:()=>{w(),T(),i&&N(void 0)},gizmoId:i,memoryName:(B=g==null?void 0:g.name)!=null?B:"ChatGPT",contextScopes:r,requiredContextScopes:o})})]})}export{er as E,Zt as G,Ut as M,It as R,Xt as a,Gt as b,Ts as t};
//# sourceMappingURL=exbyaee45o0onuld.js.map
