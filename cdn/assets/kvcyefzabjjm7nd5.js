const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ose6175gtasqnfv0.js","assets/fg33krlcm0qyi6yw.js","assets/mtk1qztvnb31pw5r.js","assets/root-mcq3deyb.css","assets/o51gjyxad96i2yey.js","assets/cv3wsu6uenrjij6h.js","assets/k65njl5wlgspihfr.js","assets/conversation-small-332fs9rk.css"])))=>i.map(i=>d[i]);
var q=Object.freeze,H=Object.defineProperty,xe=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var G=(s,n,t)=>n in s?H(s,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[n]=t,se=(s,n)=>{for(var t in n||(n={}))Z.call(n,t)&&G(s,t,n[t]);if(y)for(var t of y(n))ee.call(n,t)&&G(s,t,n[t]);return s},ne=(s,n)=>xe(s,pe(n));var te=(s,n)=>{var t={};for(var l in s)Z.call(s,l)&&n.indexOf(l)<0&&(t[l]=s[l]);if(s!=null&&y)for(var l of y(s))n.indexOf(l)<0&&ee.call(s,l)&&(t[l]=s[l]);return t};var oe=(s,n)=>q(H(s,"raw",{value:q(n||s.slice())}));import{j as e,r as g,_ as ue}from"./fg33krlcm0qyi6yw.js";import{C as fe,pt as he,pu as je,pw as w,a9 as ge,aY as _e,pv as N,l as E,bh as be,F as ve,m as Ce,hv as we,d as le,bL as Ne,b as ke,gO as ye,bT as Se}from"./mtk1qztvnb31pw5r.js";import{fu as Le,gj as Oe,b2 as Me}from"./k65njl5wlgspihfr.js";import{u as De,D as Ee}from"./ljjw8ggxidsk78ay.js";import{u as Fe,U as Pe,a as ae}from"./i1mqwoffqueglpnh.js";import{s as $e}from"./o51gjyxad96i2yey.js";import{C as O}from"./nv4rm7lkosu65gch.js";import{E as M}from"./h5lbwoaovb563r4k.js";import"./f2sn8zvpzei2915e.js";import"./kfdkis1zwf4ccfgg.js";import"./ol9d5wxhynx9q2is.js";import"./mbmcx8v24u1ao1ke.js";import"./coc2775l3yj92qmf.js";import"./nstpv5pwzyae0b4r.js";import"./jkdx73dfg7n0gxrn.js";import"./m3nchqrpfl8vs80b.js";import"./ieglwgr2zyuektzv.js";const Te=be(()=>ue(()=>import("./ose6175gtasqnfv0.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(s=>s.JsonViewer));function as({threadId:s,threadUserId:n}){return Fe(Pe.isDebugModalOpen)&&e.jsx(fe,{testId:"modal-sonic-debug",isOpen:!0,onClose:()=>ae.toggleDebugModalOpen(),type:"success",size:"fullscreen",noPadding:!0,rootClassName:"z-50",children:e.jsx(Ve,{threadId:s,threadUserId:n!=null?n:void 0,onClose:()=>ae.toggleDebugModalOpen()})})}const Ae=(s,n)=>{const t=JSON.stringify(n,null,2),l=new Blob([t],{type:"application/json"}),a=window.URL.createObjectURL(l),c=document.createElement("a");c.href=a,c.download=s,c.click(),window.URL.revokeObjectURL(a)},re="<|im_start|>",ce="<|im_sep|>",ie="<|im_end|>",ze="<|fim_suffix|>",Re="<|meta_sep|>";function de({prompt:s}){const[n,t]=g.useState({}),l=[],a=[];let c=0;for(;;){const r=s.indexOf(re,c);if(r===-1)break;const i=s.indexOf(ce,r);if(i===-1)break;let o=s.indexOf(ie,i);const m=s.indexOf(ze,i);if(m!==-1&&(o===-1||m<o)&&(o=m),o===-1)break;const d=s.substring(r+re.length,i).replace(Re," channel="),u=s.substring(i+ce.length,o);a.push(r);const k=n[r];l.push(e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>t(_=>ne(se({},_),{[r]:!_[r]})),children:k?e.jsx(M,{size:14}):e.jsx(O,{size:14})}),e.jsxs("span",{className:"font-semibold",children:["[",d,"]"]})]}),e.jsx("div",{className:E("whitespace-pre-wrap",k&&"line-clamp-2 truncate"),children:u})]},r)),c=o+ie.length}function p(r){const i={};for(const o of a)i[o]=r;t(i)}return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"absolute end-0 top-0 flex items-center gap-2 text-xs font-semibold",children:[e.jsxs("button",{className:"flex items-center gap-1 underline",onClick:()=>p(!0),children:[e.jsx(O,{size:14})," Collapse All"]}),"/",e.jsxs("button",{className:"flex items-center gap-1 underline",onClick:()=>p(!1),children:[e.jsx(M,{size:14})," Expand All"]})]}),e.jsx("div",{className:"flex flex-col gap-3",children:l})]})}var me;const j=ve.div(me||(me=oe(["mb-[-5px] pb-0.5 font-semibold uppercase border-b-2 ",""])),({$isSelected:s})=>s?"border-black dark:border-white":"border-transparent");function Ve({threadId:s,threadUserId:n,message:t,onClose:l}){var P,$,T,A,z,R,V,I,J,U,B;const[a,c]=g.useState(t?"message":"json"),{data:p,isLoading:r,refetch:i}=De({threadId:s,threadUserId:n,refetchOnMount:"always"}),o=p==null?void 0:p.thread;if(g.useEffect(()=>{c(t?"message":o!=null&&o.turns.length?"turn".concat((o==null?void 0:o.turns.length)-1):"thread")},[o==null?void 0:o.turns.length,t]),!r&&!o&&!t)return e.jsxs(Ee,{onClickRetry:()=>i(),children:["Failed to load."," "]});if(r)return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:"Loading..."});const m=o==null?void 0:o.turns,d=o==null?void 0:o.turns[o.turns.length-1],u=($=(P=d==null?void 0:d.artifacts__)==null?void 0:P.model_snapshots)==null?void 0:$.default_id,k=(R=(z=(A=(T=d==null?void 0:d.artifacts__)==null?void 0:T.settings)==null?void 0:A.model_response)==null?void 0:z.completion_model)==null?void 0:R.model,_=u!=null?u:k,S=(V=d==null?void 0:d.artifacts__)==null?void 0:V.eval_preset,F=n&&s?Oe(n,s):null,b=(U=(J=(I=t==null?void 0:t.metadata)==null?void 0:I.__internal)==null?void 0:J.debug)==null?void 0:U.render_for_completion_result_decoded;return e.jsx("div",{className:"flex flex-col gap-2 font-mono text-xs break-words",children:e.jsxs(he,{orientation:"vertical",value:a,onValueChange:f=>c(f),children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs(je,{className:"flex items-center justify-start gap-3 p-2",children:[t&&e.jsx(w,{value:"message",children:e.jsx(j,{$isSelected:a==="message",children:"Message"})},"message"),b&&e.jsx(w,{value:"render_for_completion",children:e.jsx(j,{$isSelected:a==="render_for_completion",children:"Prompt"})},"render_for_completion"),o&&e.jsx(w,{value:"thread",children:e.jsx(j,{$isSelected:a==="thread",children:"Thread"})},"thread"),e.jsx(w,{value:"connectors",children:e.jsx(j,{$isSelected:a==="connectors",children:"Connectors"})},"connectors"),m==null?void 0:m.map((f,x)=>{var h,v;return e.jsxs(g.Fragment,{children:[e.jsx(w,{value:"turn".concat(x),children:e.jsxs(j,{$isSelected:a==="turn".concat(x),children:["Turn[",x,"]"]})},x),(v=(h=f.artifacts__)==null?void 0:h.debug_ddtrace_urls)==null?void 0:v.map(C=>e.jsx(j,{$isSelected:!1,children:e.jsxs("a",{target:"_blank",href:C,className:"text-nowrap",rel:"noreferrer",children:["Trace[",x,"] â†—"]})},C))]},x)})]}),e.jsxs("div",{className:"flex items-center justify-end",children:[o&&e.jsxs(ge,{size:"small",color:"secondary",onClick:()=>Ae("thread.json",o),children:[e.jsx(Le,{className:"icon-sm"})," thread.json"]}),e.jsx(_e,{onClick:l})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-2",children:[_&&e.jsxs(e.Fragment,{children:[e.jsx(L,{name:"Model",id:_,className:"shrink-0"})," ",e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),S&&S!=="production"&&e.jsxs(e.Fragment,{children:[e.jsx(L,{name:"Eval Preset",id:S,className:"shrink-0"}),e.jsx("span",{className:"text-gray-500 dark:text-white",children:"|"})]}),F&&e.jsx(e.Fragment,{children:e.jsx(L,{name:"Permalink",id:F,className:"flex-shrink-1"})})]}),m==null?void 0:m.map((f,x)=>{var v,C,K,Q,W,X,Y;const h=(v=f.model_response)==null?void 0:v.text;return e.jsxs(N,{value:"turn".concat(x),className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth",children:[e.jsxs("div",{className:E("flex flex-col gap-2 p-2",((C=f.index)!=null?C:0)%2===1&&"bg-token-main-surface-secondary"),children:[e.jsx(de,{prompt:(X=(W=(Q=(K=f.artifacts__)==null?void 0:K.debug_info)==null?void 0:Q.main_model_response)==null?void 0:W.prompt_string)!=null?X:""}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"[assistant]"}),e.jsx("div",{"data-testid":"assistant-response",className:"whitespace-pre-wrap",children:(Y=$e(h!=null?h:""))!=null?Y:h})]})]})," "]},x)}),o&&e.jsx(N,{value:"thread",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(D,{data:o,collapsed:4,jsonFiltersKey:"thread"})}),t&&e.jsx(N,{value:"message",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(D,{data:t,collapsed:4,jsonFiltersKey:"message"})}),b&&e.jsx(N,{value:"render_for_completion",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(de,{prompt:b!=null?b:""})}),e.jsx(N,{value:"connectors",className:"max-h-[calc(100vh-46px)] w-full overflow-y-scroll scroll-smooth p-2",children:e.jsx(Ie,{})})]},(B=o==null?void 0:o.turns.length)!=null?B:"message")})}function D({data:s,collapsed:n,jsonFiltersKey:t}){const[l,a]=g.useState(n!=null?n:!0);return e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[e.jsx("button",{onClick:()=>a(!l),className:"flex items-center gap-1",children:l?e.jsxs(e.Fragment,{children:[e.jsx(M,{size:14})," Expand all"]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{size:14})," Collapse all"]})}),e.jsx("div",{className:"w-full",children:e.jsx(Te,{jsonFiltersKey:t,json:s,jsonViewProps:{collapsed:l,shortenTextAfterLength:0}},String(l))})]})}function Ie(){const s=ke(),n=le(()=>Ne(s)),t=n===void 0,{data:l,isLoading:a}=le(()=>ye(s)),{connectorLinks:c,isLoading:p}=Se({fetchValidLinksOnly:!0});if(t||a||p)return e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:"Loading connectors..."});const r=n.map(i=>{const u=i,{logo_url:o,logo_url_dark:m}=u;return te(u,["logo_url","logo_url_dark"])});return e.jsx(D,{data:{availableConnectors:r,syncConnectors:l,accessConnectors:c},collapsed:2,jsonFiltersKey:"connectors"})}function L({name:s,id:n,className:t}){const l=Ce(),a=g.useCallback(c=>{we(n,l,c)},[n,l]);return e.jsxs("div",{className:E("flex items-center gap-2 truncate",t),children:[e.jsxs("span",{className:"font-semibold text-nowrap",children:[s,":"]}),e.jsx("span",{title:n,className:"truncate text-gray-500 dark:text-white",children:n}),e.jsx(Me,{onCopy:a})]})}export{D as DebugJsonViewer,as as DebugModal,Ve as DebugModalContents};
//# sourceMappingURL=kvcyefzabjjm7nd5.js.map
