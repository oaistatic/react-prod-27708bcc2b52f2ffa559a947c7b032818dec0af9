import{c as je,j as a,M as Ie,e as Re,r as fe}from"./fg33krlcm0qyi6yw.js";import{b7 as Me,g9 as _e,fD as Ee,a9 as Be,eg as He,h as Ae,o as Oe,b as Fe,d as Pe,fN as qe,aX as ye,l as Le,P as Ve,e2 as De,kw as We,kx as ze,km as Ue,aK as we,fZ as Xe,hg as Ge,dF as Je}from"./mtk1qztvnb31pw5r.js";import{A as Ke}from"./cnrdqaihcmlb57i1.js";import{B as Ce,M as Ye,g as Ze,a as Qe,b as et,c as tt}from"./gns80bg8nlx0ty1m.js";import{bN as Te,bA as me,jb as st,aC as nt,jc as at,jd as it,g1 as ot}from"./k65njl5wlgspihfr.js";import"./u9jpwxvw30u3h6nc.js";import"./kx34yg3blv92o8xp.js";function lt(m){"use forget";const e=je.c(29),{conversation:s,businesses:f,additionalBusinesses:i,selectedBusinessId:c,onClick:t,onHover:p,trackContentReferenceEvent:h}=m;let w,C,b,g,y,j;if(e[0]!==i||e[1]!==f||e[2]!==s||e[3]!==t||e[4]!==p||e[5]!==c||e[6]!==h){let r;e[13]!==s?(r=()=>{var l;return((l=Te(s))==null?void 0:l.type)==="entity"},e[13]=s,e[14]=r):r=e[14];const x=Me(r),B=()=>{x()||p(null)},N=l=>{x()||p(l)};j="mb-3 h-full w-full overflow-y-auto pb-3",w="list",C="ms-2 me-1 divide-y pb-4",b=f.map((l,v)=>a.jsx("div",{onClick:()=>t(l),className:"cursor-pointer",children:a.jsx(Ce,{isSelected:l.entity_data.id===c,idx:v,business:l.entity_data,trackContentReferenceEvent:h,enableSidebarNavigation:!1,imageClassName:"h-16 w-16",onHoverEnter:()=>N(l.entity_data.id),onHoverLeave:B})},l.entity_data.id)),e[15]!==i?(g=i&&i.length>0&&a.jsx("div",{className:"ms-2 mt-4 border-b-0 text-base font-medium",children:a.jsx(Ie,{id:"55oJaX",defaultMessage:"More places"})}),e[15]=i,e[16]=g):g=e[16],y=i==null?void 0:i.map((l,v)=>a.jsx("div",{onClick:()=>t(l),className:"cursor-pointer",children:a.jsx(Ce,{isSelected:l.entity_data.id===c,idx:v,business:l.entity_data,trackContentReferenceEvent:h,enableSidebarNavigation:!1,imageClassName:"h-16 w-16",onHoverEnter:()=>N(l.entity_data.id),onHoverLeave:B})},l.entity_data.id)),e[0]=i,e[1]=f,e[2]=s,e[3]=t,e[4]=p,e[5]=c,e[6]=h,e[7]=w,e[8]=C,e[9]=b,e[10]=g,e[11]=y,e[12]=j}else w=e[7],C=e[8],b=e[9],g=e[10],y=e[11],j=e[12];let _;e[17]!==w||e[18]!==C||e[19]!==b||e[20]!==g||e[21]!==y?(_=a.jsxs("div",{role:w,className:C,children:[b,g,y]}),e[17]=w,e[18]=C,e[19]=b,e[20]=g,e[21]=y,e[22]=_):_=e[22];let d;e[23]!==s?(d=a.jsx("div",{className:"mx-5",children:a.jsx(rt,{conversation:s})}),e[23]=s,e[24]=d):d=e[24];let o;return e[25]!==j||e[26]!==_||e[27]!==d?(o=a.jsxs("div",{className:j,children:[_,d]}),e[25]=j,e[26]=_,e[27]=d,e[28]=o):o=e[28],o}const rt=m=>{"use forget";const e=je.c(8),{conversation:s}=m,f=Re();let i;e[0]!==f?(i=f.formatMessage({id:"Fev2Lu",defaultMessage:"Show more places"}),e[0]=f,e[1]=i):i=e[1];const c=i;let t;e[2]!==s||e[3]!==c?(t=()=>{const h=me(s).currentViewState$();!s||!h||(_e(()=>{me(s).setAdditionalBusinessesMergeMode$("append"),me(s).setHasRequestedNewData$(!0)}),st({conversation:s,promptMessage:Ee(c),eventSource:"mouse",extraStreamParams:{preRetrievalSettings:{use_last_turn_query:!0,top_n:20,query_type:"local_business",query:{latitude:h.latitude,longitude:h.longitude,radius_meters:h.radiusMeters}}}}))},e[2]=s,e[3]=c,e[4]=t):t=e[4];let p;return e[5]!==c||e[6]!==t?(p=a.jsx(Be,{type:"button",color:"secondary",size:"medium",fullWidth:!0,className:"bg-token-action-secondary text-token-text-primary mt-2 justify-center",contentWrapperClassName:"font-semibold ",onClick:t,children:c}),e[5]=c,e[6]=t,e[7]=p):p=e[7],p},wt=He(()=>Ae(void 0));function Ct(m){"use forget";const e=je.c(96),{conversation:s}=m,[f,i]=fe.useState(null);let c;e[0]!==s?(c=me(s),e[0]=s,e[1]=c):c=e[1];const t=c,p=Fe(),{openThreadSidebar:h,closeThreadSidebar:w}=nt(),{resetSidebarHistory:C}=at();let b;e[2]!==p?(b=Oe(p,"1950533395"),e[2]=p,e[3]=b):b=e[3];const g=b;let y;e[4]!==s?(y=Me(()=>{var n;return((n=Te(s))==null?void 0:n.type)==="entity"}),e[4]=s,e[5]=y):y=e[5];const j=y;let _;e[6]!==t?(_=()=>({businesses:t.businesses$(),additionalBusinesses:t.additionalBusinesses$(),messageId:t.currentMessageId$(),isOpen:t.isOpen$(),initialViewState:t.initialViewState$(),turnIndex:t.turnIndex$()}),e[6]=t,e[7]=_):_=e[7];const{businesses:d,additionalBusinesses:o,messageId:r,isOpen:x,initialViewState:B,turnIndex:N}=Pe(_),[l]=qe(s.id,ht),v=l.length-1,$=l[v];let T;e[8]!==d?(T=d!=null?d:[],e[8]=d,e[9]=T):T=e[9];let R;e[10]!==o?(R=o!=null?o:[],e[10]=o,e[11]=R):R=e[11];let G;e[12]!==T||e[13]!==R?(G=[...T,...R],e[12]=T,e[13]=R,e[14]=G):G=e[14];const k=G,pe=k.length;let J;e[15]!==t?(J=n=>{t.setTurnIndex$(n),t.setAdditionalBusinessesMergeMode$("replace"),t.setHasRequestedNewData$(!1)},e[15]=t,e[16]=J):J=e[16];const E=ye(J);let K,Y;e[17]!==k||e[18]!==x||e[19]!==$||e[20]!==v||e[21]!==t||e[22]!==o||e[23]!==N||e[24]!==E?(Y=()=>{var ce,de,ue;if(!x||!t.hasRequestedNewData$()||!k||v<=N||!$||!$.messages||$.messages.length===0)return;const n=(ce=$.messages)==null?void 0:ce[$.messages.length-1],I=(ue=(de=n.metadata)==null?void 0:de.content_references)==null?void 0:ue.find(pt);if(I){const{businesses:Ne,additionalBusinesses:be}=Ze(I);_e(()=>{var $e,ke;t.setOverlayState$({messageId:n==null?void 0:n.id,contentReferenceStartIndex:(ke=($e=n==null?void 0:n.metadata)==null?void 0:$e.content_references)==null?void 0:ke[0].start_idx,businesses:Ne,additionalBusinesses:be,turnIndex:v}),E(v)});return}const u=$.messages.map(mt).find(ft);if(u&&u.length>0&&_e(()=>{if(t.additionalBusinessesMergeMode$()==="append"){const be=Qe(k,u);t.setAdditionalBusinesses$([...o!=null?o:[],...be])}else t.setBusinesses$(u),t.setAdditionalBusinesses$([]);E(v)}),n&&n.author.role===De.Assistant&&n.recipient==="all"&&We(n)===ze.Text&&Ue(n)&&n.status==="finished_successfully"){E(v);return}},K=[v,N,o,t,k,$,x,E],e[17]=k,e[18]=x,e[19]=$,e[20]=v,e[21]=t,e[22]=o,e[23]=N,e[24]=E,e[25]=K,e[26]=Y):(K=e[25],Y=e[26]),fe.useEffect(Y,K);const he=r!=null?r:"";let Z;e[27]!==s.id||e[28]!==N||e[29]!==he?(Z={clientThreadId:s.id,messageId:he,turnIndex:N},e[27]=s.id,e[28]=N,e[29]=he,e[30]=Z):Z=e[30];const H=it(Z);let Q;e[31]===Symbol.for("react.memo_cache_sentinel")?(Q=[],e[31]=Q):Q=e[31],fe.useEffect(ut,Q);let ee;e[32]!==w||e[33]!==t?(ee=()=>{we.disableStageSidebarAnimation(),w(),ot({forceFlushSync:!0,className:"map-with-entities",update:()=>{t.wasSidebarOpen$()&&we.setSidebarOpen(!0),t.close$()}}).finished.then(dt)},e[32]=w,e[33]=t,e[34]=ee):ee=e[34];const M=ye(ee);let te,se;e[35]!==M?(te=()=>Xe(window,{keydown:n=>{n.key==="Escape"&&M()}}),se=[M],e[35]=M,e[36]=te,e[37]=se):(te=e[36],se=e[37]),fe.useEffect(te,se);let ne;e[38]!==s.id||e[39]!==h||e[40]!==t||e[41]!==r||e[42]!==C?(ne=n=>{var I,u;s.id&&(C(),h({type:"entity",debugThreadId:void 0,messageId:r!=null?r:"",contentReferenceStartIndex:(I=t.contentReferenceStartIndex$())!=null?I:0,query:n.entity_data.name,category:"local_business",extraParams:(u=n.extra_params)!=null?u:void 0}))},e[38]=s.id,e[39]=h,e[40]=t,e[41]=r,e[42]=C,e[43]=ne):ne=e[43];const S=ne;let ae;e[44]!==t?(ae=n=>{t.setViewState$({viewState:n})},e[44]=t,e[45]=ae):ae=e[45];const ge=ye(ae);if(!d||!r)return null;let A;e[46]!==x?(A=x&&a.jsx("div",{className:"bg-token-bg-primary fixed inset-0 z-21"}),e[46]=x,e[47]=A):A=e[47];const xe=!x&&"pointer-events-none -translate-x-[200vw] opacity-0";let O;e[48]!==xe?(O=Le("fixed inset-0 z-21 flex flex-col overflow-hidden",xe),e[48]=xe,e[49]=O):O=e[49];const ve=!x;let ie;e[50]===Symbol.for("react.memo_cache_sentinel")?(ie=a.jsx(Ke,{className:"icon"}),e[50]=ie):ie=e[50];let F;e[51]!==pe?(F=a.jsx(Ie,{id:"1qCrIY",defaultMessage:"{count} Places",values:{count:pe}}),e[51]=pe,e[52]=F):F=e[52];let P;e[53]!==M||e[54]!==F?(P=a.jsxs(Be,{color:"ghost",className:"my-2.5 ms-2 rounded-lg",contentWrapperClassName:"flex items-center gap-2 text-[18px] font-normal",onClick:M,children:[ie,F]}),e[53]=M,e[54]=F,e[55]=P):P=e[55];let q;e[56]!==S?(q=n=>{i(n.entity_data.id),S==null||S(n)},e[56]=S,e[57]=q):q=e[57];let oe;e[58]===Symbol.for("react.memo_cache_sentinel")?(oe=n=>{i(n)},e[58]=oe):oe=e[58];let L;e[59]!==s||e[60]!==H||e[61]!==o||e[62]!==d||e[63]!==f||e[64]!==q?(L=a.jsx(lt,{conversation:s,businesses:d,additionalBusinesses:o,selectedBusinessId:f,onClick:q,onHover:oe,trackContentReferenceEvent:H}),e[59]=s,e[60]=H,e[61]=o,e[62]=d,e[63]=f,e[64]=q,e[65]=L):L=e[65];let V;e[66]!==P||e[67]!==L?(V=a.jsxs("div",{className:"flex h-full w-[25vw] max-w-[400px] min-w-[300px] flex-col items-start",id:"business-list-container",children:[P,L]}),e[66]=P,e[67]=L,e[68]=V):V=e[68];const Se=x?"[view-transition-name:map-with-entities]":void 0;let D;e[69]!==j||e[70]!==g||e[71]!==S?(D=n=>{const{idx:I,business:u,isSelected:ce,isVisible:de}=n;return a.jsx(et,{idx:I,business:u.entity_data,isSelected:ce,isOpen:!1,isVisible:de,tooltipLocation:"top",tooltipContent:a.jsx(Ce,{idx:I,business:u.entity_data,trackContentReferenceEvent:ct,onOpenEntity:()=>{i(u.entity_data.id),S==null||S(u)},enableSidebarNavigation:g,showActions:!0}),onOpenChange:ue=>{j()||i(ue?u.entity_data.id:null)},isSonicSidebarEnabled:g,onClick:()=>{i(u.entity_data.id),S==null||S(u)}},u.entity_data.id)},e[69]=j,e[70]=g,e[71]=S,e[72]=D):D=e[72];let W;e[73]!==k||e[74]!==s.id||e[75]!==ge||e[76]!==H||e[77]!==B||e[78]!==r||e[79]!==f||e[80]!==Se||e[81]!==D?(W=a.jsx("div",{className:"flex-1 overflow-hidden p-3",children:a.jsx(Ye,{businesses:k,clientThreadId:s.id,messageId:r,trackContentReferenceEvent:H,isFullScreen:!0,containerClassName:Se,selectedBusinessId:f,initialViewState:B,onMoveCallback:ge,markerComponent:D})}),e[73]=k,e[74]=s.id,e[75]=ge,e[76]=H,e[77]=B,e[78]=r,e[79]=f,e[80]=Se,e[81]=D,e[82]=W):W=e[82];let z;e[83]!==V||e[84]!==W?(z=a.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[V,W]}),e[83]=V,e[84]=W,e[85]=z):z=e[85];let le;e[86]===Symbol.for("react.memo_cache_sentinel")?(le=a.jsx("div",{className:"h-24"}),e[86]=le):le=e[86];let U;e[87]!==z?(U=a.jsxs(Ge,{children:[z,le]}),e[87]=z,e[88]=U):U=e[88];let X;e[89]!==O||e[90]!==ve||e[91]!==U?(X=a.jsx("div",{className:O,"aria-hidden":ve,children:U}),e[89]=O,e[90]=ve,e[91]=U,e[92]=X):X=e[92];let re;return e[93]!==A||e[94]!==X?(re=a.jsxs(a.Fragment,{children:[A,X]}),e[93]=A,e[94]=X,e[95]=re):re=e[95],re}function ct(){}function dt(){we.enableStageSidebarAnimation()}function ut(){Ve.logEventWithStatsig("chatgpt_web_places_overlay_shown","chatgpt_web_places_overlay_shown")}function ft(m){return!!m}function mt(m){return tt(m)}function pt(m){return m.type==="map"}function ht(m){return[Je.getConversationTurns(m)]}export{Ct as PlacesOverlay,wt as conversationTurnId$};
//# sourceMappingURL=kxldskfks1uayj6c.js.map
