var ce=Object.defineProperty,de=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var K=(t,s,i)=>s in t?ce(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,b=(t,s)=>{for(var i in s||(s={}))ge.call(s,i)&&K(t,i,s[i]);if(Y)for(var i of Y(s))pe.call(s,i)&&K(t,i,s[i]);return t},P=(t,s)=>de(t,ue(s));import{r as d,j as e,e as Z,a as fe,f as me,M as u}from"./fg33krlcm0qyi6yw.js";import{T as xe,cS as he,n as J,W as ye,m as $,sn as ve,so as Me,sp as je,ku as ke,i8 as z,G as n,sq as Te,sr as Se,v as Ce,aJ as we,o as be,b as D,C as X,a9 as k,ss as ee,st as R,su as L,sv as Pe}from"./mtk1qztvnb31pw5r.js";import{fM as Re,fN as Le,fO as Ie,c$ as Ne}from"./k65njl5wlgspihfr.js";import{S as Be,i as _e,G as Ae,A as Ue,M as qe}from"./hzwjbf9hohqarzkm.js";import"./j41djqzgv0g1dtwh.js";import"./bmppzp3y84hr7irx.js";import"./e4epv5uv3mte9vwk.js";function Ee({gizmo:t,updateGizmo:s,publishedGizmo:i,promoteGizmo:g,appealGizmo:p,setAppealState:f,showActionsModal:y,shareOnly:T,onClose:M}){const[m,j]=d.useState({type:"privacy"});return m.type==="privacy"?e.jsx(Ge,{gizmo:t,updateGizmo:s,publishedGizmo:i,promoteGizmo:g,appealGizmo:p,setAppealState:f,setStep:j,showActionsModal:y,shareOnly:T,onClose:M}):e.jsx(He,{publishedGizmo:m.publishedGizmo,onClose:M})}function Fe(t){return t?n.Workspace:n.Link}function Ge({gizmo:t,publishedGizmo:s,updateGizmo:i,promoteGizmo:g,appealGizmo:p,setAppealState:f,setStep:y,showActionsModal:T,shareOnly:M,onClose:m}){var H,O,Q,V,W;const j=D(),[se,N]=d.useState(!1),B=J(ye.isBusinessWorkspace),o=Z(),x=$(),[r,_]=d.useState(ve(t)?Fe(!!B):t.sharingRecipient),ae=fe(),A=_e(r,t.sharingTargets),{data:S,isLoading:te}=Me(),U=je(),[c,C]=d.useState(s!=null&&s.gizmo.display.categories.length>0?(O=(H=U.data)==null?void 0:H.categories.find(a=>a.id===s.gizmo.display.categories[0]))==null?void 0:O.id:void 0);d.useEffect(()=>{C(s==null?void 0:s.gizmo.display.categories[0])},[s==null?void 0:s.gizmo.display.categories]);const[ie,q]=d.useState(void 0),re=d.useRef(ke((a,l)=>z.generateCategory(a,l),1e3)),v=S!=null&&S.is_verified?void 0:o.formatMessage({id:"qUMu4e",defaultMessage:"To publish your GPTs to the Explore GPTs page, set up your builder profile in the user settings page."});r===n.Marketplace&&v!=null&&!te&&_(n.Link);const ne=B&&!((Q=t.sharingTargets)!=null&&Q.some(a=>a.recipient===n.Link)),F=Te(t,r,c),le=F.includes(Se.MissingPublicActionPrivacyPolicyURL),w=t.tools.find(a=>a.type===Ce.JIT_PLUGIN&&!a.metadata.privacy_policy_url),h=J(a=>a.currentWorkspace),oe=we();d.useEffect(()=>{let a=!0;return(async()=>{try{if(c!=null)return;const l=await re.current(t.name,t.instructions);a&&c==null&&(l?C(l.id):q(!0))}catch(l){a&&c==null&&q(!0)}})(),()=>{a=!1}},[t.instructions,t.name,oe,c]);const G=be(j,"4226692983");return e.jsx(X,{testId:"modal-simple-share-gizmo",type:"success",isOpen:!0,onClose:m,title:e.jsx(u,{id:"9viumf",defaultMessage:"Share GPT"}),showCloseButton:!0,primaryButton:A?e.jsx(k,{color:"primary",disabled:F.length>0,loading:se,onClick:async()=>{try{if(N(!0),M){if(!(s!=null&&s.gizmo.id)){x.danger(o.formatMessage({id:"QYVEx8",defaultMessage:"Error sharing GPT"}),{toastId:"simple_share_gizmo_modal",loggingTitle:"Error sharing GPT",loggingDescription:"Error message when GPT ID is missing (shouldn't happen)"});return}const a=await z.shareGizmo(s.gizmo.id,c?{sharing:R(r,[],L),categories:[c]}:{sharing:R(r,[],L)});a.error?(x.warning(o.formatMessage({id:"tmIKmp",defaultMessage:"Unable to share GPT"})),i({sharingTargets:a.sharing_targets}),f({gizmoId:s.gizmo.id,sharingRecipient:r,categories:s.gizmo.display.categories,moderationType:qe.PublishBlocked,sharingTargets:a.sharing_targets,showModal:Ue.AppealAvailable})):(ae.setQueryData(["gizmo",{gizmoId:s.gizmo.id},{draft:!1}],l=>a.resource),i(l=>P(b({},l),{sharingRecipient:r})),x.success(o.formatMessage({id:"SWSzcY",defaultMessage:"Sharing settings updated"})),m())}else{const a=await g({recipient:r,subjects:R(r,[],L)},c);a?(y({type:"published",publishedGizmo:a}),i(l=>P(b({},l),{id:a.gizmo.id,sharingRecipient:r})),a.gizmo.live_version!=null&&i({liveVersion:a.gizmo.live_version}),x.success(o.formatMessage({id:"R5zko1",defaultMessage:"GPT published"}),{testId:"gpt-published-toast"})):(x.warning(o.formatMessage({id:"uf7WYw",defaultMessage:"Unable to publish GPT"})),m())}}finally{N(!1)}},"data-testid":"save-gizmo-button",children:e.jsx(u,{id:"SW4DG4",defaultMessage:"Save"})}):G?e.jsx(e.Fragment,{children:e.jsx(k,{color:"primary",onClick:async()=>{await p(r,c)},children:e.jsx(u,{id:"bBmLUr",defaultMessage:"Appeal"})})}):null,secondaryButton:s?e.jsx(k,{color:"secondary",onClick:a=>ee(j,s,x,a,o.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"})),children:e.jsx(u,{id:"wvL15a",defaultMessage:"Copy link"})}):null,children:e.jsxs("div",{className:"mx-[-16px] flex flex-col gap-3 text-sm",children:[e.jsx("div",{className:"space-y-1.5",children:e.jsxs(Ie,{value:r,onValueChange:a=>_(a),children:[t.sharingTargets&&t.sharingTargets.map((a,l)=>e.jsx(I,{value:a.recipient,disabled:a.recipient===n.Marketplace&&v!=null,tooltipText:a.recipient===n.Marketplace?v!=null?v:o.formatMessage({id:"0Rcb4e",defaultMessage:"Your GPT will appear in the Explore GPTs page"}):void 0,shareLevel:a.recipient},l)),ne&&e.jsxs(e.Fragment,{children:[e.jsx(I,{value:n.Link,disabled:!0,tooltipText:o.formatMessage(E.workspaceDisabledHint),shareLevel:n.Link,workspaceName:h==null?void 0:h.name}),e.jsx(I,{value:n.Link,disabled:!0,tooltipText:o.formatMessage(E.workspaceDisabledHint),shareLevel:n.Marketplace,workspaceName:h==null?void 0:h.name})]})]})}),le&&e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(u,{id:"/iw1Iv",defaultMessage:"Public actions require valid privacy policy URLs. Click <fixlink>here</fixlink> to update.",values:{fixlink:a=>e.jsx("button",{onClick:()=>{T(w==null?void 0:w.metadata.action_id)},className:"underline",children:a})}})}),r!==n.Private&&e.jsx(Ae,{gizmo:t,category:c,categories:r===n.Marketplace?(W=(V=U.data)==null?void 0:V.categories)!=null?W:[]:void 0,onCategoryChange:r===n.Marketplace?a=>C(a.id):void 0}),r===n.Marketplace&&(ie?e.jsx("div",{className:"text-xs text-red-500",children:e.jsx(u,{id:"tpC3ui",defaultMessage:"There was an error updating the list of categories"})}):null),!A&&G&&e.jsx("div",{className:"text-token-text-secondary flex items-center justify-between text-sm",children:e.jsx(u,{id:"jLCMMV",defaultMessage:"Because this GPT previously may have violated our policies, you will have to submit an appeal to make it available at this level."})})]})})}function He({publishedGizmo:t,onClose:s}){const i=D(),g=Pe(i,t),p=Z(),f=$();return e.jsx(X,{testId:"modal-simple-share-published",type:"success",isOpen:!0,onClose:s,title:e.jsx(u,{id:"rCRRmx",defaultMessage:"Settings Saved"}),showCloseButton:!0,primaryButton:e.jsx(k,{color:"primary",as:"link",to:g,children:e.jsx(u,{id:"lyZz44",defaultMessage:"View GPT"})}),children:e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"bg-token-main-surface-secondary flex gap-1 rounded-sm px-2 py-1",children:[e.jsx("div",{className:"line-clamp-1 break-all text-ellipsis",children:g}),e.jsx("button",{onClick:y=>{ee(i,t,f,y,p.formatMessage({id:"KdDqMm",defaultMessage:"Copied link to clipboard"}))},className:"text-token-text-secondary hover:text-token-text-primary transition","data-testid":"copy-saved-gpt-url-button",children:e.jsx(Ne,{className:"icon-sm"})})]})})})}const E=me({workspaceDisabledHint:{id:"gizmo.workspaceDisabledHint",defaultMessage:"Your workspace administrator has disabled this setting"}});function I({shareLevel:t,workspaceName:s,value:i,disabled:g=!1,tooltipText:p}){const f=d.useId();return e.jsx(xe,{disabled:p==null,label:p,side:"top",triggerAs:null,children:e.jsxs(Re,{id:f,value:i,disabled:g,className:"hover:bg-token-main-surface-secondary flex h-14 w-full cursor-pointer flex-row items-center justify-between gap-2 rounded-md px-3 py-4 font-semibold",children:[e.jsx("label",{htmlFor:f,className:"flex cursor-pointer items-center gap-1",children:e.jsx(Be,{shareLevel:t,workspaceName:s!=null?s:"",hasInviteSharing:!1})}),e.jsx(Le,{children:e.jsx(he,{className:"icon-lg me-1"})})]})})}export{I as ShareLevelRadioOption,Ee as SimpleShareGizmoModal};
//# sourceMappingURL=ibhky4acm3xt6dtm.js.map
