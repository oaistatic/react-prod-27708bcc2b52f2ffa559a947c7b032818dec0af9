var Ve=Object.defineProperty,ze=Object.defineProperties;var Qe=Object.getOwnPropertyDescriptors;var Ae=Object.getOwnPropertySymbols;var Xe=Object.prototype.hasOwnProperty,Ye=Object.prototype.propertyIsEnumerable;var ye=(a,e,t)=>e in a?Ve(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,fe=(a,e)=>{for(var t in e||(e={}))Xe.call(e,t)&&ye(a,t,e[t]);if(Ae)for(var t of Ae(e))Ye.call(e,t)&&ye(a,t,e[t]);return a},_e=(a,e)=>ze(a,Qe(e));import{c as ke,e as Ze,r as x,f as et,v as Te,j as g}from"./fg33krlcm0qyi6yw.js";import{dB as tt,b as st,eF as nt,d as Ce,fN as rt,l3 as ve,a9 as we,dH as Ne,dF as Re,b$ as Fe,bI as ge,e4 as ee,e2 as U,fD as at,eh as ot,eW as it,dL as lt,er as ct,fw as ut,c4 as dt}from"./mtk1qztvnb31pw5r.js";import{no as ft,np as gt,jb as Pe,hn as pt,hp as mt,nq as ht,nr as St,ns as Se,eq as xt,nt as Mt,nu as pe,nv as bt,nw as me,ec as he,il as At,ed as yt}from"./k65njl5wlgspihfr.js";import{g as _t}from"./krwszi9u3lj63i9v.js";function Tt(a){"use forget";const e=ke.c(66),{prompt:t,isComplete:p,clientThreadId:i,parentMessageId:m}=a,f=st();let n;e[0]!==i||e[1]!==f?(n=tt(f,i),e[0]=i,e[1]=f,e[2]=n):n=e[2];const r=n,c=Ze(),[l,B]=x.useState(!1),H=nt();let C;e[3]!==r?(C=()=>it(r).id,e[3]=r,e[4]=C):C=e[4];const M=Ce(C);let u;e[5]!==t?(u=()=>pt(t?[t]:[]),e[5]=t,e[6]=u):u=e[6];const[d,$]=x.useState(u),y=x.useRef(null),_=rt(i,vt),D=Ce(ve.agentSafeModeHasSeenNux$),s=et({startDefault:{id:"auraAgentSuggestion.startDefault",defaultMessage:"Continue"},cancel:{id:"auraAgentSuggestion.cancel",defaultMessage:"No thanks"},accepted:{id:"auraAgentSuggestion.accepted",defaultMessage:"The user has asked for agent to complete their task."}}),q=x.useRef(!1);let S,b;e[7]===Symbol.for("react.memo_cache_sentinel")?(S=()=>(y.current||(y.current=new mt([],o=>{$(o)},!0)),()=>{var o;(o=y.current)==null||o.destroy(),y.current=null}),b=[],e[7]=S,e[8]=b):(S=e[7],b=e[8]),x.useEffect(S,b);let A,v;e[9]!==p||e[10]!==t?(A=()=>{var h;const o=t?[t]:[];o.length===0&&$([]),(h=y.current)==null||h.onMessagePartsUpdated(o,!p)},v=[t,p],e[9]=p,e[10]=t,e[11]=A,e[12]=v):(A=e[11],v=e[12]),x.useEffect(A,v);const[Ee,je]=x.useState(!1);let G;e[13]===Symbol.for("react.memo_cache_sentinel")?(G=()=>{var o,h;je((h=(o=y.current)==null?void 0:o.isComplete())!=null?h:!1)},e[13]=G):G=e[13];let K;e[14]!==d?(K=[d],e[14]=d,e[15]=K):K=e[15],x.useEffect(G,K);let W,J;e[16]!==i||e[17]!==M||e[18]!==_?(W=()=>{if(q.current||!M||_)return;q.current=!0;const o=h=>{lt(i,T=>{T.conduitToken=h,T.prepareState="success"})};ht(i,M,[ge.Agent],o,{isRegen:!1,isOnboardingConversation:!1,delayAfterCompletion:!1})},J=[i,M,_],e[16]=i,e[17]=M,e[18]=_,e[19]=W,e[20]=J):(W=e[19],J=e[20]),x.useEffect(W,J);const te=D===!1,Ie=Ct,Le=()=>c.formatMessage(s.accepted);let V;e[21]!==te?(V=()=>{te&&St(!0)},e[21]=te,e[22]=V):V=e[22];const z=V;let Q;e[23]===Symbol.for("react.memo_cache_sentinel")?(Q={isAgentHintActive:!0},e[23]=Q):Q=e[23];const{agentSessionModeNuxModal:se,ensureAgentSessionModeNux:Oe,isAgentSessionModeNuxOpen:Ue}=ft(Q),xe=async o=>{var be;if(l||!t)return;z();const h=Ne(i),T=h?Re.lastUserMessage(h):null;if(!T){Fe.error("AuraAgentSuggestion: Unable to find last user message",{clientThreadId:i,parentMessageId:m});return}B(!0),H(ge.Agent);const Me=o?Ie(o):void 0,Ge={id:Te(),author:{role:U.Tool,name:Se},create_time:Date.now()/1e3,content:{content_type:ee.Text,parts:[Le()]},recipient:"all",status:"finished_successfully",weight:0},Ke=fe(_e(fe({},(be=T.metadata)!=null?be:{}),{is_visually_hidden_from_conversation:!0}),Me!==void 0&&{n7jupd_local_safe_mode:Me}),We=at("",Ke),Je={systemHints:[ge.Agent],conversationMode:{kind:ot.PrimaryAssistant}};await Pe({conversation:r,promptMessage:We,eventSource:"mouse",prependMessages:[Ge],completionMetadata:Je})};let X;e[24]!==z||e[25]!==r||e[26]!==l?(X=async()=>{if(l)return;z(),B(!0);const o={id:Te(),author:{role:U.Tool,name:Se},create_time:Date.now()/1e3,content:{content_type:ee.Text,parts:["The user has declined to use Agent, answer their question directly"]},recipient:"all",status:"finished_successfully",weight:0};await Pe({conversation:r,promptMessage:o,eventSource:"mouse"})},e[24]=z,e[25]=r,e[26]=l,e[27]=X):X=e[27];const ne=X;if(!t)return null;let Y;e[28]!==d?(Y=gt(d),e[28]=d,e[29]=Y):Y=e[29];const re=Y,ae=c.formatMessage(s.startDefault),oe=()=>{const o=ve.agentSessionMode$();Oe(T=>{xe(T)})||xe(o)},ie=D===!0&&!Ue;let w;e[30]===Symbol.for("react.memo_cache_sentinel")?(w=_t(!1),e[30]=w):w=e[30];const Be="text-token-text-primary mb-2 flex max-w-full flex-col gap-6",le=!p;let P;e[31]!==re||e[32]!==le?(P=g.jsx(xt,{className:"text-token-text-primary text-base leading-6 break-words",isActivelyStreaming:le,children:re}),e[31]=re,e[32]=le,e[33]=P):P=e[33];const De="flex flex-col gap-3 transition-opacity duration-200",ce=Ee?1:0;let k;e[34]!==ce?(k={opacity:ce},e[34]=ce,e[35]=k):k=e[35];const He="flex flex-col gap-2 min-[420px]:flex-row min-[420px]:items-center min-[420px]:justify-end min-[420px]:gap-3",$e="flex flex-col-reverse gap-2 min-[420px]:flex-row min-[420px]:flex-wrap min-[420px]:gap-2",ue=we,qe="secondary",de=c.formatMessage(s.cancel);let N;e[36]!==ue||e[37]!==ne||e[38]!==l||e[39]!==de?(N=g.jsx(ue,{color:qe,onClick:ne,disabled:l,children:de}),e[36]=ue,e[37]=ne,e[38]=l,e[39]=de,e[40]=N):N=e[40];let R;e[41]!==oe||e[42]!==l||e[43]!==ae?(R=g.jsx(we,{color:"primary",onClick:oe,disabled:l,children:ae}),e[41]=oe,e[42]=l,e[43]=ae,e[44]=R):R=e[44];let F;e[45]!==N||e[46]!==R?(F=g.jsxs("div",{className:$e,children:[N,R]}),e[45]=N,e[46]=R,e[47]=F):F=e[47];let E;e[48]!==l||e[49]!==ie?(E=ie?g.jsx(Mt,{disabled:l,showLeadingDivider:!0}):null,e[48]=l,e[49]=ie,e[50]=E):E=e[50];let j;e[51]!==F||e[52]!==E?(j=g.jsxs("div",{className:He,children:[F,E]}),e[51]=F,e[52]=E,e[53]=j):j=e[53];let I;e[54]!==k||e[55]!==j?(I=g.jsx("div",{className:De,style:k,children:j}),e[54]=k,e[55]=j,e[56]=I):I=e[56];let L;e[57]!==P||e[58]!==I?(L=g.jsxs("div",{className:Be,children:[P,I]}),e[57]=P,e[58]=I,e[59]=L):L=e[59];let O;e[60]!==w||e[61]!==L?(O=g.jsx("div",{className:w,children:L}),e[60]=w,e[61]=L,e[62]=O):O=e[62];let Z;return e[63]!==se||e[64]!==O?(Z=g.jsxs(g.Fragment,{children:[O,se]}),e[63]=se,e[64]=O,e[65]=Z):Z=e[65],Z}function Ct(a){return a==="incognito"}function vt(a){var e;return(e=a==null?void 0:a.prepareRequestBlocked)!=null?e:!1}const wt={close_tabs:{inProgress:"Closing tabs",finished:"Closed tabs",error:"Failed to close tabs"},open_tabs:{inProgress:"Opening tabs",finished:"Opened tabs",error:"Failed to open tabs"},list_tabs:{inProgress:"Listing tabs",finished:"Listed tabs",error:"Failed to list tabs"},focus_tab:{inProgress:"Focusing tab",finished:"Focused tab",error:"Failed to focus tab"},navigate_current_tab:{inProgress:"Navigating current tab",finished:"Navigated current tab",error:"Failed to navigate current tab"},set_tab_pinned_state:{inProgress:"Updating tab pin state",finished:"Updated tab pin state",error:"Failed to update tab pin state"},set_preference:{inProgress:"Setting preference",finished:"Updated preference",error:"Failed to set preference"},add_bookmark:{inProgress:"Adding bookmark",finished:"Added bookmark",error:"Failed to add bookmark"},reorder_tabs:{inProgress:"Reordering tabs",finished:"Reordered tabs",error:"Failed to reorder tabs"},search_browsing_history:{inProgress:"Searching browser memories",finished:"Searching browser memories",error:"Failed to search browser memories"}},Pt=Object.fromEntries(Object.entries(wt).map(([a,e])=>["".concat(ct,".").concat(a),e])),kt={inProgress:"Running tool",finished:"Finished running tool",error:"Error running tool"};function Nt(a,e){const t=Pt[a];return t?t[e]:kt[e]}function Rt({messages:a,isRequestActive:e,isLastMessageInTurn:t,clientThreadId:p}){"use no forget";var _,D;const i=a.filter(s=>s.author.role===U.Assistant&&s.recipient&&pe(s.recipient)),m=Ne(p),f=m?Re.getConversationTurns(m).flatMap(s=>s.messages):[],n=f.findLastIndex(s=>s.author.role===U.Assistant&&s.recipient&&pe(s.recipient)),r=n>=0?f[n]:void 0,c=r&&r.recipient,l=n>=0?f.slice(n+1).filter(s=>s.author.role===U.Tool&&s.author.name===c):[],B=n>=0?f.slice(n+1).find(s=>s.author.role===U.Assistant&&(!s.recipient||!pe(s.recipient))):void 0,H=B!=null&&ut(B),C=l.length>0,M=r==null?void 0:r.id,u=bt(s=>M?s.getToolState(p,M):void 0);let d=null;C||(u==null?void 0:u.status)===me.Finished?d={key:"finished",status:he.Finished}:(u==null?void 0:u.status)===me.Error?d={key:"error",status:he.Error}:((u==null?void 0:u.status)===me.Running||e&&t&&!u)&&(d={key:"inProgress",status:he.Running});const $=x.useMemo(()=>!c||!d?null:Nt(c,d.key),[c,d]);if(i.length===0||!c||!i.some(s=>s.id===(r==null?void 0:r.id)))return null;if(c===Se){if(!r||l.length>0||H)return null;let s="";r.content.content_type===ee.Text?s=(D=(_=r.content.parts)==null?void 0:_[0])!=null?D:"":r.content.content_type===ee.Code&&(s=r.content.text);const q=r.status==="finished_successfully",[S]=At(s,v=>dt(v)),b=!S&&s.trim().length>0?s:null;b&&Fe.error("BrowserToolMessage: failed to parse SuggestAgent arguments",{args:s});let A="";return typeof(S==null?void 0:S.prompt)=="string"?A=S.prompt:b&&(A=b),{type:"suggestion",prompt:A,isComplete:q,parentMessageId:r.id}}return H||!d?null:{type:"message",message:$,display:d}}function Ot(a){"use forget";const e=ke.c(13),{messages:t,isRequestActive:p,isLastMessageInTurn:i,clientThreadId:m}=a;let f;e[0]!==m||e[1]!==i||e[2]!==p||e[3]!==t?(f={messages:t,isRequestActive:p,isLastMessageInTurn:i,clientThreadId:m},e[0]=m,e[1]=i,e[2]=p,e[3]=t,e[4]=f):f=e[4];const n=Rt(f);if(!n)return null;if(n.type==="suggestion"){let c;return e[5]!==m||e[6]!==n.isComplete||e[7]!==n.parentMessageId||e[8]!==n.prompt?(c=g.jsx(Tt,{prompt:n.prompt,isComplete:n.isComplete,clientThreadId:m,parentMessageId:n.parentMessageId}),e[5]=m,e[6]=n.isComplete,e[7]=n.parentMessageId,e[8]=n.prompt,e[9]=c):c=e[9],c}let r;return e[10]!==n.display.status||e[11]!==n.message?(r=g.jsx(yt,{highlightedCommand:n.message,showWorkUserSetting:!1,status:n.display.status,children:null}),e[10]=n.display.status,e[11]=n.message,e[12]=r):r=e[12],r}export{Ot as BrowserToolMessage};
//# sourceMappingURL=n1e16fbkhjeche79.js.map
