import{c as I,r as M,j as t,M as d,i as F,e as q,u as D,b as Y,a0 as H}from"./fg33krlcm0qyi6yw.js";import{I as K,b as G,ih as Q,cU as E,a9 as S,d as J,ck as V,dd as $,ga as X,ad as Z,P as b,c0 as ee,hr as te,aV as ae,R as se,A as ne,uh as U}from"./mtk1qztvnb31pw5r.js";import{a as ie,P as oe}from"./c85o71peocbdlyqu.js";import{N as B,dS as re,dN as le,cx as ce,cH as me,kO as ue,kP as O,kQ as pe}from"./k65njl5wlgspihfr.js";import{S as de}from"./c2cj1dlcffke3f7m.js";import"./gaf2c83btl9kw1dk.js";import"./ohquqctluwabmb5i.js";import"./efooahjtdr85x1lo.js";import"./km71i01x6ma5r62b.js";import"./hb1mva1gmw4bcs8w.js";function he(){"use forget";var p,y;const e=I.c(27),a=G();let s;e[0]!==a?(s=(y=(p=K(a))==null?void 0:p.normalizedAccountUserId)!=null?y:null,e[0]=a,e[1]=s):s=e[1];const n=s;let o;e[2]!==a?(o=B(a),e[2]=a,e[3]=o):o=e[3];const r=o,c=re(n!=null?n:""),[w,C]=M.useState(!1);if(!r.hasAccess||!n||w||!c)return null;let m;e[4]!==c.avatarUrl||e[5]!==c.name?(m={name:c.name,picture:c.avatarUrl},e[4]=c.avatarUrl,e[5]=c.name,e[6]=m):m=e[6];const _=m;let k;e[7]!==r?(k=()=>{C(!0),r.setUserOnboardingCompletion$()},e[7]=r,e[8]=k):k=e[8];const N=k;let h;e[9]!==_?(h=t.jsx(Q,{user:_,size:"large"}),e[9]=_,e[10]=h):h=e[10];let x;e[11]!==c.name?(x=t.jsx("p",{className:"text-token-text-primary text-base font-semibold",children:c.name}),e[11]=c.name,e[12]=x):x=e[12];let l;e[13]===Symbol.for("react.memo_cache_sentinel")?(l=t.jsx("p",{className:"text-token-text-secondary text-sm",children:t.jsx(d,{id:"c3PR7x",defaultMessage:"Set up your profile"})}),e[13]=l):l=e[13];let g;e[14]!==x?(g=t.jsxs("div",{className:"leading-tight",children:[x,l]}),e[14]=x,e[15]=g):g=e[15];let f;e[16]!==a||e[17]!==n?(f=()=>{E(a,le,{accountUserId:n})},e[16]=a,e[17]=n,e[18]=f):f=e[18];let j;e[19]===Symbol.for("react.memo_cache_sentinel")?(j=t.jsx("p",{className:"text-token-text-primary",children:t.jsx(d,{id:"RutgIh",defaultMessage:"Set up"})}),e[19]=j):j=e[19];let u;e[20]!==f?(u=t.jsx(S,{color:"secondary",size:"large",icon:ce,className:"rounded-full px-4",onClick:f,children:j}),e[20]=f,e[21]=u):u=e[21];let v;return e[22]!==N||e[23]!==u||e[24]!==h||e[25]!==g?(v=t.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:t.jsx("div",{className:"mx-auto w-full max-w-2xl",children:t.jsx(me,{icon:h,content:g,contentClassName:"flex-row items-center justify-between gap-8",closeButtonContainerClassName:"items-center!",customCtas:u,verticalCta:!1,onDismiss:N})})}),e[22]=N,e[23]=u,e[24]=h,e[25]=g,e[26]=v):v=e[26],v}const z=5e3;function ge({loaderData:e}){"use no forget";var R;const{id:a,token:s,authStatus:n}=e,o=G(),r=B(o),c=F(),w=te(),C=ae(),m=fe({authStatus:n,id:a,token:s}),_=J(()=>r==null?void 0:r.userAttributes$()),k=q(),N=V(o),h=M.useRef(!1),x=M.useRef(!1),l=(R=m.data)==null?void 0:R.content.room_id,g=r!=null&&n===$.LoggedIn&&r.hasAccess&&!w&&!C,f=D({mutationKey:["calpico","magic-link","accept",a],mutationFn:()=>r.acceptMagicLink$({magic_link_id:a,token:s}),onSuccess:i=>{i!=null&&i.roomId&&(b.logEventWithStatsig("Calpico - invite - accepted","chatgpt_web_calpico_invite_accepted",{room_id:i.roomId}),c("/gg/".concat(i.roomId)))},onError:i=>{var T;N.danger((T=X(i))!=null?T:k.formatMessage(Z.somethingWentWrong))}});if(M.useEffect(()=>{l==null||x.current||(x.current=!0,b.logEventWithStatsig("Calpico - invite - page shown","chatgpt_web_calpico_invite_page_shown",{room_id:l}))},[l]),M.useEffect(()=>{if(!(g&&r!=null&&_==null&&!h.current))return;h.current=!0,(async()=>{try{await r.fetchUserAttributes$()}catch(xe){}finally{h.current=!1}})()},[r,g,_]),m.isLoading)return t.jsx(P,{children:t.jsx("div",{className:"flex h-full w-full items-center justify-center",children:t.jsx(ee,{})})});if(m.error!=null)return t.jsx(P,{children:t.jsx("div",{className:"flex h-full w-full items-center justify-center",children:t.jsx("p",{className:"max-w-2xl px-8 text-center text-lg text-balance",children:m.error.message})})});if(m.data==null)return t.jsx(P,{children:null});const j=e.type==="ok"?e.roomName:null,u=m.data.content.member_count,v=u<=3,p=v?m.data.content.members:m.data.content.members.slice(0,2);let y=null;v?u===1?y=t.jsx(d,{id:"siksc7",defaultMessage:"<emphasis>ChatGPT</emphasis> with <emphasis>{name}</emphasis>",values:{emphasis:i=>t.jsx(A,{children:i}),name:p[0].name}}):u===2?y=t.jsx(d,{id:"Rvrtg/",defaultMessage:"<emphasis>ChatGPT</emphasis> with <emphasis>{name1} and {name2}</emphasis>",values:{emphasis:i=>t.jsx(A,{children:i}),name1:p[0].name,name2:p[1].name}}):u===3&&(y=t.jsx(d,{id:"nooFua",defaultMessage:"<emphasis>ChatGPT</emphasis> with <emphasis>{name1}, {name2}, and {name3}</emphasis>",values:{emphasis:i=>t.jsx(A,{children:i}),name1:p[0].name,name2:p[1].name,name3:p[2].name}})):y=t.jsx(d,{id:"My6mmz",defaultMessage:"<emphasis>ChatGPT</emphasis> with <emphasis>{name1}, {name2}, and {remainingCount} more</emphasis>",values:{emphasis:i=>t.jsx(A,{children:i}),name1:p[0].name,name2:p[1].name,remainingCount:u-2}});const L=t.jsx(d,{id:"a17r/Y",defaultMessage:"Join group chat"}),W=g&&_!=null&&_.onboardedAt==null;return t.jsxs(P,{children:[t.jsx("div",{className:"flex h-full flex-col items-center justify-center text-center",children:t.jsxs("div",{className:"flex max-w-3xl flex-col items-center text-center",children:[t.jsx(ue,{list:m.data.content.members.map(i=>({id:i.account_user_id,avatarUrl:i.avatar_url,name:i.name})),excludeViewer:!1,variant:"horizontal-stack"}),t.jsx("h3",{className:"text-token-text-tertiary mt-3 mb-1 text-xl font-normal text-balance",children:y}),t.jsx("p",{className:"text-token-text-secondary text-balance",children:j!=null?j:t.jsx(d,{id:"z7w9u0",defaultMessage:"Share, collaborate, and get creative â€” with some help from ChatGPT."})}),t.jsxs("div",{className:"mt-6 flex flex-col items-center space-y-1",children:[w?t.jsx(S,{color:"primary",size:"large",as:"a",openNewTab:!0,to:"chatgpt://gg/v/".concat(a,"?token=").concat(s),onClick:()=>{b.logEventWithStatsig("Calpico - invite - manually deeplink to mobile","chatgpt_web_calpico_invite_manually_deeplink_to_mobile",{room_id:l}),setTimeout(()=>{E(o,O,{roomId:l})},z)},children:L}):C?t.jsx(S,{color:"primary",size:"large",as:"a",openNewTab:!0,to:"chatgpt://chatgpt.com/gg/v/".concat(a,"?token=").concat(s),onClick:()=>{b.logEventWithStatsig("Calpico - invite - manually deeplink to mobile","chatgpt_web_calpico_invite_manually_deeplink_to_mobile",{room_id:l}),setTimeout(()=>{E(o,O,{roomId:l})},z)},children:L}):t.jsx(S,{color:"primary",size:"large",loading:f.isPending,onClick:()=>{if(n===$.LoggedOut){b.logEventWithStatsig("Calpico - invite - auth redirect","chatgpt_web_calpico_invite_auth_redirect",{room_id:l});const i=new URLSearchParams([["next","/gg/v/".concat(a,"?token=").concat(s)]]);c("/auth/login/?".concat(i.toString()));return}if(r.hasAccess){if(f.isPending)return;f.mutate()}else b.logEventWithStatsig("Calpico - invite - no access yet modal shown","chatgpt_web_calpico_invite_no_access_yet_modal_shown",{room_id:l}),E(o,pe)},children:L}),t.jsx(S,{color:"ghost",size:"large",onClick:()=>{b.logEventWithStatsig("Calpico - invite - ignored","chatgpt_web_calpico_invite_ignored",{room_id:l}),c("/")},children:t.jsx(d,{id:"tILHmH",defaultMessage:"Ignore"})})]})]})}),t.jsxs("div",{className:"absolute inset-x-0 bottom-4 flex w-full flex-col items-center space-y-2 px-6",children:[w||C?t.jsxs("div",{className:"mb-6",children:[w?t.jsx(ie,{}):null,C?t.jsx(oe,{referrer:"groupChatInvitation"}):null]}):null,W?t.jsx("div",{className:"mb-8 w-full",children:t.jsx(he,{})}):null,t.jsx("p",{className:"text-caption-regular text-token-text-tertiary text-center text-pretty",children:t.jsx(d,{id:"ytzRfA",defaultMessage:"Your personal ChatGPT memory is never used in group chats."})}),t.jsx(S,{color:"secondary",size:"small",as:"a",to:"https://help.openai.com/en/articles/12703475-group-chats",openNewTab:!0,children:t.jsx("p",{className:"text-footnote-regular text-token-text-secondary font-medium",children:t.jsx(d,{id:"ds1qjK",defaultMessage:"Learn more"})})})]})]})}function A(e){"use forget";const a=I.c(2),{children:s}=e;let n;return a[0]!==s?(n=t.jsx("span",{className:"text-token-text-primary",children:s}),a[0]=s,a[1]=n):n=a[1],n}function fe({authStatus:e,id:a,token:s}){"use no forget";return Y({queryKey:["calpico-group-link",e,a,s],queryFn:async()=>await se.safeGet("/calpico/chatgpt/links/{magic_link_id}",{parameters:{path:{magic_link_id:a},query:{token:s}},authOption:ne.SendIfAvailable})})}function P(e){"use forget";const a=I.c(4),{children:s}=e;let n;a[0]===Symbol.for("react.memo_cache_sentinel")?(n=t.jsx("div",{className:"absolute start-2 top-2 md:hidden",children:t.jsx(de,{})}),a[0]=n):n=a[0];let o;a[1]===Symbol.for("react.memo_cache_sentinel")?(o=null,a[1]=o):o=a[1];let r;return a[2]!==s?(r=t.jsxs("div",{className:"relative mx-auto h-full w-full max-w-5xl px-6 sm:px-12",children:[n,s,o]}),a[2]=s,a[3]=r):r=a[3],r}const Me=({currentUrl:e,nextUrl:a})=>!(e.pathname===a.pathname&&e.searchParams.get("token")===a.searchParams.get("token")),Ae=({loaderData:e})=>{const a=[{name:"robots",content:"noindex,nofollow"},{property:"og:type",content:"website"},{property:"og:image",content:U.url},{property:"og:image:secure_url",content:U.url},{property:"og:image:width",content:"1600"},{property:"og:image:height",content:"900"},{property:"og:site_name",content:"ChatGPT"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:image",content:U.url},{name:"twitter:site",content:"@ChatGPTapp"}];switch(e.type){case"ok":{const{ogTitle:s,ogDescription:n}=e;return[...a,{title:s},{name:"description",content:n},{property:"og:title",content:s},{property:"og:description",content:n},{property:"og:image:alt",content:s},{name:"twitter:title",content:s},{name:"twitter:description",content:n},{name:"twitter:image:alt",content:s}]}case"workspace-mismatch":{const s="Join my group chat on ChatGPT";return[...a,{title:s},{property:"og:title",content:s},{property:"og:image:alt",content:s},{name:"twitter:title",content:s},{name:"twitter:image:alt",content:s}]}}},Pe=H(function(a){"use forget";const s=I.c(2),{loaderData:n}=a;let o;return s[0]!==n?(o=t.jsx(ge,{loaderData:n}),s[0]=n,s[1]=o):o=s[1],o});export{Pe as default,Ae as meta,Me as shouldRevalidate};
//# sourceMappingURL=ba7a99476qyoogtq.js.map
