var ce=Object.defineProperty,de=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var fe=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var oe=(o,e,t)=>e in o?ce(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,D=(o,e)=>{for(var t in e||(e={}))fe.call(e,t)&&oe(o,t,e[t]);if(se)for(var t of se(e))me.call(e,t)&&oe(o,t,e[t]);return o},Q=(o,e)=>de(o,ue(e));import{c as U,j as r,r as R,e as ae}from"./fg33krlcm0qyi6yw.js";import{o2 as he,b as le,d as ge,dB as ie,k2 as xe,qv as pe,dJ as ve,ef as Ce,qw as Se,qx as je,ee as J,dE as ne,C as Te,R as ye,A as Ie,e4 as Me,e2 as _e}from"./mtk1qztvnb31pw5r.js";import{u as Ne,C as we,a as Ee}from"./f7wnq403lct52o9c.js";import{dU as Pe,N as Re,ag as Ae,dV as Le,dW as $e}from"./k65njl5wlgspihfr.js";import{c as be}from"./nnfqr8jkm9161q4d.js";import{T as ke}from"./tkv1g3prhmmeuid6.js";import{ThreadModal as re}from"./j413w2y09mrdcb4m.js";import"./mbql81gwv5du9dtu.js";import"./k43gn7pl526u53kc.js";import"./dg5jraediw4l39ow.js";import"./hb1mva1gmw4bcs8w.js";import"./efooahjtdr85x1lo.js";import"./km71i01x6ma5r62b.js";import"./mivow98b53y1taf8.js";import"./krwszi9u3lj63i9v.js";import"./i5jw6wfkpao2rx5t.js";import"./mce0eiesimdmeqmr.js";import"./ifrwee0bgh9e2but.js";import"./gqx9i5tb3deqoo5z.js";import"./kgrrqncjl71482vi.js";import"./ohquqctluwabmb5i.js";import"./c2cj1dlcffke3f7m.js";import"./ei2dcm731f3fuz8o.js";const Fe={source:Ce.CLIENT,value:ve.STREAMING};function Oe(o,e){return{id:o,author:{role:_e.Assistant,name:"assistant"},content:{content_type:Me.Text,parts:[e]},status:"in_progress"}}function ze({message:o,messageIndex:e,postId:t}){var d,u;const s=(d=o.id)!=null?d:"".concat(t,"-").concat(e),n=(u=o.status)!=null?u:"finished_successfully";return Q(D({},o),{id:s,status:n})}function Ge(o,e){for(let t=o.length-1;t>=0;t--){const s=o[t],n=s.role==="assistant"?s.attachments:s.role==="user"?s.content.attachments:null;if(!(!n||n.length===0)){for(const d of n)if((d==null?void 0:d.type)==="post"&&d.post_id===e)return d}}return null}function Ke(o){var e,t;return(t=(e=o.loading_message)!=null?e:o.loadingMessage)!=null?t:null}function qe(o){"use forget";const e=U.c(38),{attachmentId:t,attachmentKind:s,clientThreadId:n,roomId:d,title:u,replyToMessageId:c,onClose:P}=o,a=le(),h=ae(),g=Ne();let T,y;e[0]!==g||e[1]!==c||e[2]!==u?(T=()=>{c&&g.replyTo$.set({messageId:c,messageType:"text",previewText:u})},y=[g,c,u],e[0]=g,e[1]=c,e[2]=u,e[3]=T,e[4]=y):(T=e[3],y=e[4]),R.useEffect(T,y);let w;e[5]!==t||e[6]!==s||e[7]!==n||e[8]!==a?(w=ie(a,n,s==="conversation"?{sharedConversationId:t}:void 0),e[5]=t,e[6]=s,e[7]=n,e[8]=a,e[9]=w):w=e[9];const i=w;let E;e[10]!==P?(E=()=>(P(),!1),e[10]=P,e[11]=E):E=e[11];const l=E;let I;e[12]!==h?(I=h.formatMessage({id:"ISN8OO",defaultMessage:"ChatGPT can make mistakes. Check important info. Your personal ChatGPT memory is never used in group chats."}),e[12]=h,e[13]=I):I=e[13];const m=I;let M;e[14]!==i?(M=r.jsx("div",{className:"flex h-full w-full flex-col",children:r.jsx("div",{className:"min-h-0 flex-1 overflow-y-auto",children:r.jsx(ke,{conversation:i,hideDisclaimer:!0})})}),e[14]=i,e[15]=M):M=e[15];const _=M;let x;e[16]!==t||e[17]!==s||e[18]!==i||e[19]!==_?(x=s==="conversation"?r.jsxs(xe.Provider,{value:{serverSharedThreadId:t},children:[_,r.jsx(re,{conversation:i,allowAnyScreenSize:!0})]}):r.jsxs(r.Fragment,{children:[_,r.jsx(re,{conversation:i,allowAnyScreenSize:!0})]}),e[16]=t,e[17]=s,e[18]=i,e[19]=_,e[20]=x):x=e[20];let f;e[21]!==i||e[22]!==x?(f=r.jsx(Se,{children:r.jsx(je,{conversation:i,children:x})}),e[21]=i,e[22]=x,e[23]=f):f=e[23];let p;e[24]!==i||e[25]!==f?(p=r.jsx("div",{className:"min-h-0 flex-1",children:r.jsx(pe.Provider,{value:i,children:f})}),e[24]=i,e[25]=f,e[26]=p):p=e[26];let v;e[27]!==l||e[28]!==d?(v=r.jsx(we,{roomId:d,scrollToBottom:l}),e[27]=l,e[28]=d,e[29]=v):v=e[29];let C;e[30]!==m?(C=r.jsx("div",{className:"text-token-text-secondary relative mt-auto flex min-h-8 w-full items-center justify-center p-2 text-center text-xs text-pretty",children:r.jsx("p",{children:m})}),e[30]=m,e[31]=C):C=e[31];let S;e[32]!==v||e[33]!==C?(S=r.jsx("div",{children:r.jsxs(Ae,{children:[v,C]})}),e[32]=v,e[33]=C,e[34]=S):S=e[34];let N;return e[35]!==S||e[36]!==p?(N=r.jsxs("div",{className:"flex h-full w-full flex-col",children:[p,S]}),e[35]=S,e[36]=p,e[37]=N):N=e[37],N}function Be(o){"use forget";var X,Z,ee,te;const e=U.c(62),{onClose:t,attachmentId:s,attachmentKind:n,postAttachment:d,title:u,roomId:c,replyToMessageId:P,clientThreadId:a}=o,h=le(),g=ae(),T=!!Pe.useCurrentImage();let y;e[0]!==h?(y=Re(h),e[0]=h,e[1]=y):y=e[1];const w=y;let i;e[2]!==s||e[3]!==w||e[4]!==c?(i=()=>{const j=w.rooms$().get(c);if(!j)return null;const W=j.viewMessages$();return Ge(W,s)},e[2]=s,e[3]=w,e[4]=c,e[5]=i):i=e[5];const E=ge(i),l=(X=E!=null?E:d)!=null?X:null;let I;e[6]!==n||e[7]!==g||e[8]!==l?(I=n==="post"&&l!=null&&((ee=(Z=l.messages)==null?void 0:Z.length)!=null?ee:0)===0?(te=Ke(l))!=null?te:g.formatMessage({id:"sFy2dW",defaultMessage:"Loading…"}):null,e[6]=n,e[7]=g,e[8]=l,e[9]=I):I=e[9];const m=I;let M;e[10]!==n||e[11]!==(l==null?void 0:l.messages)||e[12]!==m?(M=n==="post"&&(m!=null||(l==null?void 0:l.messages.some(We))),e[10]=n,e[11]=l==null?void 0:l.messages,e[12]=m,e[13]=M):M=e[13];const _=M;let x;e[14]===Symbol.for("react.memo_cache_sentinel")?(x={status:"loading"},e[14]=x):x=e[14];const[f,p]=R.useState(x);let v,C;e[15]!==a?(v=()=>(J.retainThread(a),()=>{J.releaseThread(a)}),C=[a],e[15]=a,e[16]=v,e[17]=C):(v=e[16],C=e[17]),R.useEffect(v,C);let S,N;e[18]!==a||e[19]!==h||e[20]!==_?(S=()=>{const j=ie(h,a);return ne(j,_?Fe:null),()=>{ne(j,null)}},N=[a,h,_],e[18]=a,e[19]=h,e[20]=_,e[21]=S,e[22]=N):(S=e[21],N=e[22]),R.useEffect(S,N);let O,z;e[23]!==s||e[24]!==n||e[25]!==a?(O=()=>{if(n!=="conversation")return;let j=!1;return p({status:"loading"}),(async()=>{try{const k=await ye.safeGet("/share/{shared_conversation_id}",{parameters:{path:{shared_conversation_id:s}},authOption:Ie.SendIfAvailable});if(j)return;J.updateThreadFromServer(a,k,{skipIfExisting:!0,continuingFromSharedConversationId:s}),p({status:"ready"})}catch(k){const F=k;if(j)return;let H;F instanceof Error?H=F.message:H=String(F),p({status:"error",message:H})}})(),()=>{j=!0}},z=[s,n,a],e[23]=s,e[24]=n,e[25]=a,e[26]=O,e[27]=z):(O=e[26],z=e[27]),R.useEffect(O,z);let G,K;e[28]!==s||e[29]!==n||e[30]!==a||e[31]!==l||e[32]!==m?(G=()=>{if(n!=="post"||!l)return;const j=l.messages.length===0&&m!=null?[Oe("".concat(s,"-loading"),m)]:l.messages.map((k,F)=>ze({message:k,messageIndex:F,postId:s})),W=be(j);J.updateThreadFromServer(a,W.threadResponse),p({status:"ready"})},K=[s,n,a,l,m],e[28]=s,e[29]=n,e[30]=a,e[31]=l,e[32]=m,e[33]=G,e[34]=K):(G=e[33],K=e[34]),R.useEffect(G,K);let q;e[35]!==T||e[36]!==t?(q=()=>{T||t()},e[35]=T,e[36]=t,e[37]=q):q=e[37];const Y=q,V=!T;let A;e[38]!==s||e[39]!==n||e[40]!==a||e[41]!==g||e[42]!==f.message||e[43]!==f.status||e[44]!==t||e[45]!==P||e[46]!==c||e[47]!==u?(A=f.status==="ready"?r.jsx(qe,{attachmentId:s,attachmentKind:n,clientThreadId:a,roomId:c,title:u,replyToMessageId:P,onClose:t}):f.status==="error"?r.jsx("div",{className:"text-token-text-secondary flex h-full w-full items-center justify-center p-8 text-sm",children:f.message}):r.jsx("div",{className:"text-token-text-secondary flex h-full w-full items-center justify-center p-8 text-sm",children:g.formatMessage({id:"7mKfkJ",defaultMessage:"Loading…"})}),e[38]=s,e[39]=n,e[40]=a,e[41]=g,e[42]=f.message,e[43]=f.status,e[44]=t,e[45]=P,e[46]=c,e[47]=u,e[48]=A):A=e[48];let L;e[49]!==c||e[50]!==A?(L=r.jsx("div",{className:"@container/main flex h-full w-full flex-col",children:r.jsx(Ee,{roomId:c,children:A})}),e[49]=c,e[50]=A,e[51]=L):L=e[51];let $;e[52]!==Y||e[53]!==V||e[54]!==L||e[55]!==u?($=r.jsx(Te,{testId:"modal-calpico-shared",isOpen:V,onClose:Y,size:"fullscreen",showCloseButton:!0,title:u,contentClassName:"[&_#thread-bottom]:hidden",isScrollable:!1,children:L}),e[52]=Y,e[53]=V,e[54]=L,e[55]=u,e[56]=$):$=e[56];let b;e[57]!==a?(b=r.jsx(Le,{clientThreadId:a}),e[57]=a,e[58]=b):b=e[58];let B;return e[59]!==$||e[60]!==b?(B=r.jsxs(r.Fragment,{children:[$,b]}),e[59]=$,e[60]=b,e[61]=B):B=e[61],B}function We(o){return o.status==="in_progress"}function pt(o){"use forget";const e=U.c(3),t="".concat(o.attachmentKind,":").concat(o.attachmentId);let s;return e[0]!==o||e[1]!==t?(s=r.jsx(De,D({},o),t),e[0]=o,e[1]=t,e[2]=s):s=e[2],s}function De(o){"use forget";const e=U.c(6),[t]=R.useState(Je);let s;e[0]!==t||e[1]!==o?(s=r.jsx(Be,Q(D({},o),{clientThreadId:t})),e[0]=t,e[1]=o,e[2]=s):s=e[2];let n;return e[3]!==t||e[4]!==s?(n=r.jsx($e,{clientThreadId:t,children:s}),e[3]=t,e[4]=s,e[5]=n):n=e[5],n}function Je(){return he()}export{pt as CalpicoSharedModalContainer};
//# sourceMappingURL=mfujv3piojpkt0st.js.map
