var hs=Object.defineProperty,ys=Object.defineProperties;var vs=Object.getOwnPropertyDescriptors;var it=Object.getOwnPropertySymbols;var bs=Object.prototype.hasOwnProperty,ks=Object.prototype.propertyIsEnumerable;var dt=(t,a,s)=>a in t?hs(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,p=(t,a)=>{for(var s in a||(a={}))bs.call(a,s)&&dt(t,s,a[s]);if(it)for(var s of it(a))ks.call(a,s)&&dt(t,s,a[s]);return t},A=(t,a)=>ys(t,vs(a));import{j as e,M as c,r as n,e as xe,b as gt,a as js,a0 as Ms}from"./fg33krlcm0qyi6yw.js";import{l as ce,gK as Ns,g2 as de,c0 as pt,R as ye,H as Is,m as Cs,p as ct,kW as As,b as ws}from"./mtk1qztvnb31pw5r.js";import{kA as Rs,cw as Ss,A as Ge,pZ as _s}from"./k65njl5wlgspihfr.js";import{A as Us}from"./ocjy2hqri2k6d7gs.js";import"./bhm7utdivrybcfbl.js";import"./ohquqctluwabmb5i.js";import"./efooahjtdr85x1lo.js";import"./km71i01x6ma5r62b.js";import"./c2cj1dlcffke3f7m.js";import"./hb1mva1gmw4bcs8w.js";import"./mivow98b53y1taf8.js";import"./krwszi9u3lj63i9v.js";import"./e5ksk0bbujs0ac88.js";function We(t){var a;return t.status==="revoked"&&t.revokedAt?t.revokedAt:(a=t.updatedAt)!=null?a:t.createdAt}function he(t){if(!t)return"—";try{return new Intl.DateTimeFormat("en",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(t))}catch(a){return t}}function ae(t,a){var s,d;return(d=(s=a.find(i=>i.userId===t))==null?void 0:s.name)!=null?d:t}function Ls({activityFeed:t,members:a}){return e.jsxs("div",{className:"border-token-border-light bg-token-surface-secondary/60 rounded-3xl border p-6 shadow-sm",children:[e.jsx("h2",{className:"text-token-text-primary text-xl font-semibold",children:e.jsx(c,{id:"R4k/NG",defaultMessage:"Activity explorer"})}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(c,{id:"Ch4WMX",defaultMessage:"Recent grant activity pulled from the live workspace. Useful for verifying audit timelines once backend flows land."})}),e.jsxs("div",{className:"mt-4 flex flex-col gap-4",children:[t.map(s=>{var y,f;const d=s.status==="revoked",i=d?(f=s.revokedByName)!=null?f:ae((y=s.revokedBy)!=null?y:"",a):ae(s.grantedBy,a),h=We(s);return e.jsx(n.Fragment,{children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:ce("mt-1 h-2 w-2 rounded-full border",d?"border-rose-500 bg-rose-500/30":"border-emerald-500 bg-emerald-500/30")}),e.jsxs("div",{className:"flex-1 text-sm",children:[e.jsx("div",{className:"text-token-text-primary font-medium",children:e.jsx(c,{id:"QBVCpE",defaultMessage:"{user} · {repo}",values:{user:ae(s.userId,a),repo:s.repoFullName}})}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:d?e.jsx(c,{id:"gm22ph",defaultMessage:"Revoked by {name}",values:{name:i}}):e.jsx(c,{id:"OoDDZ8",defaultMessage:"Granted by {name}",values:{name:i}})}),e.jsxs("div",{className:"bg-token-surface-tertiary text-token-text-secondary mt-1 rounded-lg px-3 py-2 text-xs",children:[e.jsx("div",{children:d?e.jsx(c,{id:"Z8PnjH",defaultMessage:"Last updated: {date}",values:{date:he(h)}}):e.jsx(c,{id:"dDfzdH",defaultMessage:"Created: {date}",values:{date:he(h)}})}),d&&e.jsx("div",{children:e.jsx(c,{id:"rkrPE7",defaultMessage:"Originally granted: {date}",values:{date:he(s.createdAt)}})}),s.notes&&e.jsx("div",{className:"text-token-text-tertiary mt-1 italic",children:e.jsx(c,{id:"vg90LB",defaultMessage:'"{notes}"',values:{notes:s.notes}})})]})]})]})},"".concat(s.grantId,"-activity"))}),!t.length&&e.jsx("div",{className:"text-token-text-secondary text-sm",children:e.jsx(c,{id:"PE6kYh",defaultMessage:"No recent activity recorded yet. Grants will appear here as they are created or revoked."})})]})]})}function we({items:t,onRemove:a,limit:s=3}){const d=xe();if(!t.length)return null;const i=t.slice(0,s),h=t.length-i.length;return e.jsxs("div",{className:"flex flex-wrap gap-1",children:[i.map(y=>e.jsxs("span",{className:"border-token-border-light text-token-text-primary bg-token-surface-secondary/70 inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-xs font-medium",children:[e.jsx("span",{className:"max-w-[140px] truncate",children:y.title}),e.jsx("button",{type:"button",className:"text-token-text-secondary hover:text-token-text-primary",onClick:f=>{f.stopPropagation(),a(y.id)},"aria-label":d.formatMessage({id:"U8fQX6",defaultMessage:"Remove {label}"},{label:y.title}),children:e.jsx(Rs,{className:"h-3 w-3"})})]},y.id)),h>0&&e.jsx("span",{className:"text-token-text-tertiary text-xs font-semibold",children:e.jsx(c,{id:"T1FRDv",defaultMessage:"+{count} more",values:{count:h}})})]})}function Re({label:t,name:a,placeholder:s,options:d,selectedId:i,onSelect:h,allowClear:y=!1,clearLabel:f,disabled:b=!1,maxSuggestions:N=50,emptyStateLabel:R="No matches",className:v,onQueryChange:m,query:k,isLoading:M=!1,selectedIds:x=[],selectionMode:C="single"}){const L=xe(),[se,V]=n.useState(""),z=typeof k=="string",X=z?k:se,W=X.trim().toLowerCase(),w=n.useMemo(()=>new Set(x.filter(Boolean)),[x]),F=n.useMemo(()=>C==="single"?d.find(l=>l.id===i):void 0,[d,i,C]),T=n.useMemo(()=>d.filter(Q=>W?[Q.title,Q.subtitle,Q.badge].filter(Boolean).join(" ").toLowerCase().includes(W):!0).slice(0,N),[d,W,N]),_=n.useMemo(()=>{var l,Q,K,u;if(C==="multi"){if(w.size===0)return s!=null?s:t;if(w.size===1){const[O]=Array.from(w),q=d.find(ve=>ve.id===O);return(Q=(l=q==null?void 0:q.title)!=null?l:s)!=null?Q:t}return L.formatMessage({id:"hUX2Pt",defaultMessage:"{count} selected"},{count:w.size})}return(u=(K=F==null?void 0:F.title)!=null?K:s)!=null?u:t},[C,w,s,t,d,L,F]),G=y&&(C==="multi"?w.size>0:!!F||W.length>0),D=l=>{z||V(l),m==null||m(l)},oe=l=>{h(l),z||V("")},re=l=>e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx("span",{className:"text-token-text-primary font-medium",children:l.title}),(l.subtitle||l.badge)&&e.jsxs("span",{className:"text-token-text-secondary flex items-center gap-2 text-xs",children:[l.subtitle,l.badge&&e.jsx("span",{className:"border-token-border-light text-token-text-tertiary rounded-full border px-2 py-0.5 text-[10px] font-semibold tracking-[0.2em] uppercase",children:l.badge})]})]}),l.meta?e.jsx("span",{className:"text-token-text-tertiary text-xs",children:l.meta}):null]}),J=f!=null?f:L.formatMessage({id:"ZlLxqJ",defaultMessage:"Clear selection"});return e.jsxs("div",{className:ce("flex flex-col gap-1.5",v),children:[e.jsx("label",{htmlFor:a,className:"text-token-text-tertiary text-[11px] font-semibold tracking-[0.2em] uppercase",children:t}),e.jsxs(Ns,{triggerButton:e.jsxs("button",{type:"button",id:a,className:ce("border-token-border-light bg-token-surface-primary inline-flex h-10 w-full items-center justify-between rounded-xl border px-3 text-sm transition-colors",b?"cursor-not-allowed opacity-60":"hover:bg-token-main-surface-secondary"),disabled:b,children:[e.jsx("span",{className:"truncate",children:_}),e.jsx(Ss,{className:"icon-sm text-token-text-tertiary shrink-0","aria-hidden":!0})]}),children:[e.jsx("div",{className:"p-2.5",children:e.jsx(de.InputItem,{autoFocus:!0,holdFocus:!0,value:X,onChange:l=>D(l.target.value),placeholder:s!=null?s:t,"aria-label":t})}),G&&e.jsx(de.Item,{onClick:l=>{l.preventDefault(),oe(null)},children:J}),M?e.jsxs(n.Fragment,{children:[e.jsx(de.Shimmer,{}),e.jsx(de.Shimmer,{size:"short"})]}):T.length?T.map(l=>C==="multi"?e.jsx(de.MultiSelectCheckboxItem,{checked:w.has(l.id),onCheckedChange:()=>oe(l),children:re(l)},l.id):e.jsx(de.Item,{onClick:Q=>{Q.preventDefault(),oe(l)},children:re(l)},l.id)):e.jsx(de.Label,{className:"text-token-text-tertiary px-3 py-2 text-sm",children:R})]})]})}function Es({userFilter:t,repoFilter:a,includeRevoked:s,onIncludeRevokedChange:d,searchValue:i,onSearchChange:h}){const y=xe();return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"flex flex-col gap-4 md:flex-row md:items-end md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-token-text-primary text-xl font-semibold",children:e.jsx(c,{id:"KFD8Qg",defaultMessage:"Current repo access grants"})}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(c,{id:"2S/OTs",defaultMessage:"Filter by user or repository and inspect grant metadata pulled from the workspace."})})]}),e.jsxs("div",{className:"flex w-full flex-wrap gap-3",children:[e.jsxs("div",{className:"min-w-[220px] flex-1 space-y-2",children:[e.jsx(Re,p({},t)),t.selections.length>0&&e.jsx(we,{items:t.selections,onRemove:t.onRemove}),t.hasActiveQuery&&t.canLoadMore&&t.onLoadMore&&e.jsx("button",{type:"button",onClick:t.onLoadMore,className:"text-token-text-primary hover:text-token-text-strong border-token-border-subtle w-full rounded-xl border border-dashed px-3 py-2 text-sm font-semibold transition",children:e.jsx(c,{id:"fCpaS7",defaultMessage:"Load more results"})})]}),e.jsxs("div",{className:"min-w-[220px] flex-1 space-y-2",children:[e.jsx(Re,p({},a)),a.selections.length>0&&e.jsx(we,{items:a.selections,onRemove:a.onRemove})]})]})]}),e.jsxs("div",{className:"text-token-text-secondary flex flex-wrap items-center gap-3 text-sm",children:[e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"accent-token-text-primary h-4 w-4",checked:s,onChange:f=>d(f.target.checked)}),e.jsx(c,{id:"NLhGa0",defaultMessage:"Show revoked"})]}),e.jsx("div",{className:"relative min-w-[200px] flex-grow md:flex-grow-0",children:e.jsx("input",{type:"search",placeholder:y.formatMessage({id:"NfmID6",defaultMessage:"Search by team member, repo, or notes"}),className:"border-token-border-light bg-token-surface-primary w-full rounded-lg border px-3 py-2 text-sm",value:i,onChange:f=>h(f.target.value)})})]})]})}function Bs({repoComboboxProps:t,repoSelection:a,userComboboxProps:s,userSelection:d,userLoadMore:i,notesValue:h,onNotesChange:y,canSubmitSelection:f,isCreateBusy:b,isRevokeBusy:N,onCreateGrant:R,onRevokeSelectedGrants:v,bulkGrantResult:m}){const k=xe();return e.jsxs("div",{className:"border-token-border-light bg-token-surface-primary rounded-3xl border p-5 shadow-sm",children:[e.jsx("h3",{className:"text-token-text-primary text-lg font-semibold",children:e.jsx(c,{id:"97hrad",defaultMessage:"Grant or revoke access"})}),e.jsx("p",{className:"text-token-text-secondary mt-1 text-sm",children:e.jsx(c,{id:"lXrHYj",defaultMessage:"Choose repositories and users to grant or revoke scan visibility. Changes take effect immediately."})}),e.jsxs("div",{className:"mt-4 flex flex-col gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Re,p({},t)),a.items.length>0&&e.jsx(we,{items:a.items,onRemove:a.onRemove})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Re,p({},s)),d.items.length>0&&e.jsx(we,{items:d.items,onRemove:d.onRemove}),i&&i.hasActiveQuery&&i.canLoadMore&&e.jsx("button",{type:"button",onClick:i.onLoadMore,className:"text-token-text-primary hover:text-token-text-strong border-token-border-subtle w-full rounded-xl border border-dashed px-3 py-2 text-sm font-semibold transition",children:e.jsx(c,{id:"fCpaS7",defaultMessage:"Load more results"})})]}),e.jsxs("label",{className:"text-token-text-secondary text-sm font-medium",children:[e.jsx(c,{id:"5idFPy",defaultMessage:"Notes"}),e.jsx("textarea",{rows:3,className:"border-token-border-light bg-token-surface-secondary mt-1 w-full rounded-lg border px-3 py-2 text-sm",placeholder:k.formatMessage({id:"w7BYsm",defaultMessage:"Optional context to include with the grant"}),value:h,onChange:M=>y(M.target.value)})]}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2 sm:flex-row",children:[e.jsx("button",{type:"button",onClick:R,disabled:!f||b||N,className:ce("border-token-border-light bg-token-surface-primary/80 text-token-text-primary hover:bg-token-surface-secondary/60 flex-1 rounded-lg border px-3 py-2 text-sm font-medium transition",(!f||b||N)&&"cursor-not-allowed opacity-70"),children:b?k.formatMessage({id:"xzpRHp",defaultMessage:"Creating..."}):k.formatMessage({id:"TdAlEa",defaultMessage:"Create grant"})}),e.jsx("button",{type:"button",onClick:v,disabled:!f||b||N,className:ce("flex-1 rounded-lg border border-rose-400 px-3 py-2 text-sm font-medium text-rose-400 transition hover:bg-rose-400/10",(!f||b||N)&&"cursor-not-allowed opacity-70"),children:N?k.formatMessage({id:"pY23hZ",defaultMessage:"Revoking..."}):k.formatMessage({id:"n+wCYS",defaultMessage:"Revoke grant"})})]})]}),m&&e.jsxs("div",{className:"border-token-border-subtle bg-token-surface-primary/80 text-token-text-secondary mt-4 rounded-3xl border p-4 text-sm",children:[e.jsx("div",{className:"text-token-text-primary font-semibold",children:e.jsx(c,{id:"uH7OBm",defaultMessage:"Action summary"})}),e.jsxs("div",{className:"mt-2 flex flex-col gap-2",children:[e.jsx("div",{children:e.jsx(c,{id:"m1HH6y",defaultMessage:"{count} succeeded",values:{count:e.jsx("span",{className:"text-token-text-primary font-medium",children:m.succeeded})}})}),m.failed.length?e.jsxs("div",{children:[e.jsx(c,{id:"6fZrzO",defaultMessage:"{count} failed:",values:{count:e.jsx("span",{className:"font-medium text-rose-400",children:m.failed.length})}}),e.jsx("ul",{className:"text-token-text-tertiary mt-1 list-inside list-disc text-xs",children:m.failed.map((M,x)=>e.jsxs("li",{children:[e.jsx(c,{id:"2OLyqA",defaultMessage:"{userId} -> {repoId}: {reason}",values:{userId:M.targetUserId,repoId:M.repoId,reason:M.reason}}),M.hasExistingGrant?e.jsx("span",{className:"italic",children:e.jsx(c,{id:"SxTYMD",defaultMessage:"Existing grant already present."})}):null]},"".concat(M.targetUserId,"-").concat(M.repoId,"-").concat(x)))})]}):e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(c,{id:"56fV16",defaultMessage:"No failures reported."})})]})]})]})}const Fs={active:"bg-emerald-500/10 text-emerald-500 border border-emerald-500/20 text-xs font-medium px-2 py-0.5 rounded-full",revoked:"bg-rose-500/10 text-rose-500 border border-rose-500/20 text-xs font-medium px-2 py-0.5 rounded-full"};function Qs({grantList:t,isLoading:a,members:s,onRevokeGrant:d,pageStart:i,pageEnd:h,currentPage:y,totalPages:f,canGoPrev:b,canGoNext:N,onPreviousPage:R,onNextPage:v}){return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-token-border-subtle overflow-hidden rounded-2xl border",children:e.jsxs("table",{className:"divide-token-border-subtle bg-token-surface-primary/80 min-w-full divide-y",children:[e.jsx("thead",{className:"bg-token-surface-secondary/60 text-token-text-tertiary text-start text-xs tracking-wide uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:e.jsx(c,{id:"nAcW7X",defaultMessage:"Repository"})}),e.jsx("th",{className:"px-4 py-3 font-medium",children:e.jsx(c,{id:"Zz3Rta",defaultMessage:"Team member"})}),e.jsx("th",{className:"px-4 py-3 font-medium",children:e.jsx(c,{id:"q3ZECQ",defaultMessage:"Granted by"})}),e.jsx("th",{className:"px-4 py-3 font-medium",children:e.jsx(c,{id:"rG6pKz",defaultMessage:"Created"})}),e.jsx("th",{className:"px-4 py-3 font-medium",children:e.jsx(c,{id:"SUHgEm",defaultMessage:"Status"})}),e.jsx("th",{className:"px-4 py-3 text-end font-medium",children:e.jsx(c,{id:"Bk68j5",defaultMessage:"Action"})})]})}),e.jsx("tbody",{className:"divide-token-border-subtle text-token-text-primary divide-y text-sm",children:a?e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"text-token-text-secondary px-4 py-10 text-center",children:[e.jsx(pt,{className:"mx-auto h-6 w-6"}),e.jsx("div",{className:"mt-3 text-sm",children:e.jsx(c,{id:"0H4/4s",defaultMessage:"Loading grants..."})})]})}):t.items.length?t.items.map(m=>{var k,M,x,C;return e.jsxs("tr",{className:"hover:bg-token-surface-secondary/40 transition",children:[e.jsxs("td",{className:"px-4 py-4 align-top",children:[e.jsx("div",{className:"font-medium",children:m.repoFullName}),e.jsx("a",{href:m.repoUrl,className:"text-token-text-tertiary text-xs underline-offset-2 hover:underline",children:m.repoId})]}),e.jsxs("td",{className:"px-4 py-4 align-top",children:[e.jsx("div",{className:"font-medium",children:ae(m.userId,s)}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:(M=(k=s.find(L=>L.userId===m.userId))==null?void 0:k.email)!=null?M:m.userEmail})]}),e.jsxs("td",{className:"px-4 py-4 align-top",children:[e.jsx("div",{className:"font-medium",children:ae(m.grantedBy,s)}),e.jsx("div",{className:"text-token-text-tertiary text-xs",children:he(m.createdAt)})]}),e.jsx("td",{className:"px-4 py-4 align-top",children:he(m.createdAt)}),e.jsxs("td",{className:"px-4 py-4 align-top",children:[e.jsx("span",{className:Fs[m.status],children:m.status.toUpperCase()}),m.status==="revoked"&&e.jsx("div",{className:"text-token-text-tertiary mt-1 text-xs",children:e.jsx(c,{id:"BqONMP",defaultMessage:"by {name}",values:{name:(C=m.revokedByName)!=null?C:ae((x=m.revokedBy)!=null?x:"",s)}})})]}),e.jsx("td",{className:"px-4 py-4 text-end align-top",children:m.status==="active"?e.jsx("button",{type:"button",onClick:()=>d(m),className:"border-token-border-light text-token-text-secondary hover:text-token-text-primary rounded-lg border px-3 py-1 text-sm transition",children:e.jsx(c,{id:"09Grp1",defaultMessage:"Revoke"})}):e.jsx("span",{className:"text-token-text-tertiary text-xs",children:e.jsx(c,{id:"lNbhbx",defaultMessage:"Revoked"})})})]},m.grantId)}):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-token-text-secondary px-4 py-10 text-center",children:e.jsx(c,{id:"coBa73",defaultMessage:"No grants match the selected filters yet."})})})})]})}),e.jsxs("div",{className:"mt-4 flex flex-col gap-2 text-sm md:flex-row md:items-center md:justify-between",children:[e.jsx("span",{className:"text-token-text-secondary",children:t.total?e.jsx(c,{id:"UyhH8J",defaultMessage:"Showing {start}-{end} of {total}",values:{start:i+1,end:h,total:t.total}}):e.jsx(c,{id:"Y+HUmn",defaultMessage:"No grants to display."})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",disabled:!b,onClick:()=>b&&R(),className:ce("border-token-border-light bg-token-surface-primary text-token-text-primary rounded-lg border px-3 py-1.5",!b&&"cursor-not-allowed opacity-50"),children:e.jsx(c,{id:"6GXO+2",defaultMessage:"Previous"})}),e.jsx("span",{className:"text-token-text-tertiary",children:e.jsx(c,{id:"lKJ9e+",defaultMessage:"Page {current} / {total}",values:{current:t.total?y+1:1,total:f}})}),e.jsx("button",{type:"button",disabled:!N,onClick:()=>N&&v(),className:ce("border-token-border-light bg-token-surface-primary text-token-text-primary rounded-lg border px-3 py-1.5",!N&&"cursor-not-allowed opacity-50"),children:e.jsx(c,{id:"lrPGoq",defaultMessage:"Next"})})]})]})]})}function ut(t){return typeof t=="number"?t.toString():"—"}function Os({workspaceAdminCount:t,shareableRepoCount:a,aggregateActiveGrantCount:s,aggregateRevokedGrantCount:d}){const i=xe();return e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(Ce,{label:i.formatMessage({id:"91/ryq",defaultMessage:"Workspace admins"}),value:t.toString(),subLabel:i.formatMessage({id:"itWbst",defaultMessage:"Count based on ChatGPT/Codex SAML roster"})}),e.jsx(Ce,{label:i.formatMessage({id:"TuQNRD",defaultMessage:"Repos"}),value:a.toString(),subLabel:i.formatMessage({id:"ySux/T",defaultMessage:"Repos fetched from workspace scan configurations"})}),e.jsx(Ce,{label:i.formatMessage({id:"FCCsLu",defaultMessage:"Active repo grants"}),value:ut(s),subLabel:i.formatMessage({id:"3iqP/s",defaultMessage:"Grants currently active across the workspace"})}),e.jsx(Ce,{label:i.formatMessage({id:"RRi1OH",defaultMessage:"Revoked grants"}),value:ut(d),subLabel:i.formatMessage({id:"ulzpM0",defaultMessage:"Recently deactivated or cleaned-up access"})})]})}function Ce({label:t,value:a,subLabel:s}){return e.jsxs("div",{className:"border-token-border-light bg-token-surface-primary/70 rounded-2xl border p-5 shadow-sm",children:[e.jsx("div",{className:"text-token-text-tertiary text-xs tracking-[0.18em] uppercase",children:t}),e.jsx("div",{className:"text-token-text-primary mt-2 text-3xl font-semibold",children:a}),e.jsx("p",{className:"text-token-text-secondary mt-2 text-xs",children:s})]})}const ht="repo-access-grants",yt="repo-access-shareable-repos";function Qe(t,a,s){var i,h;const d=!!(t&&a)&&((i=s==null?void 0:s.enabled)!=null?i:!0);return gt(p({queryKey:[ht,t!=null?t:null,a!=null?a:null],enabled:d,queryFn:()=>{if(!a)throw new Error("Repo access grant query parameters missing");return Ts(a)},retry:(h=s==null?void 0:s.retry)!=null?h:!1},s))}function Ps(t,a){var d,i;const s=!!t&&((d=a==null?void 0:a.enabled)!=null?d:!0);return gt(p({queryKey:[yt,t!=null?t:null],enabled:s,queryFn:Gs,retry:(i=a==null?void 0:a.retry)!=null?i:!1},a))}async function Ts(t){return await ye.safeGet("/aardvark/repo-access/grants",{parameters:{query:t}})}async function Gs(){return await ye.safeGet("/aardvark/repo-access/shareable-repos",{})}async function Ws(t){return await ye.safePost("/aardvark/repo-access/grants",{requestBody:t})}async function Ds(t){return await ye.safePost("/aardvark/repo-access/grants:bulk",{requestBody:{items:t}})}async function mt(t,a,s){return await ye.safeDelete("/aardvark/repo-access/grants/{repo_id}/users/{target_user_id}",{parameters:{path:{repo_id:t,target_user_id:a},query:{reason:s}}})}const Oe={targetUserIds:[],repoIds:[],notes:"",includeAllUsers:!1,includeAllRepos:!1},Pe="__ALL_USERS__",Te="__ALL_REPOS__",qs=[{userId:"user-1001",name:"Asha Tan",email:"asha.tan@example.com",role:"Workspace Admin"},{userId:"user-1002",name:"Rafael Kim",email:"rafael.kim@example.com",role:"Workspace Admin"},{userId:"user-1040",name:"Mira Alvarez",email:"mira.alvarez@example.com",role:"Scan Owner"},{userId:"user-1048",name:"Noah Singh",email:"noah.singh@example.com",role:"Member"},{userId:"user-1055",name:"Juniper Lee",email:"juniper.lee@example.com",role:"Member"},{userId:"user-1099",name:"Elena Bourne",email:"elena.bourne@example.com",role:"Member"}],pe=100,me=10,Hs="main";function $s(t,a){try{const s=new URL(t),d=s.pathname.replace(/^\/+/,"").replace(/\/+$/,"");if(d)return d;if(s.host)return s.host}catch(s){}return a}function zs(t){var b,N,R,v,m,k,M,x,C,L,se,V,z,X,W;const a=t.repo_id,s=((b=t.repo_full_name)==null?void 0:b.trim())||$s(t.repo_url,a),d=(R=(N=t.owner)==null?void 0:N.user_id)!=null?R:"",i=((m=(v=t.owner)==null?void 0:v.name)==null?void 0:m.trim())||((M=(k=t.owner)==null?void 0:k.email)==null?void 0:M.trim())||d||"Workspace user",y=(Array.isArray(t.existing_grants)?t.existing_grants:[]).map((w,F)=>{var re,J,l,Q,K,u;const T=((re=w.status)!=null?re:"active").toLowerCase()==="revoked"?"revoked":"active",_=(J=w.grant_id)!=null?J:"repo-".concat(a,"-grant-").concat(F.toString(10).padStart(3,"0")),G=(l=w.created_at)!=null?l:"",D=(Q=w.user_id)!=null?Q:"",oe=(K=w.granted_by)!=null?K:"";return{grantId:_,userId:D,grantedBy:oe,createdAt:G,status:T,notes:(u=w.notes)!=null?u:void 0}}),f=typeof t.active_grant_count=="number"?t.active_grant_count:y.filter(w=>w.status==="active").length;return{repoId:a,repoFullName:s,repoUrl:t.repo_url,scanConfigurationId:(x=t.scan_configuration_id)!=null?x:null,defaultBranch:(C=t.default_branch)!=null?C:Hs,lastScanAt:(L=t.last_scan_at)!=null?L:"",totalFindings:(se=t.total_findings)!=null?se:0,openFindings:(V=t.open_findings)!=null?V:0,configurationOwner:{userId:d,name:i,email:(X=(z=t.owner)==null?void 0:z.email)!=null?X:""},existingGrants:y,activeGrantCount:f,tags:(W=t.tags)!=null?W:[]}}function Se(t,a){var h,y,f,b,N,R,v,m,k,M,x,C;const s=((h=t.status)==null?void 0:h.toLowerCase())==="revoked"?"revoked":"active",d=a==null?void 0:a.find(L=>L.userId===t.user_id),i=a==null?void 0:a.find(L=>L.userId===t.granted_by);return A(p({},t),{grantId:t.grant_id,userId:t.user_id,userName:(y=d==null?void 0:d.name)!=null?y:t.user_id,userEmail:(f=d==null?void 0:d.email)!=null?f:"",repoId:t.external_repo_id,repoFullName:(b=t.repo_full_name)!=null?b:t.external_repo_id,repoUrl:t.canonical_url,scanConfigurationId:(N=t.scan_configuration_id)!=null?N:null,grantedBy:t.granted_by,grantedByName:(R=i==null?void 0:i.name)!=null?R:t.granted_by,grantedByEmail:(v=i==null?void 0:i.email)!=null?v:"",notes:(m=t.notes)!=null?m:void 0,createdAt:t.created_at,updatedAt:(k=t.updated_at)!=null?k:t.created_at,status:s,revokedAt:(M=t.revoked_at)!=null?M:void 0,revokedBy:(x=t.revoked_by)!=null?x:void 0,revokedByName:t.revoked_by?ae(t.revoked_by,a!=null?a:[]):void 0,revocationReason:(C=t.revocation_reason)!=null?C:void 0})}function Ks(t,a){return{succeeded:t.succeeded.map(s=>Se(s,a)),failed:t.failed.map(s=>({targetUserId:s.target_user_id,repoId:s.repo_id,reason:s.reason,existingGrant:s.existing_grant?Se(s.existing_grant,a):void 0}))}}function Ys(t){return(t!=null?t:"").trim().toLowerCase()}function Zs(t,a){return a?[t.repoFullName,t.repoId,t.userName,t.userEmail,t.notes,t.grantedByName,t.grantedByEmail].filter(Boolean).join(" ").toLowerCase().includes(a):!0}function xt(t){if(t){if(t instanceof Error)return t.message;if(typeof t=="string")return t;try{return JSON.stringify(t)}catch(a){return String(t)}}}function Vs(t){var s,d,i;const a=t.role==="account-owner"?"Workspace Owner":t.role==="account-admin"?"Workspace Admin":"Member";return{userId:t.id,name:(d=(s=t.name)!=null?s:t.email)!=null?d:"Unnamed user",email:(i=t.email)!=null?i:"",role:a}}function vt(t){if(t!=="Member")return t==="Workspace Owner"?"Owner":t==="Workspace Admin"?"Admin":t}function Ae(t,a){return a?t.includes(a)?t.filter(s=>s!==a):[...t,a]:t}function Xs(t){return{id:t.repoId,title:t.repoFullName,subtitle:t.configurationOwner.name?"".concat(t.configurationOwner.name," · ").concat(t.configurationOwner.email):t.configurationOwner.email,badge:t.tags[0],meta:t.activeGrantCount?"".concat(t.activeGrantCount," active grant").concat(t.activeGrantCount===1?"":"s"):void 0}}function ft(t,a,s){var W,w,F;const[d,i]=n.useState(""),h=d.trim(),[y,f]=n.useState(0),[b,N]=n.useState([]),R=!!t&&h.length>0,{data:v,isFetching:m}=Ge(R?t:void 0,y,d,pe),k=n.useMemo(()=>{var _;return((_=v==null?void 0:v.items)!=null?_:[]).map(G=>Vs(G)).sort((G,D)=>G.name.localeCompare(D.name))},[v==null?void 0:v.items]);n.useEffect(()=>{if(!R){N([]);return}N(T=>{if(y===0)return k;const _=[...T];return k.forEach(G=>{_.some(D=>D.userId===G.userId)||_.push(G)}),_.sort((G,D)=>G.name.localeCompare(D.name))})},[y,k,R]);const M=(W=v==null?void 0:v.total)!=null?W:0,x=(F=(w=v==null?void 0:v.items)==null?void 0:w.length)!=null?F:0,C=R&&x>0&&M>y+x,L=n.useCallback(()=>{!C||x===0||f(T=>T+x)},[C,x]),se=n.useCallback(T=>{i(T),f(0)},[]),V=n.useCallback(()=>{i(""),f(0),N([])},[]),z=n.useMemo(()=>(h.length>0?b:a).map(_=>({id:_.userId,title:_.name,subtitle:_.email,badge:vt(_.role)})),[a,h.length,b]),X=h.length>0?m:s;return{options:z,query:d,onQueryChange:se,isLoading:X,canLoadMore:C,onLoadMore:L,hasActiveQuery:h.length>0,resetQuery:V}}function Js(){var st,rt,at,ot;const t=xe(),a=Is(),s=a==null?void 0:a.getWorkspaceId(),d=s,{data:i,isLoading:h,error:y}=Ge(d,0,"",pe),f=((st=i==null?void 0:i.total)!=null?st:0)>pe,{data:b,isLoading:N,error:R}=Ge(f?d:void 0,pe,"",pe),v=R!=null?R:y,m=h||f&&N,k=n.useMemo(()=>{var j;if(!i)return;const r=(j=i.items)!=null?j:[],o=f&&(b!=null&&b.items)?[...r,...b.items]:r;return A(p({},i),{items:o})},[i,b,f]),M=n.useMemo(()=>k!=null&&k.items?k.items.map(o=>{var Y,te,S;const j=o.role==="account-owner"?"Workspace Owner":o.role==="account-admin"?"Workspace Admin":"Member";return{userId:o.id,name:(te=(Y=o.name)!=null?Y:o.email)!=null?te:"Unnamed user",email:(S=o.email)!=null?S:"",role:j}}).sort((o,j)=>o.name.localeCompare(j.name)):void 0,[k]),x=n.useMemo(()=>M!=null?M:qs,[M]),{options:C,query:L,onQueryChange:se,isLoading:V,canLoadMore:z,onLoadMore:X,hasActiveQuery:W,resetQuery:w}=ft(s,x,m),{options:F,query:T,onQueryChange:_,isLoading:G,canLoadMore:D,onLoadMore:oe,hasActiveQuery:re,resetQuery:J}=ft(s,x,m),l=Cs(),Q=js(),K=n.useCallback(async()=>{await Promise.all([Q.invalidateQueries({queryKey:[ht]}),Q.invalidateQueries({queryKey:[yt]})])},[Q]);n.useEffect(()=>{v&&l.warning("Using fallback users (workspace roster unavailable)",{id:"fallback-admin-members-warning",description:xt(v)})},[v,l]);const[u,O]=n.useState({includeRevoked:!1,userIds:[],repoIds:[]}),[q,ve]=n.useState({items:[],total:0,nextCursor:null}),[H,De]=n.useState([]),[be,qe]=n.useState(null),[g,P]=n.useState(Oe),[_e,He]=n.useState(!1),[Ue,$e]=n.useState(!1),[ne,E]=n.useState(0),[ze,Le]=n.useState([]),bt=n.useMemo(()=>{if(!s)return null;const r=u.search?200:me,o={limit:String(r),offset:String(ne*me)};return u.includeRevoked&&(o.include_revoked="true"),u.userIds.length===1?o.user_id=u.userIds[0]:u.userIds.length>1&&(o.user_id=u.userIds),u.repoIds.length===1?o.repo_id=u.repoIds[0]:u.repoIds.length>1&&(o.repo_id=u.repoIds),o},[s,u.includeRevoked,u.userIds,u.repoIds,u.search,ne]),kt=n.useMemo(()=>{if(!s)return null;const r={limit:"50",offset:"0",include_revoked:"true"};return u.userIds.length===1?r.user_id=u.userIds[0]:u.userIds.length>1&&(r.user_id=u.userIds),u.repoIds.length===1?r.repo_id=u.repoIds[0]:u.repoIds.length>1&&(r.repo_id=u.repoIds),r},[s,u.userIds,u.repoIds]),jt=n.useMemo(()=>s?{limit:"1",offset:"0",include_revoked:"true"}:null,[s]),le=Qe(s,bt,{retry:!1}),Ke=Qe(s,kt,{retry:!1}),ke=Qe(s,jt,{retry:!1}),ie=Ps(s,{retry:!1}),Mt=!!s&&(le.isPending||le.isFetching||!1),je=!!s&&(ie.isPending||ie.isFetching||!1),Ee=n.useMemo(()=>Ys(u.search),[u.search]);n.useEffect(()=>{var U,Ie,nt,lt;if(!s){ve({items:[],total:0,nextCursor:null}),Le([]);return}const r=le.data;if(!r)return;const o=$=>Ee?$.filter(Fe=>Zs(Fe,Ee)):$,j=$=>u.includeRevoked?$:$.filter(Fe=>Fe.status==="active"),Y=r.items.map($=>Se($,x)),te=o(j(Y)),S=u.search?te.length:(U=r.total)!=null?U:te.length,Z=u.search?null:(Ie=r.next_cursor)!=null?Ie:null;ve({items:te,total:S,nextCursor:Z});const B=(nt=Ke.data)!=null?nt:r,I=((lt=B==null?void 0:B.items)!=null?lt:[]).map($=>Se($,x));if(Le(o(I)),S>0&&!u.search){const $=Math.max(1,Math.ceil(S/me));ne>=$&&E($-1)}},[s,le.data,Ke.data,x,u.includeRevoked,u.search,Ee,ne]),n.useEffect(()=>{if(!s){De([]);return}const r=ie.data;if(!r)return;const o=Array.isArray(r.items)?r.items.map(zs):[];De(o)},[s,ie.data]),n.useEffect(()=>{!s||!le.error||(l.danger("Unable to load grants",{id:"repo-access-grants-error",error:le.error}),Le([]))},[s,le.error,l]),n.useEffect(()=>{!s||!ie.error||l.danger("Unable to load shareable repositories",{id:"shareable-repos-error",error:ie.error})},[s,ie.error,l]);const Ye=n.useMemo(()=>x.map(r=>({id:r.userId,title:r.name,subtitle:r.email,badge:vt(r.role)})),[x]),fe=n.useMemo(()=>H.map(r=>Xs(r)),[H]),ge=n.useMemo(()=>({id:Pe,title:t.formatMessage({id:"jSQCcZ",defaultMessage:"All users"}),subtitle:t.formatMessage({id:"C9TWO0",defaultMessage:"{count} available"},{count:x.length})}),[t,x.length]),ue=n.useMemo(()=>({id:Te,title:t.formatMessage({id:"FXppAV",defaultMessage:"All repositories"}),subtitle:t.formatMessage({id:"2GxSjW",defaultMessage:"{count} managed"},{count:H.length})}),[t,H.length]),Nt=n.useMemo(()=>[ge,...F],[ge,F]),It=n.useMemo(()=>[ue,...fe],[ue,fe]),Ct=n.useRef(new Map),Me=n.useMemo(()=>{const r=Ct.current,o=j=>{r.set(j.id,j)};return[Ye,C,F].forEach(j=>j.forEach(o)),o(ge),new Map(r)},[Ye,C,F,ge]),Ne=n.useMemo(()=>{const r=new Map;return fe.forEach(o=>r.set(o.id,o)),r.set(ue.id,ue),r},[fe,ue]),At=n.useMemo(()=>x.filter(r=>["Workspace Admin","Workspace Owner"].includes(r.role)).length,[x]),wt=n.useMemo(()=>H.length,[H]),Ze=n.useMemo(()=>{const r=new Map;return H.forEach(o=>r.set(o.repoId,o)),r},[H]),Rt=n.useMemo(()=>g.targetUserIds.map(r=>{var o;return(o=Me.get(r))!=null?o:null}).filter(Boolean),[g.targetUserIds,Me]),St=n.useMemo(()=>g.repoIds.map(r=>{var o;return(o=Ne.get(r))!=null?o:null}).filter(Boolean),[g.repoIds,Ne]),_t=n.useMemo(()=>g.includeAllRepos?[Te]:g.repoIds,[g.includeAllRepos,g.repoIds]),Ut=n.useMemo(()=>g.includeAllUsers?[Pe]:g.targetUserIds,[g.includeAllUsers,g.targetUserIds]),Lt=n.useCallback(r=>{r&&P(o=>A(p({},o),{repoIds:o.repoIds.filter(j=>j!==r)}))},[]),Et=n.useCallback(r=>{r&&P(o=>A(p({},o),{targetUserIds:o.targetUserIds.filter(j=>j!==r)}))},[]),Bt=n.useCallback(()=>{P(r=>A(p({},r),{includeAllRepos:!1}))},[]),Ft=n.useCallback(()=>{P(r=>A(p({},r),{includeAllUsers:!1}))},[]),Qt=H.length?t.formatMessage({id:"3yHiaf",defaultMessage:"Select repositories"}):t.formatMessage({id:"WpCEdx",defaultMessage:"No repositories available"}),Ot=m?t.formatMessage({id:"aqdy4h",defaultMessage:"Loading workspace members..."}):x.length?t.formatMessage({id:"erF8b8",defaultMessage:"Select users"}):t.formatMessage({id:"FryeWT",defaultMessage:"No workspace members found"}),Pt=n.useMemo(()=>u.userIds.map(r=>{var o;return(o=Me.get(r))!=null?o:null}).filter(Boolean),[u.userIds,Me]),Tt=n.useMemo(()=>u.repoIds.map(r=>{var o;return(o=Ne.get(r))!=null?o:null}).filter(Boolean),[u.repoIds,Ne]),Gt=n.useCallback(r=>{r&&(E(0),O(o=>A(p({},o),{userIds:o.userIds.filter(j=>j!==r)})))},[O,E]),Wt=n.useCallback(r=>{r&&(E(0),O(o=>A(p({},o),{repoIds:o.repoIds.filter(j=>j!==r)})))},[O,E]),Dt=n.useCallback(r=>{E(0),O(r?o=>A(p({},o),{userIds:Ae(o.userIds,r.id)}):o=>A(p({},o),{userIds:[]})),w()},[w,O,E]),qt=n.useCallback(r=>{E(0),O(o=>A(p({},o),{repoIds:r?Ae(o.repoIds,r.id):[]}))},[O,E]),Ht=n.useCallback(r=>{if(!r){P(o=>A(p({},o),{includeAllUsers:!1,targetUserIds:[]})),J();return}if(r.id===Pe){P(o=>A(p({},o),{includeAllUsers:!o.includeAllUsers,targetUserIds:[]})),J();return}P(o=>A(p({},o),{includeAllUsers:!1,targetUserIds:Ae(o.targetUserIds,r.id)})),J()},[J,P]),$t=n.useCallback(r=>{if(!r){P(o=>A(p({},o),{includeAllRepos:!1,repoIds:[]}));return}if(r.id===Te){P(o=>A(p({},o),{includeAllRepos:!o.includeAllRepos,repoIds:[]}));return}P(o=>A(p({},o),{includeAllRepos:!1,repoIds:Ae(o.repoIds,r.id)}))},[P]),zt={label:t.formatMessage({id:"sa9xMb",defaultMessage:"User filter"}),name:"aardvark-filter-users",placeholder:t.formatMessage({id:"kOJH2j",defaultMessage:"All users"}),options:C,selectedIds:u.userIds,selectionMode:"multi",onSelect:Dt,allowClear:!0,clearLabel:t.formatMessage({id:"dEwp7p",defaultMessage:"Clear users"}),emptyStateLabel:t.formatMessage({id:"kJdD4E",defaultMessage:"No users match this search"}),isLoading:V,query:L,onQueryChange:se},Kt={label:t.formatMessage({id:"x0Hk7v",defaultMessage:"Repository filter"}),name:"aardvark-filter-repositories",placeholder:t.formatMessage({id:"noNx1I",defaultMessage:"All repositories"}),options:fe,selectedIds:u.repoIds,selectionMode:"multi",onSelect:qt,allowClear:!0,clearLabel:t.formatMessage({id:"rInvTK",defaultMessage:"Clear repositories"}),emptyStateLabel:t.formatMessage({id:"UXrBhH",defaultMessage:"No repositories match this search"}),isLoading:je},Yt={label:t.formatMessage({id:"lU0gZY",defaultMessage:"Repository"}),name:"aardvark-create-repositories",placeholder:Qt,options:It,selectedIds:_t,selectionMode:"multi",onSelect:$t,allowClear:!0,clearLabel:t.formatMessage({id:"rInvTK",defaultMessage:"Clear repositories"}),emptyStateLabel:t.formatMessage({id:"UXrBhH",defaultMessage:"No repositories match this search"}),disabled:_e||Ue||je,isLoading:je},Zt={label:t.formatMessage({id:"CzfUen",defaultMessage:"User"}),name:"aardvark-create-users",placeholder:Ot,options:Nt,selectedIds:Ut,selectionMode:"multi",onSelect:Ht,allowClear:!0,clearLabel:t.formatMessage({id:"dEwp7p",defaultMessage:"Clear users"}),emptyStateLabel:t.formatMessage({id:"kJdD4E",defaultMessage:"No users match this search"}),disabled:_e||Ue||m,isLoading:G,query:T,onQueryChange:_},ee=W&&z?{hasActiveQuery:W,canLoadMore:z,onLoadMore:X}:void 0,Vt=re&&D?{hasActiveQuery:re,canLoadMore:D,onLoadMore:oe}:void 0,Xt={items:g.includeAllRepos?[ue]:St,onRemove:g.includeAllRepos?Bt:Lt},Jt={items:g.includeAllUsers?[ge]:Rt,onRemove:g.includeAllUsers?Ft:Et},Ve={items:Tt,onRemove:Wt},Xe={items:Pt,onRemove:Gt},es=(rt=u.search)!=null?rt:"",ts=n.useCallback(r=>{E(0),O(o=>A(p({},o),{includeRevoked:r}))},[O]),ss=n.useCallback(r=>{E(0),O(o=>A(p({},o),{search:r||void 0}))},[O]),rs=n.useCallback(r=>{P(o=>A(p({},o),{notes:r}))},[]),as=A(p({},zt),{selections:Xe.items,onRemove:Xe.onRemove,canLoadMore:ee==null?void 0:ee.canLoadMore,hasActiveQuery:ee==null?void 0:ee.hasActiveQuery,onLoadMore:ee==null?void 0:ee.onLoadMore}),os=A(p({},Kt),{selections:Ve.items,onRemove:Ve.onRemove}),ns=typeof((at=ke.data)==null?void 0:at.active_total)=="number"?ke.data.active_total:null,ls=typeof((ot=ke.data)==null?void 0:ot.revoked_total)=="number"?ke.data.revoked_total:null,is=g.includeAllRepos||g.repoIds.length>0,ds=g.includeAllUsers||g.targetUserIds.length>0,cs=is&&ds,us=n.useMemo(()=>ze.slice().sort((r,o)=>new Date(We(o)).getTime()-new Date(We(r)).getTime()).slice(0,6),[ze]),ms=n.useMemo(()=>be?{succeeded:be.succeeded.length,failed:be.failed.map(r=>({targetUserId:r.targetUserId,repoId:r.repoId,reason:r.reason,hasExistingGrant:!!r.existingGrant}))}:null,[be]),Je=Math.max(1,Math.ceil(q.total/me||0)),Be=q.total?ne*me:0,xs=q.total?Math.min(Be+q.items.length,q.total):0,et=ne>0,tt=Be+me<q.total,fs=async()=>{var B;const r=g.includeAllRepos?H.map(I=>I.repoId):g.repoIds,o=Array.from(new Set(r.filter(Boolean)));if(!o.length){l.danger("Select at least one repository before granting access",{id:"grant-validation"});return}const j=g.includeAllUsers?x.map(I=>I.userId):g.targetUserIds,Y=Array.from(new Set(j.filter(I=>I)));if(!Y.length){l.danger("Select at least one user before granting access",{id:"grant-no-user"});return}if(o.filter(I=>!Ze.get(I)).length){l.danger("Unable to resolve the selected repositories",{id:"grant-missing-repo"});return}const S=[];for(const I of o){const U=Ze.get(I);for(const Ie of Y)S.push({target_user_id:Ie,repo_id:I,scan_configuration_id:(B=U==null?void 0:U.scanConfigurationId)!=null?B:void 0,notes:g.notes||void 0})}He(!0);const Z=S.length>1;try{if(!s){l.danger("Workspace context unavailable for grant creation",{id:"grant-no-workspace"});return}if(Z){const I=await Ds(S),U=Ks(I,x);qe(U),l.success("Bulk grant processed. ".concat(U.succeeded.length," succeeded, ").concat(U.failed.length," failed."),{id:"repo-access-grant-created-bulk"})}else await Ws(S[0]),qe(null),l.success("Grant created",{id:"repo-access-grant-created"});P(Oe),E(0),await K()}catch(I){I instanceof ct&&I.status===409?(l.danger("Grant already exists for this user and repository",{id:"repo-access-grant-conflict",error:I}),await K()):l.danger("Unable to create this grant",{id:"repo-access-grant-error",error:I})}finally{He(!1)}},gs=async()=>{const r=g.includeAllRepos?H.map(B=>B.repoId):g.repoIds,o=Array.from(new Set(r.filter(Boolean)));if(!o.length){l.danger("Select at least one repository before revoking access",{id:"revoke-selection-validation-repo"});return}const j=g.includeAllUsers?x.map(B=>B.userId):g.targetUserIds,Y=Array.from(new Set(j.filter(Boolean)));if(!Y.length){l.danger("Select at least one user before revoking access",{id:"revoke-selection-validation-user"});return}$e(!0);const te="Admin revoke via console";let S=0;const Z=[];try{if(!s){l.danger("Workspace context unavailable for revocation",{id:"revoke-selection-no-workspace"});return}for(const B of o)for(const I of Y)try{await mt(B,I,te),S+=1}catch(U){if(U instanceof ct&&U.status===404){S+=1;continue}Z.push({repoId:B,userId:I,error:U})}if(S&&(l.success("Revoked ".concat(S," grant").concat(S===1?"":"s","."),{id:"repo-access-revoke-selected-success"}),P(Oe),E(0),await K()),Z.length){const B=S>0?"Couldn't revoke ".concat(Z.length," grant").concat(Z.length===1?"":"s","."):"Unable to revoke the selected grants.",I=xt(Z[0].error),U=S>0?"repo-access-revoke-selected-partial":"repo-access-revoke-selected-error";S>0?l.warning(B,{id:U,description:I}):l.danger(B,{id:U,error:Z[0].error})}}finally{$e(!1)}},ps=async r=>{const o="Admin revoke via console";try{if(!s){l.danger("Workspace context unavailable for revocation",{id:"repo-access-revoke-no-workspace-".concat(r.grantId)});return}await mt(r.repoId,r.userId,o),l.success("Marked grant for ".concat(ae(r.userId,x)," as revoked"),{id:"repo-access-revoke-".concat(r.grantId)}),E(0),await K()}catch(j){l.danger("Unable to revoke this grant",{id:"repo-access-revoke-error-".concat(r.grantId),error:j})}};return e.jsxs("div",{className:"flex w-full flex-col gap-6 px-4 pb-10 md:px-6 lg:px-10",children:[e.jsxs("section",{className:"border-token-border-light bg-token-surface-secondary/60 rounded-3xl border p-6 shadow-sm backdrop-blur",children:[e.jsx("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:e.jsxs("div",{className:"max-w-2xl",children:[e.jsx("p",{className:"text-token-text-tertiary text-xs font-medium tracking-[0.16em] uppercase",children:e.jsx(c,{id:"DAK0+Z",defaultMessage:"Native repo ACL"})}),e.jsx("h1",{className:"text-token-text-primary mt-1 text-3xl font-semibold",children:e.jsx(c,{id:"VSudZf",defaultMessage:"Manage Aardvark repository access"})}),e.jsx("p",{className:"text-token-text-secondary mt-2 text-sm",children:e.jsx(c,{id:"fWVifu",defaultMessage:"Give users access to scan results, see who currently has repo access, and keep the roster tidy. Everything here reflects the latest data from your workspace."})})]})}),e.jsx("div",{className:"mt-6",children:e.jsx(Os,{workspaceAdminCount:At,shareableRepoCount:wt,aggregateActiveGrantCount:ns,aggregateRevokedGrantCount:ls})})]}),e.jsxs("section",{className:"grid gap-6 lg:grid-cols-[2fr_1fr]",children:[e.jsxs("div",{className:"border-token-border-light bg-token-surface-secondary/40 flex flex-col gap-5 rounded-3xl border p-6",children:[e.jsx(Es,{userFilter:as,repoFilter:os,includeRevoked:!!u.includeRevoked,onIncludeRevokedChange:ts,searchValue:es,onSearchChange:ss}),e.jsx(Qs,{grantList:q,isLoading:Mt,members:x,onRevokeGrant:ps,pageStart:Be,pageEnd:xs,currentPage:q.total?ne:0,totalPages:Je,canGoPrev:et,canGoNext:tt,onPreviousPage:()=>et&&E(r=>Math.max(r-1,0)),onNextPage:()=>tt&&E(r=>Math.min(r+1,Je-1))})]}),e.jsx("aside",{className:"flex flex-col gap-5",children:e.jsx(Bs,{repoComboboxProps:Yt,repoSelection:Xt,userComboboxProps:Zt,userSelection:Jt,userLoadMore:Vt,notesValue:g.notes,onNotesChange:rs,canSubmitSelection:cs,isCreateBusy:_e,isRevokeBusy:Ue,onCreateGrant:fs,onRevokeSelectedGrants:gs,bulkGrantResult:ms})})]}),e.jsxs("section",{className:"grid gap-6 lg:grid-cols-[2fr_1fr]",children:[e.jsxs("div",{className:"border-token-border-light bg-token-surface-primary/80 rounded-3xl border p-6 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-token-text-primary text-xl font-semibold",children:e.jsx(c,{id:"Ib6qrF",defaultMessage:"Repositories"})}),e.jsx("p",{className:"text-token-text-secondary text-sm",children:e.jsx(c,{id:"Vijhll",defaultMessage:"Scan configurations you can manage in this workspace. Use these cards to spot owners, findings, and current access."})})]}),je&&e.jsx(pt,{className:"h-5 w-5"})]}),e.jsx("div",{className:"mt-4 grid gap-4 md:grid-cols-2",children:H.map(r=>{const o=typeof r.activeGrantCount=="number"?r.activeGrantCount:r.existingGrants.length;return e.jsxs("div",{className:"border-token-border-subtle bg-token-surface-secondary/60 hover:border-token-border-light flex flex-col gap-3 rounded-2xl border p-4 transition",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-token-text-primary text-sm font-semibold",children:r.repoFullName}),e.jsx("a",{href:r.repoUrl,className:"text-token-text-tertiary text-xs underline-offset-2 hover:underline",children:r.repoId})]}),e.jsx("div",{className:"text-token-text-secondary text-xs",children:e.jsx(c,{id:"UgD9KK",defaultMessage:"Owner · {name}",values:{name:r.configurationOwner.name}})}),e.jsx("div",{className:"text-token-text-secondary text-xs",children:e.jsx(c,{id:"Q1Y2+E",defaultMessage:"Active grants: {count}{count, plural, =0 { (none yet)} one {} other {}}",values:{count:o}})})]},r.repoId)})})]}),e.jsx(Ls,{activityFeed:us,members:x})]})]})}function er(){const t=ws(),a=_s(t),s=As();return a?e.jsx(tr,p({},s)):null}function tr(t){return e.jsx(Us,{children:e.jsx(Js,{})})}const pr=Ms(function(){return e.jsx(er,{})});export{pr as default};
//# sourceMappingURL=g9v4sqnn1r34kzin.js.map
