var Xe=Object.freeze,_s=Object.defineProperty;var Ye=(e,t)=>Xe(_s(e,"raw",{value:Xe(t||e.slice())}));import{r as x,j as s,M as y,e as O,i as as,a as de,u as ue,m as Ts,L as Ns}from"./fg33krlcm0qyi6yw.js";import{C as me}from"./ir7nzwbolrsm3ds2.js";import{kZ as Ms,ca as Cs,uU as Ss,dt as Fs,v3 as Rs,j1 as Ps,ib as Bs,kS as Is,Z as Es,fB as Ds,ab as Ws}from"./k65njl5wlgspihfr.js";import{C as As}from"./mmn9462oogkapcg8.js";import{F as Os,bv as qs,bg as Qs,l as A,c0 as ns,m as fe,eu as ee,T as se,kk as zs,gI as Vs,oM as Us,c as te,aW as $s,gd as Ks,o as Hs,b as Gs,a9 as Zs,x as Le}from"./mtk1qztvnb31pw5r.js";import{m as Js}from"./ck1u9icgxosmytry.js";import{B as Xs,c as Ys,d as Ls,e as et,W as st}from"./eqi3xjytwhmszqqa.js";import{a as tt,w as at,W as K,c as rs,f as es}from"./sy1xvqwioh9ks4z8.js";import{h as k,K as nt,L as rt,q as ot}from"./n0ab5m1z76n8mazm.js";import{u as it,W as lt,a as ct}from"./bes67zhi4fr5gq8i.js";import{A as dt}from"./btdpwmi6j9nv6qc2.js";import{s as ae}from"./cmaobpdpreyiep8p.js";var ts;const ce=Os.div(ts||(ts=Ye(["animate-pulse rounded-[4px] bg-token-main-surface-tertiary"])));function ut(){return s.jsx(qs,{children:s.jsx(Qs.div,{className:"border-token-border-light overflow-y-clip border-b",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{duration:.15,ease:"easeOut"},children:s.jsxs("div",{className:"flex w-full flex-col gap-0.5 px-3 py-3.5",children:[s.jsx(ce,{className:"mt-[0.425rem] mb-[0.225rem] h-[0.6rem] w-[200px]"}),s.jsx(ce,{className:"mt-[0.225rem] mb-[0.425rem] h-[0.6rem] w-[100px]"})]})})})}const mt=x.memo(ut);function ft({count:e,className:t}){const o=e>=4?Xs:e===3?Ys:e===2?Ls:et;return s.jsxs("span",{className:A("border-token-border-default text-token-text-primary inline-flex h-[24px] items-center gap-1 rounded-full border px-2 py-1 text-[12px] font-medium",t),children:[s.jsx(o,{"aria-hidden":!0,className:"icon-sm"}),s.jsx(y,{id:"pNS3rO",defaultMessage:"{count}",values:{count:e}})]})}function pt({done:e,total:t,className:o}){return s.jsxs("span",{className:A("text-token-text-tertiary inline-flex items-center gap-2 text-sm",o),children:[s.jsx(y,{id:"wham.whamAttemptsProgress.progress",defaultMessage:"{done}/{total} versions",values:{done:e,total:t}}),e===0?s.jsx(me,{size:12,strokeWidth:2}):s.jsx(Ms,{percentage:e/t*100,thickness:1/10,className:"text-token-text-primary size-3",backgroundStrokeClassName:" stroke-token-text-primary/20",transitionDuration:"0.2s",transitionTimingFunction:"cubic-bezier(0.55, 0, 1, 1)"})]})}function ht({taskId:e,latestTurnId:t,behavior:o="navigate",onFixCreated:r}){const a=O(),c=fe(),n=as(),i=de(),d=k(l=>l.setLastViewedTaskId),g=k(l=>l.assignPendingTaskToFinalTask),u=k(l=>l.removePendingTaskId),w=k(l=>l.clearFixReviewTaskInFlight),m=x.useCallback(l=>{["current","all","code_review","archived"].forEach(P=>{const f=["wham","tasks",P];i.setQueryData(f,N=>ee(N,B=>{B&&B.pages.forEach(ne=>{var _;(_=ne.items)==null||_.forEach(q=>{if(q.id===e){if(!q.task_status_display){q.task_status_display={fix_task_id:l};return}q.task_status_display.fix_task_id=l}})})}))})},[i,e]);return ue({mutationFn:async()=>{if(!t)throw new Error("missing_latest_turn_id");return await K.createFixReviewTask(e,t)},onSuccess:(l,p)=>{m(l.task.id),i.invalidateQueries({queryKey:["wham","tasks"]}),i.invalidateQueries({queryKey:["wham","tasks","current"]}),w(e),p!=null&&p.pendingTaskId&&g(p.pendingTaskId,l.task.id),o==="navigate"&&(d(l.task.id),n("/codex/tasks/".concat(l.task.id)),c.success(a.formatMessage({id:"wham.whamTaskRow.fixTaskCreated",defaultMessage:"Started fix task"}))),r==null||r({fixTaskId:l.task.id,pendingTaskId:p==null?void 0:p.pendingTaskId,response:l})},onError:(l,p)=>{if(w(e),p!=null&&p.pendingTaskId&&u(p.pendingTaskId),l instanceof tt){at(l,e,a,c);return}c.danger(a.formatMessage({id:"wham.whamTaskRow.fixTaskCreateError",defaultMessage:"Couldn't start fix task"}))}})}function gt({taskId:e,latestTurnId:t,highlightTasksTabOnSuccess:o=!1}){const r=k(m=>m.addPendingTaskId),a=k(m=>m.shouldHighlightTasksTab),c=k(m=>m.setShouldHighlightTasksTab),n=k(m=>m.markFixReviewTaskInFlight),i=k(m=>m.clearFixReviewTaskInFlight),d=k(m=>!!m.fixReviewTasksInFlight[e]),g=ht({taskId:e,latestTurnId:t,behavior:"stay"}),u=x.useCallback(m=>{if(m.stopPropagation(),m.preventDefault(),d||g.isPending||!t)return;const l=crypto.randomUUID();r(l);const p=o&&!a;p&&c(!0),n(e),g.mutateAsync({pendingTaskId:l}).catch(()=>{p&&c(!1),i(e)})},[r,o,d,g,c,n,i,a,e,t]),w=g.isPending||d;return s.jsx("button",{type:"button",className:"border-token-border-subtle bg-token-bg-tertiary text-token-text-primary hover:bg-token-bg-secondary flex items-center gap-2 rounded-full border px-3 py-1 text-xs font-medium transition-colors disabled:cursor-not-allowed disabled:opacity-70",onClick:u,disabled:w||!t,children:w?s.jsx(ns,{className:"icon-sm"}):s.jsx(y,{id:"wham.whamTaskRow.fixButton",defaultMessage:"Fix"})})}function xt({criticalIssueCount:e,highIssueCount:t,totalIssueCount:o}){"use no forget";const r=O();if(o===0)return s.jsx(se,{label:r.formatMessage({id:"wham.whamTaskIssuesSummary.noIssuesTooltip",defaultMessage:"Codex didn’t flag any issues"}),children:s.jsx("span",{className:"bg-token-bg-success/20 text-token-text-primary inline-flex min-w-[1.5rem] items-center justify-center gap-1 rounded-full px-2 py-0.5 text-xs font-semibold",children:s.jsx(Cs,{className:"icon-sm text-[#008000]"})})});const a=[];return e>0&&a.push({severity:"critical",count:e}),t>0&&a.push({severity:"high",count:t}),a.length===0?null:s.jsx("div",{className:"flex flex-wrap items-center gap-2",children:a.map(({severity:c,count:n})=>{const i=c==="critical",d=i?r.formatMessage({id:"wham.whamTaskIssuesSummary.criticalIssueTooltip",defaultMessage:"Codex flagged {count, plural, one {# severe bug} other {# severe bugs}}"},{count:n}):r.formatMessage({id:"wham.whamTaskIssuesSummary.highIssueTooltip",defaultMessage:"Codex flagged {count, plural, one {# bug} other {# bugs}}"},{count:n});return s.jsx(se,{label:d,children:s.jsxs("span",{className:A("inline-flex items-center gap-1.5 rounded-full px-2.5 py-1 text-xs font-medium",i?"bg-token-text-status-error/15 text-token-text-status-error":"bg-token-text-status-warning/15 text-token-text-status-warning"),children:[s.jsx(Ss,{className:A("icon-sm",i?"text-token-text-status-error":"text-token-text-status-warning")}),i?s.jsx(y,{id:"wham.whamTaskIssuesSummary.criticalIssueCopy",defaultMessage:"{count, plural, one {# severe bug} other {# severe bugs}}",values:{count:n}}):s.jsx(y,{id:"wham.whamTaskIssuesSummary.highIssueCopy",defaultMessage:"{count, plural, one {# bug} other {# bugs}}",values:{count:n}})]})},"".concat(c,"-").concat(n))})})}function kt({dateString:e}){const t=O(),[o,r]=x.useState(()=>new Date);zs(()=>r(new Date),6e4);const a=x.useMemo(()=>new Date(e),[e]),c=x.useMemo(()=>Vs(o,a),[o,a]),n=x.useMemo(()=>Us(o,a),[o,a]);return n<1?t.formatMessage({id:"wham.formattedRelativeDateTime.justNow",defaultMessage:"Just now"}):n<60?t.formatMessage({id:"wham.formattedRelativeDateTime.minAgo",defaultMessage:"{numMinsDiff} min ago"},{numMinsDiff:n}):c===0?a.toLocaleTimeString(t.locale,{hour:"numeric",minute:"2-digit"}):a.toLocaleDateString(t.locale,{month:"short",day:"numeric"})}function wt(e){return/^[0-9a-f]{40}$/i.test(e)?e.slice(-7):e.length>48?"…"+e.slice(-48):e}const vt=te(ae,"7e3797",24,24),yt=te(ae,"e03463",24,24),bt=te(ae,"d3623f",24,24),jt=te(ae,"0e4f30",24,24);function _t(e){return e?e.merged?"merged":e.state==="closed"?"closed":e.draft?"draft":"open":null}function Tt({taskAssistantTurnId:e,taskId:t,data:o,className:r}){const[a,c]=x.useState(o),n=x.useRef(!1);if(x.useEffect(()=>{async function u(){if(!(!a||!e||!t||n.current)){if(!a.merged)try{const w=await K.getTaskTurnPR(t,e);c(w.pr)}catch(w){}n.current=!0}}u()},[a,e,t]),!a)return null;const i=_t(a);if(!i)return null;const d=a.url,g=u=>{u.stopPropagation(),u.preventDefault(),window.open(d,"_blank","noopener,noreferrer")};return s.jsxs("button",{type:"button",onClick:g,onAuxClick:u=>{u.button===1&&g(u)},className:A("inline-flex w-fit cursor-pointer items-center rounded-full px-2.5 py-1 text-[10px] font-semibold","border border-transparent","group/pill overflow-hidden",{"bg-[#C3DEC780] text-[#008C2E] dark:bg-[#6BBD6720] dark:text-[#6BBD67]":i==="open","bg-[#D6303D20] text-[#D6303D] dark:bg-[#FD756F20] dark:text-[#FD756F]":i==="closed","bg-[#8E3CF320] text-[#8E3CF3] dark:bg-[#C26FFD20] dark:text-[#C26FFD]":i==="merged","bg-[#59636E20] text-[#59636E] dark:bg-[#B2B2B220] dark:text-[#B2B2B2]":i==="draft"},r),children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"icon-container relative transition-all duration-100 group-hover/pill:translate-y-full group-hover/pill:opacity-0 group-hover/pill:blur-sm",children:i==="open"?s.jsx(jt,{"aria-hidden":!0,className:"icon-xs me-1"}):i==="closed"?s.jsx(vt,{"aria-hidden":!0,className:"icon-xs me-1"}):i==="merged"?s.jsx(bt,{"aria-hidden":!0,className:"icon-xs me-1"}):s.jsx(yt,{"aria-hidden":!0,className:"icon-xs me-1"})}),s.jsx("div",{className:"absolute start-0 top-0 -translate-y-full opacity-0 transition-all duration-100 group-hover/pill:translate-y-0 group-hover/pill:opacity-100",children:s.jsx(dt,{"aria-hidden":!0,className:"icon-xs me-1"})})]}),i==="open"?s.jsx(y,{id:"wham.prStatusBadge.open",defaultMessage:"Open"}):i==="closed"?s.jsx(y,{id:"wham.prStatusBadge.closed",defaultMessage:"Closed"}):i==="merged"?s.jsx(y,{id:"wham.prStatusBadge.merged",defaultMessage:"Merged"}):s.jsx(y,{id:"wham.prStatusBadge.draft",defaultMessage:"Draft"})]})}function ss(e){return e==="archived"?{add:["current","all"],remove:["archived","code_review"]}:e==="code_review"?{add:["archived"],remove:["code_review","current","all"]}:{add:["archived"],remove:["current","all","code_review"]}}function Nt(e){return rs(e)}function Mt(e){var t;return(t=e==null?void 0:e.filter(o=>Nt(o)).length)!=null?t:0}function Ct(e){if(e)return typeof e=="string"?e:"".concat(e.partition_key,"~").concat(e.id)}function St({taskListItem:e,index:t,disableFocusStyle:o,hoveredIndex:r,isCompact:a=!1,hideBorder:c=!1,onMouseEnter:n,onMouseLeave:i,linkPath:d,showArchiveButton:g=!0,currentFilter:u}){var Ne,Me,Ce,Se,Fe,Re,Pe,Be,Ie,Ee,De,We,Ae,Oe,qe,Qe,ze,Ve,Ue,$e,Ke,He,Ge,Ze;const w=O(),m=fe(),l=$s(),p=k(h=>h.homeTab),P=u!=null?u:rt(p),f=k(h=>h.removePendingTaskByTaskId),N=k(h=>h.setLastViewedTaskId),B=(Ne=e.task_status_display)==null?void 0:Ne.fix_task_id,ne=as(),_=(Se=(Ce=(Me=e.task_status_display)==null?void 0:Me.latest_turn_status_display)==null?void 0:Ce.turn_status)!=null?Se:"pending",q=it(e.id,_,(Re=(Fe=e.task_status_display)==null?void 0:Fe.latest_turn_status_display)==null?void 0:Re.turn_id),pe=(Ee=(Ie=(Be=(Pe=e.task_status_display)==null?void 0:Pe.latest_turn_status_display)==null?void 0:Be.diff_stats)==null?void 0:Ie.lines_added)!=null?Ee:0,he=(Oe=(Ae=(We=(De=e.task_status_display)==null?void 0:De.latest_turn_status_display)==null?void 0:We.diff_stats)==null?void 0:Ae.lines_removed)!=null?Oe:0,j=(qe=e.task_status_display)==null?void 0:qe.latest_turn_status_display,T=(Qe=j==null?void 0:j.issue_counts)!=null?Qe:null,ge=(ze=T==null?void 0:T["0"])!=null?ze:0,xe=(Ve=T==null?void 0:T["1"])!=null?Ve:0,os=T?Object.values(T).reduce((h,C)=>h+C,0):0,is=ge+xe,Q=Ks(e.pull_requests),b=Q==null?void 0:Q.pull_request,ke=Ct(Q==null?void 0:Q.assistant_turn_id),we=((Ue=e==null?void 0:e.task_status_display)==null?void 0:Ue.initial_intent)==="cr",H=we?b:null,re=b==null?void 0:b.head,ls=($e=e.task_status_display)==null?void 0:$e.branch_name,I=(Ke=re!=null?re:ls)!=null?Ke:"",ve=wt(I),cs=I&&I!==ve,ds=!l&&!!I&&I!=="master"&&I!=="main"&&(b==null?void 0:b.state)!=="closed"&&(b==null?void 0:b.state)!=="merged",oe=j==null?void 0:j.turn_id,ye=(j==null?void 0:j.cancellation_requested_at)!=null,us=_==="completed"&&is>0&&!!oe&&T!=null&&!B,be=(He=j==null?void 0:j.sibling_turn_ids)!=null?He:[],je=be.length+1,ms=be.length>0&&(_==="pending"||_==="in_progress")&&!b,{data:ie}=nt(e.id,oe,ms),G=(Ge=ie==null?void 0:ie.latest_turns)!=null?Ge:null,Z=G?G.length:je,fs=G?Mt(G):rs(j)?je:0,M=de(),ps=x.useMemo(()=>s.jsx(me,{size:20,initialOffset:Math.random()*20*Math.PI}),[]),hs=t!==void 0&&r!=null&&t===r-1,gs=Gs(),xs=!we&&!l&&!a&&_!=="pending"&&_!=="in_progress"&&g,ks=Hs(gs,"879591222")||void 0;x.useEffect(()=>{f(e.id)},[e.id,f]);const{mutate:ws}=ue({mutationFn:({taskId:h,currentFilter:C})=>C==="archived"?K.recoverTask(h):K.archiveTask(h),onMutate:async({taskId:h,taskListItem:C,currentFilter:R})=>{var X,Je;const{add:z,remove:V}=ss(R),E={},U=async S=>{E[S.join("|")]=M.getQueryData(S),await M.cancelQueries({queryKey:S})};for(const S of V){const F=["wham","tasks",S];await U(F),M.setQueryData(F,le=>ee(le,W=>{W==null||W.pages.forEach($=>{var Y;$.items=((Y=$.items)!=null?Y:[]).filter(L=>L.id!==h)})}))}for(const S of z){const F=["wham","tasks",S];await U(F),M.setQueryData(F,le=>ee(le,W=>{var L;if(!W||W.pages.length===0)return;const $=W.pages[0],Y=(L=$.items)!=null?L:[];$.items=[C,...Y].filter((vs,ys,bs)=>bs.findIndex(js=>js.id===vs.id)===ys)}))}const D=["wham","task",C.id,(Je=(X=C.task_status_display)==null?void 0:X.latest_turn_status_display)==null?void 0:Je.turn_id];return E[D.join("|")]=M.getQueryData(D),await M.cancelQueries({queryKey:D}),M.setQueryData(D,S=>ee(S,F=>{F&&(F.task.archived=!F.task.archived)})),{snapshots:E}},onError:(h,C,R)=>{var z;Object.entries((z=R==null?void 0:R.snapshots)!=null?z:{}).forEach(([V,E])=>{M.setQueryData(V.split("|"),E)}),m.danger(w.formatMessage({id:"wham.whamTaskRow.failedToUpdateTask",defaultMessage:"Failed to update task"}))},onSuccess:(h,C)=>{var U,D;const{taskListItem:R,currentFilter:z}=C,{add:V,remove:E}=ss(z);M.invalidateQueries({queryKey:["wham","task",R.id,(D=(U=R.task_status_display)==null?void 0:U.latest_turn_status_display)==null?void 0:D.turn_id]}),[...V,...E].forEach(X=>M.invalidateQueries({queryKey:["wham","tasks",X]}))}}),J=T!=null?s.jsx(xt,{criticalIssueCount:ge,highIssueCount:xe,totalIssueCount:os},"issues-summary"):null,v=[];switch(_){case"pending":case"in_progress":{ye?v.push(s.jsx("span",{className:"text-token-text-secondary",children:s.jsx(y,{id:"wham.whamTaskRow.cancelling",defaultMessage:"Cancelling…"})},"cancelling-text")):Z>1?v.push(s.jsx(pt,{done:fs,total:Z},"attempt-progress")):a?v.push(ps):(v.push(s.jsx("span",{className:"loading-shimmer-pure-text",children:Js(q,32)},"in-progress-text")),ks&&!ye&&v.push(s.jsx(Pt,{taskId:e.id})));break}case"failed":v.push(s.jsx("span",{className:"text-token-text-status-error",children:s.jsx(y,{id:"wham.whamTaskRow.failed",defaultMessage:"Failed"})},"failed-text"));break;case"cancelled":v.push(s.jsx("span",{className:"text-token-text-secondary",children:s.jsx(y,{id:"wham.whamTaskRow.cancelled",defaultMessage:"Cancelled"})},"cancelled-text"));break;case"completed":{J&&v.push(J),Z>1&&!b&&v.push(s.jsx(ft,{count:Z},"attempts")),b&&ke&&v.push(s.jsx(Tt,{taskAssistantTurnId:ke,taskId:e.id,data:b},"pr-status")),(pe!==0||he!==0)&&!T&&v.push(s.jsx(lt,{className:"min-w-10 justify-end",linesAdded:pe,linesRemoved:he},"message-stats"));break}default:v.push(s.jsx("span",{className:"text-token-text-secondary",children:s.jsx(y,{id:"wham.whamTaskRow.unknown",defaultMessage:"Unknown"})},"unknown-text"));break}B?v.push(s.jsx(Zs,{type:"button",size:"small",color:"secondary",onClick:h=>{h.preventDefault(),h.stopPropagation(),N(B),ne("/codex/tasks/".concat(B))},children:s.jsx(y,{id:"wham.whamTaskRow.viewFixTask",defaultMessage:"Open fix"})},"view-fix-button")):us&&v.push(s.jsx(gt,{taskId:e.id,latestTurnId:oe,highlightTasksTabOnSuccess:P==="code_review"},"fix-button")),_!=="completed"&&J&&v.unshift(J);const _e=e.updated_at?new Date(e.updated_at*1e3):null,Te=(Ze=e.task_status_display)==null?void 0:Ze.environment_label;return s.jsx("div",{className:"group task-row-container",onMouseEnter:n,onMouseLeave:i,children:s.jsxs(Ft,{disableFocusStyle:o,taskId:e.id,linkPath:d,children:[s.jsxs("div",{className:A("border-token-border-light grid w-full grid-cols-[minmax(0,1fr)_auto] items-center gap-5 border-b px-4 py-3.5 text-sm md:px-3",(hs||c)&&"border-b-transparent"),children:[s.jsxs("div",{className:"flex flex-col gap-0.5",children:[s.jsxs("div",{className:"text-token-text-primary flex w-full min-w-0 items-center gap-1.5",children:[e.has_unread_turn&&s.jsx("div",{className:"size-1.5 rounded-full bg-blue-500"}),s.jsx("div",{className:"flex-1 truncate font-medium",children:H!=null&&H.title?s.jsx("span",{children:H.title}):s.jsx(Rt,{task:e})})]}),_e&&s.jsxs("div",{className:"text-token-text-tertiary flex gap-1",children:[s.jsx("span",{className:"truncate empty:hidden",children:s.jsx(kt,{dateString:_e.toISOString()})}),Te&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"text-token-text-tertiary",children:"·"}),s.jsx("span",{className:"truncate empty:hidden",children:Te})]}),ds&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"text-token-text-tertiary",children:"·"}),s.jsx(se,{label:cs?I:void 0,children:s.jsx("span",{className:"max-w-[8rem] truncate md:max-w-[10rem]",children:ve})})]})]})]}),s.jsx("div",{className:"flex flex-1 items-center gap-2",children:v})]}),xs&&s.jsx("div",{role:"button",onClick:h=>{h.stopPropagation(),h.preventDefault(),ws({taskId:e.id,taskListItem:e,currentFilter:P})},className:"before:from-token-bg-tertiary before:via-token-bg-tertiary absolute inset-y-1 end-0 z-20 flex w-20 cursor-pointer items-center justify-end pe-2 opacity-0 transition-opacity duration-0 group-hover:opacity-100 group-hover:duration-0 before:pointer-events-none before:absolute before:inset-0 before:-start-0.5 before:bg-gradient-to-l before:to-transparent before:content-['']",children:s.jsx(se,{label:e.archived?w.formatMessage({id:"wham.whamTaskRow.unarchiveTask",defaultMessage:"Unarchive"}):w.formatMessage({id:"wham.whamTaskRow.archiveTask",defaultMessage:"Archive"}),side:"top",children:e.archived?s.jsx(Fs,{className:"icon-md text-token-text-secondary hover:text-token-text-primary relative z-10"}):s.jsx(Rs,{className:"icon-md text-token-text-secondary hover:text-token-text-primary relative z-10"})})})]})})}function Ft({taskId:e,children:t,disableFocusStyle:o,linkPath:r}){const a=k(d=>d.setLastViewedTaskId),c=k(d=>d.lastViewedTaskId),n=x.useRef(null),i=Ts();return x.useEffect(()=>{c===e&&requestAnimationFrame(()=>{var d,g,u;(d=n.current)==null||d.scrollIntoView({behavior:"instant",block:"center"}),(g=i.state)!=null&&g.focusComposer||(u=n.current)==null||u.focus()})},[]),e?s.jsx("div",{className:A("hover:bg-token-bg-tertiary relative ring-inset",!o&&"focus-within:border-token-border-heavy focus-within:border-s-2 focus-within:ps-[-2px]"),children:s.jsx(Ns,{className:"outline-offset-[-1px] focus-within:rounded-lg",ref:n,to:r!=null?r:"/codex/tasks/".concat(e),onClick:()=>a(e),onMouseDown:d=>d.preventDefault(),children:t})}):s.jsx("div",{className:"hover:bg-token-bg-tertiary relative rounded-lg",children:t})}function Rt({task:e}){var g,u;const t=O(),o=(g=e.task_status_display)==null?void 0:g.latest_turn_status_display,r=o?(u=o.turn_status)!=null?u:"pending":"failed",[a,c]=x.useState(),n=o==null?void 0:o.turn_id,i=e.has_generated_title===!1&&(r==="pending"||r==="in_progress")&&!!n,d=x.useMemo(()=>"title-".concat(e.id,"-").concat(n!=null?n:""),[e.id,n]);return ct(e.id,n,["task_title_generated"],{enabled:i,subscriberId:d,onEvent:w=>c(w.title)}),r==="failed"&&e.has_generated_title===!1?t.formatMessage({id:"wham.whamTaskRow.codexTask",defaultMessage:"Codex task"}):e.has_generated_title===!1&&!a?s.jsx(ce,{className:"mt-[0.425rem] mb-[0.225rem] h-[0.6rem] w-[200px]"}):s.jsx("span",{children:a!=null?a:e.title})}function Pt({taskId:e}){const t=O(),o=fe(),r=de(),[a,c]=x.useState(!1),{mutate:n}=ue({mutationFn:async()=>(c(!0),await K.cancelTask(e),await r.invalidateQueries({queryKey:["wham","tasks"]}),!0),onError:()=>{o.danger(t.formatMessage({id:"wham.whamTaskRow.failedToCancelTask",defaultMessage:"Failed to cancel task"}))},onSuccess:()=>{}});return s.jsx("button",{type:"button",className:"border-token-border-heavy hover:bg-token-bg-secondary flex h-6 w-6 items-center justify-center rounded-full border",onClick:i=>{i.stopPropagation(),i.preventDefault(),st.recordCancel("home"),n()},disabled:a,"aria-label":t.formatMessage({id:"wham.composer.cancelTask",defaultMessage:"Cancel task"}),"data-testid":"stop-button",children:a?s.jsx(ns,{className:"icon-sm p-0.5"}):s.jsx(Ps,{className:"icon-sm"})})}function Bt({pendingTaskIds:e,inProgressTasks:t,closePopover:o}){return!t.length&&!e.length?s.jsx("div",{className:"flex min-w-48 items-center justify-center py-5",children:s.jsx(y,{id:"+xSTVR",defaultMessage:"No pending work"})}):s.jsxs("ol",{className:"max-h-[600px] w-[450px] overflow-y-auto p-2",children:[e.map(r=>s.jsx(mt,{},r)),t.map((r,a)=>s.jsx("li",{onClick:o,children:s.jsx(St,{index:a,taskListItem:r,isCompact:!0,disableFocusStyle:!0,hoveredIndex:null,onMouseEnter:Le,onMouseLeave:Le,hideBorder:a===t.length-1,currentFilter:"current"})},r.id))]})}function Gt(){var P;const[e,t]=x.useState(!1),o=x.useRef(null),{data:r}=ot(),a=k(f=>f.pendingTaskIds),c=k(f=>f.pendingCodeReviewIds),n=(P=r==null?void 0:r.pages.flatMap(f=>{var N;return(N=f.items)!=null?N:[]}))!=null?P:[],i=n.filter(f=>!es(f)),d=n.filter(f=>!!f.has_unread_turn),g=n.filter(f=>!!f.has_unread_turn||!es(f)),u=Array.from(Object.values(a)).filter(f=>!n.some(N=>N.id===f)),w=Array.from(Object.values(c)).filter(f=>!n.some(N=>N.id===f)),m=[...u,...w],l=i.length+m.length,p=O();return s.jsxs(Bs,{onOpenChange:t,children:[s.jsx(Is,{asChild:!0,children:s.jsx(Es,{"aria-label":p.formatMessage({id:"wham.notificationPopover.openNotifications",defaultMessage:"Open notifications"}),children:l===0?s.jsxs("div",{className:"relative",children:[d.length>0&&s.jsx("div",{className:"absolute start-0 top-0 size-1.5 rounded-full bg-blue-500"}),s.jsx(Ds,{})]}):s.jsx(me,{size:24,arcPercentage:e?1:.25,children:s.jsx("span",{className:"text-xs",children:l})})})}),s.jsx(Ws,{forceMount:!0,children:s.jsx(As,{isOpen:e,closePopover:()=>t(!1),popoverContentRef:o,align:"end",side:"bottom",sideOffset:8,alignOffset:-8,children:s.jsx(Bt,{pendingTaskIds:m,inProgressTasks:g,closePopover:()=>t(!1)})})})]})}export{Gt as N,St as W,mt as a,wt as g,ht as u};
//# sourceMappingURL=kpobiwwkg2o2u14w.js.map
