var B=Object.defineProperty,R=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var L=(t,e,s)=>e in t?B(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,w=(t,e)=>{for(var s in e||(e={}))W.call(e,s)&&L(t,s,e[s]);if(U)for(var s of U(e))$.call(e,s)&&L(t,s,e[s]);return t},M=(t,e)=>R(t,z(e));import{e as F,r as x,j as o,f as k,M as j}from"./fg33krlcm0qyi6yw.js";import{gk as C,a9 as D,gp as A,gq as I,R as P,_ as N,c0 as q,m as H,C as O}from"./mtk1qztvnb31pw5r.js";import{cL as G,fH as T,mW as K,ku as _}from"./k65njl5wlgspihfr.js";import{A as X}from"./nwdwrv5b1h68xdm5.js";import Q from"./bio6zqk7sn9h2l92.js";function me({path:t,displayName:e,isSelected:s,isSelectable:a=!0,selectDisabledTooltip:n,deleteEnabled:l,onSelected:d,onDelete:u,onPathChange:r,canEdit:i,editDisabledTooltip:g,isPathEditing:h,onIsPathEditingChange:f}){"use no forget";const v=F(),[p,c]=x.useState(t);return x.useEffect(()=>c(t),[t]),o.jsxs("div",{className:"flex h-10 items-center justify-between gap-2 rounded-lg px-2 ".concat(s?"bg-token-bg-secondary":"hover:bg-token-bg-secondary"," group ").concat(a?"cursor-pointer":"cursor-not-allowed"," transition-colors"),onClick:()=>a&&d(),title:a?void 0:n,children:[o.jsx(C,{className:"text-token-interactive-icon-tertiary-default"}),o.jsx("div",{className:"flex h-full min-w-0 flex-1 items-center justify-between",children:!s||!i?o.jsx("div",{className:"truncate text-start text-sm font-medium",children:e}):h?o.jsx("input",{className:"ring-token-border-light focus:ring-primary h-full w-full rounded bg-transparent px-2 text-sm ring-1 outline-none",value:p,autoFocus:!0,onChange:m=>c(m.target.value),onBlur:()=>{r==null||r(p),f==null||f(!1)},onKeyDown:m=>{m.key==="Enter"&&(r==null||r(p),f==null||f(!1)),m.key==="Escape"&&(m.preventDefault(),c(t),f==null||f(!1))},disabled:!i}):o.jsx("button",{type:"button",className:"truncate text-start text-sm font-medium",onClick:m=>{m.stopPropagation(),i&&(f==null||f(!0))},disabled:!i,children:e})}),l&&o.jsx("div",{className:"opacity-0 transition-opacity group-hover:opacity-100",children:o.jsx(D,{"aria-label":v.formatMessage(Y.removeFile),size:"small",color:"danger",onClick:m=>{m.stopPropagation(),u==null||u()},disabled:!i,icon:G,title:g})})]})}const Y=k({removeFile:{id:"3Z7IQq",defaultMessage:"Remove file"}});function pe(t){const e=t.replace(/\\/g,"/").split("/").filter(Boolean);return e.length===0?t.trim()||"file":e[e.length-1]}function Z(t){const e=t.replace(/\\/g,"/").split("/").filter(Boolean);return e.length===0?"file":e[e.length-1]}function J(t){return t.trim().replace(/\\/g,"/").replace(/^\/+/,"")}function V(t){if(!t)return null;for(const e of Object.entries(t)){const[s,a]=e;if(s.trim().toLowerCase().endsWith("skill.md"))return e}return null}function ee(t){const e=t.replace(/^\ufeff/,""),s=e.split(/\r?\n/);let a=0;for(;a<s.length&&!s[a].trim();)a+=1;if(a<s.length&&s[a].trim()==="---"){let n=a+1;for(;n<s.length&&s[n].trim()!=="---";)n+=1;if(n<s.length)return s.slice(n+1).join("\n").trim()}return e.trim()}function te(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"".concat(Date.now(),"-").concat(Math.random().toString(16).slice(2))}async function ve(t,e){const s=V(t.files);if(!s)return;const[,a]=s;if(!a||typeof a.start!="number"||typeof a.length!="number"||a.length<=0)return;const n=await T(t.id,t.sediment_id);if(e!=null&&e.aborted)return;if(!n.download_url)throw new Error("Unable to fetch SKILL.md download URL");const l=Math.max(0,a.start),d=l+a.length-1,u={};a.length>0&&(u.Range="bytes=".concat(l,"-").concat(d));const r=await fetch(n.download_url,{headers:u,signal:e});if(e!=null&&e.aborted)return;let i=await r.arrayBuffer();if(e!=null&&e.aborted)return;r.status!==206&&a.length>0&&i.byteLength>=d+1&&(i=i.slice(l,d+1));const g=new TextDecoder("utf-8").decode(i);return ee(g)}const xe=async(t,e,s,a)=>{var u;const n=t.map(r=>r.webkitRelativePath&&r.webkitRelativePath.length>0?r.webkitRelativePath:void 0),l=n.every(r=>typeof r=="string"&&r.length>0);let d=null;l&&n[0]&&(d=n[0].replace(/\\/g,"/").split("/")[0]||null);for(let r=0;r<t.length;r++){const i=t[r],g=te();let h;const f=n[r];if(l&&f){const v=f.replace(/\\/g,"/"),p=d?v.split("/").slice(1).join("/"):v;h=J(p)}else h=Z(i.name);e(v=>[...v.filter(p=>p.path.toLowerCase()!==i.name.toLowerCase()),{clientId:g,filename:i.name,size:i.size,contentType:i.type||"application/octet-stream",path:h,status:"uploading"}]);try{const p=(u=(await K([{filename:i.name,content_type:i.type||"application/octet-stream"}])).uploads)==null?void 0:u[0];if(!p)throw new Error("Failed to initialize upload");await Q.put(p.upload_url,i,{headers:{"Content-Type":i.type||"application/octet-stream","x-ms-blob-type":"BlockBlob","x-ms-version":"2020-04-08"}}),await P.safePost("/hazelnuts/uploads/finish",{requestBody:{file_id:p.file_id}}),e(c=>c.map(m=>m.clientId===g?M(w({},m),{fileId:p.file_id,status:"uploaded"}):m))}catch(v){N.addError(v),e(p=>p.map(c=>c.clientId===g?M(w({},c),{status:"error",error:s.formatMessage(E.uploadFailed)}):c)),a.danger(s.formatMessage(E.uploadFailed))}}};function he(t,e,s){const a=e.trim();if(!a)return t.formatMessage(b.validationPathEmpty);const n=a.replace(/\\/g,"/");if(n.startsWith("/"))return t.formatMessage(b.validationPathAbsolute);const l=n.split("/");return l.some(d=>d===""||d===".")||l.some(d=>d==="..")?t.formatMessage(b.validationPathDot):n.trim().toLowerCase()==="skill.md"?t.formatMessage(b.validationPathSkillMd):s>1?t.formatMessage(b.validationPathDuplicate):null}async function se(t,e,s){const a=await T(t,e);if(!a.download_url)throw new Error("Unable to fetch download URL");const n={};let l=0,d=0;s&&typeof s.start=="number"&&typeof s.length=="number"&&s.length>0&&(l=Math.max(0,s.start),d=l+s.length-1,n.Range="bytes=".concat(l,"-").concat(d));const u=await fetch(a.download_url,{headers:n});if(!u.ok)throw new Error("Unable to download file content");let r=await u.arrayBuffer();if(s&&s.length>0&&u.status!==206){const i=l+s.length;r.byteLength>=i&&(r=r.slice(l,i))}return new TextDecoder("utf-8").decode(r)}async function ae(t){if(!t)throw new Error("Missing file id");const e=await A(t);if(e.status!==I.Success||!e.download_url)throw new Error("Unable to fetch download URL");const s={},a=await fetch(e.download_url,{headers:s});if(!a.ok)throw new Error("Unable to download file content");const n=await a.arrayBuffer();return new TextDecoder("utf-8").decode(n)}const E=k({uploadFailed:{id:"363wGD",defaultMessage:"Failed to upload file."}}),b=k({validationPathEmpty:{id:"Z7PcWS",defaultMessage:"Path cannot be empty."},validationPathAbsolute:{id:"X9fb9/",defaultMessage:"Path cannot start with a '/'."},validationPathDot:{id:"LhWbnQ",defaultMessage:"Path cannot contain '.' or '..' segments."},validationPathSkillMd:{id:"eQhwwM",defaultMessage:"Path cannot be 'SKILL.md'."},validationPathDuplicate:{id:"v/Kr1j",defaultMessage:"Path is duplicated."}}),S={bash:"bash",c:"c",cc:"cpp",clj:"clojure",cpp:"cpp",cs:"csharp",cts:"typescript",cxx:"cpp",go:"go",h:"cpp",hpp:"cpp",hs:"haskell",html:"html",java:"java",jl:"julia",js:"javascript",jsx:"javascript",kt:"kotlin",kts:"kotlin",less:"less",lua:"lua",m:"objectivec",mm:"objectivec",php:"php",ps1:"powershell",py:"python",r:"r",rb:"ruby",rs:"rust",sass:"scss",scala:"scala",scss:"scss",sh:"bash",sql:"sql",swift:"swift",toml:"toml",ts:"typescript",tsx:"typescript",vue:"vue",yml:"yaml",yaml:"yaml"},ne=new Set(["md","markdown","txt","rst","csv","ini"]),y=k({instructionsPlaceholder:{defaultMessage:"Type instructions...",id:"skillEditor.instructionsPlaceholder"},canvasUnsupportedFile:{defaultMessage:"Only text and code files can be edited in canvas.",id:"skillEditor.canvasUnsupportedFile"},canvasLoadFailed:{defaultMessage:"Unable to load the file. Please try again.",id:"skillEditor.canvasLoadFailed"},canvasHeading:{defaultMessage:"Editing {filename}",id:"skillEditor.canvasHeading"},canvasUnsavedWarningTitle:{defaultMessage:"Discard unsaved changes?",id:"skillEditor.canvasUnsavedWarningTitle"},canvasUnsavedWarningBody:{defaultMessage:"You have unsaved changes. If you go back, your edits will be discarded.",id:"skillEditor.canvasUnsavedWarningBody"},canvasUnsavedContinueEditing:{defaultMessage:"Continue editing",id:"skillEditor.canvasUnsavedContinueEditing"},canvasUnsavedDiscard:{defaultMessage:"Discard changes",id:"skillEditor.canvasUnsavedDiscard"},canvasLoadingFile:{defaultMessage:"Loading fileâ€¦",id:"skillEditor.canvasLoadingFile"},canvasRetry:{defaultMessage:"Retry",id:"skillEditor.canvasRetry"}});function re({clientId:t,fileName:e,filePath:s,defaultContent:a,language:n,isLoading:l=!1,placeholder:d,error:u,onRetry:r,onSave:i}){"use no forget";const g=F(),[h,f]=x.useState(a);x.useEffect(()=>{l||f(a)},[l,t]);const v=x.useCallback(()=>{i(h)},[i,h]),p=x.useMemo(()=>l?o.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-2 text-sm",children:[o.jsx(q,{className:"h-5 w-5"}),o.jsx(j,w({},y.canvasLoadingFile))]}):u?o.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-3 text-center text-sm",children:[o.jsx("p",{className:"text-token-text-tertiary",children:u}),o.jsx("div",{className:"flex gap-2",children:r&&o.jsx(_,{onClick:r,children:o.jsx(j,w({},y.canvasRetry))})})]}):o.jsx(X,{id:"file-".concat(e,"-code"),comments:[],readonlyReason:null,value:h,language:n!=null?n:void 0,onChange:c=>{const m=c.doc.toString();f(m),i(m)},placeholder:d,onSave:v,hideAccelerators:!0,hideToolbar:!0}),[h,u,e,v,l,n,r,i,d]);return o.jsxs("div",{className:"h-full w-full",children:[o.jsx("div",{className:"flex flex-wrap items-start justify-between gap-3",children:o.jsxs("div",{className:"min-w-0 space-y-1",children:[o.jsx("p",{className:"truncate text-lg font-semibold",children:g.formatMessage(y.canvasHeading,{filename:e})}),s&&o.jsx("p",{className:"text-token-text-tertiary truncate text-xs",children:s})]})}),o.jsx("div",{className:"mt-3 min-h-0 flex-1 overflow-scroll",children:p})]})}function oe(t){var n,l;const e=t.filename.toLowerCase(),s=e.includes(".")&&(l=(n=e.split(".").pop())==null?void 0:n.toLowerCase())!=null?l:"",a=t.contentType.toLowerCase();return s&&S[s]?{language:S[s]}:s==="json"?{language:"json"}:ne.has(s)?{language:null}:a.startsWith("text/")?{language:null}:a.includes("json")?{language:"json"}:a.includes("yaml")||a.includes("yml")?{language:"yaml"}:null}function ge({hazelnutId:t,file:e,onSave:s}){"use no forget";const a=F(),n=H(),[l,d]=x.useState("loading"),u=x.useMemo(()=>oe(e),[e]),[r,i]=x.useState(void 0),[g,h]=x.useState(""),f=x.useCallback(c=>{d("error"),i(c)},[]),v=x.useCallback(async()=>{if(!u){const c=a.formatMessage(y.canvasUnsupportedFile);f(c),n.danger(c);return}d("loading"),i(void 0);try{const c=e.fileId?e.status==="saved"?await se(t,e.fileId,e.range):await ae(e.fileId):"";d("ready"),h(c)}catch(c){N.addError(c);const m=a.formatMessage(y.canvasLoadFailed);f(m),n.danger(m)}},[u,e,t,a,f,n]);x.useEffect(()=>{const c=setTimeout(()=>{v()},0);return()=>clearTimeout(c)},[e.clientId,e.fileId,v]);const p=x.useCallback(c=>{s(c)},[s]);return o.jsx(re,{clientId:e.clientId,fileName:e.filename,filePath:e.path,defaultContent:g,language:u==null?void 0:u.language,isLoading:l==="loading",error:l==="error"?r!=null?r:a.formatMessage(y.canvasLoadFailed):null,onRetry:l==="error"?v:void 0,onSave:p})}const ye=({onContinueEditing:t,onDiscardChanges:e})=>{"use no forget";return o.jsxs(O,{isOpen:!0,testId:"modal-unsaved-change",title:o.jsx(j,w({},y.canvasUnsavedWarningTitle)),onClose:t,children:[o.jsx("p",{className:"text-token-text-tertiary text-sm",children:o.jsx(j,w({},y.canvasUnsavedWarningBody))}),o.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[o.jsx(D,{color:"ghost",onClick:t,children:o.jsx(j,w({},y.canvasUnsavedContinueEditing))}),o.jsx(_,{color:"danger",onClick:e,children:o.jsx(j,w({},y.canvasUnsavedDiscard))})]})]})};export{me as F,re as S,ye as U,y as a,se as b,ee as c,ve as d,pe as e,V as f,te as g,ge as h,oe as i,J as n,Z as s,xe as u,he as v};
//# sourceMappingURL=fwtla2bbxlv5yr7j.js.map
