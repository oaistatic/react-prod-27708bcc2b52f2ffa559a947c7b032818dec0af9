var ge=Object.defineProperty,ve=Object.defineProperties;var je=Object.getOwnPropertyDescriptors;var Z=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable;var H=(s,t,o)=>t in s?ge(s,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[t]=o,T=(s,t)=>{for(var o in t||(t={}))ye.call(t,o)&&H(s,o,t[o]);if(Z)for(var o of Z(t))Me.call(t,o)&&H(s,o,t[o]);return s},O=(s,t)=>ve(s,je(t));import{r as u,j as e,e as Ce}from"./fg33krlcm0qyi6yw.js";import{nC as be,nD as we,nE as I,nF as Se,nG as ke,cr as Ne,nH as Ie,jN as De,nI as te,nJ as W,cw as z,dT as $e,fC as _e,nK as R}from"./k65njl5wlgspihfr.js";import{S as Ee}from"./eukgnjb3l94r8f9i.js";import{da as Te,hh as Q,dF as G,dH as Y,gK as Oe,c0 as se,C as ne,g2 as Ve,d as Ae,bg as oe,bv as ae,l as ie,gr as Fe}from"./mtk1qztvnb31pw5r.js";import{g as Le}from"./f44hagouqeulblbg.js";import{u as Be}from"./f0tmpq9eclcs1wjb.js";import{u as Pe,g as Re}from"./m3g61ngxm1em2m1b.js";import{M as We}from"./he7oe7s4xa3cph5y.js";import"./ftef8970ba1zoykr.js";import"./iiok29s29bpdre61.js";import"./czwlkhzq2wjwrbr9.js";import"./lh519j0jeagew6wf.js";import"./lyweiq6fkrxywnz5.js";import"./oza6nyibf7qjndb1.js";import"./gy1lpvuoewmzh42c.js";import"./jed1ux7qibe55pmj.js";import"./h1em0bjkpkjv8ykw.js";import"./nfccle6oyncifphl.js";import"./hu1bt0oauegdhua6.js";const ze=s=>s>=1e3?"".concat((s/1e3).toFixed(2),"s"):"".concat(s.toFixed(0),"ms");function Ue(s,t){const o={},i=(n,r="")=>{Object.entries(n).forEach(([p,g])=>{const d=r?"".concat(r,".").concat(p):p;g&&typeof g=="object"&&!Array.isArray(g)?i(g,d):g&&(typeof g=="number"||typeof g=="string"||g==null)&&(o[d]=g)})};i(s);const c={},l=n=>c[n]||(c[n]={}),x=n=>{if(n!=null){if(typeof n=="number")return n;if(typeof n=="string")return new Date(n).getTime()}};Object.keys(o).forEach(n=>{const r=o[n];if(r==null)return;const p=n.split(".").pop(),g=[[/^(.*)_start_time$/,"start",d=>d[1]],[/^(.*)_end_time$/,"end",d=>d[1]],[/^(.*)_sent_time$/,"start",d=>d[1]],[/^(.*)_success_time$/,"end",d=>d[1]],[/^(.*)_time$/,"start",d=>d[1]]];for(const[d,w,M]of g){const C=p.match(d);if(C){const j=M(C),$=l(j);$[w]=x(r);break}}});const m=[];Object.entries(c).forEach(([n,{start:r,end:p}])=>{r!==void 0&&p!==void 0?m.push({name:n,start:r,end:p,duration:p-r}):r!==void 0&&m.push({name:n,start:r,end:r,duration:0,noEnd:!0})});let f=m;if(t&&t.length){const n=new Set(t);f=f.filter(r=>n.has(r.name))}return f.sort((n,r)=>n.start-r.start||n.name.localeCompare(r.name)),f}const ee=["text-blue-400","text-green-400","text-purple-400","text-orange-400","text-red-400","text-pink-400","text-yellow-400","text-gray-500","text-blue-300","text-green-300"],Qe=({json:s,focusNames:t,width:o,barHeight:i=18,rowGap:c=6,paddingX:l=50,paddingTop:x=20})=>{const m=u.useRef(null),[f,n]=u.useState(o||600);Te(()=>{if(!o){const a=()=>{if(m.current){const h=m.current.clientWidth;n(Math.max(300,h))}};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)}},[o]);const r=u.useMemo(()=>Ue(s,t),[s,t]),[p,g]=u.useState({}),d=u.useCallback(a=>p[a]!==!1,[p]),w=u.useCallback(a=>g(h=>O(T({},h),{[a]:h[a]===!1})),[]),M=u.useMemo(()=>r.filter(a=>d(a.name)),[r,d]),C=M.length>0,j=C?Math.min(...M.map(a=>a.start)):0,$=C?Math.max(...M.map(a=>a.end)):1,k=Math.max($-j,1),S=x+r.length*(i+c)+c+32,re=(r.length?Math.max(...r.map(a=>a.name.length)):0)*7+16+16,V=Math.max(l,re),le=l,B=(f-V-le)/k,[de,J]=u.useState(null),[A,q]=u.useState({visible:!1,x:0,y:0,lines:[]}),K=(a,h)=>{if(!m.current)return;const v=m.current.getBoundingClientRect(),y=h.clientX-v.left,F=h.clientY-v.top,_=(a.start-j).toFixed(2),E=a.noEnd?void 0:(a.end-j).toFixed(2),P=E?["start: ".concat(_," ms"),"end: ".concat(E," ms"),"dur: ".concat(a.duration.toFixed(2)," ms")]:["start: ".concat(_," ms")];q({visible:!0,x:y+10,y:F+10,lines:P})},ue=()=>q(a=>O(T({},a),{visible:!1})),me=u.useMemo(()=>{if(!C)return[0,k];const a=new Set;M.forEach(v=>{a.add(v.start-j),a.add(v.end-j)});const h=Array.from(a).sort((v,y)=>v-y);return h[0]!==0&&h.unshift(0),h[h.length-1]!==k&&h.push(k),h},[M,j,k,C]);return e.jsxs("div",{ref:m,className:"relative w-full",style:o?{width:"".concat(o,"px")}:void 0,children:[e.jsxs("svg",{width:f,height:S,className:"font-sans",children:[r.map((a,h)=>{const v=x+h*(i+c),y=d(a.name)?V+(a.start-j)*B:0,F=d(a.name)?Math.max(a.duration*B,1):0,_=ee[h%ee.length],E=de===h?"opacity-80":"opacity-100",P=a.duration===0,X=!!a.noEnd,xe=N=>{d(a.name)&&(J(h),K(a,N))},fe=N=>{d(a.name)&&K(a,N)},he=()=>{J(null),ue()};return e.jsxs("g",{onMouseEnter:xe,onMouseMove:fe,onMouseLeave:he,children:[e.jsx("foreignObject",{x:0,y:v,width:V-8,height:i,requiredExtensions:"http://www.w3.org/1999/xhtml",children:e.jsx("div",{className:"pointer-events-auto box-border flex h-full items-center justify-end gap-1 pe-1 text-[12px] text-neutral-900 select-none",children:e.jsxs("label",{className:"flex cursor-default items-center gap-1",children:[e.jsx("input",{type:"checkbox",checked:d(a.name),onChange:()=>w(a.name),className:"cursor-pointer"}),e.jsx("span",{children:a.name})]})})}),d(a.name)&&(X?(()=>{const N=v+i/2,L=i*.6/2,pe=["".concat(y,",").concat(N-L),"".concat(y+L,",").concat(N),"".concat(y,",").concat(N+L),"".concat(y-L,",").concat(N)].join(" ");return e.jsx("polygon",{points:pe,fill:"currentColor",className:"".concat(_," ").concat(E)})})():P?e.jsx("line",{x1:y,x2:y,y1:v,y2:v+i,stroke:"currentColor",strokeWidth:2,className:_}):e.jsx("rect",{x:y,y:v,width:F,height:i,fill:"currentColor",className:"".concat(_," ").concat(E)})),d(a.name)&&e.jsxs("text",{x:y+(X?i*.6:F)+4,y:v+i/2+4,fill:"currentColor",className:"text-xs text-neutral-700",children:[a.duration.toFixed(2)," ms"]})]},a.name)}),me.map(a=>{const h=V+a*B;return e.jsx("line",{x1:h,x2:h,y1:x-3,y2:S-32,stroke:"currentColor",strokeWidth:1,className:"text-gray-200"},a)}),e.jsx("text",{x:f/2,y:S-6,textAnchor:"middle",fill:"currentColor",className:"text-xs text-neutral-600",children:"Time since first event (ms)"})]}),A.visible&&e.jsx("div",{className:"pointer-events-none absolute z-10 rounded bg-black/90 px-1.5 py-1 font-mono text-xs whitespace-nowrap text-white",style:{left:A.x,top:A.y},children:A.lines.map((a,h)=>e.jsx("div",{children:a},h))})]})};function Ge({conversationId:s}){var l;const t=Q(s),o=(l=G.getCurrentNode(Y(s)))==null?void 0:l.id,i=be();return we()?e.jsx(D,{conversationId:t!=null?t:s,parentMessageId:o,status:i}):null}function D(s){var n;const t=(n=s==null?void 0:s.status)==null?void 0:n.modes,[o,i]=u.useState(!1),[c,l]=u.useState(),x=u.useCallback(r=>{l(r),i(!0)},[]),m=Ce(),f=u.useCallback(()=>i(!1),[]);return e.jsxs(e.Fragment,{children:[e.jsx(Oe,{contentAlign:"center",triggerButton:e.jsx(D.Trigger,{}),children:t?t.map(r=>u.createElement(D.Item,O(T({},s),{key:r.display_name,voiceStatusMode:r,onShowModal:x}))):e.jsx("div",{role:"progressbar","aria-valuetext":m.formatMessage({defaultMessage:"Loading voice modes",id:"voiceModeButton.loadingModes"}),"aria-busy":"true","aria-live":"assertive","aria-valuemin":0,"aria-valuemax":100,children:e.jsx(se,{"aria-hidden":"true",className:"my-4 min-w-full"})})}),e.jsx(D.Modal,{conversationId:s.conversationId,disabledModeMetadata:c,isOpen:o,onClose:f})]})}D.Modal=function(t){var l,x,m,f;const o=(x=(l=t.disabledModeMetadata)==null?void 0:l.buttons)!=null?x:[],i=Be({buttons:o,conversationId:t.conversationId,onClick:t.onClose}),c=e.jsx(We,{children:(m=t.disabledModeMetadata)==null?void 0:m.description_markdown});return e.jsx(ne,{testId:"modal-voice-mode",title:(f=t.disabledModeMetadata)==null?void 0:f.title,description:c,isOpen:t.isOpen,onClose:t.onClose,type:"success",primaryButton:i.primary,secondaryButton:i.secondary})};D.Trigger=u.forwardRef(function(t,o){var c;const i=I(l=>l.voiceMode);return e.jsxs(Se,O(T({ref:o},t),{children:[(c=ke(i))!=null?c:e.jsx(se,{}),e.jsx(Ne,{className:"icon text-token-text-tertiary"})]}))});D.Item=function({conversationId:t,parentMessageId:o,voiceStatusMode:i,onShowModal:c}){const{disabled_mode_metadata:l,mode:x}=i,{startVoiceMode:m}=Pe(),f=Q(t),n=u.useCallback(async()=>{l?c(l.disabled_message):m(Re({serverThreadId:f,parentMessageId:o,isAdvancedMode:x==="advanced"&&!l,eventSource:"voice_mode_picker",clientThreadId:t,gizmoId:G.getGizmoId(Y(t)),skipCacheReason:"debug-button-clicked"}))},[t,l,x,c,o,f,m]);return e.jsx(Ve.Item,{onClick:n,children:e.jsxs("div",{children:[i.display_name,e.jsx("div",{className:"text-token-text-tertiary text-xs",children:i.description})]})})};function Ct({conversationId:s}){const t=I(c=>c.voiceSessionId),o=Ae(()=>Ie()),i=I(c=>{const{sessionConnectedTime:l}=c.metrics;return o&&l?l.getTime()-o.getTime():null});return e.jsx("div",{className:"relative h-full",children:e.jsx(oe.div,{className:"border-s-token-sidebar-surface-secondary bg-token-main-surface-secondary absolute hidden h-full max-w-[500px] overflow-y-auto rounded-xl border-s pt-4 shadow-inner md:block",initial:{opacity:0,x:520,width:"0px"},animate:{opacity:1,x:0,width:"500px",left:"-520px"},exit:{opacity:0,x:520,width:"0px",left:"0px"},transition:{type:"tween"},children:e.jsx(ae,{children:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex w-full items-center justify-center",children:e.jsx(Ge,{conversationId:s})}),e.jsxs("div",{className:"p-4 py-2 text-sm",children:[e.jsx(b,{name:"Voice Session ID",text:t!=null?t:"n/a"}),e.jsx(Ye,{conversationId:s}),e.jsx(b,{name:"Connect Latency",text:i!==null?ze(i):"n/a"}),e.jsx(Je,{})]}),e.jsxs("div",{className:"flex h-full w-full flex-col flex-nowrap gap-4",children:[e.jsx("div",{className:"px-4",children:e.jsxs("div",{className:"flex flex-col flex-nowrap gap-4",children:[e.jsx(qe,{}),e.jsx(Ke,{})]})}),!1]})]})})})})}function Ye({conversationId:s}){var r,p,g;const t=Q(s),o=t&&Y(t),i=G.getTree(o),c=I(d=>d.server.messages.findLast(w=>w.type===te.ConversationUpdate)),l=c==null?void 0:c.payload.parent_message_id,x=l?i.findNode(d=>d.message.author.role==="assistant"&&Fe.isMultimodalTextMessage(d.message),l):void 0,{model_definition_slug:m,model_definition_virtual_model_id:f}=(p=(r=x==null?void 0:x.message.metadata)==null?void 0:r.__internal)!=null?p:{},n=(g=[m,f].filter(Boolean).join(", "))!=null?g:"pending model response";return e.jsx(b,{name:"Model ID",text:n,allowWrap:!0})}function Je(){const[s,t]=u.useState(!1),[o,i]=u.useState({}),c=De(),l=u.useCallback(()=>{const x=!s;if(t(x),x){const m=Le({voiceStore:c});i(m)}else i({})},[s,c]);return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"cursor-pointer font-semibold text-blue-500 hover:underline dark:text-blue-300",onClick:l,children:s?"Hide Client Metrics Chart":"Show Client Metrics Chart"}),e.jsxs(ne,{testId:"modal-client-metrics",title:"Client Metrics",isOpen:s,onClose:()=>t(!1),size:"fullscreen",showCloseButton:!0,children:[e.jsx(Qe,{json:o}),e.jsx("pre",{className:"bg-token-bg-tertiary text-token-text-secondary m-4 overflow-x-auto rounded-md p-2 text-[10px] font-semibold",children:JSON.stringify(o,null,2)})]})]})}function qe(){const[s,t]=u.useState("timestamp"),[o,i]=u.useState("asc"),c=I(n=>n.server.messages.filter(r=>r.type===te.Performance)),l=c[c.length-1],x=u.useCallback(n=>n>=1e3?"".concat((n/1e3).toFixed(2),"s"):"".concat(n.toFixed(1),"ms"),[]),m=u.useMemo(()=>l?[...l.payload.metrics].sort((n,r)=>{const p=s==="name"?n.name.localeCompare(r.name):n.ms-r.ms;return o==="asc"?p:-p}):[],[l,s,o]),f=n=>{n===s?i(o==="asc"?"desc":"asc"):(t(n),i("asc"))};return e.jsx(ce,{title:"Performance",open:!1,children:l?e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx(U,{text:"Metric"}),s==="name"?o==="asc"?e.jsx(W,{}):e.jsx(z,{}):null]}),e.jsxs("div",{className:"flex cursor-pointer flex-row items-center",onClick:()=>f("timestamp"),children:[e.jsx(U,{text:"Timestamp"}),s==="timestamp"?o==="asc"?e.jsx(W,{}):e.jsx(z,{}):null]}),m.map(n=>e.jsxs(e.Fragment,{children:[e.jsx("span",{title:n.name,className:"line-clamp-1 block min-w-0 truncate text-sm",children:n.name},n.name),e.jsx("span",{className:"bg-token-main-surface-tertiary line-clamp-1 rounded-lg p-0.5 px-1 font-mono text-xs",children:x(n.ms)},n.name+n.ms)]}))]}):null})}function Ke(){var m,f;const s=I(n=>n.server.connectionState),t=I(n=>n.dev.room),[o,i]=u.useState("Unknown"),c=t==null?void 0:t.localParticipant,l=(m=t==null?void 0:t.numParticipants)!=null?m:"Unknown",x=(f=t==null?void 0:t.activeSpeakers)!=null?f:[];return u.useEffect(()=>{if(c){const n=r=>{i(r)};return c.on("connectionQualityChanged",n),()=>{c.off("connectionQualityChanged",n)}}},[c]),e.jsxs(ce,{title:"Room",open:!1,children:[e.jsx(b,{name:"Connection Quality",text:String(o)}),e.jsx(b,{name:"Connection State",text:String(s)}),e.jsx(b,{name:"Participants",text:l}),e.jsx(b,{name:"Speakers",text:x.length}),e.jsx(Xe,{})]})}function Xe(){const s=I(r=>r.dev.room),[t,o]=u.useState(null),[i,c]=u.useState(null),[l,x]=u.useState(null),m=s==null?void 0:s.getActiveDevice("audioinput"),f=s==null?void 0:s.getActiveDevice("audiooutput"),n=s==null?void 0:s.getActiveDevice("videoinput");return u.useEffect(()=>{async function r(){var j,$,k;const p=await R.getLocalDevices("audioinput"),g=await R.getLocalDevices("audiooutput"),d=await R.getLocalDevices("videoinput"),w=p.find(S=>S.deviceId===m),M=g.find(S=>S.deviceId===f),C=d.find(S=>S.deviceId===n);o((j=w==null?void 0:w.label)!=null?j:"Unknown"),c(($=M==null?void 0:M.label)!=null?$:"Unknown"),x((k=C==null?void 0:C.label)!=null?k:null)}r()},[m,f,n]),e.jsxs(e.Fragment,{children:[e.jsx(U,{text:"Devices"}),l?e.jsx(b,{icon:$e,name:"Video Input",text:l}):null,e.jsx(b,{icon:_e,name:"Audio Input",text:t!=null?t:"Unknown"}),e.jsx(b,{icon:Ee,name:"Audio Output",text:i!=null?i:"Unknown"})]})}function ce({title:s,titleClassName:t,children:o,open:i}){const[c,l]=u.useState(i!=null?i:!0);return e.jsxs("div",{children:[e.jsxs("h3",{className:ie("text-token-text-secondary flex cursor-pointer items-center py-2 text-lg font-semibold",t),onClick:()=>l(!c),children:[e.jsx("span",{children:s}),e.jsx("span",{className:"ms-2",children:c?e.jsx(z,{className:"icon-sm"}):e.jsx(W,{className:"icon-sm"})})]}),e.jsx(ae,{initial:!1,children:c&&e.jsx(oe.div,{initial:"collapsed",animate:"open",exit:"collapsed",variants:{open:{height:"auto",opacity:1},collapsed:{height:0,opacity:0}},transition:{duration:.3,ease:"easeInOut"},layout:!0,children:o},"content")})]})}function U({text:s}){return e.jsx("h4",{className:"py-2 text-sm font-semibold",children:s})}function b(s){var t;return e.jsxs("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:[e.jsx("span",{className:"opacity-85",children:s.icon?e.jsx(s.icon,{className:"h-[0.75rem] w-[0.75rem]"}):e.jsxs("span",{className:"text-sm",children:[s.name,":"]})}),(t=s.content)!=null?t:e.jsx("span",{className:ie(["bg-token-main-surface-tertiary rounded-lg p-0.5 px-1 font-mono text-xs",!s.allowWrap&&"line-clamp-1"]),children:s.text})]})}export{Je as ClientMetrics,qe as PerformanceStats,b as Stat,Ct as VoiceModeDevPanel};
//# sourceMappingURL=mkmcchvtko7hqxdr.js.map
