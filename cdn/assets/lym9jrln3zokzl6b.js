import{e as E,a as ae,i as V,u as X,j as e,M as i,a9 as te,ae as se,r as $,F as ne,a0 as ie}from"./fg33krlcm0qyi6yw.js";import{m as G,C as H,M as v,l as re,ag as oe,H as le,c0 as me,T as h,a9 as p,iq as de,bX as ce,b as ue}from"./mtk1qztvnb31pw5r.js";import{gk as ge,aa as fe}from"./k65njl5wlgspihfr.js";import{N as he}from"./uigmp4vviplizx3p.js";import{W as pe}from"./gp2ycmyaevvj2458.js";import{W as xe}from"./eqi3xjytwhmszqqa.js";import{i as ve,R as Me,I as q,S as je}from"./kodpf00oq0c6g8b3.js";import{u as we}from"./mbk6r4n07eoyd764.js";import{h as x,r as be,i as De,d as Ee}from"./n0ab5m1z76n8mazm.js";import{W as U}from"./sy1xvqwioh9ks4z8.js";import{E as Pe}from"./n62ntyw00ngcyjjo.js";import{P as _e,a as Ne}from"./lptwpbjabrvjmhsj.js";import"./dy5lfx8pblnkst90.js";import"./eb2ntjcgqhqizd13.js";import"./hots192vdjsjmkwr.js";import"./efooahjtdr85x1lo.js";import"./km71i01x6ma5r62b.js";import"./f9jzes5xr4mq3zrh.js";import"./j6htuwwuulo7h0p6.js";import"./czn39vd97sciq42g.js";import"./l9v3ntkj34comb67.js";import"./cmaobpdpreyiep8p.js";import"./bhm7utdivrybcfbl.js";import"./ohquqctluwabmb5i.js";import"./c2cj1dlcffke3f7m.js";import"./hb1mva1gmw4bcs8w.js";import"./mivow98b53y1taf8.js";import"./krwszi9u3lj63i9v.js";import"./kpobiwwkg2o2u14w.js";import"./ir7nzwbolrsm3ds2.js";import"./mmn9462oogkapcg8.js";import"./ck1u9icgxosmytry.js";import"./bes67zhi4fr5gq8i.js";import"./btdpwmi6j9nv6qc2.js";import"./keo7wnl5i52xco98.js";import"./ek8ypz08ir47cco2.js";import"./kzbknm4lxuyoq9wi.js";import"./jed1ux7qibe55pmj.js";import"./h1em0bjkpkjv8ykw.js";import"./f5ep9o7usovyn4vf.js";import"./ly75bs3d14n5v622.js";import"./hu1bt0oauegdhua6.js";function ye({environmentId:s,onClose:a}){const n=E(),o=G(),l=ae(),c=V(),u=x(g=>g.setEnvironmentId),M=x(g=>g.setBranch),{mutate:t,isPending:j}=X({mutationFn:()=>U.deleteEnvironment(s),onSuccess:async()=>{be(l,s),await De(l),x.getState().environmentId===s&&(u(null),M(null)),o.success(n.formatMessage({id:"wham.deleteEnvironmentModal.environmentDeletedSuccessfully",defaultMessage:"Environment deleted successfully"})),a(),c("/codex/settings/environments")},onError:()=>{o.danger(n.formatMessage({id:"wham.deleteEnvironmentModal.failedToDeleteEnvironment",defaultMessage:"Failed to delete environment"}))}});return e.jsx(H,{testId:"modal-wham-delete-environment",isOpen:!0,type:"danger",title:e.jsx(i,{id:"wham.deleteEnvironmentModal.title",defaultMessage:"Delete environment"}),onClose:a,primaryButton:e.jsx(v.Button,{title:n.formatMessage({id:"wham.deleteEnvironmentModal.delete",defaultMessage:"Delete"}),color:"danger",loading:j,onClick:()=>{t()}}),secondaryButton:e.jsx(v.Button,{title:n.formatMessage({id:"wham.deleteEnvironmentModal.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:a}),children:e.jsx("div",{className:"text-sm",children:e.jsx(i,{id:"wham.deleteEnvironmentModal.message",defaultMessage:"Tasks that use it will remain, but users wonâ€™t be able to create follow-up tasks."})})})}function m({label:s,children:a,className:n}){return e.jsxs("div",{className:re("flex flex-col gap-1",n),children:[e.jsx("dt",{className:"text-token-text-primary text-sm font-medium",children:s}),e.jsx("dd",{className:"text-token-text-primary text-sm font-normal",children:a})]})}function Ce({environmentId:s,onClose:a}){const n=E(),o=G(),{mutate:l,isPending:c}=X({mutationFn:()=>U.invalidateEnvironmentCache(s),onSuccess:()=>{o.success(n.formatMessage({id:"wham.resetCacheModal.cacheResetSuccessfully",defaultMessage:"Cache reset successfully"})),a()},onError:()=>{o.danger(n.formatMessage({id:"wham.resetCacheModal.failedToResetCache",defaultMessage:"Failed to reset cache"}))}});return e.jsx(H,{testId:"modal-wham-delete-environment",isOpen:!0,type:"danger",title:e.jsx(i,{id:"wham.resetEnvironmentCacheModal.title",defaultMessage:"Reset cache"}),onClose:a,primaryButton:e.jsx(v.Button,{title:n.formatMessage({id:"wham.resetEnvironmentCacheModal.delete",defaultMessage:"Reset"}),color:"danger",loading:c,onClick:()=>{l()}}),secondaryButton:e.jsx(v.Button,{title:n.formatMessage({id:"wham.resetEnvironmentCacheModal.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:a}),children:e.jsx("div",{className:"text-sm",children:e.jsx(i,{id:"wham.resetEnvironmentCacheModal.message",defaultMessage:"All currently cached containers will be invalidated. The cache will be cleared for all users."})})})}function ke(){const{environmentId:s}=te(),{eligible:a}=ge();return a?e.jsx(se,{to:"/codex"}):s?e.jsx(Be,{environmentId:s}):e.jsx(he,{})}function Se(s){return s==null||s.setup==null?!1:Array.isArray(s.setup)?s.setup.length>0&&s.setup.every(a=>a!==""):s.setup!==""}function Ae(s,a,n){var o,l;return s?!!((l=(o=s.permissions)==null?void 0:o.can_write)!=null&&l||n!=null&&n.isAdminOfAccount()||(a==null?void 0:a.email)===s.creator.email):!1}function Oe(s,a,n){var o,l;return s?!!((l=(o=s==null?void 0:s.permissions)==null?void 0:o.can_delete)!=null&&l||n!=null&&n.isAdminOfAccount()||(a==null?void 0:a.email)===s.creator.email):!1}function z(s,a,n=!0){const o=s.indexOf("::");if(o===-1)return s;const l=s.slice(0,o),c=s.slice(o+2)||s;if(!l||!n)return c;const u=l==="*"?a.formatMessage({id:"wham.environmentDetailsPage.secrets.globalDomainLabel",defaultMessage:"any domain"}):l;return a.formatMessage({id:"wham.environmentDetailsPage.secrets.formatted",defaultMessage:"{name} ({domainLabel})"},{name:c,domainLabel:u})}function Be({environmentId:s}){var C,k,S,A,O,B,R,T,I,W,F;const a=E(),n=V(),[o,l]=$.useState(!1),[c,u]=$.useState(!1),M=x(r=>r.setEnvironmentId),{data:t,isLoading:j,isError:g}=Ee(s),P=oe(),f=le(),d=t,Q=ue(),_=((C=d==null?void 0:d.secrets_with_domains)!=null?C:[]).filter(r=>!!(r!=null&&r.name&&r.name.length>0)),w=ve(Q),N=Ae(t,P,f),y=Oe(t,P,f),Z=we(),b=f==null?void 0:f.name,J=b!=null?b:a.formatMessage({id:"wham.environmentDetailsPage.workspace",defaultMessage:"Workspace"}),Y=!Se(t)&&(t==null?void 0:t.auto_setup_settings)==null,K=(S=(k=t==null?void 0:t.auto_setup_settings)==null?void 0:k.use_auto_setup)!=null?S:Y,ee=_.length?_.map(r=>{const D=r.domain&&r.name?"".concat(r.domain,"::").concat(r.name):r.name;return z(D,a,w)}):Object.keys((A=d==null?void 0:d.secrets)!=null?A:{}).map(r=>z(r,a,w));return e.jsxs(pe,{topPadding:!0,showSidebar:!1,children:[e.jsx("div",{className:"flex flex-col px-8 md:px-16",children:j?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(me,{})}):g?e.jsx(Pe,{title:a.formatMessage({id:"wham.environmentDetailsPage.errorLoadingEnvironment",defaultMessage:"Error loading environment"}),description:a.formatMessage({id:"wham.environmentDetailsPage.errorLoadingEnvironmentDescription",defaultMessage:"Error loading environment description"})}):t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border-token-border-default flex flex-col justify-between gap-2 border-b pb-4",children:e.jsxs("div",{className:"flex flex-row items-center justify-between",children:[e.jsxs(Me,{children:[e.jsx(q,{label:a.formatMessage({id:"wham.environmentDetailsPage.environments",defaultMessage:"Environments"}),url:"/codex/settings/environments",className:"text-token-text-tertiary"}),e.jsx(je,{}),e.jsx(q,{label:t.label,url:"/codex/settings/environment/".concat(s),className:"text-token-text-primary font-medium"})]}),e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsx(h,{label:y?void 0:a.formatMessage({id:"wham.environmentDetailsPage.deleteEnvironmentTooltip",defaultMessage:"Only creators or editors of the environment, or an admin, can delete an environment"}),children:e.jsx(p,{color:"danger-outline",onClick:()=>l(!0),disabled:!y,"aria-label":a.formatMessage({id:"wham.environmentDetailsPage.deleteEnvironmentAriaLabel",defaultMessage:"Button to delete {environmentName}"},{environmentName:t.label}),children:e.jsx(i,{id:"wham.environmentDetailsPage.deleteEnvironment",defaultMessage:"Delete"})})}),e.jsx(h,{label:N?void 0:a.formatMessage({id:"wham.environmentDetailsPage.editEnvironmentTooltip",defaultMessage:"Only creators or editors of the environment, or an admin, can edit an environment"}),children:e.jsx(p,{icon:fe,onClick:()=>{n("/codex/settings/environment/".concat(s,"/edit"))},color:"secondary",disabled:!N,"aria-label":a.formatMessage({id:"wham.environmentDetailsPage.editEnvironmentAriaLabel",defaultMessage:"Button to edit {environmentName}"},{environmentName:t.label}),children:e.jsx(i,{id:"wham.environmentDetailsPage.editEnvironment",defaultMessage:"Edit"})})}),e.jsx(p,{size:"small",color:"secondary",onClick:()=>{M(s),xe.recordClickEnv(),n("/codex")},"aria-label":a.formatMessage({id:"wham.environmentDetailsPage.useEnvironmentAriaLabel",defaultMessage:"Button to use environment {environmentName} in a codex task"},{environmentName:t.label}),children:e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx(i,{id:"wham.turnInfoRow.useEnvironment",defaultMessage:"Use this"}),e.jsx(de,{className:"icon-sm"})]})})]})]})}),e.jsx("div",{className:"text-token-text-primary py-8 text-xl",children:t.label}),e.jsxs("div",{className:"grid gap-x-12 gap-y-6 md:grid-cols-2",children:[e.jsx(m,{label:a.formatMessage({id:"wham.environmentDetailsPage.creator",defaultMessage:"Creator"}),children:t.creator.email}),e.jsx(m,{label:a.formatMessage({id:"wham.environmentDetailsPage.image",defaultMessage:"Image"}),children:t.machine.label||e.jsx(i,{id:"wham.environmentDetailsPage.noImage",defaultMessage:"No image"})}),e.jsx(m,{label:a.formatMessage({id:"wham.environmentDetailsPage.description",defaultMessage:"Description"}),children:(O=t.description)!=null?O:e.jsx(i,{id:"wham.environmentDetailsPage.noDescription",defaultMessage:"N/A"})}),e.jsx(m,{label:a.formatMessage({id:"wham.environmentDetailsPage.agentNetworkAccess",defaultMessage:"Agent internet access"}),children:((B=t.agent_network_access)==null?void 0:B.mode)==="on"?t.agent_network_access.preset_allowlist===_e?e.jsx(i,{id:"wham.environmentDetailsPage.agentNetworkAccess.unrestricted",defaultMessage:"On: unrestricted"}):t.agent_network_access.preset_allowlist===Ne?e.jsx(i,{id:"wham.environmentDetailsPage.agentNetworkAccess.codex",defaultMessage:"On: common dependencies"}):e.jsx(i,{id:"wham.environmentDetailsPage.agentNetworkAccess.custom",defaultMessage:"On: custom domains"}):t.agent_network_access==null||t.agent_network_access.mode==="off"?e.jsx(i,{id:"wham.environmentDetailsPage.agentNetworkAccess.off",defaultMessage:"Off"}):null}),w&&e.jsx(m,{label:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(i,{id:"wham.environmentDetailsPage.enableAuthtranslator",defaultMessage:"Domain scoped secrets"}),e.jsx(h,{label:a.formatMessage({id:"wham.environmentDetailsPage.enableAuthtranslator.tooltip",defaultMessage:"Advanced prompt-injection protection: secrets never reach the model and are only sent to their domain."}),children:e.jsx(ce,{className:"icon text-token-text-tertiary"})})]}),children:d!=null&&d.enable_authtranslator?e.jsx(i,{id:"wham.environmentDetailsPage.enableAuthtranslator.enabled",defaultMessage:"Enabled"}):e.jsx(i,{id:"wham.environmentDetailsPage.enableAuthtranslator.disabled",defaultMessage:"Disabled"})}),e.jsx(m,{label:a.formatMessage({id:"wham.environmentDetailsPage.postSetupCaching",defaultMessage:"Post setup caching"}),children:e.jsxs("div",{className:"flex items-center gap-2",children:[((R=t.cache_settings)==null?void 0:R.post_setup_cache_enabled)===!0?e.jsx(i,{id:"wham.environmentDetailsPage.postSetupCaching.on",defaultMessage:"On"}):e.jsx(i,{id:"wham.environmentDetailsPage.postSetupCaching.off",defaultMessage:"Off"}),((T=t.cache_settings)==null?void 0:T.post_setup_cache_enabled)&&e.jsx(h,{label:a.formatMessage({id:"wham.environmentDetailsPage.resetCacheTooltip",defaultMessage:"Invalidate any currently cached containers"}),children:e.jsx(p,{size:"small",onClick:()=>u(!0),color:"secondary","aria-label":a.formatMessage({id:"wham.environmentDetailsPage.resetCacheAriaLabel",defaultMessage:"Button to invalidate cache for {environmentName}"},{environmentName:t.label}),children:e.jsx(i,{id:"wham.environmentDetailsPage.resetCache",defaultMessage:"Reset cache"})})})]})}),((I=t.cache_settings)==null?void 0:I.post_setup_cache_enabled)&&e.jsx(m,{label:a.formatMessage({id:"wham.environmentDetailsPage.maintenanceSetupScript",defaultMessage:"Maintenance setup script"}),children:e.jsx("pre",{className:"mono text-xs leading-5 break-all whitespace-pre-wrap",children:(Array.isArray(t.maintenance_setup)?t.maintenance_setup:[t.maintenance_setup]).filter(Boolean).join("\n")})}),e.jsx(m,{label:a.formatMessage({id:"wham.environmentDetailsPage.environmentVariables",defaultMessage:"Environment variables"}),children:e.jsx("pre",{className:"mono text-xs leading-5 break-all whitespace-pre-wrap",children:Object.keys((W=t.env_vars)!=null?W:{}).filter(r=>!r.startsWith("CODEX_ENV_")).join("\n")})}),e.jsx(m,{label:a.formatMessage({id:"wham.environmentDetailsPage.secrets",defaultMessage:"Secrets"}),children:e.jsx("pre",{className:"mono text-xs leading-5 break-all whitespace-pre-wrap",children:ee.join("\n")})}),e.jsx(m,{label:a.formatMessage({id:"wham.environmentDetailsPage.createdAt",defaultMessage:"Created at"}),children:t.created_at?e.jsx(ne,{value:new Date(t.created_at*1e3),year:"numeric",month:"long",day:"numeric"}):e.jsx(i,{id:"wham.environmentDetailsPage.noCreationDate",defaultMessage:"No creation date"})}),e.jsx(m,{label:a.formatMessage({id:"wham.environmentDetailsPage.setupScript",defaultMessage:"Setup script"}),children:K?e.jsx(i,{id:"wham.environmentDetailsPage.autoSetup.automatic",defaultMessage:"Automatic"}):e.jsx("pre",{className:"mono text-xs leading-5 break-all whitespace-pre-wrap",children:(Array.isArray(t.setup)?t.setup:[t.setup]).filter(Boolean).join("\n")})}),e.jsx(m,{label:a.formatMessage({id:"wham.environmentDetailsPage.repository",defaultMessage:"Repository"}),children:t.repo_map?Object.values(t.repo_map).map(r=>r.repository_full_name):e.jsx(i,{id:"wham.environmentDetailsPage.noRepository",defaultMessage:"No repository"})}),e.jsx(m,{label:a.formatMessage({id:"wham.environmentDetailsPage.numTasks",defaultMessage:"No. of tasks"}),children:(F=t.task_count)!=null?F:0}),Z&&e.jsxs(e.Fragment,{children:[e.jsx(m,{label:a.formatMessage({id:"94ZVks",defaultMessage:"Share"}),children:t.share_settings==="workspace"?a.formatMessage({id:"wham.environmentDetailsPage.sharedWithWorkspace",defaultMessage:"Shared with {workspaceName}"},{workspaceName:J}):a.formatMessage({id:"wham.environmentDetailsPage.private",defaultMessage:"Private"})}),t.share_settings!=="private"&&e.jsx(m,{label:a.formatMessage({id:"wham.environmentDetailsPage.shareTargets",defaultMessage:"Additional editors"}),children:t.share_targets&&t.share_targets.length>0?e.jsx("div",{className:"flex flex-col gap-1",children:t.share_targets.map((r,D)=>{var L;return e.jsx("span",{children:r.email},"".concat((L=r.type)!=null?L:"user","-").concat(r.email,"-").concat(D))})}):e.jsx(i,{id:"wham.environmentDetailsPage.shareTargetsNone",defaultMessage:"None"})})]})]})]}):e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(i,{id:"wham.environmentDetailsPage.environmentNotFound",defaultMessage:"Environment not found"})})}),o&&e.jsx(ye,{environmentId:s,onClose:()=>l(!1)}),c&&e.jsx(Ce,{environmentId:s,onClose:()=>u(!1)})]})}const Da=()=>[{title:"Codex"}],Ea=ie(function(){return e.jsx(ke,{})});export{Ea as default,Da as meta};
//# sourceMappingURL=lym9jrln3zokzl6b.js.map
