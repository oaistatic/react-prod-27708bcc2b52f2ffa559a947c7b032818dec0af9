var Je=Object.defineProperty,Qe=Object.defineProperties;var Ze=Object.getOwnPropertyDescriptors;var Oe=Object.getOwnPropertySymbols;var De=Object.prototype.hasOwnProperty,Ke=Object.prototype.propertyIsEnumerable;var Fe=(r,e,o)=>e in r?Je(r,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[e]=o,ie=(r,e)=>{for(var o in e||(e={}))De.call(e,o)&&Fe(r,o,e[o]);if(Oe)for(var o of Oe(e))Ke.call(e,o)&&Fe(r,o,e[o]);return r},ce=(r,e)=>Qe(r,Ze(e));import{c as me,j as d,r as H,e as ke,v as be,M as et}from"./fg33krlcm0qyi6yw.js";import{l as xe,aU as te,R as tt,A as st,lu as ot,ag as $e,d as G,en as qe,aX as nt,_ as at,g$ as lt,lt as rt,P as it,C as ct}from"./mtk1qztvnb31pw5r.js";import{C as Ce,R as dt,p as mt,m as ut,a as pt,P as ht,b as ft,c as gt,d as yt,u as _t,S as xt,e as kt,f as bt}from"./i9er4nvdxr1wepj7.js";import{M as He}from"./he7oe7s4xa3cph5y.js";import{r as $t}from"./ojve869uwykk95at.js";import{a as ue,l as de,b as Ct,t as Mt,c as Et,d as wt,f as Pt,h as St,i as It,j as Ge,k as jt}from"./hwvghg24zujdhy4q.js";import{u as Me,a as Ee,E as vt,P as Nt,A as At}from"./dlydj2t7w31dzqec.js";import{t as ze}from"./fnhhsiipu8vwj3on.js";import{c as fe,b as _e}from"./odbvdbv7o06jw7ls.js";import{q6 as Tt}from"./k65njl5wlgspihfr.js";import"./mcmrxiy9039fw9r6.js";import"./h7j5jaik108ahib8.js";import"./maum0adk5rsfsldc.js";import"./ns7plxqxfok4w8o8.js";import"./l9v3ntkj34comb67.js";import"./gy1lpvuoewmzh42c.js";import"./jed1ux7qibe55pmj.js";import"./h1em0bjkpkjv8ykw.js";import"./nfccle6oyncifphl.js";import"./hu1bt0oauegdhua6.js";import"./ly75bs3d14n5v622.js";import"./ktlrbeajo849nxci.js";import"./kl7c6054usfnqmd4.js";import"./ns51nblw8ziscsgd.js";import"./l6gg4oal15ycpbhj.js";import"./27egyxvdbhiyko0z.js";const Ve=r=>{"use forget";const e=me.c(4),{errorMessages:o}=r;let u;e[0]!==o?(u=o.map(Lt),e[0]=o,e[1]=u):u=e[1];let s;return e[2]!==u?(s=d.jsx("div",{className:"flex flex-col gap-2",children:u}),e[2]=u,e[3]=s):s=e[3],s};function Lt(r,e){return d.jsx(Ce,{message:r.content},e)}const We=({intl:r,amount:e,currency:o})=>{const{minimumFractionDigits:u=0}=r.formatters.getNumberFormat(r.locale,{style:"currency",currency:o}).resolvedOptions();return r.formatNumber(e/10**u,{currency:o,style:"currency"})},Rt=H.memo(He),Ut=r=>{"use forget";const e=me.c(28),{totals:o,currency:u,isLoading:s}=r,C=ke();let _,k,w,l,t,p,i;if(e[0]!==u||e[1]!==C||e[2]!==s||e[3]!==o){i=Symbol.for("react.early_return_sentinel");e:{const h=o.find(Bt);if(!h){i=null;break e}t="flex flex-col gap-3 pt-4";let S;e[11]!==u||e[12]!==C||e[13]!==s?(S=N=>d.jsxs("div",{className:"text-token-text-secondary flex items-end justify-between text-[13px]",children:[d.jsx("span",{className:"font-medium",children:N.display_text}),d.jsx(Rt,{className:xe("transition-opacity duration-200",s&&"opacity-50"),remarkPlugins:[[$t,{singleTilde:!1}]],children:We({intl:C,amount:N.amount,currency:u})})]},N.type),e[11]=u,e[12]=C,e[13]=s,e[14]=S):S=e[14];const M=o.filter(Ot).map(S);e[15]!==M?(p=d.jsx("div",{children:M}),e[15]=M,e[16]=p):p=e[16],w="flex items-end justify-between",l=d.jsx("div",{className:"flex flex-col",children:d.jsx("span",{className:"text-lg font-medium",children:h.display_text})}),_="text-xl font-medium",k=h.amount>0?d.jsx(dt,{text:We({intl:C,amount:h.amount,currency:u}),className:xe("transition-opacity duration-200",s&&"opacity-50")}):"-"}e[0]=u,e[1]=C,e[2]=s,e[3]=o,e[4]=_,e[5]=k,e[6]=w,e[7]=l,e[8]=t,e[9]=p,e[10]=i}else _=e[4],k=e[5],w=e[6],l=e[7],t=e[8],p=e[9],i=e[10];if(i!==Symbol.for("react.early_return_sentinel"))return i;let m;e[17]!==_||e[18]!==k?(m=d.jsx("div",{className:_,children:k}),e[17]=_,e[18]=k,e[19]=m):m=e[19];let c;e[20]!==w||e[21]!==l||e[22]!==m?(c=d.jsxs("div",{className:w,children:[l,m]}),e[20]=w,e[21]=l,e[22]=m,e[23]=c):c=e[23];let P;return e[24]!==t||e[25]!==p||e[26]!==c?(P=d.jsxs("div",{className:t,children:[p,c]}),e[24]=t,e[25]=p,e[26]=c,e[27]=P):P=e[27],P};function Bt(r){return r.type==="total"}function Ot(r){return r.type!=="total"}const Xe=async({conversation:r,elements:e,billingAddress:o,stripe:u,billingEmail:s,intl:C,expressPaymentType:_,onConfirm:k,paymentAttemptId:w})=>{var U,R,y,n,g,$,I,E,a,v,x,j,b,B,T,A,O,q,z,Y,X,Q,Z,D,K,se;const l=ue(r);l.status$.set("submitting"),l.messages$.set([]);const t=l.checkoutSession$(),p=(R=(U=l.chatSDK$())==null?void 0:U.connectorId)!=null?R:null,i=(n=(y=l.chatSDK$())==null?void 0:y.toolMessageId)!=null?n:null,m=(g=t==null?void 0:t.id)!=null?g:null,c=w!=null?w:be(),P=_!==void 0,h=o!=null?o:l.billingAddress$();l.billingAddress$.set(h);const S=te(t==null?void 0:t.payment_provider);if(!e||!u){de({conversation:r,checkoutId:m,connectorId:p,messageId:i},{attemptId:c,succeeded:!1,reason:"elements_or_stripe_null"}),l.status$.set("idle");return}if(!s){de({conversation:r,checkoutId:m,connectorId:p,messageId:i},{attemptId:c,succeeded:!1,reason:"user_email_empty"}),l.status$.set("idle");return}const M=(I=($=l.chatSDK$())==null?void 0:$.metadata.widget_domain)!=null?I:null,N=(x=(v=(E=l.chatSDK$())==null?void 0:E.metadata.widget_domain)!=null?v:(a=l.sellerDetails$())==null?void 0:a.external_id)!=null?x:null;Ct({conversation:r,checkoutId:m,connectorId:p,messageId:i},{paymentMethod:_!=null?_:S.provider,attemptId:c,isExpressCheckout:P,merchantName:N,merchantUrl:M});const f=await mt({stripe:te(u),elements:te(e),intl:C,billingEmail:s,billingName:te((b=h==null?void 0:h.name)!=null?b:(j=t==null?void 0:t.fulfillment_address)==null?void 0:j.name),isExpressCheckout:P});if(!f||f!=null&&f.isError){de({conversation:r,checkoutId:m,connectorId:p,messageId:i},{attemptId:c,succeeded:!1,reason:"stripe_prepare_payment_method_failed",errorMessage:(T=(B=f==null?void 0:f.error)!=null?B:f==null?void 0:f.message)!=null?T:"preparePaymentMethod returned null"}),l.status$.set("idle");return}k==null||k();try{const F=(A=f.billing_details)!=null&&A.address?ut(f.billing_details.name,f.billing_details.address,f.billing_details.phone):h,V=await tt.safePost("/shopping/ecosystem/checkout_v2/{checkout_session_id}/complete",{parameters:{path:{checkout_session_id:te(l.orderId$())}},requestBody:{payment_attempt_id:c,payment_method:{id:f.id,type:f.type,billing_address:F}},authOption:st.SendIfAvailable}),{cart:L,order:J}=V,oe=((q=(O=L==null?void 0:L.errors)==null?void 0:O.length)!=null?q:0)>0;if(J&&!oe)de({conversation:r,checkoutId:m,connectorId:p,messageId:i},{attemptId:c,succeeded:!0}),l.completeCheckout$(Mt(V));else{l.status$.set("idle"),de({conversation:r,checkoutId:m,connectorId:p,messageId:i},{attemptId:c,succeeded:!1,reason:"openai_complete_shopping_cart_failed",errorMessage:oe&&((z=L==null?void 0:L.errors)!=null&&z.length)?JSON.stringify(L.errors):"Missing order id"});const ee=Et(L==null?void 0:L.errors);if(ee){const W=ee.original_error;(Y=l.checkoutPromise$())==null||Y.reject(W!=null?W:ee),l.closeCheckout();return}const ne=(Z=(X=L==null?void 0:L.errors)==null?void 0:X.find(W=>W&&"original_error"in W))!=null?Z:(Q=L==null?void 0:L.errors)==null?void 0:Q[0];if(ne){(D=l.checkoutPromise$())==null||D.reject(ne);return}}l.messages$.set(ot(L==null?void 0:L.errors,wt))}catch(F){l.status$.set("idle"),de({conversation:r,checkoutId:m,connectorId:p,messageId:i},{attemptId:c,succeeded:!1,reason:F instanceof Error&&F.message==="Failed to fetch"?"payment_failed_network_error":"openai_complete_shopping_cart_failed",errorMessage:F instanceof Error?F.message:"Unknown error"});const V=Pt(F);if(V!==null){(K=l.checkoutPromise$())==null||K.reject(V),l.closeCheckout();return}(se=l.checkoutPromise$())==null||se.reject(F!=null?F:new Error("checkout_failed"))}},Ft=r=>{"use forget";const e=me.c(32),{maxColumns:o,maxRows:u,conversation:s,onReady:C,paymentTypes:_,allowedCountries:k,merchantTitle:w}=r;let l;e[0]!==o||e[1]!==u?(l=o?{maxColumns:o,maxRows:u}:void 0,e[0]=o,e[1]=u,e[2]=l):l=e[2];let t;e[3]!==w?(t={name:w},e[3]=w,e[4]=t):t=e[4];const p=_.includes("apple_pay")?"always":"never",i=_.includes("google_pay")?"always":"never",m=_.includes("shop_pay")?"auto":"never",c=_.includes("link")?"auto":"never";let P;e[5]!==p||e[6]!==i||e[7]!==m||e[8]!==c?(P={applePay:p,googlePay:i,shopPay:m,link:c},e[5]=p,e[6]=i,e[7]=m,e[8]=c,e[9]=P):P=e[9];const h=P;let S;e[10]===Symbol.for("react.memo_cache_sentinel")?(S=["apple_pay","google_pay","shop_pay","link"],e[10]=S):S=e[10];let M;e[11]!==k||e[12]!==l||e[13]!==t||e[14]!==h?(M={buttonHeight:40,layout:l,shippingAddressRequired:!1,shippingRates:void 0,billingAddressRequired:!0,allowedShippingCountries:k,business:t,phoneNumberRequired:!0,paymentMethods:h,paymentMethodOrder:S},e[11]=k,e[12]=l,e[13]=t,e[14]=h,e[15]=M):M=e[15];const N=M,f=ke(),U=Me(),R=Ee(),y=$e();let n;e[16]!==s?(n=ue(s),e[16]=s,e[17]=n):n=e[17];const g=n,$=y==null?void 0:y.email,I=H.useRef(null);let E;e[18]!==s||e[19]!==g?(E=x=>{var B,T,A,O,q,z;const{resolve:j,reject:b}=x;if(I.current=be(),St({conversation:s,checkoutId:(B=g.checkoutSession$())==null?void 0:B.id,connectorId:(A=(T=g.chatSDK$())==null?void 0:T.connectorId)!=null?A:null,messageId:(q=(O=g.chatSDK$())==null?void 0:O.toolMessageId)!=null?q:null},{paymentMethod:x==null?void 0:x.expressPaymentType,attemptId:(z=I.current)!=null?z:void 0}),!g.checkoutSession$()||!g.publishableKey$()||g.status$()==="submitting"){b==null||b();return}j==null||j()},e[18]=s,e[19]=g,e[20]=E):E=e[20];let a;e[21]!==$||e[22]!==s||e[23]!==R||e[24]!==f||e[25]!==U?(a=async x=>{var T,A;const j=x==null?void 0:x.expressPaymentType;I.current||(I.current=be());const{billingDetails:b}=x,B=b!=null&&b.address&&(b!=null&&b.name)?pt(b.name,b.address,b.phone):void 0;await Xe({conversation:s,elements:R,stripe:U,billingAddress:B,billingEmail:te((T=b==null?void 0:b.email)!=null?T:$),intl:f,paymentAttemptId:(A=I.current)!=null?A:void 0,expressPaymentType:j})},e[21]=$,e[22]=s,e[23]=R,e[24]=f,e[25]=U,e[26]=a):a=e[26];let v;return e[27]!==C||e[28]!==N||e[29]!==E||e[30]!==a?(v=d.jsx(vt,{options:N,onClick:E,onConfirm:a,onReady:C,onShippingAddressChange:qt,onShippingRateChange:Gt}),e[27]=C,e[28]=N,e[29]=E,e[30]=a,e[31]=v):v=e[31],v};async function qt(r){const{resolve:e}=r;return e()}async function Gt(r){const{resolve:e}=r;return e()}const zt=r=>{"use forget";var q,z,Y;const e=me.c(48),{conversation:o,footerMessage:u,cartLoadError:s,currency:C,isLoadingAddress:_,isLoadingCartSession:k,isLoadingPayment:w,merchantTitle:l,paymentTypes:t,pushPane:p,totals:i}=r;let m;e[0]!==o?(m=ue(o),e[0]=o,e[1]=m):m=e[1];const c=m;let P;e[2]!==c?(P=()=>c.status$(),e[2]=c,e[3]=P):P=e[3];const h=G(P),S=h==="complete",M=h==="submitting",N=h==="updating";let f;e[4]!==c?(f=()=>c.allowedCountries$(),e[4]=c,e[5]=f):f=e[5];const U=G(f);let R;e[6]!==c?(R=()=>c.paymentDetails$(),e[6]=c,e[7]=R):R=e[7];const y=G(R);let n;e[8]!==c?(n=()=>c.errorMessages$(),e[8]=c,e[9]=n):n=e[9];const g=G(n);let $;e[10]!==c?($=()=>c.paymentSheetButtonCta$(),e[10]=c,e[11]=$):$=e[11];const I=G($),a=!((k||w||_)&&!s)&&!s;if(s){let X;return e[12]!==s?(X=d.jsx(Ce,{message:s}),e[12]=s,e[13]=X):X=e[13],X}const v=!!(y!=null&&y.complete);let x;e[14]!==S||e[15]!==c?(x=S&&d.jsx("div",{className:"bg-token-bg-primary absolute inset-0 z-50 flex items-center justify-center",children:d.jsx(ft,{onComplete:()=>c.closeCheckout(),className:"h-44 w-44 text-green-400",loop:!1})}),e[14]=S,e[15]=c,e[16]=x):x=e[16];let j;e[17]!==k||e[18]!==w||e[19]!==y||e[20]!==p?(j=y&&d.jsxs(d.Fragment,{children:[d.jsx(ht,{onClick:()=>p("paymentMethod"),isComplete:!!(y!=null&&y.complete),label:(q=y==null?void 0:y.label)!=null?q:"",sublabel:(z=y==null?void 0:y.sublabel)!=null?z:"",icon:(Y=y==null?void 0:y.icon)!=null?Y:void 0,isLoading:w||k}),d.jsx("hr",{})]}),e[17]=k,e[18]=w,e[19]=y,e[20]=p,e[21]=j):j=e[21];let b;e[22]!==C||e[23]!==k||e[24]!==i?(b=d.jsx(Ut,{totals:i,currency:C,isLoading:k}),e[22]=C,e[23]=k,e[24]=i,e[25]=b):b=e[25];let B;e[26]!==U||e[27]!==a||e[28]!==o||e[29]!==v||e[30]!==M||e[31]!==N||e[32]!==l||e[33]!==I||e[34]!==t||e[35]!==p?(B=a&&d.jsx(Wt,{isSubmitting:M,isUpdating:N,conversation:o,merchantTitle:l,paymentTypes:t,allowedCountries:U,hasValidPaymentMethod:v,pushPane:p,paymentSheetButtonCta:I}),e[26]=U,e[27]=a,e[28]=o,e[29]=v,e[30]=M,e[31]=N,e[32]=l,e[33]=I,e[34]=t,e[35]=p,e[36]=B):B=e[36];let T;e[37]!==g?(T=g.length>0&&d.jsx(Ve,{errorMessages:g}),e[37]=g,e[38]=T):T=e[38];let A;e[39]!==u?(A=u&&d.jsx(He,{className:"bg-token-bg-elevated-secondary text-token-text-tertiary border-token-border-light -mx-6 mt-4 h-full border-t p-6 text-xs",components:{a:Ht},children:u}),e[39]=u,e[40]=A):A=e[40];let O;return e[41]!==B||e[42]!==T||e[43]!==A||e[44]!==x||e[45]!==j||e[46]!==b?(O=d.jsxs("div",{className:"flex h-full flex-col px-6",children:[x,j,b,B,T,A]}),e[41]=B,e[42]=T,e[43]=A,e[44]=x,e[45]=j,e[46]=b,e[47]=O):O=e[47],O},Wt=r=>{"use forget";const e=me.c(27),{conversation:o,merchantTitle:u,paymentTypes:s,allowedCountries:C,hasValidPaymentMethod:_,pushPane:k,isSubmitting:w,isUpdating:l,paymentSheetButtonCta:t}=r;let p;e[0]!==o?(p=ue(o),e[0]=o,e[1]=p):p=e[1];const i=p;let m;e[2]!==i?(m=()=>i.checkoutSession$(),e[2]=i,e[3]=m):m=e[3];const c=G(m),[P,h]=H.useState(!1),S=ke(),M=Me(),N=Ee(),f=$e(),U=f==null?void 0:f.email,R=!_||!c;let y;e[4]===Symbol.for("react.memo_cache_sentinel")?(y=()=>h(!0),e[4]=y):y=e[4];let n;e[5]!==C||e[6]!==o||e[7]!==u||e[8]!==s?(n=d.jsx(Ft,{maxColumns:1,maxRows:Number.MAX_SAFE_INTEGER,conversation:o,paymentTypes:s,allowedCountries:C,merchantTitle:u,onReady:y}),e[5]=C,e[6]=o,e[7]=u,e[8]=s,e[9]=n):n=e[9];let g;e[10]!==U||e[11]!==o||e[12]!==N||e[13]!==S||e[14]!==M?(g=async()=>{await Xe({conversation:o,elements:N,stripe:M,billingEmail:te(U),intl:S})},e[10]=U,e[11]=o,e[12]=N,e[13]=S,e[14]=M,e[15]=g):g=e[15];let $;return e[16]!==P||e[17]!==_||e[18]!==w||e[19]!==l||e[20]!==u||e[21]!==t||e[22]!==k||e[23]!==R||e[24]!==n||e[25]!==g?($=d.jsx(gt,{isDisabled:R,isSubmitting:w,isUpdating:l,merchantTitle:u,hasValidPaymentMethod:_,paymentSheetButtonCta:t,expressCheckoutElementReady:P,expressCheckoutElement:n,onClickPay:g,pushPane:k}),e[16]=P,e[17]=_,e[18]=w,e[19]=l,e[20]=u,e[21]=t,e[22]=k,e[23]=R,e[24]=n,e[25]=g,e[26]=$):$=e[26],$};function Ht(r){return d.jsx("a",ce(ie({},r),{className:xe(r.className,"text-blue-400 underline"),target:"_blank",children:r.children}))}const Vt=10*1e3,Xt=({resetPanes:r,setLoadingPayment:e,paymentTypes:o,setStripeLoadingError:u,conversation:s})=>{"use no forget";const C=ke(),_=$e(),k=_==null?void 0:_.email,w=Ee(),l=Me(),t=ue(s),p=G(()=>t.errorMessages$()),[i,m]=H.useState(null),[c,P]=H.useState(!1),[h,S]=H.useState(()=>qe(()=>{var n;return(n=t.paymentDetails$())!=null?n:null})),[M,N]=H.useState(()=>qe(()=>{var n;return(n=t.billingAddress$())!=null?n:null})),f=H.useRef(!0),U=H.useRef(!0),R=nt(()=>{f.current=!1,u(C.formatMessage(fe.stripeLoadingPaymentMethodError)),e(!1)});H.useEffect(()=>{const n=setTimeout(()=>{f.current&&R()},Vt);return()=>clearTimeout(n)},[R]);const y=async n=>{var g,$,I,E,a,v,x,j,b,B,T;if(m(null),f.current){if(f.current=!1,n.complete&&((g=n.value.payment_method)!=null&&g.id)){t.paymentDetails$.set(ce(ie({},_e(n)),{complete:!0}));const{name:A,address:O,phone:q}=n.value.payment_method.billing_details,z={name:A!=null?A:"",line_one:($=O.line1)!=null?$:"",line_two:(I=O.line2)!=null?I:"",city:(E=O.city)!=null?E:"",state:(a=O.state)!=null?a:"",country:(v=ze(O.country))!=null?v:"US",postal_code:(x=O.postal_code)!=null?x:"",phone_number:q!=null?q:""};t.billingAddress$.set(z),S(ce(ie({},_e(n)),{complete:n.complete})),Ge({conversation:s,checkoutId:(j=t.checkoutSession$())==null?void 0:j.id,connectorId:(B=(b=t.chatSDK$())==null?void 0:b.connectorId)!=null?B:null},{label:_e(n).label,source:"prefill",hasExistingPaymentMethod:!!((T=t.paymentDetails$())!=null&&T.paymentMethodId)})}e(!1);return}n.complete&&S(ce(ie({},_e(n)),{complete:!0}))};return d.jsxs("div",{className:"flex w-full flex-col gap-4 px-6 py-4",children:[d.jsxs("div",{className:xe(!o.includes("card")&&"hidden"),children:[d.jsx(Nt,{id:"payment-element",options:{fields:{billingDetails:{email:"never",phone:"never"}},wallets:{applePay:"never",googlePay:"never"},defaultValues:{billingDetails:{email:k}},business:{name:"OpenAI"},layout:{type:"accordion",defaultCollapsed:!1}},onLoadError:()=>{f.current&&R()},onChange:y,onSavedPaymentMethodRemove:n=>{var g,$,I,E,a,v,x;((g=t.paymentDetails$())==null?void 0:g.paymentMethodId)===(($=n.payment_method)==null?void 0:$.id)&&(t.paymentDetails$.set(null),S(null)),It({conversation:s,checkoutId:(I=t.checkoutSession$())==null?void 0:I.id,connectorId:(a=(E=t.chatSDK$())==null?void 0:E.connectorId)!=null?a:null},(x=(v=n.payment_method)==null?void 0:v.type)!=null?x:"")}}),i&&d.jsx("div",{className:"mt-2",children:d.jsx(Ce,{message:i})}),d.jsx("div",{className:"mt-6 mb-2 text-sm font-medium",children:d.jsx(et,{id:"8pb7do",defaultMessage:"Billing address"})}),d.jsx(At,{options:{mode:"billing",allowedCountries:["US"],fields:{phone:"always"},validation:{phone:{required:"always"}}},onChange:n=>{var g,$,I,E,a,v,x,j;if(m(null),U.current){U.current=!1;return}N({name:(g=n.value.name)!=null?g:"",line_one:($=n.value.address.line1)!=null?$:"",line_two:(I=n.value.address.line2)!=null?I:"",city:(E=n.value.address.city)!=null?E:"",state:(a=n.value.address.state)!=null?a:"",country:(v=ze(n.value.address.country))!=null?v:"US",postal_code:(x=n.value.address.postal_code)!=null?x:"",phone_number:(j=n.value.phone)!=null?j:""})}})]}),d.jsx(yt,{isSaving:c,isDisabled:c,onClick:async()=>{var n,g,$,I;if(m(null),!w){m(C.formatMessage(fe.cartUpdateGeneralErrorRetryMessage));return}if(!h){m(C.formatMessage(fe.cartUpdateGeneralErrorMessage));return}if(!(M!=null&&M.name)){m(C.formatMessage(fe.stripeLoadingBillingAddressError));return}try{P(!0);const{error:E,paymentMethod:a}=await l.preparePaymentMethod({elements:w,params:{allow_redisplay:"always",billing_details:{name:M.name,email:k}}});if(P(!1),E){const{code:v,decline_code:x}=E||{},j=v&&x?await l.localizeError({code:v,decline_code:x}):E.message;m(j);return}Ge({conversation:s,checkoutId:(n=t.checkoutSession$())==null?void 0:n.id,connectorId:($=(g=t.chatSDK$())==null?void 0:g.connectorId)!=null?$:null},{label:h==null?void 0:h.label,source:"user",hasExistingPaymentMethod:!!((I=t.paymentDetails$())!=null&&I.paymentMethodId)}),t.paymentDetails$.set(ce(ie({},h),{complete:!0,paymentMethodId:a==null?void 0:a.id,paymentMethodType:a==null?void 0:a.type,label:h==null?void 0:h.label,sublabel:h==null?void 0:h.sublabel})),t.billingAddress$.set(M)}catch(E){console.error(E),at.addError(E),m(C.formatMessage(fe.cartUpdateGeneralErrorMessage)),P(!1);return}r()}}),p.length>0&&d.jsx(Ve,{errorMessages:p})]})},$s=r=>{"use forget";var we,Pe,Se,Ie,je,ve,Ne,Ae,Te,Le,Re,Ue,Be;const e=me.c(82),{conversation:o}=r;let u;e[0]!==o?(u=ue(o),e[0]=o,e[1]=u):u=e[1];const s=u;let C;e[2]!==s?(C=()=>s.isLoadingPayment$(),e[2]=s,e[3]=C):C=e[3];const _=G(C);let k;e[4]!==s?(k=()=>s.footerMessage$(),e[4]=s,e[5]=k):k=e[5];const w=G(k);let l;e[6]!==s?(l=()=>s.chatSDK$(),e[6]=s,e[7]=l):l=e[7];const t=G(l);let p;e[8]!==s?(p=()=>s.checkoutSession$(),e[8]=s,e[9]=p):p=e[9];const i=G(p);let m;e[10]!==s?(m=()=>s.grandTotal$(),e[10]=s,e[11]=m):m=e[11];const c=G(m);let P;e[12]!==s?(P=()=>s.paymentTypes$(),e[12]=s,e[13]=P):P=e[13];const h=G(P);let S;e[14]!==s?(S=()=>s.sellerDetails$(),e[14]=s,e[15]=S):S=e[15];const M=G(S);let N;e[16]!==s?(N=()=>s.resolvedWidget$(),e[16]=s,e[17]=N):N=e[17];const f=G(N),{platformConnectors:U}=lt(),R=H.useRef(null),y=_t("overview"),{currentPane:n,pushPane:g,popPane:$,resetPanes:I}=y;let E;e[18]!==(t==null?void 0:t.connectorId)||e[19]!==U?(E=U.get((we=t==null?void 0:t.connectorId)!=null?we:""),e[18]=t==null?void 0:t.connectorId,e[19]=U,e[20]=E):E=e[20];const a=E,v=(Pe=a==null?void 0:a.logo_url)!=null?Pe:"",x=(Se=a==null?void 0:a.logo_url_dark)!=null?Se:"";let j;e[21]!==v||e[22]!==x?(j={lightLogoUrl:v,darkLogoUrl:x},e[21]=v,e[22]=x,e[23]=j):j=e[23];const{data:b}=Tt(j),B=(Ie=f==null?void 0:f.logoUrl)!=null?Ie:void 0;let T,A;e[24]!==t||e[25]!==i||e[26]!==a||e[27]!==o||e[28]!==_||e[29]!==s?(T=()=>{var re,pe,he;!i||!t||!a||_||R.current===i.id||(jt({conversation:o,checkoutId:i.id,connectorId:(re=t==null?void 0:t.connectorId)!=null?re:null,messageId:(pe=t==null?void 0:t.toolMessageId)!=null?pe:null},{merchantName:a.name,merchantUrl:t.metadata.widget_domain,hadSavedPaymentMethod:!!((he=s.paymentDetails$())!=null&&he.complete)}),R.current=i.id)},A=[t,i,a,o,_,s],e[24]=t,e[25]=i,e[26]=a,e[27]=o,e[28]=_,e[29]=s,e[30]=T,e[31]=A):(T=e[30],A=e[31]),H.useEffect(T,A);const O=(je=t==null?void 0:t.widgetType)!=null?je:"",q=(ve=t==null?void 0:t.connectorId)!=null?ve:"",z=(Ne=t==null?void 0:t.toolMessageId)!=null?Ne:"",Y=(Ae=t==null?void 0:t.metadata.suggestion_message_id)!=null?Ae:"",X=(Te=t==null?void 0:t.metadata.distribution_channel)!=null?Te:rt.ONLY_ME;let Q;e[32]!==o.id||e[33]!==O||e[34]!==q||e[35]!==z||e[36]!==Y||e[37]!==X?(Q={name:O,conversation_id:o.id,attribution_id:q,message_id:z,suggestion_message_id:Y,merchant_platform:"ecosystem",distribution_channel:X},e[32]=o.id,e[33]=O,e[34]=q,e[35]=z,e[36]=Y,e[37]=X,e[38]=Q):Q=e[38];const Z=Q;let D,K;if(e[39]!==Z||e[40]!==t||e[41]!==i||e[42]!==a?(D=()=>{!i||!t||!a||it.logEventWithStatsig("chatgpt_web_ecosystem_app_checkout_modal_shown","chatgpt_web_ecosystem_app_checkout_modal_shown",Z)},K=[Z,t,i,a],e[39]=Z,e[40]=t,e[41]=i,e[42]=a,e[43]=D,e[44]=K):(D=e[43],K=e[44]),H.useEffect(D,K),!i||!t||!a)return null;const se=(i==null?void 0:i.status)!=="completed";let F,V;e[45]!==s?(F=re=>{re.preventDefault(),s.cancelCheckout$()},V=()=>s.cancelCheckout$(),e[45]=s,e[46]=F,e[47]=V):(F=e[46],V=e[47]);const L=(Le=B!=null?B:b==null?void 0:b.url)!=null?Le:void 0;let J;e[48]!==t.metadata.widget_domain||e[49]!==a.name||e[50]!==n||e[51]!==$||e[52]!==L?(J=d.jsx(xt,{currentPane:n,popPane:$,url:t.metadata.widget_domain,logoUrl:L,title:a.name,PANES:Yt}),e[48]=t.metadata.widget_domain,e[49]=a.name,e[50]=n,e[51]=$,e[52]=L,e[53]=J):J=e[53];const oe=(Re=c==null?void 0:c.amount)!=null?Re:0,ee=(Ue=M==null?void 0:M.external_id)!=null?Ue:t.widgetParent,ne=(Be=M==null?void 0:M.network_id)!=null?Be:t.widgetParent;let W;e[54]!==s?(W=()=>s.fetchStripeSession$(),e[54]=s,e[55]=W):W=e[55];let ae;e[56]!==i||e[57]!==a.name||e[58]!==o||e[59]!==w||e[60]!==_||e[61]!==y||e[62]!==h||e[63]!==g||e[64]!==I||e[65]!==s?(ae=re=>{const{loadingCartSession:pe,cartLoadError:he}=re;return d.jsxs("div",{className:"relative flex h-full w-full flex-col",children:[d.jsx("hr",{className:"mx-6"}),d.jsx(bt,{className:"w-full flex-1",paneStack:y,useDelayedEnteringPane:!0,alwaysMountedPanes:["paymentMethod","overview"],renderPane:Ye=>{switch(Ye){case"overview":return d.jsx(zt,{conversation:o,cartLoadError:he,pushPane:g,merchantTitle:a.name,paymentTypes:h,isLoadingCartSession:pe,isLoadingPayment:_,isLoadingAddress:!1,currency:i.currency,totals:i.totals,footerMessage:w});case"paymentMethod":return!pe&&!he&&d.jsx(Xt,{resetPanes:I,paymentTypes:h,setStripeLoadingError:ye=>{ye&&s.addErrorMessage$(ye)},setLoadingPayment:ye=>s.isLoadingPayment$.set(ye),conversation:o})}}})]})},e[56]=i,e[57]=a.name,e[58]=o,e[59]=w,e[60]=_,e[61]=y,e[62]=h,e[63]=g,e[64]=I,e[65]=s,e[66]=ae):ae=e[66];let le;e[67]!==a.name||e[68]!==o.id||e[69]!==h||e[70]!==oe||e[71]!==ee||e[72]!==ne||e[73]!==W||e[74]!==ae?(le=d.jsx(kt,{grandTotal:oe,merchantExternalId:ee,merchantNetworkId:ne,merchantTitle:a.name,paymentMethodTypes:h,clientThreadId:o.id,fetchSession:W,children:ae}),e[67]=a.name,e[68]=o.id,e[69]=h,e[70]=oe,e[71]=ee,e[72]=ne,e[73]=W,e[74]=ae,e[75]=le):le=e[75];let ge;return e[76]!==se||e[77]!==F||e[78]!==V||e[79]!==J||e[80]!==le?(ge=d.jsx(ct,{testId:"modal-shopping-checkout",isOpen:!0,hideSeparator:!0,showCloseButton:se,size:"large",type:"success",className:"min-h-[600px] max-w-[550px]!",headerClassName:"sm:p-0 sm:px-4 sm:py-4 items-center sm:-me-1",contentClassName:"!p-0 pt-3",onEscapeKeyDown:F,onClose:V,title:J,children:le}),e[76]=se,e[77]=F,e[78]=V,e[79]=J,e[80]=le,e[81]=ge):ge=e[81],ge},Yt={overview:{name:{id:"shopping-checkout.pane.overview.title",defaultMessage:"Overview",description:"Title for shopping checkout overview pane"}},shippingAddress:{name:{id:"shopping-checkout.pane.shippingAddress.title",defaultMessage:"Add Shipping Address",description:"Title for shopping checkout shipping address pane"}},shippingMethod:{name:{id:"shopping-checkout.pane.shippingMethod.title",defaultMessage:"Select Shipping Method",description:"Title for shopping checkout shipping method pane"}},paymentMethod:{name:{id:"shopping-checkout.pane.paymentMethod.title",defaultMessage:"Add payment method",description:"Title for shopping checkout payment method pane"}}};export{$s as EcosystemCheckoutModal};
//# sourceMappingURL=bysclkdhj1m29gld.js.map
