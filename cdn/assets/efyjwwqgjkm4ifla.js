var pe=Object.defineProperty;var H=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var ae=(t,e,s)=>e in t?pe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,W=(t,e)=>{for(var s in e||(e={}))ne.call(e,s)&&ae(t,s,e[s]);if(H)for(var s of H(e))re.call(e,s)&&ae(t,s,e[s]);return t};var Z=(t,e)=>{var s={};for(var a in t)ne.call(t,a)&&e.indexOf(a)<0&&(s[a]=t[a]);if(t!=null&&H)for(var a of H(t))e.indexOf(a)<0&&re.call(t,a)&&(s[a]=t[a]);return s};import{c as K,r as m,j as n,e as ie,M as x}from"./fg33krlcm0qyi6yw.js";import{f as ge,fY as be,d as le,l as G,a9 as ce,py as xe,e as ue,g2 as se,M as ee,az as ve,aq as ye,i6 as je,gK as we}from"./mtk1qztvnb31pw5r.js";import{ca as Ce,dT as Me,nx as Se,fS as ke}from"./k65njl5wlgspihfr.js";const Ie=ge(()=>{const t=navigator.permissions;let e=t?null:"unsupported";return be(()=>e,s=>{if(!t)return()=>{};let a;function i(){a&&(e=a.state,s())}return t.query({name:"camera"}).then(l=>{a=l,i(),a.addEventListener("change",i)},()=>{e="unsupported",s()}),()=>{a&&a.removeEventListener("change",i)}})});function Ne(t){"use forget";var u;const e=K.c(8);let s,a;e[0]!==t?(u=t,{file:s}=u,a=Z(u,["file"]),e[0]=t,e[1]=s,e[2]=a):(s=e[1],a=e[2]);const i=m.useRef(null);let l,o;e[3]!==s?(l=()=>{if(i.current){const f=URL.createObjectURL(s);return i.current.src=f,()=>{setTimeout(()=>URL.revokeObjectURL(f),250)}}},o=[s],e[3]=s,e[4]=l,e[5]=o):(l=e[4],o=e[5]),m.useEffect(l,o);let c;return e[6]!==a?(c=n.jsx("img",W({ref:i,alt:""},a)),e[6]=a,e[7]=c):c=e[7],c}const Re="RhH-yq_countdown",_e={countdown:Re};function We(t){"use forget";const e=K.c(60),{isOpen:s,onClose:a,onPhotoSave:i}=t,l=s===void 0?!0:s,o=ie(),c=m.useRef(null),u=m.useRef(null);let f;e[0]===Symbol.for("react.memo_cache_sentinel")?(f={status:0},e[0]=f):f=e[0];const[r,d]=m.useState(f),[p,de]=m.useState(0),[v,fe]=m.useState(void 0),[y,me]=m.useState(void 0);let D;e[1]!==v?(D=h=>{h!==v&&m.startTransition(()=>{d({status:0}),me(h)})},e[1]=v,e[2]=D):D=e[2];const X=D,g=le(De);let O;e[3]!==y?(O=()=>{const h=new AbortController;return(async()=>{if(!c.current)return;const A=await Pe(y,{signal:h.signal});A.status==="success"?(await Be(c.current,A.stream),d({status:2}),fe($e(A.stream))):A.status==="permissionDenied"&&d({status:1})})(),()=>h.abort(new DOMException(""))},e[3]=y,e[4]=O):O=e[4];let T;e[5]!==g||e[6]!==y||e[7]!==p?(T=[g,p,y],e[5]=g,e[6]=y,e[7]=p,e[8]=T):T=e[8],m.useEffect(O,T);let q;if(e[9]===Symbol.for("react.memo_cache_sentinel")){const h=async()=>{if(d({status:4}),await Fe(350),!c.current)return;const b=await Le(c.current);c.current&&d(b?{status:5,file:b}:{status:2})};q=()=>{if(!c.current)return;d({status:3,seconds:3});let b=3;u.current=window.setInterval(()=>{c.current&&(b=b-1,b>0?d({status:3,seconds:b}):h())},1e3)},e[9]=q}else q=e[9];const he=q;let L,P;e[10]!==r.status?(L=()=>{if(r.status===3)return()=>{u.current&&(window.clearInterval(u.current),u.current=null)}},P=[r.status],e[10]=r.status,e[11]=L,e[12]=P):(L=e[11],P=e[12]),m.useEffect(L,P);let $;e[13]!==r.status||e[14]!==a?($=h=>{h.preventDefault(),r.status===3||r.status===5?d({status:2}):a==null||a()},e[13]=r.status,e[14]=a,e[15]=$):$=e[15];const J=$;let j;e[16]!==a?(j=()=>a==null?void 0:a(),e[16]=a,e[17]=j):j=e[17];let B;e[18]===Symbol.for("react.memo_cache_sentinel")?(B=n.jsx(ee.Overlay,{className:"z-0!"}),e[18]=B):B=e[18];const Y=r.status===3?"opacity-70":"opacity-0";let w;e[19]!==Y?(w=G("pointer-events-none fixed inset-0 transition-opacity duration-150 ease-in-out dark:bg-white",Y),e[19]=Y,e[20]=w):w=e[20];let C;e[21]!==w?(C=n.jsx("div",{className:w}),e[21]=w,e[22]=C):C=e[22];const Q=r.status!==4&&"opacity-0 transition-opacity duration-750 ease-in-out";let M;e[23]!==Q?(M=G("pointer-events-none fixed inset-0 z-100 bg-white",Q),e[23]=Q,e[24]=M):M=e[24];let S;e[25]!==M?(S=n.jsx("div",{className:M}),e[25]=M,e[26]=S):S=e[26];let z,F;e[27]===Symbol.for("react.memo_cache_sentinel")?(z=n.jsx(ve,{children:n.jsx(ye,{children:n.jsx(x,{id:"+gUP6P",defaultMessage:"Photo booth"})})}),F=n.jsx("video",{ref:c,className:"absolute inset-0 h-full w-full -scale-x-100 bg-gray-700 object-cover",playsInline:!0,muted:!0}),e[27]=z,e[28]=F):(z=e[27],F=e[28]);let k;e[29]!==r.file||e[30]!==r.status||e[31]!==o?(k=r.status===5&&n.jsx(Ne,{file:r.file,className:"absolute inset-0 h-full w-full -scale-x-100 object-cover","aria-label":o.formatMessage({id:"GvTutH",defaultMessage:"Captured photo preview"})}),e[29]=r.file,e[30]=r.status,e[31]=o,e[32]=k):k=e[32];let I;e[33]!==o?(I=o.formatMessage({id:"uf6UyP",defaultMessage:"Close photo booth"}),e[33]=o,e[34]=I):I=e[34];let U;e[35]===Symbol.for("react.memo_cache_sentinel")?(U=n.jsx(ke,{"aria-hidden":!0,className:"icon"}),e[35]=U):U=e[35];let N;e[36]!==a||e[37]!==I?(N=n.jsx(E,{size:"small",color:"secondary",className:"absolute! end-4 top-4 h-10 w-10 shadow-none",onClick:a,"aria-label":I,children:U}),e[36]=a,e[37]=I,e[38]=N):N=e[38];let R;e[39]!==v||e[40]!==r.file||e[41]!==r.seconds||e[42]!==r.status||e[43]!==X||e[44]!==o||e[45]!==a||e[46]!==i||e[47]!==g?(R=r.status===0||r.status===1||g==="denied"?n.jsx("div",{className:"bg-token-surface-primary/80 absolute inset-0 flex items-center justify-center",children:n.jsx("div",{className:"text-token-text-secondary text-center",children:r.status===1||g==="denied"?n.jsxs("div",{className:"flex flex-col items-center gap-4",children:[n.jsx(x,{id:"4MPrcH",defaultMessage:"Couldn't access your camera. Check permissions."}),n.jsx(ce,{color:"primary",onClick:()=>{m.startTransition(()=>{d({status:0}),de(Ee)})},children:n.jsx(x,{id:"XOyGLW",defaultMessage:"Try again"})})]}):g==="prompt"?n.jsx("div",{className:"transition-opacity delay-750 duration-100 starting:opacity-0",children:n.jsx(x,{id:"Xm3zBl",defaultMessage:"Waiting for permission…"})}):n.jsx("div",{className:"transition-opacity delay-750 duration-100 starting:opacity-0",children:n.jsx(x,{id:"jq+hug",defaultMessage:"Starting camera…"})})})}):n.jsxs("div",{className:"absolute inset-x-0 bottom-4 flex items-center justify-center gap-3",children:[r.status===5&&n.jsxs("div",{className:"relative bottom-0 h-16 w-48",children:[n.jsx(E,{color:"secondary",className:"absolute! start-1 top-3 h-10 w-10",onClick:()=>{d({status:2})},"aria-label":o.formatMessage({id:"4iTJDm",defaultMessage:"Retake photo"}),children:n.jsx(xe,{"aria-hidden":!0,className:"icon"})}),n.jsx(E,{ref:te,className:"absolute! start-16 h-16 w-16",onClick:()=>{i==null||i(r.file),a==null||a()},"aria-label":o.formatMessage({id:"V9g3b/",defaultMessage:"Keep this photo"}),children:n.jsx(Ce,{"aria-hidden":!0,className:"h-7 w-7"})})]}),r.status===2&&n.jsx(E,{ref:te,disabled:r.status!==2,className:"h-16 w-16",onClick:he,"aria-label":o.formatMessage({id:"3kqvVC",defaultMessage:"Take a photo"}),children:n.jsx(Me,{"aria-hidden":!0,className:"h-7 w-7"})}),r.status===3&&n.jsx("button",{ref:te,type:"button",className:G("flex h-16 w-16 items-center justify-center rounded-full border border-white/15 text-center text-4xl font-semibold text-white/60 outline-none focus-visible:ring-2 focus-visible:ring-offset-1",_e.countdown),onClick:()=>d({status:2}),"aria-label":o.formatMessage({id:"xepTCY",defaultMessage:"Cancel photo"}),children:r.seconds}),r.status===2&&n.jsx(Oe,{selectedCameraId:v,onChange:X})]}),e[39]=v,e[40]=r.file,e[41]=r.seconds,e[42]=r.status,e[43]=X,e[44]=o,e[45]=a,e[46]=i,e[47]=g,e[48]=R):R=e[48];let _;e[49]!==J||e[50]!==k||e[51]!==N||e[52]!==R?(_=n.jsxs(ee.Content,{className:"dark relative aspect-2/3 max-h-full w-auto! max-w-[min(800px,100%)] overflow-hidden select-none sm:aspect-3/2",onEscapeKeyDown:J,children:[z,F,k,N,R]}),e[49]=J,e[50]=k,e[51]=N,e[52]=R,e[53]=_):_=e[53];let V;return e[54]!==l||e[55]!==j||e[56]!==C||e[57]!==S||e[58]!==_?(V=n.jsxs(ee.Root,{isOpen:l,onClose:j,testId:"modal-photo-booth",shouldIgnoreClickOutside:!0,children:[B,C,S,_]}),e[54]=l,e[55]=j,e[56]=C,e[57]=S,e[58]=_,e[59]=V):V=e[59],V}function Ee(t){return t+1}function De(){return Ie(ue())}function Oe(t){"use forget";const e=K.c(15),{selectedCameraId:s,onChange:a}=t,i=ie(),l=le(qe);if(!l||l.length<2)return null;let o;e[0]!==i?(o=i.formatMessage({id:"E+qxJV",defaultMessage:"Select camera"}),e[0]=i,e[1]=o):o=e[1];let c;e[2]===Symbol.for("react.memo_cache_sentinel")?(c=n.jsx(je,{"aria-hidden":!0,className:"icon"}),e[2]=c):c=e[2];let u;e[3]!==o?(u=n.jsx(E,{color:"secondary",className:"absolute! end-4 bottom-0 flex h-10 w-10 items-center gap-1.5 px-0","aria-label":o,children:c}),e[3]=o,e[4]=u):u=e[4];let f;e[5]===Symbol.for("react.memo_cache_sentinel")?(f=n.jsx(se.Label,{children:n.jsx(x,{id:"WXdIEB",defaultMessage:"Camera"})}),e[5]=f):f=e[5];let r;e[6]!==l?(r=l.map(Te),e[6]=l,e[7]=r):r=e[7];let d;e[8]!==a||e[9]!==s||e[10]!==r?(d=n.jsx(se.RadioGroup,{value:s,onValueChange:a,children:r}),e[8]=a,e[9]=s,e[10]=r,e[11]=d):d=e[11];let p;return e[12]!==u||e[13]!==d?(p=n.jsxs(we,{contentAlign:"end",side:"top",size:"small",sideOffset:4,triggerButton:u,children:[f,d]}),e[12]=u,e[13]=d,e[14]=p):p=e[14],p}function Te(t,e){return n.jsx(se.RadioItem,{value:t.deviceId,label:t.label?ze(t.label):n.jsx(x,{id:"fjQnn4",defaultMessage:"Camera {number}",values:{number:e+1}})},t.deviceId)}function qe(){return Se(ue())}function E(t){"use forget";var f;const e=K.c(10);let s,a,i;e[0]!==t?(f=t,{className:a,color:i}=f,s=Z(f,["className","color"]),e[0]=t,e[1]=s,e[2]=a,e[3]=i):(s=e[1],a=e[2],i=e[3]);const l=i==="secondary"?"border-black/5 bg-gray-400/25! backdrop-blur-xs not-disabled:hover:border-black/10 not-disabled:hover:bg-gray-400/35! not-disabled:hover:backdrop-blur-sm":"border-black/5 bg-gray-200/45! backdrop-blur-sm not-disabled:hover:border-black/10 not-disabled:hover:bg-gray-200/55! not-disabled:hover:backdrop-blur-md";let o;e[4]!==a||e[5]!==l?(o=G("pointer-events-auto rounded-full text-white shadow-lg shadow-black/20 transition-colors text-shadow-[rgb(0,0,0,0.6)_0_0_20px]",l,a),e[4]=a,e[5]=l,e[6]=o):o=e[6];const c=s;let u;return e[7]!==o||e[8]!==c?(u=n.jsx(ce,W({color:"custom",className:o},c)),e[7]=o,e[8]=c,e[9]=u):u=e[9],u}async function Le(t){const e="photo-".concat(Date.now(),".jpg");try{const s=document.createElement("canvas");s.hidden=!0,s.width=t.videoWidth,s.height=t.videoHeight,document.documentElement.appendChild(s);const a=s.getContext("2d");if(a){a.drawImage(t,0,0,s.width,s.height);const i=await new Promise(l=>{s.toBlob(l,"image/jpeg",.9)});if(i)return document.documentElement.removeChild(s),new File([i],e,{type:i.type})}return document.documentElement.removeChild(s),null}catch(s){return null}}async function Pe(t,{signal:e}){try{const s=await navigator.mediaDevices.getUserMedia({audio:!1,video:W({width:{ideal:1620},height:{ideal:1080}},t?{deviceId:{exact:t}}:{facingMode:"user"})});return e.aborted?(oe(s),{status:"aborted"}):(e.addEventListener("abort",()=>oe(s)),{status:"success",stream:s})}catch(s){return{status:"permissionDenied"}}}function oe(t){t.getTracks().forEach(e=>e.stop())}function $e(t){var e;return(e=t.getTracks().find(s=>s.getSettings().deviceId))==null?void 0:e.getSettings().deviceId}async function Be(t,e){try{t.srcObject=e,await t.play()}catch(s){if(!(s instanceof DOMException&&s.name==="AbortError"))throw s}}const ze=t=>t.replace(/\s*\(\s*[0-9a-fA-F]{3,4}\s*:\s*[0-9a-fA-F]{3,4}\s*\)\s*$/,"").replace(/\s*\((default|built-?in)\)\s*$/i,"").replace(/\s+/g," ").trim(),te=t=>t==null?void 0:t.focus(),Fe=t=>new Promise(e=>setTimeout(e,t));export{We as PhotoBoothModal};
//# sourceMappingURL=efyjwwqgjkm4ifla.js.map
