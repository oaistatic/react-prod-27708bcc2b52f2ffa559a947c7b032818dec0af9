import{b as Ce,r as se,c as ge,am as ye,j}from"./fg33krlcm0qyi6yw.js";import{R as Ne,H as be,b as ke,d as E,mN as Ie,bb as Oe,bR as pe,o_ as ie,bo as Te,bB as he,gY as Re,gZ as Se,bU as le,bZ as ve,bq as ae,bt as de}from"./mtk1qztvnb31pw5r.js";import{fn as ue}from"./k65njl5wlgspihfr.js";function Ae(n){const{data:e,isLoading:o}=Ce({queryKey:["workspace_connector_stats",n],queryFn:()=>Ne.safeGet("/aip/workspace/connector-stats"),enabled:!!n}),s=se.useMemo(()=>{var l,d,O;const c=new Map,m=(l=e==null?void 0:e.connector_stats)!=null?l:[];for(const _ of m){const f=Number((d=_.unique_user_cnt)!=null?d:0);Number.isFinite(f)&&c.set(_.connector_id,((O=c.get(_.connector_id))!=null?O:0)+f)}return c},[e]),a=se.useMemo(()=>{const c=Array.from(s.entries()).map(([m,l])=>({connectorId:m,totalCount:l}));return c.sort((m,l)=>l.totalCount-m.totalCount),c},[s]);return{totalsByConnectorId:s,topSorted:a,isLoading:o}}function De(n){"use forget";var U,$,W,F,G,Q,V,K,Y,Z,H,X,J,ee,ne;const e=ge.c(36),o=ke(),s=be();let a;e[0]!==o?(a=()=>{var r;return(r=Te(o,{}).data)==null?void 0:r.connectors},e[0]=o,e[1]=a):a=e[1];const c=E(a),m=c===void 0;let l;e[2]!==o?(l=()=>{var r;return(r=he(o,{fetchValidLinksOnly:!0}))==null?void 0:r.data},e[2]=o,e[3]=l):l=e[3];const d=E(l),O=d===void 0;let _;e[4]!==o?(_=()=>Re(o),e[4]=o,e[5]=_):_=e[5];const f=E(_);let p;e[6]!==o?(p=()=>Se(o),e[6]=o,e[7]=p):p=e[7];const y=E(p),fe=f===void 0||y===void 0,N=Ie(),x=Oe()&&n.theme!=="light"||n.theme==="dark",{mutateAsync:L,isSuccess:M}=pe();let T;e[8]===Symbol.for("react.memo_cache_sentinel")?(T={filters:{mutationKey:["upgradeConnectorToSync"]},select:qe},e[8]=T):T=e[8];const q=ye(T);let h;e[9]!==s?(h=s==null?void 0:s.getWorkspaceId(),e[9]=s,e[10]=h):h=e[10];const{totalsByConnectorId:R}=Ae(h);let k;if(e[11]!==q){k=new Set;for(const r of q)r.status==="success"&&k.add(r.variables.link.connector_id);e[11]=q,e[12]=k}else k=e[12];const P=k;let S;if(e[13]!==f||e[14]!==P||e[15]!==d||e[16]!==o||e[17]!==y||e[18]!==x||e[19]!==N||e[20]!==n.iconSize||e[21]!==n.referrer||e[22]!==n.theme||e[23]!==c||e[24]!==R||e[25]!==L||e[26]!==M){const r=new Map;for(const t of f!=null?f:[]){const u=((U=d==null?void 0:d.get(t.id))!=null?U:[]).length>0,C=($=R.get(t.id))!=null?$:0;r.set(t.id,{key:t.id,label:t.name,connected:u,isSync:!1,totalCount:C,icon:j.jsx(ue,{connector:t,size:(W=n.iconSize)!=null?W:"small",theme:n.theme}),onClick:u?void 0:()=>N({connectorId:t.id,noRedirect:!0,referrer:n.referrer})})}for(const t of y!=null?y:[]){const i=t.user_connection_details.connector_id,u=c==null?void 0:c.find(D=>D.id===i);if(!u||!i)continue;const C=(Q=(G=u==null?void 0:u.name)!=null?G:(F=t==null?void 0:t.connection_display_info)==null?void 0:F.display_name)!=null?Q:"",_e=P.has(i),te=((K=i&&((V=r.get(i))==null?void 0:V.connected))!=null?K:!1)||(t==null?void 0:t.user_connection_details.auth_status)==="admin_connected"||(t==null?void 0:t.user_connection_details.auth_status)==="user_connected"||["partially_activated","activated","activating"].includes(t==null?void 0:t.user_connection_details.activation_status)||_e,g={key:t.user_connection_details.connection_type,label:C,connected:te,isSync:!0,totalCount:(Y=R.get(i))!=null?Y:0,icon:u?j.jsx(ue,{connector:u,size:(Z=n.iconSize)!=null?Z:"small",theme:n.theme}):j.jsx("img",{src:x&&((H=t==null?void 0:t.connection_display_info)!=null&&H.icon_dark_url)?(X=t==null?void 0:t.connection_display_info)==null?void 0:X.icon_dark_url:(ee=(J=t==null?void 0:t.connection_display_info)==null?void 0:J.icon_url)!=null?ee:"",alt:C,className:"icon-lg"}),onClick:te?void 0:()=>N({connectorId:i,noRedirect:!0,referrer:n.referrer})};t.user_connection_details.connection_type===ie.gdrive_sync_connector?(g.connected=g.connected||M,g.onClick=g.connected?void 0:async()=>{var ce,re;const D=(ce=c==null?void 0:c.find(Me))==null?void 0:ce.id,oe=(re=d==null?void 0:d.get(le))==null?void 0:re.find(me=>me.connector_id===D);oe?(await L({link:oe,referrer:String(n.referrer)}),setTimeout(()=>{ve(o)},1e3)):N({connectorId:ae[de.GDRIVE_ACTION_CONNECTOR],noRedirect:!0,referrer:n.referrer})}):t.user_connection_details.connection_type===ie.notion_sync_connector&&(g.onClick=g.connected?void 0:()=>N({connectorId:ae[de.NOTION_CONNECTOR],noRedirect:!0,referrer:n.referrer,syncOnly:!0})),r.set(i,g)}S=Array.from(r.values()),e[13]=f,e[14]=P,e[15]=d,e[16]=o,e[17]=y,e[18]=x,e[19]=N,e[20]=n.iconSize,e[21]=n.referrer,e[22]=n.theme,e[23]=c,e[24]=R,e[25]=L,e[26]=M,e[27]=S}else S=e[27];const w=S;let I;if(e[28]!==w){const r=new Map,t=Le;for(const i of w){const u=String((ne=i.label)!=null?ne:"").toLowerCase().trim(),C=r.get(u);r.set(u,C?t(C,i):i)}I=Array.from(r.values()),I.sort(xe),e[28]=w,e[29]=I}else I=e[29];const b=I;let v;e[30]!==b?(v=b.filter(Ee),e[30]=b,e[31]=v):v=e[31];const z=v.length,B=fe||O||m;let A;return e[32]!==z||e[33]!==B||e[34]!==b?(A={uniqueItems:b,connectedCount:z,isLoading:B},e[32]=z,e[33]=B,e[34]=b,e[35]=A):A=e[35],A}function Ee(n){return n.connected}function xe(n,e){var a,c;if(n.connected!==e.connected)return Number(e.connected)-Number(n.connected);const o=Number((a=n.totalCount)!=null?a:0),s=Number((c=e.totalCount)!=null?c:0);return o!==s?s-o:0}function Le(n,e){var a,c;if(n.connected!==e.connected)return e.connected?e:n;if(n.isSync!==e.isSync)return e.isSync?e:n;const o=Number((a=n.totalCount)!=null?a:0),s=Number((c=e.totalCount)!=null?c:0);return o!==s&&s>o?e:n}function Me(n){return n.id===le}function qe(n){return n.state}export{De as u};
//# sourceMappingURL=jd4eqvrqcumq5jwz.js.map
