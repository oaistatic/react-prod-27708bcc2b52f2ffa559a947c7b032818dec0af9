import{j as s,c as V,a as ve,e as U,r as F,h as $e}from"./fg33krlcm0qyi6yw.js";import{A as me,a as Re,b as _e,g as be,p as ke,c as Me,E as je,S as Le,F as C,C as Pe}from"./dp77n34mztiej9w9.js";import{l as Fe,m as H,H as Ie,ag as Te,gK as Ee,fA as we,eD as Ne,C as Be,M as fe,hv as he,jR as De,pY as Ue,xh as qe,fj as Ge,jj as We}from"./mtk1qztvnb31pw5r.js";import{A as ze,gA as G,z as Oe,an as I,b2 as pe}from"./k65njl5wlgspihfr.js";import{m as Ve}from"./ocjy2hqri2k6d7gs.js";import{p as He}from"./jcfo2542d2wvunuv.js";function Qe({title:t,children:e,className:a=""}){return s.jsx("div",{className:"border-token-border-light bg-token-main-surface-primary ring-token-border-light/60 overflow-hidden rounded-lg border p-4 shadow ring-1 shadow-black/20 md:p-5 dark:shadow-black/60 dark:ring-white/10 ".concat(a),children:s.jsxs("section",{children:[t&&s.jsx("div",{className:"text-title-small mb-5 font-semibold tracking-wide",children:t}),s.jsx("div",{className:"grid grid-cols-1 gap-3",children:e})]})})}function S({label:t,children:e}){return s.jsxs("div",{className:"grid grid-cols-2 items-start gap-1 text-sm md:grid-cols-[auto,1fr] md:gap-2",children:[s.jsx("div",{className:"text-token-text-tertiary md:w-44",children:t}),s.jsx("div",{className:"w-full min-w-0 overflow-hidden break-words hyphens-auto",children:e})]})}const Ye={success:"bg-green-700/15 text-green-700 dark:bg-green-900/40 dark:text-green-300",warning:"bg-yellow-700/15 text-yellow-700 dark:bg-yellow-900/40 dark:text-yellow-300",critical:"bg-red-700/15 text-red-700 dark:bg-red-900/60 dark:text-red-300",danger:"bg-red-500/15 text-red-500 dark:bg-red-500/15 dark:text-red-300",muted:"bg-token-bg-elevated-secondary text-token-text-tertiary dark:bg-token-bg-elevated-secondary/70 dark:text-token-text-tertiary",neutral:"bg-token-main-surface-secondary/70 text-token-text-secondary border border-token-border-strong dark:bg-token-main-surface-secondary/80",purple:"bg-purple-400/15 text-purple-400"};function T(t){"use forget";const e=V.c(7),{variant:a,children:r,className:i,size:c}=t,u=(c===void 0?"md":c)==="sm"?"px-1.5 py-0 text-[11px]":"px-2 py-0.5 text-xs",h=Ye[a];let n;e[0]!==i||e[1]!==u||e[2]!==h?(n=Fe("inline-flex items-center rounded-full",u,h,i),e[0]=i,e[1]=u,e[2]=h,e[3]=n):n=e[3];let o;return e[4]!==r||e[5]!==n?(o=s.jsx("span",{className:n,children:r}),e[4]=r,e[5]=n,e[6]=o):o=e[6],o}function ge({name:t,email:e}){var c;const a=(t!=null?t:"").trim();if(a.length>0){const l=a.split(/\s+/).filter(Boolean);return l.length>=2?(l[0][0]+l[l.length-1][0]).toUpperCase():l[0].slice(0,2).toUpperCase()}const r=(c=(e!=null?e:"").split("@")[0])!=null?c:"";if(!r)return"?";const i=r.split(/[._-]+/).filter(Boolean);return i.length>=2?(i[0][0]+i[1][0]).toUpperCase():r.slice(0,2).toUpperCase()}function Ke({finding:t}){var $,R,L,P,b;const e=ve(),a=H(),r=U(),i=Ie(),c=i==null?void 0:i.getWorkspaceId(),l=i==null?void 0:i.normalizedAccountUserId,[u,h]=F.useState(""),[n,o]=F.useState(!1),f=Te(),{data:g,isLoading:v}=ze(c!=null?c:void 0,0,u,100),x=F.useMemo(()=>{var y,k;return{id:l!=null?l:"",email:(y=f==null?void 0:f.email)!=null?y:"",name:(k=f==null?void 0:f.name)!=null?k:void 0}},[l,f==null?void 0:f.email,f==null?void 0:f.name]),m=F.useMemo(()=>{var k;const y=((k=g==null?void 0:g.items)!=null?k:[]).map(_=>{var w,B;return{id:_.account_user_id,email:(w=_.email)!=null?w:"",name:(B=_.name)!=null?B:void 0}}).filter(_=>_.email.length>0);return x.id&&x.email&&(y.some(w=>w.id===x.id||w.email.toLowerCase()===x.email.toLowerCase())||y.unshift(x)),y},[g==null?void 0:g.items,x]),p=($=t.assignee_id)!=null?$:"none",d=p==="none"?"":(L=(R=t.assignee)==null?void 0:R.email)!=null?L:"",A=p==="none"?void 0:(b=(P=t.assignee)==null?void 0:P.name)!=null?b:"",M=p==="none"?"—":ge({name:A,email:d}),j=async y=>{try{o(!0);const _=await new _e(we).patch("/aardvark/scan-findings/{id}",{headers:Ne(),path:{id:t.id},body:{version:t.version,assignee_user_email:y}});if(_.status!==200)throw be(_.status,_.data);ke(e,t.hid,_.data),Me(e,t.hid,_.data),a.successNeutral(r.formatMessage({id:"aardvark.toast.assigneeUpdated",defaultMessage:"Assignee updated"}),{duration:5,hasCloseButton:!0})}catch(k){const _=k,w=r.formatMessage(je.assigneeUpdate,{details:_.message});a.danger(w,{duration:5,hasCloseButton:!0})}finally{o(!1)}};return n?s.jsx("button",{disabled:!0,title:d,className:"border-token-border-light bg-token-bg-primary inline-flex h-8 w-8 cursor-not-allowed items-center justify-center rounded-full border text-[11px] font-semibold opacity-60","aria-disabled":!0,children:p==="none"?s.jsx(G,{className:"icon-sm","aria-hidden":!0}):M}):s.jsx(Ee,{triggerButton:s.jsx("button",{title:d,className:"border-token-border-light bg-token-bg-primary inline-flex h-8 w-8 items-center justify-center rounded-full border text-[11px] font-semibold","aria-busy":v,children:p==="none"?s.jsx(G,{className:"icon-sm","aria-hidden":!0}):M}),children:s.jsxs("div",{className:"p-2.5",children:[s.jsx(Oe,{color:"search",name:"assignee-search",type:"text",value:u,onChange:y=>h(y.target.value),placeholder:r.formatMessage(me.search),ariaLabel:r.formatMessage(me.search),className:"text-token-text-tertiary flex h-8 w-full items-center rounded-sm",inputClassName:"text-token-text-primary w-full",containerInputClassName:"w-full"}),s.jsxs("div",{className:"mt-2 max-h-60 overflow-y-auto",children:[s.jsxs("button",{type:"button",onClick:()=>j(null),className:"hover:bg-token-bg-tertiary flex w-full items-center gap-2 rounded-sm px-2 py-1 text-start text-sm ".concat(p==="none"?"bg-token-bg-tertiary":""),children:[s.jsx("div",{className:"border-token-border-light bg-token-bg-primary inline-flex h-7 w-7 items-center justify-center rounded-full border text-[11px] font-semibold",children:s.jsx(G,{className:"icon-sm","aria-hidden":!0})}),s.jsx("div",{className:"flex flex-col",children:s.jsx("span",{className:"leading-4",children:r.formatMessage(Re.none)})})]},"none"),m.map(y=>{var _;const k=ge({name:y.name,email:y.email});return s.jsxs("button",{type:"button",onClick:()=>j(y.email),className:"hover:bg-token-bg-tertiary flex w-full items-center gap-2 rounded-sm px-2 py-1 text-start text-sm ".concat(y.id===p?"bg-token-bg-tertiary":""),children:[s.jsx("div",{className:"border-token-border-light bg-token-bg-primary inline-flex h-7 w-7 items-center justify-center rounded-full border text-[11px] font-semibold",children:k}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"leading-4",children:(_=y.name)!=null?_:y.email}),s.jsx("span",{className:"text-token-text-tertiary text-xs leading-4",children:y.email})]})]},y.id)})]})]})})}function Je({finding:t}){const e=U(),a=t.status,r=ve(),i=H(),[c,l]=F.useState(!1),[u,h]=F.useState(!1),[n,o]=F.useState(null),[f,g]=F.useState(""),v=async({id:m,hid:p,payload:d,onSuccess:A,onError:M,setIsSaving:j,intl:$,queryClient:R,toaster:L})=>{try{j(!0);const b=await new _e(we).patch("/aardvark/scan-findings/{id}",{path:{id:m},body:d,headers:Ne()});if(b.status!==200)throw be(b.status,b.data);ke(R,p,b.data),Me(R,p,b.data),L.successNeutral($.formatMessage({id:"aardvark.toast.statusUpdated",defaultMessage:"Status updated"}),{duration:5,hasCloseButton:!0}),A&&A(b.data)}catch(P){const b=P,y=$.formatMessage(je.statusUpdate,{details:b.message});L.danger(y),M&&M(b)}finally{j(!1)}},x=async m=>{if(m==="wontfix"||m==="fixed"||m==="duplicate"){o(m),h(!0);return}await v({id:t.id,hid:t.hid,payload:{version:t.version,status:m},setIsSaving:l,intl:e,queryClient:r,toaster:i})};return s.jsxs(s.Fragment,{children:[s.jsxs(I.Root,{value:a,onValueChange:x,disabled:c,children:[s.jsx(I.Trigger,{className:"border-token-border-light bg-token-bg-primary mr h-7 rounded-md border px-2 text-xs",children:s.jsxs("div",{className:"flex w-full items-center justify-between",children:[s.jsx("div",{className:"truncate",children:s.jsx(I.Value,{})}),s.jsx(I.Icon,{})]})}),s.jsx(I.Portal,{children:s.jsx(I.Content,{align:"start",className:"rounded-lg text-sm",children:Ve(Le,(m,p)=>s.jsx(I.Item,{value:p,children:e.formatMessage(m,{status:p})},p))})})]}),u&&s.jsx(Be,{testId:"modal-wontfix-reason",isOpen:!0,onClose:()=>{h(!1),g(""),o(null)},title:n==="fixed"?e.formatMessage({id:"aardvark.findings.fixed.title",defaultMessage:"Add PR link"}):n==="duplicate"?e.formatMessage({id:"aardvark.findings.duplicate.title",defaultMessage:"Mark as duplicate"}):e.formatMessage({id:"aardvark.findings.wontfix.title",defaultMessage:"Add reason"}),showCloseButton:!0,primaryButton:s.jsx(fe.Button,{title:n==="fixed"?e.formatMessage({id:"aardvark.findings.fixed.save",defaultMessage:"Save"}):e.formatMessage({id:"aardvark.findings.wontfix.save",defaultMessage:"Save"}),color:"primary",loading:c,onClick:async()=>{if(n){if(!f.trim()){i.danger(n==="fixed"?e.formatMessage({id:"aardvark.findings.fixed.required",defaultMessage:"Please paste a PR link"}):n==="duplicate"?e.formatMessage({id:"aardvark.findings.duplicate.required",defaultMessage:"Please paste a link to the original scan finding"}):e.formatMessage({id:"aardvark.findings.wontfix.required",defaultMessage:"Please enter a reason"}));return}await v({id:t.id,hid:t.hid,payload:{version:t.version,status:n,resolution_reason:f.trim()},setIsSaving:l,intl:e,queryClient:r,toaster:i,onSuccess:()=>{h(!1),g(""),o(null)}})}}}),secondaryButton:s.jsx(fe.Button,{title:n==="fixed"?e.formatMessage({id:"aardvark.findings.fixed.cancel",defaultMessage:"Cancel"}):e.formatMessage({id:"aardvark.findings.wontfix.cancel",defaultMessage:"Cancel"}),color:"secondary",onClick:()=>{h(!1),g(""),o(null)}}),children:s.jsxs("div",{className:"space-y-3",children:[s.jsx("div",{children:s.jsx("div",{className:"text-token-text-secondary mt-1 text-sm",children:n==="fixed"?e.formatMessage({id:"aardvark.findings.fixed.prompt",defaultMessage:"Which PR merged the fix? Paste the URL."}):n==="duplicate"?e.formatMessage({id:"aardvark.findings.duplicate.prompt",defaultMessage:"Which scan finding does this duplicate? Paste a link to the original finding."}):e.formatMessage({id:"aardvark.findings.wontfix.prompt",defaultMessage:"Why won't this be fixed?"})})}),s.jsx("div",{children:s.jsx("textarea",{value:f,onChange:m=>g(m.target.value),className:"border-token-border-default bg-token-bg-primary text-token-text-primary placeholder:text-token-text-tertiary w-full rounded-lg border p-3 text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none",placeholder:n==="fixed"?e.formatMessage({id:"aardvark.findings.fixed.placeholder",defaultMessage:"Paste PR URL (required)"}):n==="duplicate"?e.formatMessage({id:"aardvark.findings.duplicate.placeholder",defaultMessage:"Paste link (required)"}):e.formatMessage({id:"aardvark.findings.wontfix.placeholder",defaultMessage:"Add a short reason (required)"}),rows:5})})]})})]})}function O(t){return t.slice(0,7)}function Se(t){if(!t)return"";try{const e=new URL(t);if(e.pathname.endsWith(".git")&&(e.pathname=e.pathname.slice(0,-4)),e.hostname.includes("github.com")){const a=e.pathname.split("/").filter(Boolean);if(a.length>=2)return"".concat(a[0],"/").concat(a[1])}return e.hostname}catch(e){return t}}function Xe(t,e){if(!t)return null;try{const a=new URL(t.replace(/\.git$/,""));if(a.hostname.includes("github.com"))return"".concat(a.origin).concat(a.pathname,"/commit/").concat(e)}catch(a){}return null}function Ce(t){try{const e=typeof t=="string"?JSON.parse(t):t;if(e&&typeof e=="object"){const a=e,r={};return Array.isArray(a.relevant_lines)&&(r.relevant_lines=a.relevant_lines),typeof a.cvss_score=="number"&&(r.cvss_score=a.cvss_score),typeof a.criticality_cvss_reason=="string"&&(r.criticality_cvss_reason=a.criticality_cvss_reason),r}}catch(e){}return null}function q(t){if(!t)return"—";try{const e=new Date(t);return Number.isNaN(e.getTime())?"—":e.toLocaleString()}catch(e){return"—"}}function yt(t){if(typeof t!="number"||!Number.isFinite(t))return"—";try{const e=new Date(t*1e3);return Number.isNaN(e.getTime())?"—":e.toLocaleString()}catch(e){return"—"}}function Ze(t){if(!t)return null;const e=typeof t.path=="string"&&t.path.trim()||typeof t.file_path=="string"&&t.file_path.trim();return e?e.replace(/\\/g,"/"):null}function vt(t,e=3){var c,l,u,h;const a=[...(l=(c=t.commit_analysis)==null?void 0:c.relevant_lines)!=null?l:[]];if(!a.length){const n=Ce((h=(u=t.commit_analysis)==null?void 0:u.proposed_patch)!=null?h:null);n!=null&&n.relevant_lines&&a.push(...n.relevant_lines)}const r=new Map;for(const n of a){const o=Ze(n);if(!o)continue;const f=o.lastIndexOf("/");if(f<=0)continue;const g=o.slice(0,f);if(!g)continue;const v=g.toLowerCase(),x=r.get(v);x?x.count+=1:r.set(v,{label:g,count:1})}if(r.size===0)return[];const i=Array.from(r.values()).sort((n,o)=>o.count!==n.count?o.count-n.count:n.label.localeCompare(o.label));return i.slice(0,Math.max(e,0)||i.length).map(n=>n.label)}function _t(t){if(!t)return null;const e=t.trim();if(!e)return null;const a=new Date(e);return Number.isNaN(a.getTime())?null:a}function bt(t,e){if(!e)return null;const a=t.formatDate(e,{year:"numeric",month:"long",day:"numeric"}),r=t.formatTime(e,{hour:"numeric",minute:"2-digit"});return"".concat(a," ").concat(r)}function kt(t){if(!t)return null;const e=t.getTime()-Date.now(),a=Math.abs(e),r=60*1e3,i=60*r,c=24*i,l=7*c,u=30*c,h=365*c;let n,o;a>=h?(n="year",o=e/h):a>=u?(n="month",o=e/u):a>=l?(n="week",o=e/l):a>=c?(n="day",o=e/c):a>=i?(n="hour",o=e/i):a>=r?(n="minute",o=e/r):(n="second",o=e/1e3);let f=o>0?Math.floor(o):Math.ceil(o);return f===0&&(f=o<0?-1:1),{value:f,unit:n}}function D(t){return t===!0||t!=null&&(String(t).toLowerCase()==="true"||String(t).toLowerCase()==="yes")}function Ae(t){var l,u,h,n,o;const e=D((l=t.commit_analysis)==null?void 0:l.validated),a=D((u=t.commit_analysis)==null?void 0:u.proposed_patch_generated),r=D((h=t.commit_analysis)==null?void 0:h.attack_path_generated),i=D((n=t.commit_analysis)==null?void 0:n.privacy_related),c=D((o=t.commit_analysis)==null?void 0:o.security_related);return{isValidated:e,hasPatch:a,hasAttackPath:r,isPrivacyRelated:i,isSecurityRelated:c}}function Mt(t){var e;return(e=t.created_at)!=null?e:null}function jt(t){var e,a;return(a=(e=t.commit_analysis)==null?void 0:e.committer_date)!=null?a:null}function wt(t,e){return t?t.length<=e?t:t.slice(0,e-1)+"…":""}function E(t){if(t==null)return"";const e=String(t).trim();return e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1).trim():e}function et(t){return typeof t!="object"||t==null||!("role"in t)||!("output_items"in t)?!1:t.role==="assistant"&&Array.isArray(t.output_items)}function tt(t,e){const a=[];return e.isSecurityRelated&&a.push(t.formatMessage(C.security)),e.isPrivacyRelated&&a.push(t.formatMessage(C.privacy)),e.isValidated&&a.push(t.formatMessage(C.validated)),e.hasPatch&&a.push(t.formatMessage(C.patch)),e.hasAttackPath&&a.push(t.formatMessage(C.attackpath)),a.length===0?t.formatMessage({id:"aardvark.findings.clipboard.noSignals",defaultMessage:"None"}):a.join(", ")}function at(t){return typeof(t==null?void 0:t.path)=="string"&&t.path.trim()||typeof(t==null?void 0:t.file_path)=="string"&&t.file_path.trim()||""||"(unknown path)"}function st(t){var c,l,u,h;let e=(l=(c=t.commit_analysis)==null?void 0:c.relevant_lines)!=null?l:[];const a=Array.isArray(e)&&e.length>0,r=(u=t.commit_analysis)==null?void 0:u.proposed_patch;if(!a){const n=Ce(r);e=(h=n==null?void 0:n.relevant_lines)!=null?h:[]}const i=[];if(Array.isArray(e)&&e.length>0){const n=(()=>{var f,g,v,x;const o=new Map;for(const m of e){const p=at(m),d=(f=m.start_line_number)!=null?f:0,A=(v=(g=m.end_line_number)!=null?g:m.start_line_number)!=null?v:0,M="".concat(p,"|").concat(d,"-").concat(A),j=(x=o.get(M))!=null?x:[];j.push(m),o.set(M,j)}return Array.from(o.entries()).sort((m,p)=>m[0].localeCompare(p[0]))})();for(const[o,f]of n){const[g,v]=o.split("|"),x=(v!=null?v:"").replace("-"," to ");i.push("".concat(g," (L").concat(x,")"));for(const m of f)if(m.comment&&i.push("  Note: ".concat(m.comment)),m.content){const p=String(m.content).trimEnd().split("\n");for(const d of p)i.push("  ".concat(d))}i.push("")}}else typeof r=="string"&&r.trim().length>0&&i.push(r);return i.filter((n,o,f)=>!(n===""&&f[o-1]===""))}function rt(t){var c,l,u;const e=(c=t.proposed_patch)==null?void 0:c.latest_task;if(!e)return null;const a=et((l=e.codex_task_turn)==null?void 0:l.turn)?(u=e.codex_task_turn)==null?void 0:u.turn:null;if(!a)return null;const i=He({assistantTurn:a}).map(h=>{var n;return(n=h.hunksText)!=null?n:""}).filter(h=>h.trim().length>0).join("\n\n").trim();return i.length>0?i:null}function nt(t,e){var A,M,j,$,R,L,P,b,y,k,_,w,B,Q,Y,K,J,X,Z,ee,te,ae,se,re,ne,ie,oe,le;const a=[],r=typeof window<"u"&&window.location?window.location.href:null,i=Ae(t),c=(M=(A=t.commit_analysis)==null?void 0:A.commit_hash)!=null?M:"",l=[];(j=t.commit_analysis)!=null&&j.bugs_found_or_fixed&&l.push(($=t.commit_analysis)==null?void 0:$.bugs_found_or_fixed),(R=t.commit_analysis)!=null&&R.description&&l.push((L=t.commit_analysis)==null?void 0:L.description);const u=[((P=t.commit_analysis)==null?void 0:P.title)||"Finding",t.hid||t.id||""].filter(Boolean);a.push(u.join(" - ")),r&&a.push("Link: ".concat(r)),a.push("Criticality: ".concat((b=t.criticality)!=null?b:"unknown").concat((k=(y=t.commit_analysis)==null?void 0:y.attack_path_analysis)!=null&&k.adjusted_criticality_final?" (attack path: ".concat(t.commit_analysis.attack_path_analysis.adjusted_criticality_final,")"):"")),a.push("Status: ".concat((_=t.status)!=null?_:"unknown")),l.length>0&&(a.push(""),a.push("Summary:"),a.push(...l));const h=(w=t.commit_analysis)==null?void 0:w.cvss_score,n=(B=t.commit_analysis)==null?void 0:B.criticality_cvss_score_reason;(h!=null||n)&&(a.push(""),a.push("CVSS:"),h!=null&&a.push("Score: ".concat(h)),n&&a.push(n)),a.push(""),a.push("Metadata:"),a.push("Repo: ".concat(Se((Q=t.repo_url)!=null?Q:"")||"N/A")),a.push("Commit: ".concat(O(c)||"N/A")),a.push("Author: ".concat(E((Y=t.commit_analysis)==null?void 0:Y.author_email)||"N/A")),a.push("Created: ".concat(q(t.created_at)||"N/A"));const o=E(t.assignee_email)||E((K=t==null?void 0:t.assignee)==null?void 0:K.email),f=E((J=t==null?void 0:t.assignee)==null?void 0:J.name),g=f&&o?"".concat(f," <").concat(o,">"):f||o;a.push("Assignee: ".concat(g||"Unassigned")),a.push("Signals: ".concat(tt(e,i))),t.resolution_reason&&a.push("Resolution: ".concat(t.resolution_reason));const v=st(t);v.length>0&&(a.push(""),a.push("Relevant lines:"),a.push(...v));const x=((X=t.commit_analysis)==null?void 0:X.validation_report)||((Z=t==null?void 0:t.commit_analysis)==null?void 0:Z.validation_str),m=(ee=t.commit_analysis)==null?void 0:ee.validation_rubric;(m||x)&&(a.push(""),a.push("Validation:"),m&&(a.push("Rubric:"),a.push(m)),x&&(a.push("Report:"),a.push(String(x))));const p=rt(t);p?(a.push(""),a.push("Proposed patch:"),a.push(p)):t.proposed_patch&&(a.push(""),a.push("Proposed patch: (no diff available)"));const d=(te=t.commit_analysis)==null?void 0:te.attack_path_analysis;if(d){a.push(""),a.push("Attack-path analysis:");const ce=["Final: ".concat(d.adjusted_criticality_final||d.severity||d.original_severity||"unknown"),d.adjustment_decider?"Decider: ".concat(d.adjustment_decider):null,d.matrix_severity?"Matrix severity: ".concat(d.matrix_severity):null,d.policy_adjusted_criticality?"Policy adjusted: ".concat(d.policy_adjusted_criticality):null].filter(Boolean);if(ce.length>0&&a.push(ce.join(" | ")),d.adjustment_reason&&a.push("Rationale: ".concat(d.adjustment_reason)),d.likelihood||d.impact){const N=d.impact?"".concat((ae=d.impact.level)!=null?ae:"unknown").concat(d.impact.why?" - ".concat(d.impact.why):""):null,ue=d.likelihood?"".concat((se=d.likelihood.level)!=null?se:"unknown").concat(d.likelihood.why?" - ".concat(d.likelihood.why):""):null;ue&&a.push("Likelihood: ".concat(ue)),N&&a.push("Impact: ".concat(N))}const de=[...(re=d.assumptions)!=null?re:[],...(oe=(ie=(ne=d.facts)==null?void 0:ne.precondition)==null?void 0:ie.requires)!=null?oe:[]];if(de.length>0){a.push("Assumptions:");for(const N of de)a.push("- ".concat(N))}if((le=d.attack_path)!=null&&le.ascii&&(a.push("Path:"),a.push(d.attack_path.ascii)),d.narrative&&(a.push("Narrative:"),a.push(d.narrative)),d.evidence&&d.evidence.length>0){a.push("Evidence:");for(const N of d.evidence)a.push("- ".concat(N))}if(d.controls&&d.controls.length>0){a.push("Controls:");for(const N of d.controls)a.push("- ".concat(N))}if(d.blindspots&&d.blindspots.length>0){a.push("Blindspots:");for(const N of d.blindspots)a.push("- ".concat(N))}}return a.join("\n").trim()}function it({intl:t,signals:e,className:a,badgeSize:r="md",badgeVariants:i}){const{isSecurityRelated:c,isPrivacyRelated:l,isValidated:u,hasPatch:h,hasAttackPath:n}=e,o=(g,v)=>{var x;return(x=i==null?void 0:i[g])!=null?x:v};if(!c&&!l&&!u&&!h&&!n)return null;const f=["flex flex-wrap items-center gap-2",a].filter(Boolean).join(" ");return s.jsxs("div",{className:f,children:[c&&s.jsx(T,{variant:o("security","neutral"),size:r,children:t.formatMessage(C.security)}),l&&s.jsx(T,{variant:o("privacy","neutral"),size:r,children:t.formatMessage(C.privacy)}),u&&s.jsx(T,{variant:o("validated","neutral"),size:r,children:t.formatMessage(C.validated)}),h&&s.jsx(T,{variant:o("patch","neutral"),size:r,children:t.formatMessage(C.patch)}),n&&s.jsx(T,{variant:o("attackpath","neutral"),size:r,children:t.formatMessage(C.attackpath)})]})}function Nt({finding:t}){var n,o,f,g,v,x;const e=U(),a=H(),r=t,i=Ae(r),c=it({intl:e,signals:i}),l=(o=(n=r.commit_analysis)==null?void 0:n.commit_hash)!=null?o:"",u=Xe(r.repo_url,l),h="border-token-border-light hover:bg-token-bg-elevated-secondary inline-flex min-h-[3.25rem] w-full items-center justify-center rounded border px-3 py-2 text-center text-sm leading-tight";return s.jsxs(Qe,{title:e.formatMessage({id:"aardvark.findings.metadataTitle",defaultMessage:"Metadata"}),children:[s.jsxs("div",{className:"grid grid-cols-1 items-stretch gap-3 text-sm",children:[s.jsx(S,{label:e.formatMessage({id:"aardvark.table.repo",defaultMessage:"Repository"}),children:r.repo_url?s.jsx("a",{href:r.repo_url,target:"_blank",rel:"noopener noreferrer",className:"text-token-text-accent hover:underline",children:Se(r.repo_url)}):s.jsx("span",{className:"text-token-text-tertiary",children:e.formatMessage({id:"aardvark.findings.repo.na",defaultMessage:"N/A"})})}),s.jsx(S,{label:e.formatMessage({id:"aardvark.findings.commit",defaultMessage:"Commit"}),children:u?s.jsx("a",{href:u,target:"_blank",rel:"noopener noreferrer",className:"text-token-text-accent font-mono text-xs hover:underline",children:O(l)}):s.jsx("code",{className:"bg-token-bg-elevated-secondary rounded px-1 py-0.5 text-[10px]",children:O(l)})}),s.jsx(S,{label:e.formatMessage({id:"aardvark.findings.author",defaultMessage:"Author"}),children:s.jsxs("div",{className:"flex min-w-0 flex-col",children:[(()=>{var p;const m=E((p=r.commit_analysis)==null?void 0:p.author);return m?s.jsx("span",{className:"truncate",children:m}):s.jsx("span",{className:"text-token-text-tertiary",children:e.formatMessage({id:"aardvark.placeholder.missing",defaultMessage:"—"})})})(),(()=>{var p;const m=E((p=r.commit_analysis)==null?void 0:p.author_email);return m?s.jsx("span",{className:"text-token-text-tertiary font-mono text-xs break-all",children:m}):null})()]})}),s.jsx(S,{label:e.formatMessage({id:"aardvark.findings.authoredAt",defaultMessage:"Authored at"}),children:q((g=(f=r.commit_analysis)==null?void 0:f.author_date)!=null?g:null)}),s.jsx(S,{label:e.formatMessage({id:"aardvark.findings.committedAt",defaultMessage:"Committed at"}),children:q((x=(v=r.commit_analysis)==null?void 0:v.committer_date)!=null?x:null)}),s.jsx(S,{label:e.formatMessage({id:"aardvark.findings.createdAt",defaultMessage:"Detected at"}),children:q(r.created_at)}),s.jsx(S,{label:e.formatMessage({id:"aardvark.table.assignee",defaultMessage:"Assignee"}),children:s.jsx("div",{className:"min-w-[200px]",children:s.jsx(Ke,{finding:r})})}),s.jsx(S,{label:e.formatMessage({id:"aardvark.table.status",defaultMessage:"Status"}),children:s.jsx("div",{className:"min-w-[200px]",children:s.jsx(Je,{finding:r})})}),c?s.jsx(S,{label:e.formatMessage({id:"aardvark.findings.signals",defaultMessage:"Signals"}),children:c}):null,r.resolution_reason?s.jsx(S,{label:e.formatMessage({id:"aardvark.findings.resolutionReason",defaultMessage:"Resolution notes"}),children:s.jsxs("div",{className:"text-sm whitespace-pre-wrap",children:[r.resolution_reason,r.resolution_set_by_email?s.jsx("div",{className:"text-token-text-tertiary mt-1 text-xs",children:e.formatMessage({id:"aardvark.findings.resolutionSetBy",defaultMessage:"Set by {email}"},{email:r.resolution_set_by_email})}):null]})}):null]}),s.jsxs("div",{className:"mt-3 grid grid-cols-1 items-stretch gap-3 p-1 sm:grid-cols-3",children:[u&&s.jsx(ot,{commitUrlStr:u}),s.jsx(pe,{className:h,iconClassName:"icon-sm",buttonText:e.formatMessage({id:"aardvark.actions.share",defaultMessage:"Share link"}),onCopy:m=>{const p=typeof window<"u"&&window.location?"".concat(window.location.origin).concat(window.location.pathname):"";he(p,a,m),a.successNeutral(e.formatMessage({id:"aardvark.toast.linkCopied",defaultMessage:"Link copied"}),{duration:2})}}),s.jsx(pe,{className:h,iconClassName:"icon-sm",buttonText:e.formatMessage({id:"aardvark.actions.copyFinding",defaultMessage:"Copy this finding"}),onCopy:async m=>{try{const p=nt(r,e);await he(p,a,m),a.successNeutral(e.formatMessage({id:"aardvark.toast.findingCopied",defaultMessage:"Finding copied"}),{duration:2})}catch(p){}}})]})]})}function ot({commitUrlStr:t}){const e=U();return s.jsxs("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"border-token-border-light hover:bg-token-bg-elevated-secondary inline-flex min-h-[3.25rem] w-full items-center justify-center rounded border px-3 py-2 text-center text-sm leading-tight",children:[s.jsx(De,{className:"icon-sm me-1","aria-hidden":!0}),e.formatMessage({id:"aardvark.actions.openGithub",defaultMessage:"Open in GitHub"})]})}var W,xe;function lt(){if(xe)return W;xe=1;var t=Ue();function e(a,r){var i=[];return t(a,function(c,l,u){r(c,l,u)&&i.push(c)}),i}return W=e,W}var z,ye;function ct(){if(ye)return z;ye=1;var t=qe(),e=lt(),a=Ge(),r=We();function i(c,l){var u=r(c)?t:e;return u(c,a(l,3))}return z=i,z}var dt=ct();const St=$e(dt),ut={critical:"critical",high:"danger",medium:"purple",low:"warning"};function Ct(t){"use forget";const e=V.c(6),{level:a}=t,r=U(),i=ut[a];let c;e[0]!==r||e[1]!==a?(c=r.formatMessage(Pe[a]),e[0]=r,e[1]=a,e[2]=c):c=e[2];const l=c;let u;return e[3]!==l||e[4]!==i?(u=s.jsx(T,{variant:i,children:l}),e[3]=l,e[4]=i,e[5]=u):u=e[5],u}function At(t){"use forget";const e=V.c(2);if(!t)return;const a=String(t);let r;e[0]!==a?(r=a.toLowerCase(),e[0]=a,e[1]=r):r=e[1];const i=r;if(i==="critical"||i==="high"||i==="medium"||i==="low")return i;if(i==="ignore")return"low"}export{T as A,Nt as F,At as N,Qe as S,q as a,yt as b,Ct as c,_t as d,vt as e,St as f,Ae as g,jt as h,Mt as i,kt as j,bt as k,it as l,Je as m,Ke as n,Ce as p,Se as r,wt as t};
//# sourceMappingURL=4p7fk9xlp4aux1yu.js.map
