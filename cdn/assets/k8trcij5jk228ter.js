var j=Object.defineProperty,$=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var k=(o,t,s)=>t in o?j(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s,w=(o,t)=>{for(var s in t||(t={}))W.call(t,s)&&k(o,s,t[s]);if(R)for(var s of R(t))v.call(t,s)&&k(o,s,t[s]);return o},y=(o,t)=>$(o,B(t));import{a0 as K,e as z,i as Q,r as b,a as J,j as P,aa as I,f as V}from"./fg33krlcm0qyi6yw.js";import{kp as u,cI as X,ck as Y,b as Z,bR as ee,nX as te,R as h,ko as p,bq as ne,bt as se,a$ as oe,b3 as d,bx as ce,b1 as ae,qV as M,P as N,bm as U,qW as re,p as ie}from"./mtk1qztvnb31pw5r.js";import{h as ue}from"./k65njl5wlgspihfr.js";import{C as le}from"./ir7nzwbolrsm3ds2.js";const _e={OAUTH_SCOPES_MISMATCH:u.OAUTH_FAILED_SCOPE_MISMATCH,EMAIL_DOMAIN_CLAIMED_BY_ANOTHER_WORKSPACE:u.OAUTH_FAILED_EMAIL_DOMAIN_ENFORCEMENT},L=V({genericSuccess:{id:"connectorPlatformOauthRedirect.genericSuccess",defaultMessage:"{connector} is now connected"},slackAiAppSuccess:{id:"connectorPlatformOauthRedirect.slackAiAppSuccess",defaultMessage:"AI App for Slack is now installed"}}),Ce=K(function(){const t=z(),s=Z(),_=Q(),f=te("installations/select_target"),g=X(),H=Y(s),A=b.useRef(!1),{mutateAsync:x}=ee(),C=J();return b.useEffect(()=>{if(A.current===!0)return;A.current=!0;async function D(){var T,m,E,S;const O=ue()==="popup"||g,q=window.location.href;try{const e=await h.safePost("/aip/connectors/links/oauth/callback",{requestBody:{full_redirect_url:q}});if(await C.invalidateQueries({refetchType:"all",queryKey:["fetchConnectorLinkData"]}),!(e!=null&&e.post_auth_url)){_(p(u.OAUTH_FAILED_GENERIC));return}const n=new URL(e.post_auth_url,location.origin),r=((T=e==null?void 0:e.link)==null?void 0:T.connector_id)===ne[se.GITHUB_CONNECTOR],i=n.searchParams.get("github_onboarding")==="sync-repos";if(r&&i){const c=await h.safePost("/aip/connectors/github/search_repos",{requestBody:{query:"",limit:20,next_token:null,link_id:e.link.id}});if(!c||c.repos.length===0){window.open("".concat(f,"?state=").concat(encodeURIComponent(JSON.stringify({client_redirect_to:"".concat(window.location.origin,"/?github_onboarding=sync-repos")}))),"_self");return}}const l=oe(n.hash)===d.Connectors;if(!l){const c=ce[e.link.connector_id];c&&n.searchParams.set("add_source",c)}let a;if(l){const c=new URLSearchParams;c.set("connector",e.link.connector_id),r&&!i&&c.set("github_onboarding","configure-repos");const G=y(w({},n),{search:"",hash:ae(d.Connectors).hash+"?".concat(c.toString())});a=I(G)}else r&&!i&&n.searchParams.set("github_onboarding","configure-repos"),a=I({pathname:n.pathname,search:n.search,hash:n.hash});if(O){M({success:!0,connectorId:e.link.connector_id,linkId:e.link.id}),window.close();return}N.logEventWithStatsig("Connector OAuth Connect","chatgpt_connectors_oauth_connect_success",{success:!0,type:e.link.connector_id}),U.logOAuthCompleted({connector_id_metadata:U.createIdMetadataFromId(s,e.link.connector_id,"unknown_referrer"),referrer:"unknown_referrer",authType:"OAUTH",scopes:null,success:!0});const F=e.link.connector_id===re?t.formatMessage(L.slackAiAppSuccess):t.formatMessage(L.genericSuccess,{connector:e.link.name});_(p(u.CUSTOM_MSG,a,F))}catch(e){let n;try{const i=new URL(window.location.href),l=(m=i.searchParams.get("oauth_state_id"))!=null?m:i.searchParams.get("state");if(l){const a=await h.safeGet("/aip/connectors/links/oauth/state/{oauth_state_id}",{parameters:{path:{oauth_state_id:l}}});a!=null&&a.connector_id&&(n=a.connector_id)}}catch(i){}const r=e instanceof ie?(S=_e[(E=e.detail)==null?void 0:E.error_code])!=null?S:u.OAUTH_FAILED_GENERIC:u.OAUTH_FAILED_GENERIC;if(O){M({success:!1,connectorId:n!=null?n:"",errorType:r}),window.close();return}N.logEventWithStatsig("Connector OAuth Connect","chatgpt_connectors_oauth_connect_error",{errorType:r,success:!1,type:n!=null?n:"unknown"}),_(p(r,"#settings/".concat(d.Connectors)))}}D()},[s,g,f,t,_,H,x,C]),P.jsx("div",{className:"flex h-screen w-screen items-center justify-center",children:P.jsx(le,{size:36})})});export{Ce as default};
//# sourceMappingURL=k8trcij5jk228ter.js.map
