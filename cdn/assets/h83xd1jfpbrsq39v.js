var ae=Object.freeze,Ae=Object.defineProperty;var j=(n,s)=>ae(Ae(n,"raw",{value:ae(s||n.slice())}));import{r as h,j as e,e as be,M as o,F as ve,i as O,b as De,a0 as Le,a9 as Se}from"./fg33krlcm0qyi6yw.js";import{F as b,l as y,bv as Ee,T as U,u9 as Oe,ua as Re,hG as Fe,ub as Pe,uc as Be,c0 as Ue,py as Ve,d as $e,hP as Je,b as me,I as we,v as C,bg as ie,aY as He,x as We,ud as Ye,C as qe,a9 as le,ue as Qe,i8 as Ke,rv as Xe,ed as Ze}from"./mtk1qztvnb31pw5r.js";import{N as ze}from"./ce3hgmw4iyyhicud.js";import{ku as V,gQ as Te,da as Ge,jz as et,r as tt}from"./k65njl5wlgspihfr.js";import{I as st,a as nt}from"./cfhn0kk0x40cm0ng.js";import{G as at}from"./nn3g3bm9s41ua8hv.js";import{F as m,a as w,b as S,c as it,G as lt}from"./ibjz9c01f0uy7k53.js";const rt=h.memo(function({onSelectVersion:s,selectedVersion:t,currentVersion:l,gizmoVersions:i}){return e.jsx(ot,{selectedVersion:t,onSelectVersion:s,currentVersion:l,gizmoVersions:i})});var de;const dt=b.div(de||(de=j(["flex h-full w-full max-w-3xs flex-col overflow-y-scroll bg-token-sidebar-surface-primary px-2 py-6"])));function ot({onSelectVersion:n,selectedVersion:s,currentVersion:t,gizmoVersions:l}){const i=l==null?void 0:l.items.reduce((a,d)=>{const r=new Date(d.updated_at),c="".concat(r.getFullYear(),"-").concat(r.getMonth()+1,"-").concat(r.getDate());return a[c]||(a[c]=[]),a[c].push(d),a},{});return i?e.jsx(dt,{children:Object.keys(i).map((a,d)=>e.jsx(gt,{date:a,entries:i[a],selectedVersion:s,onSelectVersion:n,currentVersion:t},d))}):null}const pe=({name:n,userId:s,showName:t=!1})=>e.jsxs("div",{className:"flex items-center gap-1.5",children:[t&&e.jsx(U,{delayDuration:2e3,label:n,className:"text-token-text-secondary max-w-[100px] truncate text-xs",children:n}),e.jsx("div",{className:y("icon flex items-center justify-center rounded-full text-[8px] text-white",Re(s)),children:Oe(n)})]});var oe;const ut=b.div(oe||(oe=j(["flex w-full flex-col rounded-lg px-3 py-2 text-base hover:cursor-pointer hover:bg-token-sidebar-surface-tertiary"])));var ue;const ct=b.div(ue||(ue=j(["px-3 text-xs font-medium text-token-text-secondary"])));var ce;const xt=b.div(ce||(ce=j(["flex flex-col space-y-1"])));var xe;const ft=b.div(xe||(xe=j(["mb-8 flex flex-col space-y-2"])));function Ce(n,s){const t=new Date(s),l=new Date,i=new Date(l);i.setDate(l.getDate()-1);const a=n.locale||"en-US";return t.toDateString()===l.toDateString()?"Today":t.toDateString()===i.toDateString()?"Yesterday":new Intl.DateTimeFormat(a,{dateStyle:"medium"}).format(t)}const gt=({date:n,entries:s,onSelectVersion:t,selectedVersion:l,currentVersion:i})=>{const a=be(),d=r=>r===i;return e.jsxs(ft,{children:[e.jsx(ct,{children:Ce(a,n)}),e.jsx(xt,{children:s.map((r,c)=>e.jsx(jt,{item:r,isCurrentVersion:d,selectedVersion:l,onSelectVersion:t},c))})]})},jt=({item:n,isCurrentVersion:s,selectedVersion:t,onSelectVersion:l})=>{const[i,a]=h.useState(!1),{version:d,updated_at:r,author:c}=n;return e.jsx(ut,{className:y(t===d&&"bg-token-sidebar-surface-tertiary"),onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),onClick:()=>l(d),children:e.jsxs("div",{className:"flex w-full items-center justify-between",children:[e.jsx("div",{className:"text-base",children:s(d)?e.jsx(o,{id:"gizmo.version.current",defaultMessage:"Current version"}):e.jsx(ve,{value:r,timeStyle:"short"})}),e.jsx(Ee,{children:!s(d)&&c&&e.jsx(pe,{showName:t===d||i,name:c.user_name,userId:c.user_id})})]})})},ht=({gizmoId:n,version:s,skip:t=!1})=>De({queryFn:async()=>Ke.getVersion({gizmoId:n,version:s}),queryKey:["gizmo","version",{gizmoId:n,version:s}],enabled:!t}),re=(n,s)=>"/gpts/editor/".concat(n,"?version=").concat(s);var fe;const _e=b.div(fe||(fe=j(["flex h-screen w-full flex-col items-center"])));var ge;const Me=b.div(ge||(ge=j(["flex w-full grow overflow-hidden"])));var je;const Ne=b.div(je||(je=j(["flex h-full grow flex-wrap items-start justify-between gap-4 overflow-auto"])));var he;const Ie=b.div(he||(he=j(["sticky top-0 flex h-16 w-full items-center justify-between gap-2 border-b border-token-border-medium bg-token-main-surface-primary px-3 py-3"])));function yt({gizmoId:n}){var r,c,v;const{data:s,isLoading:t,refetch:l}=Fe(n),i=(r=s==null?void 0:s.gizmo)==null?void 0:r.current_user_permission,a=(c=i==null?void 0:i.can_write)!=null?c:!1,d=(v=i==null?void 0:i.can_view_config)!=null?v:!1;return!s||t?null:a?e.jsx(vt,{gizmoResource:s,refetchGizmo:l}):d?e.jsx(bt,{gizmoResource:s}):null}const ke=({children:n})=>{const s=O();return e.jsxs("div",{className:"flex cursor-pointer items-center gap-1.5",onClick:()=>s(-1),children:[e.jsx(Ve,{className:"icon"}),e.jsx("div",{children:n})]})},bt=({gizmoResource:n})=>{const s=O(),t=Be(),l=n.gizmo.id,i=async()=>{const a=await t.mutateAsync({gizmoId:l});a.gizmo.id&&s("/gpts/editor/".concat(a.gizmo.id))};return e.jsxs(_e,{children:[e.jsxs(Ie,{children:[e.jsx(ke,{children:e.jsx(o,{id:"gizmoReadOnly.configurationTitle",defaultMessage:"Configuration"})}),e.jsx("div",{className:"me-4 flex gap-2",children:e.jsx(V,{color:"secondary",loading:t.isPending,onClick:i,children:e.jsx(o,{id:"gizmo.readonly.duplicate",defaultMessage:"Duplicate"})})})]}),e.jsx(Me,{children:e.jsx(Ne,{children:e.jsx($,{displayGizmo:n})})})]})},vt=({gizmoResource:n,refetchGizmo:s})=>{const t=n.gizmo.id,{data:l,refetch:i}=Pe({gizmoId:t});h.useEffect(()=>{s(),i()},[s,i]);const a=n==null?void 0:n.gizmo.live_version;return a==null||!l?null:e.jsx(mt,{gizmoResource:n,currentVersion:a,gizmoVersions:l})};function mt({gizmoResource:n,currentVersion:s,gizmoVersions:t}){const l=O(),i=n.gizmo.id,[a,d]=h.useState(s),[r,c]=h.useState(!1),[v,p]=h.useState(!1),g=()=>{l(a?re(i,a):Qe(i))},R=()=>{if(a!==s&&n.tools.find(L=>{var M;return L.type===C.JIT_PLUGIN&&((M=L.metadata.auth)==null?void 0:M.type)!==Ye.None})){p(!0);return}l(re(i,a))},f=()=>{a===s&&s>1&&d(s-1),r&&d(s),c(!r)},N=s>1;h.useEffect(()=>{a===s&&c(!1)},[a,s]);const{data:_,isLoading:D}=ht({gizmoId:i,version:a});return e.jsxs(_e,{children:[e.jsxs(Ie,{children:[e.jsx(ke,{children:e.jsx(o,{id:"gizmoReadOnly.versionHistoryTitle",defaultMessage:"Version History"})}),e.jsxs("div",{className:"me-4 flex gap-2",children:[N&&e.jsx(U,{label:e.jsx(o,{id:"gizmo.readonly.compareTooltip",defaultMessage:"Compare to the previous version"}),disabled:!N||r,triggerAs:null,children:e.jsx(V,{color:r?"primary":"secondary",className:y("btn rounded-full border transition-colors",r?y(ze,"border-transparent"):"border-token-border-default hover:bg-token-surface-hover bg-transparent"),onClick:f,icon:r?st:nt,children:r?e.jsx(o,{id:"gizmo.readonly.comparing",defaultMessage:"Comparing changes"}):e.jsx(o,{id:"gizmo.readonly.compare",defaultMessage:"Compare changes"})})}),e.jsx(U,{label:e.jsx(o,{id:"gizmo.readonly.restoreVersionTooltip",defaultMessage:"You will be able to edit before publishing"}),disabled:a===s,triggerAs:null,children:e.jsx(V,{color:"secondary",disabled:a===s,icon:Te,onClick:R,children:e.jsx(o,{id:"gizmo.readonly.restoreVersion",defaultMessage:"Restore this version"})})})]})]}),e.jsxs(Me,{children:[e.jsx(rt,{selectedVersion:a,currentVersion:s,onSelectVersion:d,gizmoVersions:t}),D&&e.jsx("div",{className:"flex h-full w-full grow flex-col items-center justify-center",children:e.jsx(Ue,{})}),_&&e.jsxs(Ne,{children:[e.jsx($,{displayGizmo:_,isComparing:r,gizmoVersions:t}),r&&e.jsx($,{displayGizmo:n,compareToGizmo:_,setIsComparing:c,isComparing:!0,gizmoVersions:t})]})]}),v&&e.jsx(Ct,{onClose:()=>p(!1),onContinue:g})]})}const B=(n,s=[],t=[],l)=>n?[...t,...s.filter(l)]:s,E=(n,s)=>y(n&&s?"bg-blue-400/10":"bg-token-main-surface-secondary");function $({isComparing:n,displayGizmo:s,compareToGizmo:t,setIsComparing:l,gizmoVersions:i}){var H,W,Y,q,Q,K,X,Z,z,T,G,ee,te,se,ne;const a=me(),d=be(),r=$e(()=>Je(a,{isGizmo:!0})),c=(H=we(a))==null?void 0:H.hasPaidFeatures(),v=s.gizmo.default_model!==(t==null?void 0:t.gizmo.default_model),p=s.gizmo.display.name!==(t==null?void 0:t.gizmo.display.name),g=s.gizmo.display.description!==(t==null?void 0:t.gizmo.display.description),R=s.gizmo.instructions!==(t==null?void 0:t.gizmo.instructions),f=n&&!!t,N=B(f,(W=s.gizmo.display.prompt_starters)!=null?W:[],(Y=t==null?void 0:t.gizmo.display.prompt_starters)!=null?Y:[],u=>{var x;return!((x=t==null?void 0:t.gizmo.display.prompt_starters)!=null&&x.includes(u))}),_=B(f,(q=s.files)!=null?q:[],(Q=t==null?void 0:t.files)!=null?Q:[],u=>{var x;return!((x=t==null?void 0:t.files)!=null&&x.find(I=>I.id===u.id))}),D=B(f,(X=(K=s.tools)==null?void 0:K.filter(u=>u.type===C.JIT_PLUGIN))!=null?X:[],(z=(Z=t==null?void 0:t.tools)==null?void 0:Z.filter(u=>u.type===C.JIT_PLUGIN))!=null?z:[],u=>u.type===C.JIT_PLUGIN&&!(t!=null&&t.tools.find(x=>x.type===C.JIT_PLUGIN&&x.metadata.action_id===u.metadata.action_id))),L=s.gizmo.display.profile_picture_url!==(t==null?void 0:t.gizmo.display.profile_picture_url),M=(T=i==null?void 0:i.items.find(u=>u.version===s.gizmo.version))==null?void 0:T.author;return e.jsx(ie.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:10},transition:{duration:.2},className:y("relative flex min-w-0 flex-1 grow justify-center overflow-auto",f&&"border-s"),children:e.jsxs("div",{className:"flex w-full max-w-2xl flex-col px-4 py-8 text-sm",children:[e.jsxs(ie.div,{initial:{opacity:0},animate:{opacity:n?1:0},transition:{duration:n?.2:0},className:"mb-4 flex w-full items-center justify-between",children:[e.jsx("div",{className:"text-token-text-tertiary text-base",children:t?e.jsx(o,{id:"gizmo.readonly.currentVersion",defaultMessage:"Current"}):e.jsx(o,{id:"gizmo.readonly.previous",defaultMessage:"Previous"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.gizmo.version_updated_at&&e.jsx("div",{className:"text-token-text-tertiary text-xs",children:e.jsx(o,{id:"gizmo.readonly.updatedAt",defaultMessage:"{date} at {time}",values:{date:Ce(d,s.gizmo.version_updated_at),time:e.jsx(ve,{value:new Date(s.gizmo.version_updated_at),hour:"numeric",minute:"numeric"})}})}),M&&e.jsx(pe,{name:M.user_name,userId:M.user_id}),t&&l&&e.jsx(He,{onClick:()=>l(!1)})]})]}),e.jsx(m,{className:"self-center",children:e.jsx(Ge,{src:s.gizmo.display.profile_picture_url,isFirstParty:!1,className:y("h-20 w-20",L&&t&&"border-opacity-10 rounded-full border-4 border-blue-400"),showLoading:!0})}),e.jsxs(m,{children:[e.jsx(w,{label:e.jsx(o,{id:"gizmo.readonly.nameLabel",defaultMessage:"Name"})}),e.jsx(S,{type:"text",value:(G=s.gizmo.display.name)!=null?G:"",disabled:!0,className:E(f,p)})]}),e.jsxs(m,{children:[e.jsx(w,{label:e.jsx(o,{id:"gizmo.readonly.descriptionLabel",defaultMessage:"Description"})}),e.jsx(S,{type:"text",value:(ee=s.gizmo.display.description)!=null?ee:"",disabled:!0,className:E(f,g)})]}),e.jsxs(m,{children:[e.jsx(w,{label:e.jsx(o,{id:"gizmo.readonly.instructionsLabel",defaultMessage:"Instructions"})}),e.jsx(it,{rows:8,value:(te=s.gizmo.instructions)!=null?te:"",disabled:!0,className:y("resize-none",E(f,R))})]}),N.length>0&&e.jsxs(m,{children:[e.jsx(w,{label:e.jsx(o,{id:"gizmo.readonly.conversationStartersLabel",defaultMessage:"Conversation starters"})}),N.map((u,x)=>{var k,A;const I=!((k=t==null?void 0:t.gizmo.display.prompt_starters)!=null&&k.includes(u)),F=!((A=s.gizmo.display.prompt_starters)!=null&&A.includes(u));return e.jsx(S,{type:"text",value:u,disabled:!0,className:y("bg-token-main-surface-secondary mb-2 resize-none",J(f,I,F))},x)})]}),_.length>0&&e.jsxs(m,{children:[e.jsx(w,{label:e.jsx(o,{id:"gizmo.readonly.knowledgeLabel",defaultMessage:"Knowledge"})}),e.jsx("div",{className:"flex flex-wrap gap-1",children:_.map((u,x)=>{var k,A;const I=!((k=t==null?void 0:t.files)!=null&&k.find(P=>P.id===u.id)),F=!((A=s.files)!=null&&A.find(P=>P.id===u.id));return e.jsx(et,{file:u.name,fileId:u.id,className:J(f,I,F)},x)})})]}),e.jsxs(m,{children:[e.jsx(w,{label:e.jsx(o,{id:"gizmo.readonly.capabilitiesLabel",defaultMessage:"Capabilities"})}),e.jsx(at,{enabledTools:s.tools,diffedEnabledTools:t==null?void 0:t.tools,onEnabledToolsChange:We,noConnectorsAvailable:!1,isConnectorsLoading:!1})]}),c&&e.jsxs(m,{children:[e.jsx(w,{label:e.jsx(o,{id:"gizmo.readonly.recommendedModelLabel",defaultMessage:"Recommended Model"})}),e.jsx(S,{type:"text",value:s.gizmo.default_model?(ne=(se=r.models.get(s.gizmo.default_model))==null?void 0:se.title)!=null?ne:s.gizmo.default_model:d.formatMessage({id:"gizmoEditor.noneOption",defaultMessage:"No Recommended Model - Users will use any model they prefer"}),disabled:!0,className:E(f,v)})]}),!!D.length&&e.jsxs(m,{children:[e.jsx(w,{label:e.jsx(o,{id:"gizmo.readonly.actionsLabel",defaultMessage:"Actions"})}),e.jsx("div",{className:"flex flex-col gap-1",children:D.map((u,x)=>e.jsx(pt,{tool:u,isDiffed:f,compareToGizmo:t,displayGizmo:s},x))})]})]})})}var ye;const wt=b.textarea(ye||(ye=j(["mb-8 rounded-lg block h-96 w-full border-token-main-surface-tertiary bg-transparent p-2 font-mono text-xs text-token-text-primary"]))),pt=({tool:n,compareToGizmo:s,displayGizmo:t,isDiffed:l})=>{var v,p;const i=n,[a,d]=h.useState(!1),r=!((v=s==null?void 0:s.tools)!=null&&v.find(g=>g.type===C.JIT_PLUGIN&&g.metadata.action_id===i.metadata.action_id)),c=!t.tools.find(g=>g.type===C.JIT_PLUGIN&&g.metadata.action_id===i.metadata.action_id);return e.jsxs(e.Fragment,{children:[e.jsx(lt,{isDisabled:!1,actionTool:i,className:J(l,r,c),onShowActionsEditor:()=>d(g=>!g)}),a&&e.jsx(wt,{readOnly:!0,value:(p=i.metadata.raw_spec)!=null?p:""})]})},J=(n,s,t)=>y(n&&s&&"bg-blue-400/10!",n&&t&&"bg-blue-400/10! text-token-text-secondary line-through opacity-50");function Ct({onClose:n,onContinue:s}){const[t,l]=h.useState(!1);return e.jsx(qe,{testId:"modal-gizmo-auth-restore",isOpen:!0,onClose:n,type:"warning",showCloseButton:!0,title:e.jsx(o,{id:"gizmoReadOnly.authModalWarningTitle",defaultMessage:"Reset Authentication for Custom Actions"}),primaryButton:e.jsx(le,{onClick:()=>{l(!0),s()},loading:t,color:"secondary",children:e.jsx(o,{id:"gizmoReadOnly.authModalContinueButton",defaultMessage:"Continue"})}),secondaryButton:e.jsx(le,{onClick:n,color:"secondary",children:e.jsx(o,{id:"gizmoReadOnly.authModalCancelButton",defaultMessage:"Cancel"})}),size:"normal",children:e.jsx(o,{id:"gizmoReadOnly.authModalWarningBody",defaultMessage:"Restoring this version will reset authentication of your custom actions. You may need to reconfigure each custom action afterwards."})})}const St=()=>(tt(),null),Et=Le(function(){var r;const s=me(),t=we(s),l=O(),a=(r=Se().gizmoId)!=null?r:"",d=Xe(a);return h.useEffect(()=>{t!=null&&t.isFree()&&l("/")},[t,l]),h.useEffect(()=>{d&&Ze(d)&&l("/g/".concat(a,"/project"))},[d,l,a]),e.jsx(yt,{gizmoId:d})});export{St as clientLoader,Et as default};
//# sourceMappingURL=h83xd1jfpbrsq39v.js.map
